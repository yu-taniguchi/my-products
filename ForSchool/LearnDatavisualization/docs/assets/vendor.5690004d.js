/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var i9=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),r9=Object.prototype.hasOwnProperty;function Hm(e,t){return r9.call(e,t)}function Ym(e){if(Array.isArray(e)){for(var n=new Array(e.length),t=0;t<n.length;t++)n[t]=""+t;return n}if(Object.keys)return Object.keys(e);var n=[];for(var i in e)Hm(e,i)&&n.push(i);return n}function Hn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Vm(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Po(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function LA(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Xm(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Xm(e[t]))return!0}else if(typeof e=="object"){for(var i=Ym(e),r=i.length,t=0;t<r;t++)if(Xm(e[i[t]]))return!0}}return!1}function PA(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r!="undefined"&&n.push(i+": "+r)}return n.join(`
`)}var IA=function(e){i9(t,e);function t(n,i,r,s,o){var a=this.constructor,u=e.call(this,PA(n,{name:i,index:r,operation:s,tree:o}))||this;return u.name=i,u.index=r,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=PA(n,{name:i,index:r,operation:s,tree:o}),u}return t}(Error),et=IA,s9=Hn,ru={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=Id(n,this.path);i&&(i=Hn(i));var r=Io(n,{op:"remove",path:this.from}).removed;return Io(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=Id(n,this.from);return Io(n,{op:"add",path:this.path,value:Hn(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Ul(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},o9={add:function(e,t,n){return Vm(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:ru.move,copy:ru.copy,test:ru.test,_get:ru._get};function Id(e,t){if(t=="")return e;var n={op:"_get",path:t};return Io(e,n),n.value}function Io(e,t,n,i,r,s){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):zd(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Id(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Ul(e,t.value),o.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{i||(e=Hn(e));var a=t.path||"",u=a.split("/"),l=e,c=1,f=u.length,d=void 0,h=void 0,g=void 0;for(typeof n=="function"?g=n:g=zd;;){if(h=u[c],h&&h.indexOf("~")!=-1&&(h=LA(h)),r&&h=="__proto__")throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=u.slice(0,c).join("/"):c==f-1&&(d=t.path),d!==void 0&&g(t,0,e,d)),c++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!Vm(h))throw new et("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Vm(h)&&(h=~~h)}if(c>=f){if(n&&t.op==="add"&&h>l.length)throw new et("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=o9[t.op].call(t,l,h,e);if(o.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(c>=f){var o=ru[t.op].call(t,l,h,e);if(o.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&c<f&&(!l||typeof l!="object"))throw new et("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Bd(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=Hn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Io(e,t[o],n,!0,r,o),e=s[o].newDocument;return s.newDocument=e,s}function a9(e,t,n){var i=Io(e,t);if(i.test===!1)throw new et("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function zd(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new et("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ru[e.op]){if(typeof e.path!="string")throw new et("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new et('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new et("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Xm(e.value))throw new et("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new et("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new et("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=BA([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new et("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new et("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function BA(e,t,n){try{if(!Array.isArray(e))throw new et("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Bd(Hn(t),Hn(e),n||!0);else{n=n||zd;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof et)return r;throw r}}function Ul(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,s,o;if(n&&i){if(s=e.length,s!=t.length)return!1;for(r=s;r--!=0;)if(!Ul(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(r=s;r--!=0;)if(!t.hasOwnProperty(a[r]))return!1;for(r=s;r--!=0;)if(o=a[r],!Ul(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var u9=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",JsonPatchError:et,deepClone:s9,getValueByPointer:Id,applyOperation:Io,applyPatch:Bd,applyReducer:a9,validator:zd,validate:BA,_areEquals:Ul});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var Km=new WeakMap,l9=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),c9=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function f9(e){return Km.get(e)}function d9(e,t){return e.observers.get(t)}function h9(e,t){e.observers.delete(t.callback)}function g9(e,t){t.unobserve()}function p9(e,t){var n=[],i,r=f9(e);if(!r)r=new l9(e),Km.set(e,r);else{var s=d9(r,t);i=s&&s.observer}if(i)return i;if(i={},r.value=Hn(e),t){i.callback=t,i.next=null;var o=function(){Jm(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=e,i.unobserve=function(){Jm(i),clearTimeout(i.next),h9(r,i),typeof window!="undefined"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new c9(t,i)),i}function Jm(e,t){t===void 0&&(t=!1);var n=Km.get(e.object);Qm(n.value,e.object,e.patches,"",t),e.patches.length&&Bd(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Qm(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Ym(t),o=Ym(e),a=!1,u=o.length-1;u>=0;u--){var l=o[u],c=e[l];if(Hm(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?Qm(c,f,n,i+"/"+Po(l),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+Po(l),value:Hn(c)}),n.push({op:"replace",path:i+"/"+Po(l),value:Hn(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Po(l),value:Hn(c)}),n.push({op:"remove",path:i+"/"+Po(l)}),a=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var l=s[u];!Hm(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+Po(l),value:Hn(t[l])})}}}function m9(e,t,n){n===void 0&&(n=!1);var i=[];return Qm(e,t,i,"",n),i}var y9=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",unobserve:g9,observe:p9,generate:Jm,compare:m9});Object.assign({},u9,y9,{JsonPatchError:IA,deepClone:Hn,escapePathComponent:Po,unescapePathComponent:LA});var v9=/("(?:[^\\"]|\\.)*")|[:,]/g,Zm=function(t,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,u,l){var c,f,d,h,g,p,m,y,v,b,x,E;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),x=JSON.stringify(a,s),x===void 0)return x;if(m=r-u.length-l,x.length<=m&&(v=x.replace(v9,function(_,w){return w||_+" "}),v.length<=m))return v;if(s!=null&&(a=JSON.parse(x),s=void 0),typeof a=="object"&&a!==null){if(y=u+i,d=[],f=0,Array.isArray(a))for(b="[",c="]",m=a.length;f<m;f++)d.push(o(a[f],y,f===m-1?0:1)||"null");else for(b="{",c="}",p=Object.keys(a),m=p.length;f<m;f++)h=p[f],g=JSON.stringify(h)+": ",E=o(a[h],y,g.length+(f===m-1?0:1)),E!==void 0&&d.push(g+E);if(d.length>0)return[b,i+d.join(`,
`+y),c].join(`
`+u)}return x}(t,"",0)},As={exports:{}};const b9="2.0.0",x9=256,w9=Number.MAX_SAFE_INTEGER||9007199254740991,E9=16;var Ud={SEMVER_SPEC_VERSION:b9,MAX_LENGTH:x9,MAX_SAFE_INTEGER:w9,MAX_SAFE_COMPONENT_LENGTH:E9};const _9=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var qd=_9;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=Ud,i=qd;t=e.exports={};const r=t.re=[],s=t.src=[],o=t.t={};let a=0;const u=(l,c,f)=>{const d=a++;i(d,c),o[l]=d,s[d]=c,r[d]=new RegExp(c,f?"g":void 0)};u("NUMERICIDENTIFIER","0|[1-9]\\d*"),u("NUMERICIDENTIFIERLOOSE","[0-9]+"),u("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),u("MAINVERSION",`(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})\\.(${s[o.NUMERICIDENTIFIER]})`),u("MAINVERSIONLOOSE",`(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})\\.(${s[o.NUMERICIDENTIFIERLOOSE]})`),u("PRERELEASEIDENTIFIER",`(?:${s[o.NUMERICIDENTIFIER]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASEIDENTIFIERLOOSE",`(?:${s[o.NUMERICIDENTIFIERLOOSE]}|${s[o.NONNUMERICIDENTIFIER]})`),u("PRERELEASE",`(?:-(${s[o.PRERELEASEIDENTIFIER]}(?:\\.${s[o.PRERELEASEIDENTIFIER]})*))`),u("PRERELEASELOOSE",`(?:-?(${s[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${s[o.PRERELEASEIDENTIFIERLOOSE]})*))`),u("BUILDIDENTIFIER","[0-9A-Za-z-]+"),u("BUILD",`(?:\\+(${s[o.BUILDIDENTIFIER]}(?:\\.${s[o.BUILDIDENTIFIER]})*))`),u("FULLPLAIN",`v?${s[o.MAINVERSION]}${s[o.PRERELEASE]}?${s[o.BUILD]}?`),u("FULL",`^${s[o.FULLPLAIN]}$`),u("LOOSEPLAIN",`[v=\\s]*${s[o.MAINVERSIONLOOSE]}${s[o.PRERELEASELOOSE]}?${s[o.BUILD]}?`),u("LOOSE",`^${s[o.LOOSEPLAIN]}$`),u("GTLT","((?:<|>)?=?)"),u("XRANGEIDENTIFIERLOOSE",`${s[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),u("XRANGEIDENTIFIER",`${s[o.NUMERICIDENTIFIER]}|x|X|\\*`),u("XRANGEPLAIN",`[v=\\s]*(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:\\.(${s[o.XRANGEIDENTIFIER]})(?:${s[o.PRERELEASE]})?${s[o.BUILD]}?)?)?`),u("XRANGEPLAINLOOSE",`[v=\\s]*(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${s[o.XRANGEIDENTIFIERLOOSE]})(?:${s[o.PRERELEASELOOSE]})?${s[o.BUILD]}?)?)?`),u("XRANGE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAIN]}$`),u("XRANGELOOSE",`^${s[o.GTLT]}\\s*${s[o.XRANGEPLAINLOOSE]}$`),u("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),u("COERCERTL",s[o.COERCE],!0),u("LONETILDE","(?:~>?)"),u("TILDETRIM",`(\\s*)${s[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",u("TILDE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAIN]}$`),u("TILDELOOSE",`^${s[o.LONETILDE]}${s[o.XRANGEPLAINLOOSE]}$`),u("LONECARET","(?:\\^)"),u("CARETTRIM",`(\\s*)${s[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",u("CARET",`^${s[o.LONECARET]}${s[o.XRANGEPLAIN]}$`),u("CARETLOOSE",`^${s[o.LONECARET]}${s[o.XRANGEPLAINLOOSE]}$`),u("COMPARATORLOOSE",`^${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]})$|^$`),u("COMPARATOR",`^${s[o.GTLT]}\\s*(${s[o.FULLPLAIN]})$|^$`),u("COMPARATORTRIM",`(\\s*)${s[o.GTLT]}\\s*(${s[o.LOOSEPLAIN]}|${s[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",u("HYPHENRANGE",`^\\s*(${s[o.XRANGEPLAIN]})\\s+-\\s+(${s[o.XRANGEPLAIN]})\\s*$`),u("HYPHENRANGELOOSE",`^\\s*(${s[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${s[o.XRANGEPLAINLOOSE]})\\s*$`),u("STAR","(<|>)?=?\\s*\\*"),u("GTE0","^\\s*>=\\s*0.0.0\\s*$"),u("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")})(As,As.exports);const A9=["includePrerelease","loose","rtl"],O9=e=>e?typeof e!="object"?{loose:!0}:A9.filter(t=>e[t]).reduce((t,n)=>(t[n]=!0,t),{}):{};var Wd=O9;const zA=/^[0-9]+$/,UA=(e,t)=>{const n=zA.test(e),i=zA.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},S9=(e,t)=>UA(t,e);var e1={compareIdentifiers:UA,rcompareIdentifiers:S9};const Gd=qd,{MAX_LENGTH:qA,MAX_SAFE_INTEGER:Hd}=Ud,{re:WA,t:GA}=As.exports,C9=Wd,{compareIdentifiers:ql}=e1;class Oi{constructor(t,n){if(n=C9(n),t instanceof Oi){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid Version: ${t}`);if(t.length>qA)throw new TypeError(`version is longer than ${qA} characters`);Gd("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const i=t.trim().match(n.loose?WA[GA.LOOSE]:WA[GA.FULL]);if(!i)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Hd||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Hd||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Hd||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const s=+r;if(s>=0&&s<Hd)return s}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Gd("SemVer.compare",this.version,this.options,t),!(t instanceof Oi)){if(typeof t=="string"&&t===this.version)return 0;t=new Oi(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof Oi||(t=new Oi(t,this.options)),ql(this.major,t.major)||ql(this.minor,t.minor)||ql(this.patch,t.patch)}comparePre(t){if(t instanceof Oi||(t=new Oi(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const i=this.prerelease[n],r=t.prerelease[n];if(Gd("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return ql(i,r)}while(++n)}compareBuild(t){t instanceof Oi||(t=new Oi(t,this.options));let n=0;do{const i=this.build[n],r=t.build[n];if(Gd("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return ql(i,r)}while(++n)}inc(t,n){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n),this.inc("pre",n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n),this.inc("pre",n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}n&&(this.prerelease[0]===n?isNaN(this.prerelease[1])&&(this.prerelease=[n,0]):this.prerelease=[n,0]);break;default:throw new Error(`invalid increment argument: ${t}`)}return this.format(),this.raw=this.version,this}}var on=Oi;const{MAX_LENGTH:$9}=Ud,{re:HA,t:YA}=As.exports,VA=on,F9=Wd,k9=(e,t)=>{if(t=F9(t),e instanceof VA)return e;if(typeof e!="string"||e.length>$9||!(t.loose?HA[YA.LOOSE]:HA[YA.FULL]).test(e))return null;try{return new VA(e,t)}catch{return null}};var su=k9;const D9=su,M9=(e,t)=>{const n=D9(e,t);return n?n.version:null};var T9=M9;const N9=su,R9=(e,t)=>{const n=N9(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var j9=R9;const L9=on,P9=(e,t,n,i)=>{typeof n=="string"&&(i=n,n=void 0);try{return new L9(e,n).inc(t,i).version}catch{return null}};var I9=P9;const XA=on,B9=(e,t,n)=>new XA(e,n).compare(new XA(t,n));var Si=B9;const z9=Si,U9=(e,t,n)=>z9(e,t,n)===0;var t1=U9;const KA=su,q9=t1,W9=(e,t)=>{if(q9(e,t))return null;{const n=KA(e),i=KA(t),r=n.prerelease.length||i.prerelease.length,s=r?"pre":"",o=r?"prerelease":"";for(const a in n)if((a==="major"||a==="minor"||a==="patch")&&n[a]!==i[a])return s+a;return o}};var G9=W9;const H9=on,Y9=(e,t)=>new H9(e,t).major;var V9=Y9;const X9=on,K9=(e,t)=>new X9(e,t).minor;var J9=K9;const Q9=on,Z9=(e,t)=>new Q9(e,t).patch;var e7=Z9;const t7=su,n7=(e,t)=>{const n=t7(e,t);return n&&n.prerelease.length?n.prerelease:null};var i7=n7;const r7=Si,s7=(e,t,n)=>r7(t,e,n);var o7=s7;const a7=Si,u7=(e,t)=>a7(e,t,!0);var l7=u7;const JA=on,c7=(e,t,n)=>{const i=new JA(e,n),r=new JA(t,n);return i.compare(r)||i.compareBuild(r)};var n1=c7;const f7=n1,d7=(e,t)=>e.sort((n,i)=>f7(n,i,t));var h7=d7;const g7=n1,p7=(e,t)=>e.sort((n,i)=>g7(i,n,t));var m7=p7;const y7=Si,v7=(e,t,n)=>y7(e,t,n)>0;var Yd=v7;const b7=Si,x7=(e,t,n)=>b7(e,t,n)<0;var i1=x7;const w7=Si,E7=(e,t,n)=>w7(e,t,n)!==0;var QA=E7;const _7=Si,A7=(e,t,n)=>_7(e,t,n)>=0;var r1=A7;const O7=Si,S7=(e,t,n)=>O7(e,t,n)<=0;var s1=S7;const C7=t1,$7=QA,F7=Yd,k7=r1,D7=i1,M7=s1,T7=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return C7(e,n,i);case"!=":return $7(e,n,i);case">":return F7(e,n,i);case">=":return k7(e,n,i);case"<":return D7(e,n,i);case"<=":return M7(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var ZA=T7;const N7=on,R7=su,{re:Vd,t:Xd}=As.exports,j7=(e,t)=>{if(e instanceof N7)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(Vd[Xd.COERCE]);else{let i;for(;(i=Vd[Xd.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||i.index+i[0].length!==n.index+n[0].length)&&(n=i),Vd[Xd.COERCERTL].lastIndex=i.index+i[1].length+i[2].length;Vd[Xd.COERCERTL].lastIndex=-1}return n===null?null:R7(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var L7=j7,P7=Se;Se.Node=Bo;Se.create=Se;function Se(e){var t=this;if(t instanceof Se||(t=new Se),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(r){t.push(r)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}Se.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};Se.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};Se.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};Se.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)B7(this,arguments[e]);return this.length};Se.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)z7(this,arguments[e]);return this.length};Se.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};Se.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};Se.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,i=0;n!==null;i++)e.call(t,n.value,i,this),n=n.next};Se.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,i=this.length-1;n!==null;i--)e.call(t,n.value,i,this),n=n.prev};Se.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};Se.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};Se.prototype.map=function(e,t){t=t||this;for(var n=new Se,i=this.head;i!==null;)n.push(e.call(t,i.value,this)),i=i.next;return n};Se.prototype.mapReverse=function(e,t){t=t||this;for(var n=new Se,i=this.tail;i!==null;)n.push(e.call(t,i.value,this)),i=i.prev;return n};Se.prototype.reduce=function(e,t){var n,i=this.head;if(arguments.length>1)n=t;else if(this.head)i=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)n=e(n,i.value,r),i=i.next;return n};Se.prototype.reduceReverse=function(e,t){var n,i=this.tail;if(arguments.length>1)n=t;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)n=e(n,i.value,r),i=i.prev;return n};Se.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};Se.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};Se.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new Se;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(;r!==null&&i<t;i++,r=r.next)n.push(r.value);return n};Se.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new Se;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,r=this.tail;r!==null&&i>t;i--)r=r.prev;for(;r!==null&&i>e;i--,r=r.prev)n.push(r.value);return n};Se.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(var s=[],i=0;r&&i<t;i++)s.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<n.length;i++)r=I7(this,r,n[i]);return s};Se.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=t,this.tail=e,this};function I7(e,t,n){var i=t===e.head?new Bo(n,null,t,e):new Bo(n,t,t.next,e);return i.next===null&&(e.tail=i),i.prev===null&&(e.head=i),e.length++,i}function B7(e,t){e.tail=new Bo(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function z7(e,t){e.head=new Bo(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Bo(e,t,n,i){if(!(this instanceof Bo))return new Bo(e,t,n,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{require("./iterator.js")(Se)}catch{}const U7=P7,zo=Symbol("max"),qr=Symbol("length"),ou=Symbol("lengthCalculator"),Wl=Symbol("allowStale"),Uo=Symbol("maxAge"),Wr=Symbol("dispose"),eO=Symbol("noDisposeOnSet"),_t=Symbol("lruList"),Ci=Symbol("cache"),tO=Symbol("updateAgeOnGet"),o1=()=>1;class q7{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[zo]=t.max||1/0;const n=t.length||o1;if(this[ou]=typeof n!="function"?o1:n,this[Wl]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[Uo]=t.maxAge||0,this[Wr]=t.dispose,this[eO]=t.noDisposeOnSet||!1,this[tO]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[zo]=t||1/0,Gl(this)}get max(){return this[zo]}set allowStale(t){this[Wl]=!!t}get allowStale(){return this[Wl]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[Uo]=t,Gl(this)}get maxAge(){return this[Uo]}set lengthCalculator(t){typeof t!="function"&&(t=o1),t!==this[ou]&&(this[ou]=t,this[qr]=0,this[_t].forEach(n=>{n.length=this[ou](n.value,n.key),this[qr]+=n.length})),Gl(this)}get lengthCalculator(){return this[ou]}get length(){return this[qr]}get itemCount(){return this[_t].length}rforEach(t,n){n=n||this;for(let i=this[_t].tail;i!==null;){const r=i.prev;nO(this,t,i,n),i=r}}forEach(t,n){n=n||this;for(let i=this[_t].head;i!==null;){const r=i.next;nO(this,t,i,n),i=r}}keys(){return this[_t].toArray().map(t=>t.key)}values(){return this[_t].toArray().map(t=>t.value)}reset(){this[Wr]&&this[_t]&&this[_t].length&&this[_t].forEach(t=>this[Wr](t.key,t.value)),this[Ci]=new Map,this[_t]=new U7,this[qr]=0}dump(){return this[_t].map(t=>Kd(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[_t]}set(t,n,i){if(i=i||this[Uo],i&&typeof i!="number")throw new TypeError("maxAge must be a number");const r=i?Date.now():0,s=this[ou](n,t);if(this[Ci].has(t)){if(s>this[zo])return au(this,this[Ci].get(t)),!1;const u=this[Ci].get(t).value;return this[Wr]&&(this[eO]||this[Wr](t,u.value)),u.now=r,u.maxAge=i,u.value=n,this[qr]+=s-u.length,u.length=s,this.get(t),Gl(this),!0}const o=new W7(t,n,s,r,i);return o.length>this[zo]?(this[Wr]&&this[Wr](t,n),!1):(this[qr]+=o.length,this[_t].unshift(o),this[Ci].set(t,this[_t].head),Gl(this),!0)}has(t){if(!this[Ci].has(t))return!1;const n=this[Ci].get(t).value;return!Kd(this,n)}get(t){return a1(this,t,!0)}peek(t){return a1(this,t,!1)}pop(){const t=this[_t].tail;return t?(au(this,t),t.value):null}del(t){au(this,this[Ci].get(t))}load(t){this.reset();const n=Date.now();for(let i=t.length-1;i>=0;i--){const r=t[i],s=r.e||0;if(s===0)this.set(r.k,r.v);else{const o=s-n;o>0&&this.set(r.k,r.v,o)}}}prune(){this[Ci].forEach((t,n)=>a1(this,n,!1))}}const a1=(e,t,n)=>{const i=e[Ci].get(t);if(i){const r=i.value;if(Kd(e,r)){if(au(e,i),!e[Wl])return}else n&&(e[tO]&&(i.value.now=Date.now()),e[_t].unshiftNode(i));return r.value}},Kd=(e,t)=>{if(!t||!t.maxAge&&!e[Uo])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Uo]&&n>e[Uo]},Gl=e=>{if(e[qr]>e[zo])for(let t=e[_t].tail;e[qr]>e[zo]&&t!==null;){const n=t.prev;au(e,t),t=n}},au=(e,t)=>{if(t){const n=t.value;e[Wr]&&e[Wr](n.key,n.value),e[qr]-=n.length,e[Ci].delete(n.key),e[_t].removeNode(t)}};class W7{constructor(t,n,i,r,s){this.key=t,this.value=n,this.length=i,this.now=r,this.maxAge=s||0}}const nO=(e,t,n,i)=>{let r=n.value;Kd(e,r)&&(au(e,n),e[Wl]||(r=void 0)),r&&t.call(i,r.value,r.key,e)};var G7=q7;class Hl{constructor(t,n){if(n=Y7(n),t instanceof Hl)return t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease?t:new Hl(t.raw,n);if(t instanceof u1)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map(i=>this.parseRange(i.trim())).filter(i=>i.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${t}`);if(this.set.length>1){const i=this.set[0];if(this.set=this.set.filter(r=>!rO(r[0])),this.set.length===0)this.set=[i];else if(this.set.length>1){for(const r of this.set)if(r.length===1&&Q7(r[0])){this.set=[r];break}}}this.format()}format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){t=t.trim();const i=`parseRange:${Object.keys(this.options).join(",")}:${t}`,r=iO.get(i);if(r)return r;const s=this.options.loose,o=s?Bt[Mt.HYPHENRANGELOOSE]:Bt[Mt.HYPHENRANGE];t=t.replace(o,uL(this.options.includePrerelease)),at("hyphen replace",t),t=t.replace(Bt[Mt.COMPARATORTRIM],X7),at("comparator trim",t,Bt[Mt.COMPARATORTRIM]),t=t.replace(Bt[Mt.TILDETRIM],K7),t=t.replace(Bt[Mt.CARETTRIM],J7),t=t.split(/\s+/).join(" ");const a=s?Bt[Mt.COMPARATORLOOSE]:Bt[Mt.COMPARATOR],u=t.split(" ").map(f=>Z7(f,this.options)).join(" ").split(/\s+/).map(f=>aL(f,this.options)).filter(this.options.loose?f=>!!f.match(a):()=>!0).map(f=>new u1(f,this.options));u.length;const l=new Map;for(const f of u){if(rO(f))return[f];l.set(f.value,f)}l.size>1&&l.has("")&&l.delete("");const c=[...l.values()];return iO.set(i,c),c}intersects(t,n){if(!(t instanceof Hl))throw new TypeError("a Range is required");return this.set.some(i=>sO(i,n)&&t.set.some(r=>sO(r,n)&&i.every(s=>r.every(o=>s.intersects(o,n)))))}test(t){if(!t)return!1;if(typeof t=="string")try{t=new V7(t,this.options)}catch{return!1}for(let n=0;n<this.set.length;n++)if(lL(this.set[n],t,this.options))return!0;return!1}}var $i=Hl;const H7=G7,iO=new H7({max:1e3}),Y7=Wd,u1=Qd,at=qd,V7=on,{re:Bt,t:Mt,comparatorTrimReplace:X7,tildeTrimReplace:K7,caretTrimReplace:J7}=As.exports,rO=e=>e.value==="<0.0.0-0",Q7=e=>e.value==="",sO=(e,t)=>{let n=!0;const i=e.slice();let r=i.pop();for(;n&&i.length;)n=i.every(s=>r.intersects(s,t)),r=i.pop();return n},Z7=(e,t)=>(at("comp",e,t),e=nL(e,t),at("caret",e),e=eL(e,t),at("tildes",e),e=rL(e,t),at("xrange",e),e=oL(e,t),at("stars",e),e),an=e=>!e||e.toLowerCase()==="x"||e==="*",eL=(e,t)=>e.trim().split(/\s+/).map(n=>tL(n,t)).join(" "),tL=(e,t)=>{const n=t.loose?Bt[Mt.TILDELOOSE]:Bt[Mt.TILDE];return e.replace(n,(i,r,s,o,a)=>{at("tilde",e,i,r,s,o,a);let u;return an(r)?u="":an(s)?u=`>=${r}.0.0 <${+r+1}.0.0-0`:an(o)?u=`>=${r}.${s}.0 <${r}.${+s+1}.0-0`:a?(at("replaceTilde pr",a),u=`>=${r}.${s}.${o}-${a} <${r}.${+s+1}.0-0`):u=`>=${r}.${s}.${o} <${r}.${+s+1}.0-0`,at("tilde return",u),u})},nL=(e,t)=>e.trim().split(/\s+/).map(n=>iL(n,t)).join(" "),iL=(e,t)=>{at("caret",e,t);const n=t.loose?Bt[Mt.CARETLOOSE]:Bt[Mt.CARET],i=t.includePrerelease?"-0":"";return e.replace(n,(r,s,o,a,u)=>{at("caret",e,r,s,o,a,u);let l;return an(s)?l="":an(o)?l=`>=${s}.0.0${i} <${+s+1}.0.0-0`:an(a)?s==="0"?l=`>=${s}.${o}.0${i} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.0${i} <${+s+1}.0.0-0`:u?(at("replaceCaret pr",u),s==="0"?o==="0"?l=`>=${s}.${o}.${a}-${u} <${s}.${o}.${+a+1}-0`:l=`>=${s}.${o}.${a}-${u} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.${a}-${u} <${+s+1}.0.0-0`):(at("no pr"),s==="0"?o==="0"?l=`>=${s}.${o}.${a}${i} <${s}.${o}.${+a+1}-0`:l=`>=${s}.${o}.${a}${i} <${s}.${+o+1}.0-0`:l=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),at("caret return",l),l})},rL=(e,t)=>(at("replaceXRanges",e,t),e.split(/\s+/).map(n=>sL(n,t)).join(" ")),sL=(e,t)=>{e=e.trim();const n=t.loose?Bt[Mt.XRANGELOOSE]:Bt[Mt.XRANGE];return e.replace(n,(i,r,s,o,a,u)=>{at("xRange",e,i,r,s,o,a,u);const l=an(s),c=l||an(o),f=c||an(a),d=f;return r==="="&&d&&(r=""),u=t.includePrerelease?"-0":"",l?r===">"||r==="<"?i="<0.0.0-0":i="*":r&&d?(c&&(o=0),a=0,r===">"?(r=">=",c?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):r==="<="&&(r="<",c?s=+s+1:o=+o+1),r==="<"&&(u="-0"),i=`${r+s}.${o}.${a}${u}`):c?i=`>=${s}.0.0${u} <${+s+1}.0.0-0`:f&&(i=`>=${s}.${o}.0${u} <${s}.${+o+1}.0-0`),at("xRange return",i),i})},oL=(e,t)=>(at("replaceStars",e,t),e.trim().replace(Bt[Mt.STAR],"")),aL=(e,t)=>(at("replaceGTE0",e,t),e.trim().replace(Bt[t.includePrerelease?Mt.GTE0PRE:Mt.GTE0],"")),uL=e=>(t,n,i,r,s,o,a,u,l,c,f,d,h)=>(an(i)?n="":an(r)?n=`>=${i}.0.0${e?"-0":""}`:an(s)?n=`>=${i}.${r}.0${e?"-0":""}`:o?n=`>=${n}`:n=`>=${n}${e?"-0":""}`,an(l)?u="":an(c)?u=`<${+l+1}.0.0-0`:an(f)?u=`<${l}.${+c+1}.0-0`:d?u=`<=${l}.${c}.${f}-${d}`:e?u=`<${l}.${c}.${+f+1}-0`:u=`<=${u}`,`${n} ${u}`.trim()),lL=(e,t,n)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let i=0;i<e.length;i++)if(at(e[i].semver),e[i].semver!==u1.ANY&&e[i].semver.prerelease.length>0){const r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},Yl=Symbol("SemVer ANY");class Jd{static get ANY(){return Yl}constructor(t,n){if(n=cL(n),t instanceof Jd){if(t.loose===!!n.loose)return t;t=t.value}c1("comparator",t,n),this.options=n,this.loose=!!n.loose,this.parse(t),this.semver===Yl?this.value="":this.value=this.operator+this.semver.version,c1("comp",this)}parse(t){const n=this.options.loose?oO[aO.COMPARATORLOOSE]:oO[aO.COMPARATOR],i=t.match(n);if(!i)throw new TypeError(`Invalid comparator: ${t}`);this.operator=i[1]!==void 0?i[1]:"",this.operator==="="&&(this.operator=""),i[2]?this.semver=new uO(i[2],this.options.loose):this.semver=Yl}toString(){return this.value}test(t){if(c1("Comparator.test",t,this.options.loose),this.semver===Yl||t===Yl)return!0;if(typeof t=="string")try{t=new uO(t,this.options)}catch{return!1}return l1(t,this.operator,this.semver,this.options)}intersects(t,n){if(!(t instanceof Jd))throw new TypeError("a Comparator is required");if((!n||typeof n!="object")&&(n={loose:!!n,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new lO(t.value,n).test(this.value);if(t.operator==="")return t.value===""?!0:new lO(this.value,n).test(t.semver);const i=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),r=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),s=this.semver.version===t.semver.version,o=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),a=l1(this.semver,"<",t.semver,n)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),u=l1(this.semver,">",t.semver,n)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return i||r||s&&o||a||u}}var Qd=Jd;const cL=Wd,{re:oO,t:aO}=As.exports,l1=ZA,c1=qd,uO=on,lO=$i,fL=$i,dL=(e,t,n)=>{try{t=new fL(t,n)}catch{return!1}return t.test(e)};var Zd=dL;const hL=$i,gL=(e,t)=>new hL(e,t).set.map(n=>n.map(i=>i.value).join(" ").trim().split(" "));var pL=gL;const mL=on,yL=$i,vL=(e,t,n)=>{let i=null,r=null,s=null;try{s=new yL(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!i||r.compare(o)===-1)&&(i=o,r=new mL(i,n))}),i};var bL=vL;const xL=on,wL=$i,EL=(e,t,n)=>{let i=null,r=null,s=null;try{s=new wL(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!i||r.compare(o)===1)&&(i=o,r=new xL(i,n))}),i};var _L=EL;const f1=on,AL=$i,cO=Yd,OL=(e,t)=>{e=new AL(e,t);let n=new f1("0.0.0");if(e.test(n)||(n=new f1("0.0.0-0"),e.test(n)))return n;n=null;for(let i=0;i<e.set.length;++i){const r=e.set[i];let s=null;r.forEach(o=>{const a=new f1(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||cO(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!n||cO(n,s))&&(n=s)}return n&&e.test(n)?n:null};var SL=OL;const CL=$i,$L=(e,t)=>{try{return new CL(e,t).range||"*"}catch{return null}};var FL=$L;const kL=on,fO=Qd,{ANY:DL}=fO,ML=$i,TL=Zd,dO=Yd,hO=i1,NL=s1,RL=r1,jL=(e,t,n,i)=>{e=new kL(e,i),t=new ML(t,i);let r,s,o,a,u;switch(n){case">":r=dO,s=NL,o=hO,a=">",u=">=";break;case"<":r=hO,s=RL,o=dO,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(TL(e,t,i))return!1;for(let l=0;l<t.set.length;++l){const c=t.set[l];let f=null,d=null;if(c.forEach(h=>{h.semver===DL&&(h=new fO(">=0.0.0")),f=f||h,d=d||h,r(h.semver,f.semver,i)?f=h:o(h.semver,d.semver,i)&&(d=h)}),f.operator===a||f.operator===u||(!d.operator||d.operator===a)&&s(e,d.semver))return!1;if(d.operator===u&&o(e,d.semver))return!1}return!0};var d1=jL;const LL=d1,PL=(e,t,n)=>LL(e,t,">",n);var IL=PL;const BL=d1,zL=(e,t,n)=>BL(e,t,"<",n);var UL=zL;const gO=$i,qL=(e,t,n)=>(e=new gO(e,n),t=new gO(t,n),e.intersects(t));var WL=qL;const GL=Zd,HL=Si;var YL=(e,t,n)=>{const i=[];let r=null,s=null;const o=e.sort((c,f)=>HL(c,f,n));for(const c of o)GL(c,t,n)?(s=c,r||(r=c)):(s&&i.push([r,s]),s=null,r=null);r&&i.push([r,null]);const a=[];for(const[c,f]of i)c===f?a.push(c):!f&&c===o[0]?a.push("*"):f?c===o[0]?a.push(`<=${f}`):a.push(`${c} - ${f}`):a.push(`>=${c}`);const u=a.join(" || "),l=typeof t.raw=="string"?t.raw:String(t);return u.length<l.length?u:t};const pO=$i,eh=Qd,{ANY:h1}=eh,Vl=Zd,g1=Si,VL=(e,t,n={})=>{if(e===t)return!0;e=new pO(e,n),t=new pO(t,n);let i=!1;e:for(const r of e.set){for(const s of t.set){const o=XL(r,s,n);if(i=i||o!==null,o)continue e}if(i)return!1}return!0},XL=(e,t,n)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===h1){if(t.length===1&&t[0].semver===h1)return!0;n.includePrerelease?e=[new eh(">=0.0.0-0")]:e=[new eh(">=0.0.0")]}if(t.length===1&&t[0].semver===h1){if(n.includePrerelease)return!0;t=[new eh(">=0.0.0")]}const i=new Set;let r,s;for(const h of e)h.operator===">"||h.operator===">="?r=mO(r,h,n):h.operator==="<"||h.operator==="<="?s=yO(s,h,n):i.add(h.semver);if(i.size>1)return null;let o;if(r&&s){if(o=g1(r.semver,s.semver,n),o>0)return null;if(o===0&&(r.operator!==">="||s.operator!=="<="))return null}for(const h of i){if(r&&!Vl(h,String(r),n)||s&&!Vl(h,String(s),n))return null;for(const g of t)if(!Vl(h,String(g),n))return!1;return!0}let a,u,l,c,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1,d=r&&!n.includePrerelease&&r.semver.prerelease.length?r.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const h of t){if(c=c||h.operator===">"||h.operator===">=",l=l||h.operator==="<"||h.operator==="<=",r){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator===">"||h.operator===">="){if(a=mO(r,h,n),a===h&&a!==r)return!1}else if(r.operator===">="&&!Vl(r.semver,String(h),n))return!1}if(s){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator==="<"||h.operator==="<="){if(u=yO(s,h,n),u===h&&u!==s)return!1}else if(s.operator==="<="&&!Vl(s.semver,String(h),n))return!1}if(!h.operator&&(s||r)&&o!==0)return!1}return!(r&&l&&!s&&o!==0||s&&c&&!r&&o!==0||d||f)},mO=(e,t,n)=>{if(!e)return t;const i=g1(e.semver,t.semver,n);return i>0?e:i<0||t.operator===">"&&e.operator===">="?t:e},yO=(e,t,n)=>{if(!e)return t;const i=g1(e.semver,t.semver,n);return i<0?e:i>0||t.operator==="<"&&e.operator==="<="?t:e};var KL=VL;const p1=As.exports;var vO={re:p1.re,src:p1.src,tokens:p1.t,SEMVER_SPEC_VERSION:Ud.SEMVER_SPEC_VERSION,SemVer:on,compareIdentifiers:e1.compareIdentifiers,rcompareIdentifiers:e1.rcompareIdentifiers,parse:su,valid:T9,clean:j9,inc:I9,diff:G9,major:V9,minor:J9,patch:e7,prerelease:i7,compare:Si,rcompare:o7,compareLoose:l7,compareBuild:n1,sort:h7,rsort:m7,gt:Yd,lt:i1,eq:t1,neq:QA,gte:r1,lte:s1,cmp:ZA,coerce:L7,Comparator:Qd,Range:$i,satisfies:Zd,toComparators:pL,maxSatisfying:bL,minSatisfying:_L,minVersion:SL,validRange:FL,outside:d1,gtr:IL,ltr:UL,intersects:WL,simplifyRange:YL,subset:KL};function Sn(e,t,n){return e.fields=t||[],e.fname=n,e}function tt(e){return e==null?null:e.fname}function zt(e){return e==null?null:e.fields}function bO(e){return e.length===1?JL(e[0]):QL(e)}const JL=e=>function(t){return t[e]},QL=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function N(e){throw Error(e)}function th(e){const t=[],n=e.length;let i=null,r=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===i)l(),i=null,r=-1;else{if(i)continue;o===r&&u==='"'||o===r&&u==="'"?(o=a+1,i=u):u==="."&&!r?a>o?l():o=a+1:u==="["?(a>o&&l(),r=o=a+1):u==="]"&&(r||N("Access path missing open bracket: "+e),r>0&&l(),r=0,o=a+1)}return r&&N("Access path missing closing bracket: "+e),i&&N("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Cn(e,t,n){const i=th(e);return e=i.length===1?i[0]:e,Sn((n&&n.get||bO)(i),[e],t||e)}const Xl=Cn("id"),un=Sn(e=>e,[],"identity"),Os=Sn(()=>0,[],"zero"),uu=Sn(()=>1,[],"one"),oi=Sn(()=>!0,[],"true"),Ss=Sn(()=>!1,[],"false");function ZL(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}const xO=0,m1=1,wO=2,EO=3,_O=4;function AO(e,t,n=ZL){let i=e||xO;return{level(r){return arguments.length?(i=+r,this):i},error(){return i>=m1&&n(t||"error","ERROR",arguments),this},warn(){return i>=wO&&n(t||"warn","WARN",arguments),this},info(){return i>=EO&&n(t||"log","INFO",arguments),this},debug(){return i>=_O&&n(t||"log","DEBUG",arguments),this}}}var K=Array.isArray;function ue(e){return e===Object(e)}const OO=e=>e!=="__proto__";function nh(...e){return e.reduce((t,n)=>{for(const i in n)if(i==="signals")t.signals=eP(t.signals,n.signals);else{const r=i==="legend"?{layout:1}:i==="style"?!0:null;Kl(t,i,n[i],r)}return t},{})}function Kl(e,t,n,i){if(!OO(t))return;let r,s;if(ue(n)&&!K(n)){s=ue(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?Kl(s,r,n[r]):OO(r)&&(s[r]=n[r])}else e[t]=n}function eP(e,t){if(e==null)return t;const n={},i=[];function r(s){n[s.name]||(n[s.name]=1,i.push(s))}return t.forEach(r),e.forEach(r),i}function be(e){return e[e.length-1]}function Ut(e){return e==null||e===""?null:+e}const SO=e=>t=>e*Math.exp(t),CO=e=>t=>Math.log(e*t),$O=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),FO=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,ih=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function rh(e,t,n,i){const r=n(e[0]),s=n(be(e)),o=(s-r)*t;return[i(r-o),i(s-o)]}function kO(e,t){return rh(e,t,Ut,un)}function DO(e,t){var n=Math.sign(e[0]);return rh(e,t,CO(n),SO(n))}function MO(e,t,n){return rh(e,t,ih(n),ih(1/n))}function TO(e,t,n){return rh(e,t,$O(n),FO(n))}function sh(e,t,n,i,r){const s=i(e[0]),o=i(be(e)),a=t!=null?i(t):(s+o)/2;return[r(a+(s-a)*n),r(a+(o-a)*n)]}function y1(e,t,n){return sh(e,t,n,Ut,un)}function v1(e,t,n){const i=Math.sign(e[0]);return sh(e,t,n,CO(i),SO(i))}function oh(e,t,n,i){return sh(e,t,n,ih(i),ih(1/i))}function b1(e,t,n,i){return sh(e,t,n,$O(i),FO(i))}function NO(e){return 1+~~(new Date(e).getMonth()/3)}function RO(e){return 1+~~(new Date(e).getUTCMonth()/3)}function re(e){return e!=null?K(e)?e:[e]:[]}function jO(e,t,n){let i=e[0],r=e[1],s;return r<i&&(s=r,r=i,i=s),s=r-i,s>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-s),i+s]}function ge(e){return typeof e=="function"}const tP="descending";function x1(e,t,n){n=n||{},t=re(t)||[];const i=[],r=[],s={},o=n.comparator||nP;return re(e).forEach((a,u)=>{a!=null&&(i.push(t[u]===tP?-1:1),r.push(a=ge(a)?a:Cn(a,null,n)),(zt(a)||[]).forEach(l=>s[l]=1))}),r.length===0?null:Sn(o(r,i),Object.keys(s))}const ah=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),nP=(e,t)=>e.length===1?iP(e[0],t[0]):rP(e,t,e.length),iP=(e,t)=>function(n,i){return ah(e(n),e(i))*t},rP=(e,t,n)=>(t.push(0),function(i,r){let s,o=0,a=-1;for(;o===0&&++a<n;)s=e[a],o=ah(s(i),s(r));return o*t[a]});function qt(e){return ge(e)?e:()=>e}function w1(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(t(i),n=null),e)}}function de(e){for(let t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function nr(e,t){let n=0,i,r,s,o;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(s=o=r;n<i;++n)r=e[n],r!=null&&(r<s&&(s=r),r>o&&(o=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(s=o=r;n<i;++n)r=t(e[n]),r!=null&&(r<s&&(s=r),r>o&&(o=r))}return[s,o]}function LO(e,t){const n=e.length;let i=-1,r,s,o,a,u;if(t==null){for(;++i<n;)if(s=e[i],s!=null&&s>=s){r=o=s;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)s=e[i],s!=null&&(r>s&&(r=s,a=i),o<s&&(o=s,u=i))}else{for(;++i<n;)if(s=t(e[i],i,e),s!=null&&s>=s){r=o=s;break}if(i===n)return[-1,-1];for(a=u=i;++i<n;)s=t(e[i],i,e),s!=null&&(r>s&&(r=s,a=i),o<s&&(o=s,u=i))}return[a,u]}const sP=Object.prototype.hasOwnProperty;function se(e,t){return sP.call(e,t)}const uh={};function lu(e){let t={},n;function i(s){return se(t,s)&&t[s]!==uh}const r={size:0,empty:0,object:t,has:i,get(s){return i(s)?t[s]:void 0},set(s,o){return i(s)||(++r.size,t[s]===uh&&--r.empty),t[s]=o,this},delete(s){return i(s)&&(--r.size,++r.empty,t[s]=uh),this},clear(){r.size=r.empty=0,r.object=t={}},test(s){return arguments.length?(n=s,r):n},clean(){const s={};let o=0;for(const a in t){const u=t[a];u!==uh&&(!n||!n(u))&&(s[a]=u,++o)}r.size=o,r.empty=0,r.object=t=s}};return e&&Object.keys(e).forEach(s=>{r.set(s,e[s])}),r}function PO(e,t,n,i,r,s){if(!n&&n!==0)return s;const o=+n;let a=e[0],u=be(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=o?i:c<=o?r:s}function z(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),de(i,n)}function cu(e,t,n,i){let r=t[0],s=t[t.length-1],o;return r>s&&(o=r,r=s,s=o),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=s:e<s)}function E1(e){return typeof e=="boolean"}function Cs(e){return Object.prototype.toString.call(e)==="[object Date]"}function IO(e){return e&&ge(e[Symbol.iterator])}function $s(e){return typeof e=="number"}function BO(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function _e(e){return typeof e=="string"}function _1(e,t,n){e&&(e=t?re(e).map(a=>a.replace(/\\(.)/g,"$1")):re(e));const i=e&&e.length,r=n&&n.get||bO,s=a=>r(t?[a]:th(a));let o;if(!i)o=function(){return""};else if(i===1){const a=s(e[0]);o=function(u){return""+a(u)}}else{const a=e.map(s);o=function(u){let l=""+a[0](u),c=0;for(;++c<i;)l+="|"+a[c](u);return l}}return Sn(o,e,"key")}function zO(e,t){const n=e[0],i=be(e),r=+t;return r?r===1?i:n+r*(i-n):n}const oP=1e4;function UO(e){e=+e||oP;let t,n,i;const r=()=>{t={},n={},i=0},s=(o,a)=>(++i>e&&(n=t,t={},i=1),t[o]=a);return r(),{clear:r,has:o=>se(t,o)||se(n,o),get:o=>se(t,o)?t[o]:se(n,o)?s(o,n[o]):void 0,set:(o,a)=>se(t,o)?t[o]=a:s(o,a)}}function qO(e,t,n,i){const r=t.length,s=n.length;if(!s)return t;if(!r)return n;const o=i||new t.constructor(r+s);let a=0,u=0,l=0;for(;a<r&&u<s;++l)o[l]=e(t[a],n[u])>0?n[u++]:t[a++];for(;a<r;++a,++l)o[l]=t[a];for(;u<s;++u,++l)o[l]=n[u];return o}function Jl(e,t){let n="";for(;--t>=0;)n+=e;return n}function WO(e,t,n,i){const r=n||" ",s=e+"",o=t-s.length;return o<=0?s:i==="left"?Jl(r,o)+s:i==="center"?Jl(r,~~(o/2))+s+Jl(r,Math.ceil(o/2)):s+Jl(r,o)}function Ql(e){return e&&be(e)-e[0]||0}function ee(e){return K(e)?"["+e.map(ee)+"]":ue(e)||_e(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function A1(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const aP=e=>$s(e)||Cs(e)?e:Date.parse(e);function O1(e,t){return t=t||aP,e==null||e===""?null:t(e)}function S1(e){return e==null||e===""?null:e+""}function Fi(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function GO(e,t,n,i){const r=i!=null?i:"\u2026",s=e+"",o=s.length,a=Math.max(0,t-r.length);return o<=t?s:n==="left"?r+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+r+s.slice(o-~~(a/2)):s.slice(0,a)+r}function Fs(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const s=t(e[r]);s&&n(s,r,e)}}else e.forEach(n)}var HO={},C1={},$1=34,Zl=10,F1=13;function YO(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function uP(e,t){var n=YO(e);return function(i,r){return t(n(i),r,e)}}function VO(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function $n(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function lP(e){return e<0?"-"+$n(-e,6):e>9999?"+"+$n(e,6):$n(e,4)}function cP(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":lP(e.getUTCFullYear())+"-"+$n(e.getUTCMonth()+1,2)+"-"+$n(e.getUTCDate(),2)+(r?"T"+$n(t,2)+":"+$n(n,2)+":"+$n(i,2)+"."+$n(r,3)+"Z":i?"T"+$n(t,2)+":"+$n(n,2)+":"+$n(i,2)+"Z":n||t?"T"+$n(t,2)+":"+$n(n,2)+"Z":"")}function fP(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,d){var h,g,p=r(f,function(m,y){if(h)return h(m,y-1);g=m,h=d?uP(m,d):YO(m)});return p.columns=g||[],p}function r(f,d){var h=[],g=f.length,p=0,m=0,y,v=g<=0,b=!1;f.charCodeAt(g-1)===Zl&&--g,f.charCodeAt(g-1)===F1&&--g;function x(){if(v)return C1;if(b)return b=!1,HO;var _,w=p,A;if(f.charCodeAt(w)===$1){for(;p++<g&&f.charCodeAt(p)!==$1||f.charCodeAt(++p)===$1;);return(_=p)>=g?v=!0:(A=f.charCodeAt(p++))===Zl?b=!0:A===F1&&(b=!0,f.charCodeAt(p)===Zl&&++p),f.slice(w+1,_-1).replace(/""/g,'"')}for(;p<g;){if((A=f.charCodeAt(_=p++))===Zl)b=!0;else if(A===F1)b=!0,f.charCodeAt(p)===Zl&&++p;else if(A!==n)continue;return f.slice(w,_)}return v=!0,f.slice(w,g)}for(;(y=x())!==C1;){for(var E=[];y!==HO&&y!==C1;)E.push(y),y=x();d&&(E=d(E,m++))==null||h.push(E)}return h}function s(f,d){return f.map(function(h){return d.map(function(g){return c(h[g])}).join(e)})}function o(f,d){return d==null&&(d=VO(f)),[d.map(c).join(e)].concat(s(f,d)).join(`
`)}function a(f,d){return d==null&&(d=VO(f)),s(f,d).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?cP(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:o,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function dP(e){return e}function hP(e){if(e==null)return dP;var t,n,i=e.scale[0],r=e.scale[1],s=e.translate[0],o=e.translate[1];return function(a,u){u||(t=n=0);var l=2,c=a.length,f=new Array(c);for(f[0]=(t+=a[0])*i+s,f[1]=(n+=a[1])*r+o;l<c;)f[l]=a[l],++l;return f}}function gP(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function pP(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return XO(e,n)})}:XO(e,t)}function XO(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,s=KO(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:s}:i==null?{type:"Feature",id:n,properties:r,geometry:s}:{type:"Feature",id:n,bbox:i,properties:r,geometry:s}}function KO(e,t){var n=hP(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var d=i[c<0?~c:c],h=0,g=d.length;h<g;++h)f.push(n(d[h],h));c<0&&gP(f,g)}function s(c){return n(c)}function o(c){for(var f=[],d=0,h=c.length;d<h;++d)r(c[d],f);return f.length<2&&f.push(f[0]),f}function a(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(a)}function l(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":d=s(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(s);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=u(c.arcs);break;case"MultiPolygon":d=c.arcs.map(u);break;default:return null}return{type:f,coordinates:d}}return l(t)}function mP(e,t){var n={},i={},r={},s=[],o=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],d;f.length<3&&!f[1][0]&&!f[1][1]&&(d=t[++o],t[o]=l,t[c]=d)}),t.forEach(function(l){var c=a(l),f=c[0],d=c[1],h,g;if(h=r[f])if(delete r[h.end],h.push(l),h.end=d,g=i[d]){delete i[g.start];var p=g===h?h:h.concat(g);i[p.start=h.start]=r[p.end=g.end]=p}else i[h.start]=r[h.end]=h;else if(h=i[d])if(delete i[h.start],h.unshift(l),h.start=f,g=r[f]){delete r[g.end];var m=g===h?h:g.concat(h);i[m.start=g.start]=r[m.end=h.end]=m}else i[h.start]=r[h.end]=h;else h=[l],i[h.start=f]=r[h.end=d]=h});function a(l){var c=e.arcs[l<0?~l:l],f=c[0],d;return e.transform?(d=[0,0],c.forEach(function(h){d[0]+=h[0],d[1]+=h[1]})):d=c[c.length-1],l<0?[d,f]:[f,d]}function u(l,c){for(var f in l){var d=l[f];delete c[d.start],delete d.start,delete d.end,d.forEach(function(h){n[h<0?~h:h]=1}),s.push(d)}}return u(r,i),u(i,r),t.forEach(function(l){n[l<0?~l:l]||s.push([l])}),s}function yP(e){return KO(e,vP.apply(this,arguments))}function vP(e,t,n){var i,r,s;if(arguments.length>1)i=bP(e,t,n);else for(r=0,i=new Array(s=e.arcs.length);r<s;++r)i[r]=r;return{type:"MultiLineString",arcs:mP(e,i)}}function bP(e,t,n){var i=[],r=[],s;function o(f){var d=f<0?~f:f;(r[d]||(r[d]=[])).push({i:f,g:s})}function a(f){f.forEach(o)}function u(f){f.forEach(a)}function l(f){f.forEach(u)}function c(f){switch(s=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}function fu(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function ec(e){let t=e,n=e;e.length===1&&(t=(o,a)=>e(o)-a,n=xP(e));function i(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)<0?u=c+1:l=c}return u}function r(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)>0?l=c:u=c+1}return u}function s(o,a,u,l){u==null&&(u=0),l==null&&(l=o.length);const c=i(o,a,u,l-1);return c>u&&t(o[c-1],a)>-t(o[c],a)?c-1:c}return{left:i,center:s,right:r}}function xP(e){return(t,n)=>fu(e(t),n)}function JO(e){return e===null?NaN:+e}function*wP(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}const QO=ec(fu),lh=QO.right,EP=QO.left;ec(JO).center;var tc=lh;function _P(e,t){let n=0,i,r=0,s=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(i=o-r,r+=i/++n,s+=i*(o-r));else{let o=-1;for(let a of e)(a=t(a,++o,e))!=null&&(a=+a)>=a&&(i=a-r,r+=i/++n,s+=i*(a-r))}if(n>1)return s/(n-1)}function AP(e,t){const n=_P(e,t);return n&&Math.sqrt(n)}class ln{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[i++]=a),t=o}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,s,o=0;if(n>0){for(o=t[--n];n>0&&(i=o,r=t[--n],o=i+r,s=r-(o-i),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(r=s*2,i=o+r,r==i-o&&(o=i))}return o}}function OP(e,t){return Array.from(t,n=>e[n])}var k1=Math.sqrt(50),D1=Math.sqrt(10),M1=Math.sqrt(2);function T1(e,t,n){var i,r=-1,s,o,a;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((i=t<e)&&(s=e,e=t,t=s),(a=ZO(e,t,n))===0||!isFinite(a))return[];if(a>0){let u=Math.round(e/a),l=Math.round(t/a);for(u*a<e&&++u,l*a>t&&--l,o=new Array(s=l-u+1);++r<s;)o[r]=(u+r)*a}else{a=-a;let u=Math.round(e*a),l=Math.round(t*a);for(u/a<e&&++u,l/a>t&&--l,o=new Array(s=l-u+1);++r<s;)o[r]=(u+r)/a}return i&&o.reverse(),o}function ZO(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),s=i/Math.pow(10,r);return r>=0?(s>=k1?10:s>=D1?5:s>=M1?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(s>=k1?10:s>=D1?5:s>=M1?2:1)}function ks(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=i/r;return s>=k1?r*=10:s>=D1?r*=5:s>=M1&&(r*=2),t<e?-r:r}function qo(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function N1(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function eS(e,t,n=0,i=e.length-1,r=fu){for(;i>n;){if(i-n>600){const u=i-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),h=Math.max(n,Math.floor(t-l*f/u+d)),g=Math.min(i,Math.floor(t+(u-l)*f/u+d));eS(e,t,h,g,r)}const s=e[t];let o=n,a=i;for(nc(e,n,t),r(e[i],s)>0&&nc(e,n,i);o<a;){for(nc(e,o,a),++o,--a;r(e[o],s)<0;)++o;for(;r(e[a],s)>0;)--a}r(e[n],s)===0?nc(e,n,a):(++a,nc(e,a,i)),a<=t&&(n=a+1),t<=a&&(i=a-1)}return e}function nc(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function R1(e,t,n){if(e=Float64Array.from(wP(e,n)),!!(i=e.length)){if((t=+t)<=0||i<2)return N1(e);if(t>=1)return qo(e);var i,r=(i-1)*t,s=Math.floor(r),o=qo(eS(e,s).subarray(0,s+1)),a=N1(e.subarray(s+1));return o+(a-o)*(r-s)}}function tS(e,t,n=JO){if(!!(i=e.length)){if((t=+t)<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,s=Math.floor(r),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(r-s)}}function SP(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of e)(s=t(s,++r,e))!=null&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function nS(e,t){return R1(e,.5,t)}function*CP(e){for(const t of e)yield*t}function iS(e){return Array.from(CP(e))}function Yn(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(r);++i<r;)s[i]=e+i*n;return s}function rS(e,t){let n=0;if(t===void 0)for(let i of e)(i=+i)&&(n+=i);else{let i=-1;for(let r of e)(r=+t(r,++i,e))&&(n+=r)}return n}function $P(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ch(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function du(e){return e=ch(Math.abs(e)),e?e[1]:NaN}function FP(e,t){return function(n,i){for(var r=n.length,s=[],o=0,a=e[0],u=0;r>0&&a>0&&(u+a+1>i&&(a=Math.max(1,i-u)),s.push(n.substring(r-=a,r+a)),!((u+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function kP(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var DP=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hu(e){if(!(t=DP.exec(e)))throw new Error("invalid format: "+e);var t;return new j1({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}hu.prototype=j1.prototype;function j1(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}j1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function MP(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var sS;function TP(e,t){var n=ch(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(sS=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+ch(e,Math.max(0,t+s-1))[0]}function oS(e,t){var n=ch(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var aS={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:$P,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>oS(e*100,t),r:oS,s:TP,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function uS(e){return e}var lS=Array.prototype.map,cS=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function fS(e){var t=e.grouping===void 0||e.thousands===void 0?uS:FP(lS.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?uS:kP(lS.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=hu(f);var d=f.fill,h=f.align,g=f.sign,p=f.symbol,m=f.zero,y=f.width,v=f.comma,b=f.precision,x=f.trim,E=f.type;E==="n"?(v=!0,E="g"):aS[E]||(b===void 0&&(b=12),x=!0,E="g"),(m||d==="0"&&h==="=")&&(m=!0,d="0",h="=");var _=p==="$"?n:p==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",w=p==="$"?i:/[%p]/.test(E)?o:"",A=aS[E],S=/[defgprs%]/.test(E);b=b===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function O(C){var k=_,F=w,j,$,R;if(E==="c")F=A(C)+F,C="";else{C=+C;var L=C<0||1/C<0;if(C=isNaN(C)?u:A(Math.abs(C),b),x&&(C=MP(C)),L&&+C==0&&g!=="+"&&(L=!1),k=(L?g==="("?g:a:g==="-"||g==="("?"":g)+k,F=(E==="s"?cS[8+sS/3]:"")+F+(L&&g==="("?")":""),S){for(j=-1,$=C.length;++j<$;)if(R=C.charCodeAt(j),48>R||R>57){F=(R===46?r+C.slice(j+1):C.slice(j))+F,C=C.slice(0,j);break}}}v&&!m&&(C=t(C,1/0));var U=k.length+C.length+F.length,H=U<y?new Array(y-U+1).join(d):"";switch(v&&m&&(C=t(H+C,H.length?y-F.length:1/0),H=""),h){case"<":C=k+C+F+H;break;case"=":C=k+H+C+F;break;case"^":C=H.slice(0,U=H.length>>1)+k+C+F+H.slice(U);break;default:C=H+k+C+F;break}return s(C)}return O.toString=function(){return f+""},O}function c(f,d){var h=l((f=hu(f),f.type="f",f)),g=Math.max(-8,Math.min(8,Math.floor(du(d)/3)))*3,p=Math.pow(10,-g),m=cS[8+g/3];return function(y){return h(p*y)+m}}return{format:l,formatPrefix:c}}var fh,dh,L1;NP({thousands:",",grouping:[3],currency:["$",""]});function NP(e){return fh=fS(e),dh=fh.format,L1=fh.formatPrefix,fh}function dS(e){return Math.max(0,-du(Math.abs(e)))}function hS(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(du(t)/3)))*3-du(Math.abs(e)))}function gS(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,du(t)-du(e))+1}var P1=new Date,I1=new Date;function At(e,t,n,i){function r(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return r.floor=function(s){return e(s=new Date(+s)),s},r.ceil=function(s){return e(s=new Date(s-1)),t(s,1),e(s),s},r.round=function(s){var o=r(s),a=r.ceil(s);return s-o<a-s?o:a},r.offset=function(s,o){return t(s=new Date(+s),o==null?1:Math.floor(o)),s},r.range=function(s,o,a){var u=[],l;if(s=r.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},r.filter=function(s){return At(function(o){if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},function(o,a){if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););})},n&&(r.count=function(s,o){return P1.setTime(+s),I1.setTime(+o),e(P1),e(I1),Math.floor(n(P1,I1))},r.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?r.filter(i?function(o){return i(o)%s==0}:function(o){return r.count(0,o)%s==0}):r}),r}var B1=At(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});B1.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?At(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):B1};var z1=B1;const Gr=1e3,ai=Gr*60,Hr=ai*60,Wo=Hr*24,U1=Wo*7,pS=Wo*30,q1=Wo*365;var RP=At(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*Gr)},function(e,t){return(t-e)/Gr},function(e){return e.getUTCSeconds()}),Ds=RP,jP=At(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gr)},function(e,t){e.setTime(+e+t*ai)},function(e,t){return(t-e)/ai},function(e){return e.getMinutes()}),W1=jP,LP=At(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gr-e.getMinutes()*ai)},function(e,t){e.setTime(+e+t*Hr)},function(e,t){return(t-e)/Hr},function(e){return e.getHours()}),G1=LP,PP=At(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ai)/Wo,e=>e.getDate()-1),Ms=PP;function Go(e){return At(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*ai)/U1})}var ic=Go(0),H1=Go(1);Go(2);Go(3);var rc=Go(4);Go(5);Go(6);var IP=At(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),hh=IP,mS=At(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});mS.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:At(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};var Ts=mS,BP=At(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*ai)},function(e,t){return(t-e)/ai},function(e){return e.getUTCMinutes()}),Y1=BP,zP=At(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Hr)},function(e,t){return(t-e)/Hr},function(e){return e.getUTCHours()}),V1=zP,UP=At(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Wo},function(e){return e.getUTCDate()-1}),Ns=UP;function Ho(e){return At(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/U1})}var sc=Ho(0),X1=Ho(1);Ho(2);Ho(3);var oc=Ho(4);Ho(5);Ho(6);var qP=At(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),gh=qP,yS=At(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});yS.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:At(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};var Rs=yS;function vS(e,t,n,i,r,s){const o=[[Ds,1,Gr],[Ds,5,5*Gr],[Ds,15,15*Gr],[Ds,30,30*Gr],[s,1,ai],[s,5,5*ai],[s,15,15*ai],[s,30,30*ai],[r,1,Hr],[r,3,3*Hr],[r,6,6*Hr],[r,12,12*Hr],[i,1,Wo],[i,2,2*Wo],[n,1,U1],[t,1,pS],[t,3,3*pS],[e,1,q1]];function a(l,c,f){const d=c<l;d&&([l,c]=[c,l]);const h=f&&typeof f.range=="function"?f:u(l,c,f),g=h?h.range(l,+c+1):[];return d?g.reverse():g}function u(l,c,f){const d=Math.abs(c-l)/f,h=ec(([,,m])=>m).right(o,d);if(h===o.length)return e.every(ks(l/q1,c/q1,f));if(h===0)return z1.every(Math.max(ks(l,c,f),1));const[g,p]=o[d/o[h-1][2]<o[h][2]/d?h-1:h];return g.every(p)}return[a,u]}const[WP,GP]=vS(Rs,gh,sc,Ns,V1,Y1),[HP,YP]=vS(Ts,hh,ic,Ms,G1,W1),Tt="year",Fn="quarter",Wt="month",pt="week",kn="date",Gt="day",ir="dayofyear",Vn="hours",Xn="minutes",ui="seconds",ki="milliseconds",K1=[Tt,Fn,Wt,pt,kn,Gt,ir,Vn,Xn,ui,ki],J1=K1.reduce((e,t,n)=>(e[t]=1+n,e),{});function Q1(e){const t=re(e).slice(),n={};return t.length||N("Missing time unit."),t.forEach(r=>{se(J1,r)?n[r]=1:N("Invalid time unit: ".concat(r,"."))}),(n[pt]||n[Gt]?1:0)+(n[Fn]||n[Wt]||n[kn]?1:0)+(n[ir]?1:0)>1&&N("Incompatible time units: ".concat(e)),t.sort((r,s)=>J1[r]-J1[s]),t}const VP={[Tt]:"%Y ",[Fn]:"Q%q ",[Wt]:"%b ",[kn]:"%d ",[pt]:"W%U ",[Gt]:"%a ",[ir]:"%j ",[Vn]:"%H:00",[Xn]:"00:%M",[ui]:":%S",[ki]:".%L",["".concat(Tt,"-").concat(Wt)]:"%Y-%m ",["".concat(Tt,"-").concat(Wt,"-").concat(kn)]:"%Y-%m-%d ",["".concat(Vn,"-").concat(Xn)]:"%H:%M"};function bS(e,t){const n=de({},VP,t),i=Q1(e),r=i.length;let s="",o=0,a,u;for(o=0;o<r;)for(a=i.length;a>o;--a)if(u=i.slice(o,a).join("-"),n[u]!=null){s+=n[u],o=a;break}return s.trim()}const Yo=new Date;function Z1(e){return Yo.setFullYear(e),Yo.setMonth(0),Yo.setDate(1),Yo.setHours(0,0,0,0),Yo}function xS(e){return ES(new Date(e))}function wS(e){return ey(new Date(e))}function ES(e){return Ms.count(Z1(e.getFullYear())-1,e)}function ey(e){return ic.count(Z1(e.getFullYear())-1,e)}function ty(e){return Z1(e).getDay()}function XP(e,t,n,i,r,s,o){if(0<=e&&e<100){const a=new Date(-1,t,n,i,r,s,o);return a.setFullYear(e),a}return new Date(e,t,n,i,r,s,o)}function _S(e){return OS(new Date(e))}function AS(e){return ny(new Date(e))}function OS(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Ns.count(t-1,e)}function ny(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return sc.count(t-1,e)}function iy(e){return Yo.setTime(Date.UTC(e,0,1)),Yo.getUTCDay()}function KP(e,t,n,i,r,s,o){if(0<=e&&e<100){const a=new Date(Date.UTC(-1,t,n,i,r,s,o));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(e,t,n,i,r,s,o))}function SS(e,t,n,i,r){const s=t||1,o=be(e),a=(y,v,b)=>(b=b||y,JP(n[b],i[b],y===o&&s,v)),u=new Date,l=Fi(e),c=l[Tt]?a(Tt):qt(2012),f=l[Wt]?a(Wt):l[Fn]?a(Fn):Os,d=l[pt]&&l[Gt]?a(Gt,1,pt+Gt):l[pt]?a(pt,1):l[Gt]?a(Gt,1):l[kn]?a(kn,1):l[ir]?a(ir,1):uu,h=l[Vn]?a(Vn):Os,g=l[Xn]?a(Xn):Os,p=l[ui]?a(ui):Os,m=l[ki]?a(ki):Os;return function(y){u.setTime(+y);const v=c(u);return r(v,f(u),d(u,v),h(u),g(u),p(u),m(u))}}function JP(e,t,n,i){const r=n<=1?e:i?(s,o)=>i+n*Math.floor((e(s,o)-i)/n):(s,o)=>n*Math.floor(e(s,o)/n);return t?(s,o)=>t(r(s,o),o):r}function gu(e,t,n){return t+e*7-(n+6)%7}const QP={[Tt]:e=>e.getFullYear(),[Fn]:e=>Math.floor(e.getMonth()/3),[Wt]:e=>e.getMonth(),[kn]:e=>e.getDate(),[Vn]:e=>e.getHours(),[Xn]:e=>e.getMinutes(),[ui]:e=>e.getSeconds(),[ki]:e=>e.getMilliseconds(),[ir]:e=>ES(e),[pt]:e=>ey(e),[pt+Gt]:(e,t)=>gu(ey(e),e.getDay(),ty(t)),[Gt]:(e,t)=>gu(1,e.getDay(),ty(t))},ZP={[Fn]:e=>3*e,[pt]:(e,t)=>gu(e,0,ty(t))};function CS(e,t){return SS(e,t||1,QP,ZP,XP)}const eI={[Tt]:e=>e.getUTCFullYear(),[Fn]:e=>Math.floor(e.getUTCMonth()/3),[Wt]:e=>e.getUTCMonth(),[kn]:e=>e.getUTCDate(),[Vn]:e=>e.getUTCHours(),[Xn]:e=>e.getUTCMinutes(),[ui]:e=>e.getUTCSeconds(),[ki]:e=>e.getUTCMilliseconds(),[ir]:e=>OS(e),[pt]:e=>ny(e),[Gt]:(e,t)=>gu(1,e.getUTCDay(),iy(t)),[pt+Gt]:(e,t)=>gu(ny(e),e.getUTCDay(),iy(t))},tI={[Fn]:e=>3*e,[pt]:(e,t)=>gu(e,0,iy(t))};function $S(e,t){return SS(e,t||1,eI,tI,KP)}const nI={[Tt]:Ts,[Fn]:hh.every(3),[Wt]:hh,[pt]:ic,[kn]:Ms,[Gt]:Ms,[ir]:Ms,[Vn]:G1,[Xn]:W1,[ui]:Ds,[ki]:z1},iI={[Tt]:Rs,[Fn]:gh.every(3),[Wt]:gh,[pt]:sc,[kn]:Ns,[Gt]:Ns,[ir]:Ns,[Vn]:V1,[Xn]:Y1,[ui]:Ds,[ki]:z1};function pu(e){return nI[e]}function mu(e){return iI[e]}function FS(e,t,n){return e?e.offset(t,n):void 0}function kS(e,t,n){return FS(pu(e),t,n)}function DS(e,t,n){return FS(mu(e),t,n)}function MS(e,t,n,i){return e?e.range(t,n,i):void 0}function TS(e,t,n,i){return MS(pu(e),t,n,i)}function NS(e,t,n,i){return MS(mu(e),t,n,i)}const ac=1e3,uc=ac*60,lc=uc*60,ph=lc*24,rI=ph*7,RS=ph*30,ry=ph*365,jS=[Tt,Wt,kn,Vn,Xn,ui,ki],cc=jS.slice(0,-1),fc=cc.slice(0,-1),dc=fc.slice(0,-1),sI=dc.slice(0,-1),oI=[Tt,pt],LS=[Tt,Wt],PS=[Tt],hc=[[cc,1,ac],[cc,5,5*ac],[cc,15,15*ac],[cc,30,30*ac],[fc,1,uc],[fc,5,5*uc],[fc,15,15*uc],[fc,30,30*uc],[dc,1,lc],[dc,3,3*lc],[dc,6,6*lc],[dc,12,12*lc],[sI,1,ph],[oI,1,rI],[LS,1,RS],[LS,3,3*RS],[PS,1,ry]];function IS(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(Ql(t))/n;let r=ec(a=>a[2]).right(hc,i),s,o;return r===hc.length?(s=PS,o=ks(t[0]/ry,t[1]/ry,n)):r?(r=hc[i/hc[r-1][2]<hc[r][2]/i?r-1:r],s=r[0],o=r[1]):(s=jS,o=Math.max(ks(t[0],t[1],n),1)),{units:s,step:o}}function sy(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function oy(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function gc(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function BS(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=pc(r),c=mc(r),f=pc(s),d=mc(s),h=pc(o),g=mc(o),p=pc(a),m=mc(a),y=pc(u),v=mc(u),b={a:L,A:U,b:H,B:ae,c:null,d:HS,e:HS,f:FI,g:II,G:zI,H:SI,I:CI,j:$I,L:YS,m:kI,M:DI,p:De,q:Oe,Q:ZS,s:eC,S:MI,u:TI,U:NI,V:RI,w:jI,W:LI,x:null,X:null,y:PI,Y:BI,Z:UI,"%":QS},x={a:Ze,A:Be,b:st,B:sn,c:null,d:XS,e:XS,f:HI,g:nB,G:rB,H:qI,I:WI,j:GI,L:KS,m:YI,M:VI,p:Ai,q:si,Q:ZS,s:eC,S:XI,u:KI,U:JI,V:QI,w:ZI,W:eB,x:null,X:null,y:tB,Y:iB,Z:sB,"%":QS},E={a:O,A:C,b:k,B:F,c:j,d:WS,e:WS,f:EI,g:qS,G:US,H:GS,I:GS,j:vI,L:wI,m:yI,M:bI,p:S,q:mI,Q:AI,s:OI,S:xI,u:fI,U:dI,V:hI,w:cI,W:gI,x:$,X:R,y:qS,Y:US,Z:pI,"%":_I};b.x=_(n,b),b.X=_(i,b),b.c=_(t,b),x.x=_(n,x),x.X=_(i,x),x.c=_(t,x);function _(G,oe){return function(he){var I=[],lt=-1,ve=0,gt=G.length,ot,_s,Ur;for(he instanceof Date||(he=new Date(+he));++lt<gt;)G.charCodeAt(lt)===37&&(I.push(G.slice(ve,lt)),(_s=zS[ot=G.charAt(++lt)])!=null?ot=G.charAt(++lt):_s=ot==="e"?" ":"0",(Ur=oe[ot])&&(ot=Ur(he,_s)),I.push(ot),ve=lt+1);return I.push(G.slice(ve,lt)),I.join("")}}function w(G,oe){return function(he){var I=gc(1900,void 0,1),lt=A(I,G,he+="",0),ve,gt;if(lt!=he.length)return null;if("Q"in I)return new Date(I.Q);if("s"in I)return new Date(I.s*1e3+("L"in I?I.L:0));if(oe&&!("Z"in I)&&(I.Z=0),"p"in I&&(I.H=I.H%12+I.p*12),I.m===void 0&&(I.m="q"in I?I.q:0),"V"in I){if(I.V<1||I.V>53)return null;"w"in I||(I.w=1),"Z"in I?(ve=oy(gc(I.y,0,1)),gt=ve.getUTCDay(),ve=gt>4||gt===0?X1.ceil(ve):X1(ve),ve=Ns.offset(ve,(I.V-1)*7),I.y=ve.getUTCFullYear(),I.m=ve.getUTCMonth(),I.d=ve.getUTCDate()+(I.w+6)%7):(ve=sy(gc(I.y,0,1)),gt=ve.getDay(),ve=gt>4||gt===0?H1.ceil(ve):H1(ve),ve=Ms.offset(ve,(I.V-1)*7),I.y=ve.getFullYear(),I.m=ve.getMonth(),I.d=ve.getDate()+(I.w+6)%7)}else("W"in I||"U"in I)&&("w"in I||(I.w="u"in I?I.u%7:"W"in I?1:0),gt="Z"in I?oy(gc(I.y,0,1)).getUTCDay():sy(gc(I.y,0,1)).getDay(),I.m=0,I.d="W"in I?(I.w+6)%7+I.W*7-(gt+5)%7:I.w+I.U*7-(gt+6)%7);return"Z"in I?(I.H+=I.Z/100|0,I.M+=I.Z%100,oy(I)):sy(I)}}function A(G,oe,he,I){for(var lt=0,ve=oe.length,gt=he.length,ot,_s;lt<ve;){if(I>=gt)return-1;if(ot=oe.charCodeAt(lt++),ot===37){if(ot=oe.charAt(lt++),_s=E[ot in zS?oe.charAt(lt++):ot],!_s||(I=_s(G,he,I))<0)return-1}else if(ot!=he.charCodeAt(I++))return-1}return I}function S(G,oe,he){var I=l.exec(oe.slice(he));return I?(G.p=c.get(I[0].toLowerCase()),he+I[0].length):-1}function O(G,oe,he){var I=h.exec(oe.slice(he));return I?(G.w=g.get(I[0].toLowerCase()),he+I[0].length):-1}function C(G,oe,he){var I=f.exec(oe.slice(he));return I?(G.w=d.get(I[0].toLowerCase()),he+I[0].length):-1}function k(G,oe,he){var I=y.exec(oe.slice(he));return I?(G.m=v.get(I[0].toLowerCase()),he+I[0].length):-1}function F(G,oe,he){var I=p.exec(oe.slice(he));return I?(G.m=m.get(I[0].toLowerCase()),he+I[0].length):-1}function j(G,oe,he){return A(G,t,oe,he)}function $(G,oe,he){return A(G,n,oe,he)}function R(G,oe,he){return A(G,i,oe,he)}function L(G){return o[G.getDay()]}function U(G){return s[G.getDay()]}function H(G){return u[G.getMonth()]}function ae(G){return a[G.getMonth()]}function De(G){return r[+(G.getHours()>=12)]}function Oe(G){return 1+~~(G.getMonth()/3)}function Ze(G){return o[G.getUTCDay()]}function Be(G){return s[G.getUTCDay()]}function st(G){return u[G.getUTCMonth()]}function sn(G){return a[G.getUTCMonth()]}function Ai(G){return r[+(G.getUTCHours()>=12)]}function si(G){return 1+~~(G.getUTCMonth()/3)}return{format:function(G){var oe=_(G+="",b);return oe.toString=function(){return G},oe},parse:function(G){var oe=w(G+="",!1);return oe.toString=function(){return G},oe},utcFormat:function(G){var oe=_(G+="",x);return oe.toString=function(){return G},oe},utcParse:function(G){var oe=w(G+="",!0);return oe.toString=function(){return G},oe}}}var zS={"-":"",_:" ","0":"0"},Ot=/^\s*\d+/,aI=/^%/,uI=/[\\^$*+?|[\]().{}]/g;function Ce(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",s=r.length;return i+(s<n?new Array(n-s+1).join(t)+r:r)}function lI(e){return e.replace(uI,"\\$&")}function pc(e){return new RegExp("^(?:"+e.map(lI).join("|")+")","i")}function mc(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function cI(e,t,n){var i=Ot.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function fI(e,t,n){var i=Ot.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function dI(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function hI(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function gI(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function US(e,t,n){var i=Ot.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function qS(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function pI(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function mI(e,t,n){var i=Ot.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function yI(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function WS(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function vI(e,t,n){var i=Ot.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function GS(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function bI(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function xI(e,t,n){var i=Ot.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function wI(e,t,n){var i=Ot.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function EI(e,t,n){var i=Ot.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function _I(e,t,n){var i=aI.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function AI(e,t,n){var i=Ot.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function OI(e,t,n){var i=Ot.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function HS(e,t){return Ce(e.getDate(),t,2)}function SI(e,t){return Ce(e.getHours(),t,2)}function CI(e,t){return Ce(e.getHours()%12||12,t,2)}function $I(e,t){return Ce(1+Ms.count(Ts(e),e),t,3)}function YS(e,t){return Ce(e.getMilliseconds(),t,3)}function FI(e,t){return YS(e,t)+"000"}function kI(e,t){return Ce(e.getMonth()+1,t,2)}function DI(e,t){return Ce(e.getMinutes(),t,2)}function MI(e,t){return Ce(e.getSeconds(),t,2)}function TI(e){var t=e.getDay();return t===0?7:t}function NI(e,t){return Ce(ic.count(Ts(e)-1,e),t,2)}function VS(e){var t=e.getDay();return t>=4||t===0?rc(e):rc.ceil(e)}function RI(e,t){return e=VS(e),Ce(rc.count(Ts(e),e)+(Ts(e).getDay()===4),t,2)}function jI(e){return e.getDay()}function LI(e,t){return Ce(H1.count(Ts(e)-1,e),t,2)}function PI(e,t){return Ce(e.getFullYear()%100,t,2)}function II(e,t){return e=VS(e),Ce(e.getFullYear()%100,t,2)}function BI(e,t){return Ce(e.getFullYear()%1e4,t,4)}function zI(e,t){var n=e.getDay();return e=n>=4||n===0?rc(e):rc.ceil(e),Ce(e.getFullYear()%1e4,t,4)}function UI(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Ce(t/60|0,"0",2)+Ce(t%60,"0",2)}function XS(e,t){return Ce(e.getUTCDate(),t,2)}function qI(e,t){return Ce(e.getUTCHours(),t,2)}function WI(e,t){return Ce(e.getUTCHours()%12||12,t,2)}function GI(e,t){return Ce(1+Ns.count(Rs(e),e),t,3)}function KS(e,t){return Ce(e.getUTCMilliseconds(),t,3)}function HI(e,t){return KS(e,t)+"000"}function YI(e,t){return Ce(e.getUTCMonth()+1,t,2)}function VI(e,t){return Ce(e.getUTCMinutes(),t,2)}function XI(e,t){return Ce(e.getUTCSeconds(),t,2)}function KI(e){var t=e.getUTCDay();return t===0?7:t}function JI(e,t){return Ce(sc.count(Rs(e)-1,e),t,2)}function JS(e){var t=e.getUTCDay();return t>=4||t===0?oc(e):oc.ceil(e)}function QI(e,t){return e=JS(e),Ce(oc.count(Rs(e),e)+(Rs(e).getUTCDay()===4),t,2)}function ZI(e){return e.getUTCDay()}function eB(e,t){return Ce(X1.count(Rs(e)-1,e),t,2)}function tB(e,t){return Ce(e.getUTCFullYear()%100,t,2)}function nB(e,t){return e=JS(e),Ce(e.getUTCFullYear()%100,t,2)}function iB(e,t){return Ce(e.getUTCFullYear()%1e4,t,4)}function rB(e,t){var n=e.getUTCDay();return e=n>=4||n===0?oc(e):oc.ceil(e),Ce(e.getUTCFullYear()%1e4,t,4)}function sB(){return"+0000"}function QS(){return"%"}function ZS(e){return+e}function eC(e){return Math.floor(+e/1e3)}var yu,ay,tC,uy,nC;oB({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function oB(e){return yu=BS(e),ay=yu.format,tC=yu.parse,uy=yu.utcFormat,nC=yu.utcParse,yu}function yc(e){const t={};return n=>t[n]||(t[n]=e(n))}function aB(e,t){return n=>{const i=e(n),r=i.indexOf(t);if(r<0)return i;let s=uB(i,r);const o=s<i.length?i.slice(s):"";for(;--s>r;)if(i[s]!=="0"){++s;break}return i.slice(0,s)+o}}function uB(e,t){let n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function iC(e){const t=yc(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){const r=hu(i||",");if(r.precision==null){switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return aB(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,s,o){o=hu(o==null?",f":o);const a=ks(i,r,s),u=Math.max(Math.abs(i),Math.abs(r));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=hS(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=gS(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=dS(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}let ly;rC();function rC(){return ly=iC({format:dh,formatPrefix:L1})}function sC(e){return iC(fS(e))}function mh(e){return arguments.length?ly=sC(e):ly}function oC(e,t,n){n=n||{},ue(n)||N("Invalid time multi-format specifier: ".concat(n));const i=t(ui),r=t(Xn),s=t(Vn),o=t(kn),a=t(pt),u=t(Wt),l=t(Fn),c=t(Tt),f=e(n[ki]||".%L"),d=e(n[ui]||":%S"),h=e(n[Xn]||"%I:%M"),g=e(n[Vn]||"%I %p"),p=e(n[kn]||n[Gt]||"%a %d"),m=e(n[pt]||"%b %d"),y=e(n[Wt]||"%B"),v=e(n[Fn]||"%B"),b=e(n[Tt]||"%Y");return x=>(i(x)<x?f:r(x)<x?d:s(x)<x?h:o(x)<x?g:u(x)<x?a(x)<x?p:m:c(x)<x?l(x)<x?y:v:b)(x)}function aC(e){const t=yc(e.format),n=yc(e.utcFormat);return{timeFormat:i=>_e(i)?t(i):oC(t,pu,i),utcFormat:i=>_e(i)?n(i):oC(n,mu,i),timeParse:yc(e.parse),utcParse:yc(e.utcParse)}}let cy;uC();function uC(){return cy=aC({format:ay,parse:tC,utcFormat:uy,utcParse:nC})}function lC(e){return aC(BS(e))}function vc(e){return arguments.length?cy=lC(e):cy}const fy=(e,t)=>de({},e,t);function cC(e,t){const n=e?sC(e):mh(),i=t?lC(t):vc();return fy(n,i)}function dy(e,t){const n=arguments.length;return n&&n!==2&&N("defaultLocale expects either zero or two arguments."),n?fy(mh(e),vc(t)):fy(mh(),vc())}function lB(){return rC(),uC(),dy()}const cB=/^(data:|([A-Za-z]+:)?\/\/)/,fB=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,dB=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,fC="file://";function hB(e,t){return n=>({options:n||{},sanitize:pB,load:gB,fileAccess:!!t,file:mB(t),http:vB(e)})}async function gB(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function pB(e,t){t=de({},this.options,t);const n=this.fileAccess,i={href:null};let r,s,o;const a=fB.test(e.replace(dB,""));(e==null||typeof e!="string"||!a)&&N("Sanitize failure, invalid URI: "+ee(e));const u=cB.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(r=e.startsWith(fC))||t.mode==="file"||t.mode!=="http"&&!u&&n,r?e=e.slice(fC.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!s}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function mB(e){return e?t=>new Promise((n,i)=>{e.readFile(t,(r,s)=>{r?i(r):n(s)})}):yB}async function yB(){N("No file system access.")}function vB(e){return e?async function(t,n){const i=de({},this.options.http,n),r=n&&n.response,s=await e(t,i);return s.ok?ge(s[r])?s[r]():s.text():N(s.status+""+s.statusText)}:bB}async function bB(){N("No HTTP fetch method available.")}const xB=e=>e!=null&&e===e,wB=e=>e==="true"||e==="false"||e===!0||e===!1,EB=e=>!Number.isNaN(Date.parse(e)),dC=e=>!Number.isNaN(+e)&&!(e instanceof Date),_B=e=>dC(e)&&Number.isInteger(+e),hy={boolean:A1,integer:Ut,number:Ut,date:O1,string:S1,unknown:un},yh=[wB,_B,dC,EB],AB=["boolean","integer","number","date"];function hC(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=yh.length,r=yh.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<i;++a)if(r[a]&&xB(u)&&!yh[a](u)&&(r[a]=0,++o,o===yh.length))return"string";return AB[r.reduce((s,o)=>s===0?o:s,0)-1]}function gC(e,t){return t.reduce((n,i)=>(n[i]=hC(e,i),n),{})}function pC(e){const t=function(n,i){const r={delimiter:e};return gy(n,i?de(i,r):r)};return t.responseType="text",t}function gy(e,t){return t.header&&(e=t.header.map(ee).join(t.delimiter)+`
`+e),fP(t.delimiter).parse(e+"")}gy.responseType="text";function OB(e){return typeof Buffer=="function"&&ge(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function py(e,t){const n=t&&t.property?Cn(t.property):un;return ue(e)&&!OB(e)?SB(n(e),t):n(JSON.parse(e))}py.responseType="json";function SB(e,t){return!K(e)&&IO(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const CB={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function mC(e,t){let n,i,r,s;return e=py(e,t),t&&t.feature?(n=pP,r=t.feature):t&&t.mesh?(n=yP,r=t.mesh,s=CB[t.filter]):N("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,s):N("Invalid TopoJSON object: "+r),i&&i.features||[i]}mC.responseType="json";const vh={dsv:gy,csv:pC(","),tsv:pC("	"),json:py,topojson:mC};function my(e,t){return arguments.length>1?(vh[e]=t,this):se(vh,e)?vh[e]:null}function yC(e){const t=my(e);return t&&t.responseType||"text"}function vC(e,t,n,i){t=t||{};const r=my(t.type||"json");return r||N("Unknown data format type: "+t.type),e=r(e,t),t.parse&&$B(e,t.parse,n,i),se(e,"columns")&&delete e.columns,e}function $B(e,t,n,i){if(!e.length)return;const r=vc();n=n||r.timeParse,i=i||r.utcParse;let s=e.columns||Object.keys(e[0]),o,a,u,l,c,f;t==="auto"&&(t=gC(e,s)),s=Object.keys(t);const d=s.map(h=>{const g=t[h];let p,m;if(g&&(g.startsWith("date:")||g.startsWith("utc:")))return p=g.split(/:(.+)?/,2),m=p[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(p[0]==="utc"?i:n)(m);if(!hy[g])throw Error("Illegal format pattern: "+h+":"+g);return hy[g]});for(u=0,c=e.length,f=s.length;u<c;++u)for(o=e[u],l=0;l<f;++l)a=s[l],o[a]=d[l](o[a])}const bh=hB(typeof fetch!="undefined"&&fetch,null);function xh(e){const t=e||un,n=[],i={};return n.add=r=>{const s=t(r);return i[s]||(i[s]=1,n.push(r)),n},n.remove=r=>{const s=t(r);if(i[s]){i[s]=0;const o=n.indexOf(r);o>=0&&n.splice(o,1)}return n},n}async function wh(e,t){try{await t(e)}catch(n){e.error(n)}}const bC=Symbol("vega_id");let FB=1;function Eh(e){return!!(e&&J(e))}function J(e){return e[bC]}function xC(e,t){return e[bC]=t,e}function Me(e){const t=e===Object(e)?e:{data:e};return J(t)?t:xC(t,FB++)}function yy(e){return _h(e,Me({}))}function _h(e,t){for(const n in e)t[n]=e[n];return t}function wC(e,t){return xC(t,J(e))}function Vo(e,t){return e?t?(n,i)=>e(n,i)||J(t(n))-J(t(i)):(n,i)=>e(n,i)||J(n)-J(i):null}function EC(e){return e&&e.constructor===Xo}function Xo(){const e=[],t=[],n=[],i=[],r=[];let s=null,o=!1;return{constructor:Xo,insert(a){const u=re(a),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(a){const u=ge(a)?i:t,l=re(a),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(a,u,l){const c={field:u,value:qt(l)};return ge(a)?(c.filter=a,r.push(c)):(c.tuple=a,n.push(c)),this},encode(a,u){return ge(a)?r.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return s=a,this},reflow(){return o=!0,this},pulse(a,u){const l={},c={};let f,d,h,g,p,m;for(f=0,d=u.length;f<d;++f)l[J(u[f])]=1;for(f=0,d=t.length;f<d;++f)p=t[f],l[J(p)]=-1;for(f=0,d=i.length;f<d;++f)g=i[f],u.forEach(v=>{g(v)&&(l[J(v)]=-1)});for(f=0,d=e.length;f<d;++f)p=e[f],m=J(p),l[m]?l[m]=1:a.add.push(Me(e[f]));for(f=0,d=u.length;f<d;++f)p=u[f],l[J(p)]<0&&a.rem.push(p);function y(v,b,x){x?v[b]=x(v):a.encode=b,o||(c[J(v)]=v)}for(f=0,d=n.length;f<d;++f)h=n[f],p=h.tuple,g=h.field,m=l[J(p)],m>0&&(y(p,g,h.value),a.modifies(g));for(f=0,d=r.length;f<d;++f)h=r[f],g=h.filter,u.forEach(v=>{g(v)&&l[J(v)]>0&&y(v,h.field,h.value)}),a.modifies(h.field);if(o)a.mod=t.length||i.length?u.filter(v=>l[J(v)]>0):u.slice();else for(m in c)a.mod.push(c[m]);return(s||s==null&&(t.length||i.length))&&a.clean(!0),a}}}const Ah="_:mod:_";function Oh(){Object.defineProperty(this,Ah,{writable:!0,value:{}})}Oh.prototype={set(e,t,n,i){const r=this,s=r[e],o=r[Ah];return t!=null&&t>=0?(s[t]!==n||i)&&(s[t]=n,o[t+":"+e]=-1,o[e]=-1):(s!==n||i)&&(r[e]=n,o[e]=K(n)?1+n.length:-1),r},modified(e,t){const n=this[Ah];if(arguments.length){if(K(e)){for(let i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(const i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[Ah]={},this}};let kB=0;const DB="pulse",MB=new Oh,TB=1,NB=2;function ze(e,t,n,i){this.id=++kB,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function _C(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}ze.prototype={targets(){return this._targets||(this._targets=xh(Xl))},set(e){return this.value!==e?(this.value=e,1):0},skip:_C(TB),modified:_C(NB),parameters(e,t,n){t=t!==!1;const i=this._argval=this._argval||new Oh,r=this._argops=this._argops||[],s=[];let o,a,u,l;const c=(f,d,h)=>{h instanceof ze?(h!==this&&(t&&h.targets().add(this),s.push(h)),r.push({op:h,name:f,index:d})):i.set(f,d,h)};for(o in e)if(a=e[o],o===DB)re(a).forEach(f=>{f instanceof ze?f!==this&&(f.targets().add(this),s.push(f)):N("Pulse parameters must be operator instances.")}),this.source=a;else if(K(a))for(i.set(o,-1,Array(u=a.length)),l=0;l<u;++l)c(o,l,a[l]);else c(o,-1,a);return this.marshall().clear(),n&&(r.initonly=!0),s},marshall(e){const t=this._argval||MB,n=this._argops;let i,r,s,o;if(n){const a=n.length;for(r=0;r<a;++r)i=n[r],s=i.op,o=s.modified()&&s.stamp===e,t.set(i.name,i.index,s.value,o);if(n.initonly){for(r=0;r<a;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function RB(e,t,n,i){let r=1,s;return e instanceof ze?s=e:e&&e.prototype instanceof ze?s=new e:ge(e)?s=new ze(null,e):(r=0,s=new ze(e,t)),this.rank(s),r&&(i=n,n=t),n&&this.connect(s,s.parameters(n,i)),this.touch(s),s}function jB(e,t){const n=e.rank,i=t.length;for(let r=0;r<i;++r)if(n<t[r].rank){this.rerank(e);return}}let LB=0;function Sh(e,t,n){this.id=++LB,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function js(e,t,n){return new Sh(e,t,n)}Sh.prototype={_filter:oi,_apply:un,targets(){return this._targets||(this._targets=xh(Xl))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=js(e);return this.targets().add(t),t},apply(e){const t=js(null,e);return this.targets().add(t),t},merge(){const e=js();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=js();return this.targets().add(js(null,null,w1(e,n=>{const i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},between(e,t){let n=!1;return e.targets().add(js(null,null,()=>n=!0)),t.targets().add(js(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=oi,this._targets=null}};function PB(e,t,n,i){const r=this,s=js(n,i),o=function(l){l.dataflow=r;try{s.receive(l)}catch(c){r.error(c)}finally{r.run()}};let a;typeof e=="string"&&typeof document!="undefined"?a=document.querySelectorAll(e):a=re(e);const u=a.length;for(let l=0;l<u;++l)a[l].addEventListener(t,o);return s}function IB(e,t){const n=this.locale();return vC(e,t,n.timeParse,n.utcParse)}function BB(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function zB(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:yC(t&&t.type)});try{r=n.parse(r,t)}catch(s){i=-2,n.warn("Data ingestion failed",e,s)}}catch(s){i=-1,n.warn("Loading failed",e,s)}return{data:r,status:i}}async function UB(e,t,n){const i=this,r=i._pending||qB(i);r.requests+=1;const s=await i.request(t,n);return i.pulse(e,i.changeset().remove(oi).insert(s.data||[])),r.done(),s}function qB(e){let t;const n=new Promise(i=>t=i);return n.requests=0,n.done=()=>{--n.requests==0&&(e._pending=null,t(e))},e._pending=n}const WB={skip:!0};function GB(e,t,n,i,r){return(e instanceof ze?YB:HB)(this,e,t,n,i,r),this}function HB(e,t,n,i,r,s){const o=de({},s,WB);let a,u;ge(n)||(n=qt(n)),i===void 0?a=l=>e.touch(n(l)):ge(i)?(u=new ze(null,i,r,!1),a=l=>{u.evaluate(l);const c=n(l),f=u.value;EC(f)?e.pulse(c,f,s):e.update(c,f,o)}):a=l=>e.update(n(l),i,o),t.apply(a)}function YB(e,t,n,i,r,s){if(i===void 0)t.targets().add(n);else{const o=s||{},a=new ze(null,VB(n,i),r,!1);a.modified(o.force),a.rank=t.rank,t.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),e.connect(n,[a]))}}function VB(e,t){return t=ge(t)?t:qt(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function XB(e){e.rank=++this._rank}function KB(e){const t=[e];let n,i,r;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&N("Cycle detected in dataflow graph.")}const Ch={},rr=1<<0,Ls=1<<1,Yr=1<<2,JB=rr|Ls,AC=rr|Yr,vu=rr|Ls|Yr,OC=1<<3,bc=1<<4,SC=1<<5,CC=1<<6;function Ps(e,t,n){this.dataflow=e,this.stamp=t==null?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function vy(e,t){const n=[];return Fs(e,t,i=>n.push(i)),n}function $C(e,t){const n={};return e.visit(t,i=>{n[J(i)]=1}),i=>n[J(i)]?null:i}function $h(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}Ps.prototype={StopPropagation:Ch,ADD:rr,REM:Ls,MOD:Yr,ADD_REM:JB,ADD_MOD:AC,ALL:vu,REFLOW:OC,SOURCE:bc,NO_SOURCE:SC,NO_FIELDS:CC,fork(e){return new Ps(this.dataflow).init(this,e)},clone(){const e=this.fork(vu);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(vu|bc)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new Ps(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&CC)&&(n.fields=e.fields),t&rr?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&Ls?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&Yr?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&SC?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||vu;return t&rr&&this.add.length||t&Ls&&this.rem.length||t&Yr&&this.mod.length},reflow(e){if(e)return this.fork(vu).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(Yr,$C(this,rr))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return K(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?K(e)?e.some(i=>n[i]):n[e]:!!n:!1},filter(e,t){const n=this;return e&rr&&(n.addF=$h(n.addF,t)),e&Ls&&(n.remF=$h(n.remF,t)),e&Yr&&(n.modF=$h(n.modF,t)),e&bc&&(n.srcF=$h(n.srcF,t)),n},materialize(e){e=e||vu;const t=this;return e&rr&&t.addF&&(t.add=vy(t.add,t.addF),t.addF=null),e&Ls&&t.remF&&(t.rem=vy(t.rem,t.remF),t.remF=null),e&Yr&&t.modF&&(t.mod=vy(t.mod,t.modF),t.modF=null),e&bc&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(e&bc)return Fs(n.source,n.srcF,i),n;e&rr&&Fs(n.add,n.addF,i),e&Ls&&Fs(n.rem,n.remF,i),e&Yr&&Fs(n.mod,n.modF,i);const r=n.source;if(e&OC&&r){const s=n.add.length+n.mod.length;s===r.length||(s?Fs(r,$C(n,AC),i):Fs(r,n.srcF,i))}return n}};function by(e,t,n,i){const r=this,s=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(let a=0;a<s;++a){const u=n[a];if(u.stamp===t){if(u.fields){const l=r.fields||(r.fields={});for(const c in u.fields)l[c]=1}u.changed(r.ADD)&&(o|=r.ADD),u.changed(r.REM)&&(o|=r.REM),u.changed(r.MOD)&&(o|=r.MOD)}}this.changes=o}z(by,Ps,{fork(e){const t=new Ps(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?K(e)?e.some(i=>n[i]):n[e]:0},filter(){N("MultiPulse does not support filtering.")},materialize(){N("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,r=i.length;let s=0;if(e&n.SOURCE)for(;s<r;++s)i[s].visit(e,t);else for(;s<r;++s)i[s].stamp===n.stamp&&i[s].visit(e,t);return n}});async function QB(e,t,n){const i=this,r=[];if(i._pulse)return FC(i);if(i._pending&&await i._pending,t&&await wh(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const s=++i._clock;i._pulse=new Ps(i,s,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=xh(Xl);let o=0,a,u,l;try{for(;i._heap.size()>0;){if(a=i._heap.pop(),a.rank!==a.qrank){i._enqueue(a,!0);continue}u=a.run(i._getPulse(a,e)),u.then?u=await u:u.async&&(r.push(u.async),u=Ch),u!==Ch&&a._targets&&a._targets.forEach(c=>i._enqueue(c)),++o}}catch(c){i._heap.clear(),l=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${s}: ${o} operators`),l&&(i._postrun=[],i.error(l)),i._postrun.length){const c=i._postrun.sort((f,d)=>d.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await wh(i,c[f].callback)}return n&&await wh(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(d){i.error(d)}})})),i}async function ZB(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function ez(e,t,n){return this._pulse?FC(this):(this.evaluate(e,t,n),this)}function tz(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function FC(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function nz(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function iz(e,t){const n=e.source,i=this._clock;return n&&K(n)?new by(this,i,n.map(r=>r.pulse),t):this._input[e.id]||rz(this._pulse,n&&n.pulse)}function rz(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Ch&&(e.source=t.source),e)}const xy={skip:!1,force:!1};function sz(e,t){const n=t||xy;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function oz(e,t,n){const i=n||xy;return(e.set(t)||i.force)&&this.touch(e,i),this}function az(e,t,n){this.touch(e,n||xy);const i=new Ps(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function uz(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),kC(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,lz(t,0,e)):i=n,i}}}function kC(e,t,n,i){let r,s;const o=e[n];for(;n>t;){if(s=n-1>>1,r=e[s],i(o,r)<0){e[n]=r,n=s;continue}break}return e[n]=o}function lz(e,t,n){const i=t,r=e.length,s=e[t];let o=(t<<1)+1,a;for(;o<r;)a=o+1,a<r&&n(e[o],e[a])>=0&&(o=a),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=s,kC(e,i,t,n)}function bu(){this.logger(AO()),this.logLevel(m1),this._clock=0,this._rank=0,this._locale=dy();try{this._loader=bh()}catch{}this._touched=xh(Xl),this._input={},this._pulse=null,this._heap=uz((e,t)=>e.qrank-t.qrank),this._postrun=[]}function xc(e){return function(){return this._log[e].apply(this,arguments)}}bu.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:xc("error"),warn:xc("warn"),info:xc("info"),debug:xc("debug"),logLevel:xc("level"),cleanThreshold:1e4,add:RB,connect:jB,rank:XB,rerank:KB,pulse:az,touch:sz,update:oz,changeset:Xo,ingest:BB,parse:IB,preload:UB,request:zB,events:PB,on:GB,evaluate:QB,run:ez,runAsync:ZB,runAfter:tz,_enqueue:nz,_getPulse:iz};function D(e,t){ze.call(this,e,null,t)}z(D,ze,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const xu={};function DC(e){const t=MC(e);return t&&t.Definition||null}function MC(e){return e=e&&e.toLowerCase(),se(xu,e)?xu[e]:null}function*TC(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function wy(e,t,n){const i=Float64Array.from(TC(e,n));return i.sort(fu),t.map(r=>tS(i,r))}function Ey(e,t){return wy(e,[.25,.5,.75],t)}function _y(e,t){const n=e.length,i=AP(e,t),r=Ey(e,t),s=(r[2]-r[0])/1.34,o=Math.min(i,s)||i||Math.abs(r[0])||1;return 1.06*o*Math.pow(n,-.2)}function NC(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2];let s=e.extent[0],o=e.extent[1],a,u,l,c,f,d;const h=e.span||o-s||Math.abs(s)||1;if(e.step)a=e.step;else if(e.steps){for(c=h/t,f=0,d=e.steps.length;f<d&&e.steps[f]<c;++f);a=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/i),l=e.minstep||0,a=Math.max(l,Math.pow(n,Math.round(Math.log(h)/i)-u));Math.ceil(h/a)>t;)a*=n;for(f=0,d=r.length;f<d;++f)c=a/r[f],c>=l&&h/c<=t&&(a=c)}c=Math.log(a);const g=c>=0?0:~~(-c/i)+1,p=Math.pow(n,-g-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(s/a+p)*a,s=s<c?c-a:c,o=Math.ceil(o/a)*a),{start:s,stop:o===s?s+a:o,step:a}}var li=Math.random;function cz(e){li=e}function RC(e,t,n,i){if(!e.length)return[void 0,void 0];const r=Float64Array.from(TC(e,i)),s=r.length,o=t;let a,u,l,c;for(l=0,c=Array(o);l<o;++l){for(a=0,u=0;u<s;++u)a+=r[~~(li()*s)];c[l]=a/s}return c.sort(fu),[R1(c,n/2),R1(c,1-n/2)]}function jC(e,t,n,i){i=i||(d=>d);const r=e.length,s=new Float64Array(r);let o=0,a=1,u=i(e[0]),l=u,c=u+t,f;for(;a<r;++a){if(f=i(e[a]),f>=c){for(l=(u+l)/2;o<a;++o)s[o]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;o<a;++o)s[o]=l;return n?fz(s,t+t/4):s}function fz(e,t){const n=e.length;let i=0,r=1,s,o;for(;e[i]===e[r];)++r;for(;r<n;){for(s=r+1;e[r]===e[s];)++s;if(e[r]-e[r-1]<t){for(o=r+(i+s-r-r>>1);o<r;)e[o++]=e[r];for(;o>r;)e[o--]=e[i]}i=r,r=s}return e}function dz(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function hz(e,t){t==null&&(t=e,e=0);let n,i,r;const s={min(o){return arguments.length?(n=o||0,r=i-n,s):n},max(o){return arguments.length?(i=o||0,r=i-n,s):i},sample(){return n+Math.floor(r*li())},pdf(o){return o===Math.floor(o)&&o>=n&&o<i?1/r:0},cdf(o){const a=Math.floor(o);return a<n?0:a>=i?1:(a-n+1)/r},icdf(o){return o>=0&&o<=1?n-1+Math.floor(o*r):NaN}};return s.min(e).max(t)}const LC=Math.sqrt(2*Math.PI),gz=Math.SQRT2;let wc=NaN;function Fh(e,t){e=e||0,t=t==null?1:t;let n=0,i=0,r,s;if(wc===wc)n=wc,wc=NaN;else{do n=li()*2-1,i=li()*2-1,r=n*n+i*i;while(r===0||r>1);s=Math.sqrt(-2*Math.log(r)/r),n*=s,wc=i*s}return e+n*t}function Ay(e,t,n){n=n==null?1:n;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*LC)}function kh(e,t,n){t=t||0,n=n==null?1:n;const i=(e-t)/n,r=Math.abs(i);let s;if(r>37)s=0;else{const o=Math.exp(-r*r/2);let a;r<7.07106781186547?(a=.0352624965998911*r+.700383064443688,a=a*r+6.37396220353165,a=a*r+33.912866078383,a=a*r+112.079291497871,a=a*r+221.213596169931,a=a*r+220.206867912376,s=o*a,a=.0883883476483184*r+1.75566716318264,a=a*r+16.064177579207,a=a*r+86.7807322029461,a=a*r+296.564248779674,a=a*r+637.333633378831,a=a*r+793.826512519948,a=a*r+440.413735824752,s=s/a):(a=r+.65,a=r+4/a,a=r+3/a,a=r+2/a,a=r+1/a,s=o/a/2.506628274631)}return i>0?1-s:s}function Dh(e,t,n){return e<0||e>1?NaN:(t||0)+(n==null?1:n)*gz*pz(2*e-1)}function pz(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function Oy(e,t){let n,i;const r={mean(s){return arguments.length?(n=s||0,r):n},stdev(s){return arguments.length?(i=s==null?1:s,r):i},sample:()=>Fh(n,i),pdf:s=>Ay(s,n,i),cdf:s=>kh(s,n,i),icdf:s=>Dh(s,n,i)};return r.mean(e).stdev(t)}function Sy(e,t){const n=Oy();let i=0;const r={data(s){return arguments.length?(e=s,i=s?s.length:0,r.bandwidth(t)):e},bandwidth(s){return arguments.length?(t=s,!t&&e&&(t=_y(e)),r):t},sample(){return e[~~(li()*i)]+t*n.sample()},pdf(s){let o=0,a=0;for(;a<i;++a)o+=n.pdf((s-e[a])/t);return o/t/i},cdf(s){let o=0,a=0;for(;a<i;++a)o+=n.cdf((s-e[a])/t);return o/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(e)}function Cy(e,t){return e=e||0,t=t==null?1:t,Math.exp(e+Fh()*t)}function $y(e,t,n){if(e<=0)return 0;t=t||0,n=n==null?1:n;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*LC*e)}function Fy(e,t,n){return kh(Math.log(e),t,n)}function ky(e,t,n){return Math.exp(Dh(e,t,n))}function PC(e,t){let n,i;const r={mean(s){return arguments.length?(n=s||0,r):n},stdev(s){return arguments.length?(i=s==null?1:s,r):i},sample:()=>Cy(n,i),pdf:s=>$y(s,n,i),cdf:s=>Fy(s,n,i),icdf:s=>ky(s,n,i)};return r.mean(e).stdev(t)}function IC(e,t){let n=0,i;function r(o){const a=[];let u=0,l;for(l=0;l<n;++l)u+=a[l]=o[l]==null?1:+o[l];for(l=0;l<n;++l)a[l]/=u;return a}const s={weights(o){return arguments.length?(i=r(t=o||[]),s):t},distributions(o){return arguments.length?(o?(n=o.length,e=o):(n=0,e=[]),s.weights(t)):e},sample(){const o=li();let a=e[n-1],u=i[0],l=0;for(;l<n-1;u+=i[++l])if(o<u){a=e[l];break}return a.sample()},pdf(o){let a=0,u=0;for(;u<n;++u)a+=i[u]*e[u].pdf(o);return a},cdf(o){let a=0,u=0;for(;u<n;++u)a+=i[u]*e[u].cdf(o);return a},icdf(){throw Error("Mixture icdf not supported.")}};return s.distributions(e).weights(t)}function Dy(e,t){return t==null&&(t=e==null?1:e,e=0),e+(t-e)*li()}function My(e,t,n){return n==null&&(n=t==null?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function Ty(e,t,n){return n==null&&(n=t==null?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Ny(e,t,n){return n==null&&(n=t==null?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function BC(e,t){let n,i;const r={min(s){return arguments.length?(n=s||0,r):n},max(s){return arguments.length?(i=s==null?1:s,r):i},sample:()=>Dy(n,i),pdf:s=>My(s,n,i),cdf:s=>Ty(s,n,i),icdf:s=>Ny(s,n,i)};return t==null&&(t=e==null?1:e,e=0),r.min(e).max(t)}function Ec(e,t,n,i){const r=i-e*e,s=Math.abs(r)<1e-24?0:(n-e*t)/r;return[t-s*e,s]}function Mh(e,t,n,i){e=e.filter(h=>{let g=t(h),p=n(h);return g!=null&&(g=+g)>=g&&p!=null&&(p=+p)>=p}),i&&e.sort((h,g)=>t(h)-t(g));const r=e.length,s=new Float64Array(r),o=new Float64Array(r);let a=0,u=0,l=0,c,f,d;for(d of e)s[a]=c=+t(d),o[a]=f=+n(d),++a,u+=(c-u)/a,l+=(f-l)/a;for(a=0;a<r;++a)s[a]-=u,o[a]-=l;return[s,o,u,l]}function _c(e,t,n,i){let r=-1,s,o;for(const a of e)s=t(a),o=n(a),s!=null&&(s=+s)>=s&&o!=null&&(o=+o)>=o&&i(s,o,++r)}function wu(e,t,n,i,r){let s=0,o=0;return _c(e,t,n,(a,u)=>{const l=u-r(a),c=u-i;s+=l*l,o+=c*c}),1-s/o}function Ry(e,t,n){let i=0,r=0,s=0,o=0,a=0;_c(e,t,n,(c,f)=>{++a,i+=(c-i)/a,r+=(f-r)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=Ec(i,r,s,o),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:wu(e,t,n,r,l)}}function zC(e,t,n){let i=0,r=0,s=0,o=0,a=0;_c(e,t,n,(c,f)=>{++a,c=Math.log(c),i+=(c-i)/a,r+=(f-r)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=Ec(i,r,s,o),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:wu(e,t,n,r,l)}}function UC(e,t,n){const[i,r,s,o]=Mh(e,t,n);let a=0,u=0,l=0,c=0,f=0,d,h,g;_c(e,t,n,(v,b)=>{d=i[f++],h=Math.log(b),g=d*b,a+=(b*h-a)/f,u+=(g-u)/f,l+=(g*h-l)/f,c+=(d*g-c)/f});const[p,m]=Ec(u/o,a/o,l/o,c/o),y=v=>Math.exp(p+m*(v-s));return{coef:[Math.exp(p-m*s),m],predict:y,rSquared:wu(e,t,n,o,y)}}function qC(e,t,n){let i=0,r=0,s=0,o=0,a=0,u=0;_c(e,t,n,(f,d)=>{const h=Math.log(f),g=Math.log(d);++u,i+=(h-i)/u,r+=(g-r)/u,s+=(h*g-s)/u,o+=(h*h-o)/u,a+=(d-a)/u});const l=Ec(i,r,s,o),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:wu(e,t,n,a,c)}}function jy(e,t,n){const[i,r,s,o]=Mh(e,t,n),a=i.length;let u=0,l=0,c=0,f=0,d=0,h,g,p,m;for(h=0;h<a;)g=i[h],p=r[h++],m=g*g,u+=(m-u)/h,l+=(m*g-l)/h,c+=(m*m-c)/h,f+=(g*p-f)/h,d+=(m*p-d)/h;const y=c-u*u,v=u*y-l*l,b=(d*u-f*l)/v,x=(f*y-d*l)/v,E=-b*u,_=w=>(w=w-s,b*w*w+x*w+E+o);return{coef:[E-x*s+b*s*s+o,x-2*b*s,b],predict:_,rSquared:wu(e,t,n,o,_)}}function WC(e,t,n,i){if(i===1)return Ry(e,t,n);if(i===2)return jy(e,t,n);const[r,s,o,a]=Mh(e,t,n),u=r.length,l=[],c=[],f=i+1;let d,h,g,p,m;for(d=0;d<f;++d){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d)*s[g];for(l.push(p),m=new Float64Array(f),h=0;h<f;++h){for(g=0,p=0;g<u;++g)p+=Math.pow(r[g],d+h);m[h]=p}c.push(m)}c.push(l);const y=yz(c),v=b=>{b-=o;let x=a+y[0]+y[1]*b+y[2]*b*b;for(d=3;d<f;++d)x+=y[d]*Math.pow(b,d);return x};return{coef:mz(f,y,-o,a),predict:v,rSquared:wu(e,t,n,a,v)}}function mz(e,t,n,i){const r=Array(e);let s,o,a,u;for(s=0;s<e;++s)r[s]=0;for(s=e-1;s>=0;--s)for(a=t[s],u=1,r[s]+=a,o=1;o<=s;++o)u*=(s+1-o)/o,r[s-o]+=a*Math.pow(n,o)*u;return r[0]+=i,r}function yz(e){const t=e.length-1,n=[];let i,r,s,o,a;for(i=0;i<t;++i){for(o=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][o])&&(o=r);for(s=i;s<t+1;++s)a=e[s][i],e[s][i]=e[s][o],e[s][o]=a;for(r=i+1;r<t;++r)for(s=t;s>=i;s--)e[s][r]-=e[s][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(a=0,s=r+1;s<t;++s)a+=e[s][r]*n[s];n[r]=(e[t][r]-a)/e[r][r]}return n}const GC=2,HC=1e-12;function YC(e,t,n,i){const[r,s,o,a]=Mh(e,t,n,!0),u=r.length,l=Math.max(2,~~(i*u)),c=new Float64Array(u),f=new Float64Array(u),d=new Float64Array(u).fill(1);for(let h=-1;++h<=GC;){const g=[0,l-1];for(let m=0;m<u;++m){const y=r[m],v=g[0],b=g[1],x=y-r[v]>r[b]-y?v:b;let E=0,_=0,w=0,A=0,S=0;const O=1/Math.abs(r[x]-y||1);for(let F=v;F<=b;++F){const j=r[F],$=s[F],R=vz(Math.abs(y-j)*O)*d[F],L=j*R;E+=R,_+=L,w+=$*R,A+=$*L,S+=j*L}const[C,k]=Ec(_/E,w/E,A/E,S/E);c[m]=C+k*y,f[m]=Math.abs(s[m]-c[m]),bz(r,m+1,g)}if(h===GC)break;const p=nS(f);if(Math.abs(p)<HC)break;for(let m=0,y,v;m<u;++m)y=f[m]/(6*p),d[m]=y>=1?HC:(v=1-y*y)*v}return xz(r,c,o,a)}function vz(e){return(e=1-e*e*e)*e*e}function bz(e,t,n){const i=e[t];let r=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>r&&e[s]-i<=i-e[r];)n[0]=++r,n[1]=s,++s}function xz(e,t,n,i){const r=e.length,s=[];let o=0,a=0,u=[],l;for(;o<r;++o)l=e[o]+n,u[0]===l?u[1]+=(t[o]-u[1])/++a:(a=0,u[1]+=i,u=[l,t[o]],s.push(u));return u[1]+=i,s}const wz=.5*Math.PI/180;function Th(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=p=>[p,e(p)],s=t[0],o=t[1],a=o-s,u=a/i,l=[r(s)],c=[];if(n===i){for(let p=1;p<i;++p)l.push(r(s+p/n*a));return l.push(r(o)),l}else{c.push(r(o));for(let p=n;--p>0;)c.push(r(s+p/n*a))}let f=l[0],d=c[c.length-1];const h=1/a,g=Ez(f[1],c);for(;d;){const p=r((f[0]+d[0])/2);p[0]-f[0]>=u&&_z(f,p,d,h,g)>wz?c.push(p):(f=d,l.push(d),c.pop()),d=c[c.length-1]}return l}function Ez(e,t){let n=e,i=e;const r=t.length;for(let s=0;s<r;++s){const o=t[s][1];o<n&&(n=o),o>i&&(i=o)}return 1/(i-n)}function _z(e,t,n,i,r){const s=Math.atan2(r*(n[1]-e[1]),i*(n[0]-e[0])),o=Math.atan2(r*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(s-o)}function Az(e){return t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}}function Ly(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:Az(e)}function VC(e,t,n){return n||e+(t?"_"+t:"")}const Py=()=>{},Oz={init:Py,add:Py,rem:Py,idx:0},Ac={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Oc=Object.keys(Ac);function Sz(e,t){return n=>de({name:e,out:n||e},Oz,t)}Oc.forEach(e=>{Ac[e]=Sz(e,Ac[e])});function XC(e,t){return Ac[e](t)}function KC(e,t){return e.idx-t.idx}function Cz(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{!i.req||i.req.forEach(r=>{t[r]||n(t[r]=Ac[r]())})};return e.forEach(n),Object.values(t).sort(KC)}function $z(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function Fz(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function kz(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function Dz(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function JC(e,t){const n=t||un,i=Cz(e),r=e.slice().sort(KC);function s(o){this._ops=i,this._out=r,this.cell=o,this.init()}return s.prototype.init=$z,s.prototype.add=Fz,s.prototype.rem=kz,s.prototype.set=Dz,s.prototype.get=n,s.fields=e.map(o=>o.out),s}function Iy(e){this._key=e?Cn(e):J,this.reset()}const Nt=Iy.prototype;Nt.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};Nt.add=function(e){this._add.push(e)};Nt.rem=function(e){this._rem.push(e)};Nt.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,s=Array(i-r),o={};let a,u,l;for(a=0;a<r;++a)o[n(t[a])]=1;for(a=0,u=0;a<i;++a)o[n(l=e[a])]?o[n(l)]=0:s[u++]=l;return this._rem=[],this._add=s};Nt.distinct=function(e){const t=this.values(),n={};let i=t.length,r=0,s;for(;--i>=0;)s=e(t[i])+"",se(n,s)||(n[s]=1,++r);return r};Nt.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=LO(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};Nt.argmin=function(e){return this.extent(e)[0]||{}};Nt.argmax=function(e){return this.extent(e)[1]||{}};Nt.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};Nt.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};Nt.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=Ey(this.values(),e),this._get=e),this._q};Nt.q1=function(e){return this.quartile(e)[0]};Nt.q2=function(e){return this.quartile(e)[1]};Nt.q3=function(e){return this.quartile(e)[2]};Nt.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=RC(this.values(),1e3,.05,e),this._get=e),this._ci};Nt.ci0=function(e){return this.ci(e)[0]};Nt.ci1=function(e){return this.ci(e)[1]};function Is(e){D.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Is.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Oc},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};z(Is,D,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map(()=>({})),r=n.length;function s(a){let u,l,c,f;for(u in a)for(c=a[u].tuple,l=0;l<r;++l)i[l][f=c[n[l]]]=f}s(e._prev),s(t);function o(a,u,l){const c=n[l],f=i[l++];for(const d in f){const h=a?a+"|"+d:d;u[c]=f[d],l<r?o(h,u,l):t[h]||e.cell(h,u)}}o("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function r(m){const y=re(zt(m)),v=y.length;let b=0,x;for(;b<v;++b)i[x=y[b]]||(i[x]=1,t.push(x))}this._dims=re(e.groupby),this._dnames=this._dims.map(m=>{const y=tt(m);return r(m),n.push(y),y}),this.cellkey=e.key?e.key:Ly(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],o=e.ops||["count"],a=e.as||[],u=s.length,l={};let c,f,d,h,g,p;for(u!==o.length&&N("Unmatched number of fields and aggregate ops."),p=0;p<u;++p){if(c=s[p],f=o[p],c==null&&f!=="count"&&N("Null aggregate field specified."),h=tt(c),g=VC(f,h,a[p]),n.push(g),f==="count"){this._counts.push(g);continue}d=l[h],d||(r(c),d=l[h]=[],d.field=c,this._measures.push(d)),f!=="count"&&(this._countOnly=!1),d.push(XC(f,g))}return this._measures=this._measures.map(m=>JC(m,m.field)),{}},cellkey:Ly(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,r=i.length;n.agg=Array(r);for(let s=0;s<r;++s)n.agg[s]=new i[s](n)}return n.store&&(n.data=new Iy),n},newtuple(e,t){const n=this._dnames,i=this._dims,r=i.length,s={};for(let o=0;o<r;++o)s[n[o]]=i[o](e);return t?wC(t.tuple,s):Me(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let r=0,s=i.length;r<s;++r)i[r].add(i[r].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let r=0,s=i.length;r<s;++r)i[r].rem(i[r].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,r=n.length;i<r;++i)t[n[i]]=e.num;if(!this._countOnly){const i=e.agg;for(let r=0,s=i.length;r<s;++r)i[r].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,r=this._drop,s=e.add,o=e.rem,a=e.mod;let u,l,c,f;if(i)for(l in i)u=i[l],(!r||u.num)&&o.push(u.tuple);for(c=0,f=this._alen;c<f;++c)s.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&r?o:a).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const Mz=1e-14;function By(e){D.call(this,null,e)}By.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};z(By,D,{transform(e,t){const n=e.interval!==!1,i=this._bins(e),r=i.start,s=i.step,o=e.as||["bin0","bin1"],a=o[0],u=o[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(zt(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=i(c);c[a]=f,c[u]=f==null?null:r+s*(1+(f-r)/s)}:c=>c[a]=i(c)),t.modifies(n?o:a)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=NC(e),i=n.step;let r=n.start,s=r+Math.ceil((n.stop-r)/i)*i,o,a;(o=e.anchor)!=null&&(a=o-(r+i*Math.floor((o-r)/i)),r+=a,s+=a);const u=function(l){let c=Ut(t(l));return c==null?null:c<r?-1/0:c>s?1/0:(c=Math.max(r,Math.min(c,s-i)),r+i*Math.floor(Mz+(c-r)/i))};return u.start=r,u.stop=n.stop,u.step=i,this.value=Sn(u,zt(t),e.name||"bin_"+tt(t))}});function QC(e,t,n){const i=e;let r=t||[],s=n||[],o={},a=0;return{add:u=>s.push(u),remove:u=>o[i(u)]=++a,size:()=>r.length,data:(u,l)=>(a&&(r=r.filter(c=>!o[i(c)]),o={},a=0),l&&u&&r.sort(u),s.length&&(r=u?qO(u,r,s.sort(u)):r.concat(s),s=[]),r)}}function zy(e){D.call(this,[],e)}zy.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};z(zy,D,{transform(e,t){const n=t.fork(t.ALL),i=QC(J,this.value,n.materialize(n.ADD).add),r=e.sort,s=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(s),this.value=n.source=i.data(Vo(r),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function ZC(e){ze.call(this,null,Tz,e)}z(ZC,ze);function Tz(e){return this.value&&!e.modified()?this.value:x1(e.fields,e.orders)}function Uy(e){D.call(this,null,e)}Uy.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function Nz(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}z(Uy,D,{transform(e,t){const n=f=>d=>{for(var h=Nz(a(d),e.case,s)||[],g,p=0,m=h.length;p<m;++p)o.test(g=h[p])||f(g)},i=this._parameterCheck(e,t),r=this._counts,s=this._match,o=this._stop,a=e.field,u=e.as||["text","count"],l=n(f=>r[f]=1+(r[f]||0)),c=n(f=>r[f]-=1);return i?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],s=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let a,u,l;for(a in n)u=i[a],l=n[a]||0,!u&&l?(i[a]=u=Me({}),u[r]=a,u[s]=l,o.add.push(u)):l===0?(u&&o.rem.push(u),n[a]=null,i[a]=null):u[s]!==l&&(u[s]=l,o.mod.push(u));return o.modifies(t)}});function qy(e){D.call(this,null,e)}qy.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};z(qy,D,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],r=i[0],s=i[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let a=this.value;return o?(a&&(n.rem=a),a=t.materialize(t.SOURCE).source,n.add=this.value=Rz(a,r,s,e.filter||oi)):n.mod=a,n.source=this.value,n.modifies(i)}});function Rz(e,t,n,i){for(var r=[],s={},o=e.length,a=0,u,l;a<o;++a)for(s[t]=l=e[a],u=0;u<o;++u)s[n]=e[u],i(s)&&(r.push(Me(s)),s={},s[t]=l);return r}const e$={kde:Sy,mixture:IC,normal:Oy,lognormal:PC,uniform:BC},jz="distributions",t$="function",Lz="field";function n$(e,t){const n=e[t$];se(e$,n)||N("Unknown distribution function: "+n);const i=e$[n]();for(const r in e)r===Lz?i.data((e.from||t()).map(e[r])):r===jz?i[r](e[r].map(s=>n$(s,t))):typeof i[r]===t$&&i[r](e[r]);return i}function Wy(e){D.call(this,null,e)}const i$=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Pz={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:i$},{name:"weights",type:"number",array:!0}]};Wy.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:i$.concat(Pz)},{name:"as",type:"string",array:!0,default:["value","density"]}]};z(Wy,D,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=n$(e.distribution,Iz(t)),r=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&N("Invalid density method: "+o),!e.extent&&!i.data&&N("Missing density extent parameter."),o=i[o];const a=e.as||["value","density"],u=e.extent||nr(i.data()),l=Th(o,u,r,s).map(c=>{const f={};return f[a[0]]=c[0],f[a[1]]=c[1],Me(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function Iz(e){return()=>e.materialize(e.SOURCE).source}function r$(e,t){return e?e.map((n,i)=>t[i]||tt(n)):null}function Gy(e,t,n){const i=[],r=f=>f(u);let s,o,a,u,l,c;if(t==null)i.push(e.map(n));else for(s={},o=0,a=e.length;o<a;++o)u=e[o],l=t.map(r),c=s[l],c||(s[l]=c=[],c.dims=l,i.push(c)),c.push(n(u));return i}const s$="bin";function Hy(e){D.call(this,null,e)}Hy.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:s$}]};const Bz=(e,t)=>Ql(nr(e,t))/30;z(Hy,D,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=Gy(t.source,e.groupby,un),r=e.smooth||!1,s=e.field,o=e.step||Bz(n,s),a=Vo((g,p)=>s(g)-s(p)),u=e.as||s$,l=i.length;let c=1/0,f=-1/0,d=0,h;for(;d<l;++d){const g=i[d].sort(a);h=-1;for(const p of jC(g,o,r,s))p<c&&(c=p),p>f&&(f=p),g[++h][u]=p}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(u)}});function o$(e){ze.call(this,null,zz,e),this.modified(!0)}z(o$,ze);function zz(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Sn(n=>t(n,e),zt(t),tt(t))}function Yy(e){D.call(this,[void 0,void 0],e)}Yy.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};z(Yy,D,{transform(e,t){const n=this.value,i=e.field,r=t.changed()||t.modified(i.fields)||e.modified("field");let s=n[0],o=n[1];if((r||s==null)&&(s=1/0,o=-1/0),t.visit(r?t.SOURCE:t.ADD,a=>{const u=Ut(i(a));u!=null&&(u<s&&(s=u),u>o&&(o=u))}),!Number.isFinite(s)||!Number.isFinite(o)){let a=tt(i);a&&(a=` for field "${a}"`),t.dataflow.warn(`Infinite extent${a}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]}});function Vy(e,t){ze.call(this,e),this.parent=t,this.count=0}z(Vy,ze,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function Nh(e){D.call(this,{},e),this._keys=lu();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}z(Nh,D,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const r=this.value;let s=se(r,e)&&r[e],o,a;return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=i||(a=this._group[e])&&a.tuple,o=n.dataflow,s=new Vy(n.fork(n.NO_SOURCE),this),o.add(s).connect(t(o,e,a)),r[e]=s,this.activate(s)),s},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let r=0;for(;r<i;++r)t[r]=e[r];for(;r<n&&t[r]!=null;++r)t[r]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,r=e.subflow,s=this._keys,o=e.modified("key"),a=u=>this.subflow(u,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=J(u),c=s.get(l);c!==void 0&&(s.delete(l),a(c).rem(u))}),t.visit(t.ADD,u=>{const l=i(u);s.set(J(u),l),a(l).add(u)}),o||t.modified(i.fields)?t.visit(t.MOD,u=>{const l=J(u),c=s.get(l),f=i(u);c===f?a(f).mod(u):(s.set(l,f),a(c).rem(u),a(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{a(s.get(J(u))).mod(u)}),o&&t.visit(t.REFLOW,u=>{const l=J(u),c=s.get(l),f=i(u);c!==f&&(s.set(l,f),a(c).rem(u),a(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}});function a$(e){ze.call(this,null,Uz,e)}z(a$,ze);function Uz(e){return this.value&&!e.modified()?this.value:K(e.name)?re(e.name).map(t=>Cn(t)):Cn(e.name,e.as)}function Xy(e){D.call(this,lu(),e)}Xy.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};z(Xy,D,{transform(e,t){const n=t.dataflow,i=this.value,r=t.fork(),s=r.add,o=r.rem,a=r.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const d=J(f);i.has(d)?i.delete(d):o.push(f)}),t.visit(t.ADD,f=>{u(f,e)?s.push(f):i.set(J(f),1)});function c(f){const d=J(f),h=u(f,e),g=i.get(d);h&&g?(i.delete(d),s.push(f)):!h&&!g?(i.set(d,1),o.push(f)):l&&h&&!g&&a.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}});function Ky(e){D.call(this,[],e)}Ky.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};z(Ky,D,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=r$(i,e.as||[]),s=e.index||null,o=r.length;return n.rem=this.value,t.visit(t.SOURCE,a=>{const u=i.map(g=>g(a)),l=u.reduce((g,p)=>Math.max(g,p.length),0);let c=0,f,d,h;for(;c<l;++c){for(d=yy(a),f=0;f<o;++f)d[r[f]]=(h=u[f][c])==null?null:h;s&&(d[s]=c),n.add.push(d)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(r)}});function Jy(e){D.call(this,[],e)}Jy.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};z(Jy,D,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(tt),s=e.as||["key","value"],o=s[0],a=s[1],u=i.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=yy(l),f[o]=r[c],f[a]=i[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(s)}});function Qy(e){D.call(this,null,e)}Qy.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};z(Qy,D,{transform(e,t){const n=e.expr,i=e.as,r=e.modified(),s=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(s,o=>o[i]=n(o,e))}});function u$(e){D.call(this,[],e)}z(u$,D,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let r=this.value,s=e.size-r.length,o,a,u;if(s>0){for(o=[];--s>=0;)o.push(u=Me(i(e))),r.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else a=r.slice(0,-s),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,r=r.slice(-s);return n.source=this.value=r,n}});const Rh={value:"value",median:nS,mean:SP,min:N1,max:qo},qz=[];function Zy(e){D.call(this,[],e)}Zy.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function Wz(e){var t=e.method||Rh.value,n;if(Rh[t]==null)N("Unrecognized imputation method: "+t);else return t===Rh.value?(n=e.value!==void 0?e.value:0,()=>n):Rh[t]}function Gz(e){const t=e.field;return n=>n?t(n):NaN}z(Zy,D,{transform(e,t){var n=t.fork(t.ALL),i=Wz(e),r=Gz(e),s=tt(e.field),o=tt(e.key),a=(e.groupby||[]).map(tt),u=Hz(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,d,h,g,p,m,y,v,b,x,E;for(m=0,b=u.length;m<b;++m)for(d=u[m],g=d.values,h=NaN,v=0;v<f;++v)if(d[v]==null){for(p=u.domain[v],E={_impute:!0},y=0,x=g.length;y<x;++y)E[a[y]]=g[y];E[o]=p,E[s]=Number.isNaN(h)?h=i(d,r):h,l.push(Me(E))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function Hz(e,t,n,i){var r=y=>y(m),s=[],o=i?i.slice():[],a={},u={},l,c,f,d,h,g,p,m;for(o.forEach((y,v)=>a[y]=v+1),d=0,p=e.length;d<p;++d)m=e[d],g=n(m),h=a[g]||(a[g]=o.push(g)),c=(l=t?t.map(r):qz)+"",(f=u[c])||(f=u[c]=[],s.push(f),f.values=l),f[h-1]=m;return s.domain=o,s}function ev(e){Is.call(this,e)}ev.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Oc},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};z(ev,Is,{transform(e,t){const n=this,i=e.modified();let r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(r=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{de(s,r[n.cellkey(s)].tuple)}),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function tv(e){D.call(this,null,e)}tv.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};z(tv,D,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=Gy(i,e.groupby,e.field),s=(e.groupby||[]).map(tt),o=e.bandwidth,a=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;a!=="pdf"&&a!=="cdf"&&N("Invalid density method: "+a),e.resolve==="shared"&&(c||(c=nr(i,e.field)),f=d=e.steps||d),r.forEach(h=>{const g=Sy(h,o)[a],p=e.counts?h.length:1,m=c||nr(h);Th(g,m,f,d).forEach(y=>{const v={};for(let b=0;b<s.length;++b)v[s[b]]=h.dims[b];v[u[0]]=y[0],v[u[1]]=y[1]*p,l.push(Me(v))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function l$(e){ze.call(this,null,Yz,e)}z(l$,ze);function Yz(e){return this.value&&!e.modified()?this.value:_1(e.fields,e.flat)}function c$(e){D.call(this,[],e),this._pending=null}z(c$,D,{transform(e,t){const n=t.dataflow;return this._pending?nv(this,t,this._pending):Vz(e)?t.StopPropagation:e.values?nv(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=re(r.data),s=>s.touch(this)))}:n.request(e.url,e.format).then(i=>nv(this,t,re(i.data)))}});function Vz(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function nv(e,t,n){n.forEach(Me);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function iv(e){D.call(this,{},e)}iv.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};z(iv,D,{transform(e,t){const n=e.fields,i=e.index,r=e.values,s=e.default==null?null:e.default,o=e.modified(),a=n.length;let u=o?t.SOURCE:t.ADD,l=t,c=e.as,f,d,h;return r?(d=r.length,a>1&&!c&&N('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==a*d&&N('The "as" parameter has too few output field names.'),c=c||r.map(tt),f=function(g){for(var p=0,m=0,y,v;p<a;++p)if(v=i.get(n[p](g)),v==null)for(y=0;y<d;++y,++m)g[c[m]]=s;else for(y=0;y<d;++y,++m)g[c[m]]=r[y](v)}):(c||N("Missing output field names."),f=function(g){for(var p=0,m;p<a;++p)m=i.get(n[p](g)),g[c[p]]=m==null?s:m}),o?l=t.reflow(!0):(h=n.some(g=>t.modified(g.fields)),u|=h?t.MOD:0),t.visit(u,f),l.modifies(c)}});function f$(e){ze.call(this,null,Xz,e)}z(f$,ze);function Xz(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let i=1/0,r=-1/0,s,o;for(s=0;s<n;++s)o=t[s],o[0]<i&&(i=o[0]),o[1]>r&&(r=o[1]);return[i,r]}function d$(e){ze.call(this,null,Kz,e)}z(d$,ze);function Kz(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function h$(e){D.call(this,null,e)}z(h$,D,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function rv(e){Is.call(this,e)}rv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Oc,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};z(rv,Is,{_transform:Is.prototype.transform,transform(e,t){return this._transform(Jz(e,t),t)}});function Jz(e,t){const n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",s=zt(n).concat(zt(i)),o=Zz(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(()=>r),fields:o.map(a=>Qz(a,n,i,s)),as:o.map(a=>a+""),modified:e.modified.bind(e)}}function Qz(e,t,n,i){return Sn(r=>t(r)===e?n(r):NaN,i,e+"")}function Zz(e,t,n){const i={},r=[];return n.visit(n.SOURCE,s=>{const o=e(s);i[o]||(i[o]=1,r.push(o))}),r.sort(ah),t?r.slice(0,t):r}function g$(e){Nh.call(this,e)}z(g$,Nh,{transform(e,t){const n=e.subflow,i=e.field,r=s=>this.subflow(J(s),n,t,s);return(e.modified("field")||i&&t.modified(zt(i)))&&N("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,s=>{const o=r(s);i(s).forEach(a=>o.mod(a))}),t.visit(t.ADD,s=>{const o=r(s);i(s).forEach(a=>o.add(Me(a)))}),t.visit(t.REM,s=>{const o=r(s);i(s).forEach(a=>o.rem(a))})):(t.visit(t.MOD,s=>r(s).mod(s)),t.visit(t.ADD,s=>r(s).add(s)),t.visit(t.REM,s=>r(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}});function sv(e){D.call(this,null,e)}sv.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};z(sv,D,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=r$(e.fields,e.as||[]),s=i?(a,u)=>eU(a,u,i,r):_h;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,a=>{const u=J(a);n.rem.push(o[u]),o[u]=null}),t.visit(t.ADD,a=>{const u=s(a,Me({}));o[J(a)]=u,n.add.push(u)}),t.visit(t.MOD,a=>{n.mod.push(s(a,o[J(a)]))}),n}});function eU(e,t,n,i){for(let r=0,s=n.length;r<s;++r)t[i[r]]=n[r](e);return t}function p$(e){D.call(this,null,e)}z(p$,D,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function ov(e){D.call(this,null,e)}ov.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const tU=1e-14;z(ov,D,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,s=Gy(r,e.groupby,e.field),o=(e.groupby||[]).map(tt),a=[],u=e.step||.01,l=e.probs||Yn(u/2,1-tU,u),c=l.length;return s.forEach(f=>{const d=wy(f,l);for(let h=0;h<c;++h){const g={};for(let p=0;p<o.length;++p)g[o[p]]=f.dims[p];g[i[0]]=l[h],g[i[1]]=d[h],a.push(Me(g))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function m$(e){D.call(this,null,e)}z(m$,D,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{const s=J(r);n.rem.push(i[s]),i[s]=null}),t.visit(t.ADD,r=>{const s=yy(r);i[J(r)]=s,n.add.push(s)}),t.visit(t.MOD,r=>{const s=i[J(r)];for(const o in r)s[o]=r[o],n.modifies(o);n.mod.push(s)})),n}});function av(e){D.call(this,[],e),this.count=0}av.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};z(av,D,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,s=this.value.reduce((c,f)=>(c[J(f)]=1,c),{});let o=this.value,a=this.count,u=0;function l(c){let f,d;o.length<r?o.push(c):(d=~~((a+1)*li()),d<o.length&&d>=u&&(f=o[d],s[J(f)]&&n.rem.push(f),o[d]=c)),++a}if(t.rem.length&&(t.visit(t.REM,c=>{const f=J(c);s[f]&&(s[f]=-1,n.rem.push(c)),--a}),o=o.filter(c=>s[J(c)]!==-1)),(t.rem.length||i)&&o.length<r&&t.source&&(u=a=o.length,t.visit(t.SOURCE,c=>{s[J(c)]||l(c)}),u=-1),i&&o.length>r){const c=o.length-r;for(let f=0;f<c;++f)s[J(o[f])]=-1,n.rem.push(o[f]);o=o.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{s[J(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=o.filter(c=>!s[J(c)])),this.count=a,this.value=n.source=o,n}});function uv(e){D.call(this,null,e)}uv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};z(uv,D,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Yn(e.start,e.stop,e.step||1).map(r=>{const s={};return s[i]=r,Me(s)}),n.add=t.add.concat(this.value),n}});function y$(e){D.call(this,null,e),this.modified(!0)}z(y$,D,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function lv(e){D.call(this,null,e)}const v$=["unit0","unit1"];lv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:K1,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:v$}]};z(lv,D,{transform(e,t){const n=e.field,i=e.interval!==!1,r=e.timezone==="utc",s=this._floor(e,t),o=(r?mu:pu)(s.unit).offset,a=e.as||v$,u=a[0],l=a[1],c=s.step;let f=s.start||1/0,d=s.stop||-1/0,h=t.ADD;return(e.modified()||t.modified(zt(n)))&&(t=t.reflow(!0),h=t.SOURCE,f=1/0,d=-1/0),t.visit(h,g=>{const p=n(g);let m,y;p==null?(g[u]=null,i&&(g[l]=null)):(g[u]=m=y=s(p),i&&(g[l]=y=o(m,c)),m<f&&(f=m),y>d&&(d=y))}),s.start=f,s.stop=d,t.modifies(i?a:u)},_floor(e,t){const n=e.timezone==="utc",{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:IS({extent:e.extent||nr(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=Q1(i),o=this.value||{},a=(n?$S:CS)(s,r);return a.unit=be(s),a.units=s,a.step=r,a.start=o.start,a.stop=o.stop,this.value=a}});function b$(e){D.call(this,lu(),e)}z(b$,D,{transform(e,t){const n=t.dataflow,i=e.field,r=this.value,s=a=>r.set(i(a),a);let o=!0;return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,a=>r.delete(i(a))),t.visit(t.ADD,s)):o=!1,this.modified(o),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()}});function x$(e){D.call(this,null,e)}z(x$,D,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Vo(e.sort)):t.source).map(e.field))}});function nU(e,t,n,i){const r=Sc[e](t,n);return{init:r.init||Os,update:function(s,o){o[i]=r.next(s)}}}const Sc={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=Sc.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let r=t.index;if(e<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;e=r}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||N("ntile num must be greater than zero.");const n=Sc.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||N("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const r=i.data;return i.index<=n?t:(n=iU(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function iU(e,t,n){for(let i=t.length;n<i;++n)if(e(t[n])!=null)return n;return-1}const rU=Object.keys(Sc);function w$(e){const t=re(e.ops),n=re(e.fields),i=re(e.params),r=re(e.as),s=this.outputs=[],o=this.windows=[],a={},u={},l=[],c=[];let f=!0;function d(h){re(zt(h)).forEach(g=>a[g]=1)}d(e.sort),t.forEach((h,g)=>{const p=n[g],m=tt(p),y=VC(h,m,r[g]);if(d(p),s.push(y),se(Sc,h))o.push(nU(h,n[g],i[g],y));else{if(p==null&&h!=="count"&&N("Null aggregate field specified."),h==="count"){l.push(y);return}f=!1;let v=u[m];v||(v=u[m]=[],v.field=p,c.push(v)),v.push(XC(h,y))}}),(l.length||c.length)&&(this.cell=sU(c,l,f)),this.inputs=Object.keys(a)}const E$=w$.prototype;E$.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};E$.update=function(e,t){const n=this.cell,i=this.windows,r=e.data,s=i&&i.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(r[o]);for(o=e.p1;o<e.i1;++o)n.add(r[o]);n.set(t)}for(o=0;o<s;++o)i[o].update(e,t)};function sU(e,t,n){e=e.map(u=>JC(u,u.field));const i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,s=i.agg=Array(r),o=0;o<r;++o)s[o]=new e[o](i);if(i.store)var a=i.data=new Iy;return i.add=function(u){if(i.num+=1,!n){a&&a.add(u);for(let l=0;l<r;++l)s[l].add(s[l].get(u),u)}},i.rem=function(u){if(i.num-=1,!n){a&&a.rem(u);for(let l=0;l<r;++l)s[l].rem(s[l].get(u),u)}},i.set=function(u){let l,c;for(a&&a.values(),l=0,c=t.length;l<c;++l)u[t[l]]=i.num;if(!n)for(l=0,c=s.length;l<c;++l)s[l].set(u)},i.init=function(){i.num=0,a&&a.reset();for(let u=0;u<r;++u)s[u].init()},i}function cv(e){D.call(this,{},e),this._mlen=0,this._mods=[]}cv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:rU.concat(Oc)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};z(cv,D,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=Vo(e.sort),r=Ly(e.groupby),s=a=>this.group(r(a));let o=this.state;(!o||n)&&(o=this.state=new w$(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,a=>s(a).add(a))):(t.visit(t.REM,a=>s(a).remove(a)),t.visit(t.ADD,a=>s(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)oU(this._mods[a],o,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=QC(J),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function oU(e,t,n,i){const r=i.sort,s=r&&!i.ignorePeers,o=i.frame||[null,0],a=e.data(n),u=a.length,l=s?ec(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:r||qt(-1)};t.init();for(let f=0;f<u;++f)aU(c,o,f,u),s&&uU(c,l),t.update(c,a[f])}function aU(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function uU(e,t){const n=e.i0,i=e.i1-1,r=e.compare,s=e.data,o=s.length-1;n>0&&!r(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),i<o&&!r(s[i],s[i+1])&&(e.i1=t.right(s,s[i]))}var lU=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",aggregate:Is,bin:By,collect:zy,compare:ZC,countpattern:Uy,cross:qy,density:Wy,dotbin:Hy,expression:o$,extent:Yy,facet:Nh,field:a$,filter:Xy,flatten:Ky,fold:Jy,formula:Qy,generate:u$,impute:Zy,joinaggregate:ev,kde:tv,key:l$,load:c$,lookup:iv,multiextent:f$,multivalues:d$,params:h$,pivot:rv,prefacet:g$,project:sv,proxy:p$,quantile:ov,relay:m$,sample:av,sequence:uv,sieve:y$,subflow:Vy,timeunit:lv,tupleindex:b$,values:x$,window:cv});const fv=Math.PI,dv=2*fv,Ko=1e-6,cU=dv-Ko;function hv(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Jo(){return new hv}hv.prototype=Jo.prototype={constructor:hv,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+s)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var s=this._x1,o=this._y1,a=n-e,u=i-t,l=s-e,c=o-t,f=l*l+c*c;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>Ko)if(!(Math.abs(c*a-u*l)>Ko)||!r)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var d=n-s,h=i-o,g=a*a+u*u,p=d*d+h*h,m=Math.sqrt(g),y=Math.sqrt(f),v=r*Math.tan((fv-Math.acos((g+f-p)/(2*m*y)))/2),b=v/y,x=v/m;Math.abs(b-1)>Ko&&(this._+="L"+(e+b*l)+","+(t+b*c)),this._+="A"+r+","+r+",0,0,"+ +(c*d>l*h)+","+(this._x1=e+x*a)+","+(this._y1=t+x*u)}},arc:function(e,t,n,i,r,s){e=+e,t=+t,n=+n,s=!!s;var o=n*Math.cos(i),a=n*Math.sin(i),u=e+o,l=t+a,c=1^s,f=s?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>Ko||Math.abs(this._y1-l)>Ko)&&(this._+="L"+u+","+l),!!n&&(f<0&&(f=f%dv+dv),f>cU?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-a)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):f>Ko&&(this._+="A"+n+","+n+",0,"+ +(f>=fv)+","+c+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};function Te(e){return function(){return e}}var _$=Math.abs,Ht=Math.atan2,Qo=Math.cos,fU=Math.max,gv=Math.min,sr=Math.sin,Eu=Math.sqrt,Yt=1e-12,_u=Math.PI,jh=_u/2,A$=2*_u;function dU(e){return e>1?0:e<-1?_u:Math.acos(e)}function O$(e){return e>=1?jh:e<=-1?-jh:Math.asin(e)}function hU(e){return e.innerRadius}function gU(e){return e.outerRadius}function pU(e){return e.startAngle}function mU(e){return e.endAngle}function yU(e){return e&&e.padAngle}function vU(e,t,n,i,r,s,o,a){var u=n-e,l=i-t,c=o-r,f=a-s,d=f*u-c*l;if(!(d*d<Yt))return d=(c*(t-s)-f*(e-r))/d,[e+d*u,t+d*l]}function Lh(e,t,n,i,r,s,o){var a=e-n,u=t-i,l=(o?s:-s)/Eu(a*a+u*u),c=l*u,f=-l*a,d=e+c,h=t+f,g=n+c,p=i+f,m=(d+g)/2,y=(h+p)/2,v=g-d,b=p-h,x=v*v+b*b,E=r-s,_=d*p-g*h,w=(b<0?-1:1)*Eu(fU(0,E*E*x-_*_)),A=(_*b-v*w)/x,S=(-_*v-b*w)/x,O=(_*b+v*w)/x,C=(-_*v+b*w)/x,k=A-m,F=S-y,j=O-m,$=C-y;return k*k+F*F>j*j+$*$&&(A=O,S=C),{cx:A,cy:S,x01:-c,y01:-f,x11:A*(r/E-1),y11:S*(r/E-1)}}function bU(){var e=hU,t=gU,n=Te(0),i=null,r=pU,s=mU,o=yU,a=null;function u(){var l,c,f=+e.apply(this,arguments),d=+t.apply(this,arguments),h=r.apply(this,arguments)-jh,g=s.apply(this,arguments)-jh,p=_$(g-h),m=g>h;if(a||(a=l=Jo()),d<f&&(c=d,d=f,f=c),!(d>Yt))a.moveTo(0,0);else if(p>A$-Yt)a.moveTo(d*Qo(h),d*sr(h)),a.arc(0,0,d,h,g,!m),f>Yt&&(a.moveTo(f*Qo(g),f*sr(g)),a.arc(0,0,f,g,h,m));else{var y=h,v=g,b=h,x=g,E=p,_=p,w=o.apply(this,arguments)/2,A=w>Yt&&(i?+i.apply(this,arguments):Eu(f*f+d*d)),S=gv(_$(d-f)/2,+n.apply(this,arguments)),O=S,C=S,k,F;if(A>Yt){var j=O$(A/f*sr(w)),$=O$(A/d*sr(w));(E-=j*2)>Yt?(j*=m?1:-1,b+=j,x-=j):(E=0,b=x=(h+g)/2),(_-=$*2)>Yt?($*=m?1:-1,y+=$,v-=$):(_=0,y=v=(h+g)/2)}var R=d*Qo(y),L=d*sr(y),U=f*Qo(x),H=f*sr(x);if(S>Yt){var ae=d*Qo(v),De=d*sr(v),Oe=f*Qo(b),Ze=f*sr(b),Be;if(p<_u&&(Be=vU(R,L,Oe,Ze,ae,De,U,H))){var st=R-Be[0],sn=L-Be[1],Ai=ae-Be[0],si=De-Be[1],G=1/sr(dU((st*Ai+sn*si)/(Eu(st*st+sn*sn)*Eu(Ai*Ai+si*si)))/2),oe=Eu(Be[0]*Be[0]+Be[1]*Be[1]);O=gv(S,(f-oe)/(G-1)),C=gv(S,(d-oe)/(G+1))}}_>Yt?C>Yt?(k=Lh(Oe,Ze,R,L,d,C,m),F=Lh(ae,De,U,H,d,C,m),a.moveTo(k.cx+k.x01,k.cy+k.y01),C<S?a.arc(k.cx,k.cy,C,Ht(k.y01,k.x01),Ht(F.y01,F.x01),!m):(a.arc(k.cx,k.cy,C,Ht(k.y01,k.x01),Ht(k.y11,k.x11),!m),a.arc(0,0,d,Ht(k.cy+k.y11,k.cx+k.x11),Ht(F.cy+F.y11,F.cx+F.x11),!m),a.arc(F.cx,F.cy,C,Ht(F.y11,F.x11),Ht(F.y01,F.x01),!m))):(a.moveTo(R,L),a.arc(0,0,d,y,v,!m)):a.moveTo(R,L),!(f>Yt)||!(E>Yt)?a.lineTo(U,H):O>Yt?(k=Lh(U,H,ae,De,f,-O,m),F=Lh(R,L,Oe,Ze,f,-O,m),a.lineTo(k.cx+k.x01,k.cy+k.y01),O<S?a.arc(k.cx,k.cy,O,Ht(k.y01,k.x01),Ht(F.y01,F.x01),!m):(a.arc(k.cx,k.cy,O,Ht(k.y01,k.x01),Ht(k.y11,k.x11),!m),a.arc(0,0,f,Ht(k.cy+k.y11,k.cx+k.x11),Ht(F.cy+F.y11,F.cx+F.x11),m),a.arc(F.cx,F.cy,O,Ht(F.y11,F.x11),Ht(F.y01,F.x01),!m))):a.arc(0,0,f,x,b,m)}if(a.closePath(),l)return a=null,l+""||null}return u.centroid=function(){var l=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2-_u/2;return[Qo(c)*l,sr(c)*l]},u.innerRadius=function(l){return arguments.length?(e=typeof l=="function"?l:Te(+l),u):e},u.outerRadius=function(l){return arguments.length?(t=typeof l=="function"?l:Te(+l),u):t},u.cornerRadius=function(l){return arguments.length?(n=typeof l=="function"?l:Te(+l),u):n},u.padRadius=function(l){return arguments.length?(i=l==null?null:typeof l=="function"?l:Te(+l),u):i},u.startAngle=function(l){return arguments.length?(r=typeof l=="function"?l:Te(+l),u):r},u.endAngle=function(l){return arguments.length?(s=typeof l=="function"?l:Te(+l),u):s},u.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:Te(+l),u):o},u.context=function(l){return arguments.length?(a=l==null?null:l,u):a},u}function S$(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function C$(e){this._context=e}C$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function pv(e){return new C$(e)}function $$(e){return e[0]}function F$(e){return e[1]}function k$(e,t){var n=Te(!0),i=null,r=pv,s=null;e=typeof e=="function"?e:e===void 0?$$:Te(e),t=typeof t=="function"?t:t===void 0?F$:Te(t);function o(a){var u,l=(a=S$(a)).length,c,f=!1,d;for(i==null&&(s=r(d=Jo())),u=0;u<=l;++u)!(u<l&&n(c=a[u],u,a))===f&&((f=!f)?s.lineStart():s.lineEnd()),f&&s.point(+e(c,u,a),+t(c,u,a));if(d)return s=null,d+""||null}return o.x=function(a){return arguments.length?(e=typeof a=="function"?a:Te(+a),o):e},o.y=function(a){return arguments.length?(t=typeof a=="function"?a:Te(+a),o):t},o.defined=function(a){return arguments.length?(n=typeof a=="function"?a:Te(!!a),o):n},o.curve=function(a){return arguments.length?(r=a,i!=null&&(s=r(i)),o):r},o.context=function(a){return arguments.length?(a==null?i=s=null:s=r(i=a),o):i},o}function D$(e,t,n){var i=null,r=Te(!0),s=null,o=pv,a=null;e=typeof e=="function"?e:e===void 0?$$:Te(+e),t=typeof t=="function"?t:Te(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?F$:Te(+n);function u(c){var f,d,h,g=(c=S$(c)).length,p,m=!1,y,v=new Array(g),b=new Array(g);for(s==null&&(a=o(y=Jo())),f=0;f<=g;++f){if(!(f<g&&r(p=c[f],f,c))===m)if(m=!m)d=f,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),h=f-1;h>=d;--h)a.point(v[h],b[h]);a.lineEnd(),a.areaEnd()}m&&(v[f]=+e(p,f,c),b[f]=+t(p,f,c),a.point(i?+i(p,f,c):v[f],n?+n(p,f,c):b[f]))}if(y)return a=null,y+""||null}function l(){return k$().defined(r).curve(o).context(s)}return u.x=function(c){return arguments.length?(e=typeof c=="function"?c:Te(+c),i=null,u):e},u.x0=function(c){return arguments.length?(e=typeof c=="function"?c:Te(+c),u):e},u.x1=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:Te(+c),u):i},u.y=function(c){return arguments.length?(t=typeof c=="function"?c:Te(+c),n=null,u):t},u.y0=function(c){return arguments.length?(t=typeof c=="function"?c:Te(+c),u):t},u.y1=function(c){return arguments.length?(n=c==null?null:typeof c=="function"?c:Te(+c),u):n},u.lineX0=u.lineY0=function(){return l().x(e).y(t)},u.lineY1=function(){return l().x(e).y(n)},u.lineX1=function(){return l().x(i).y(t)},u.defined=function(c){return arguments.length?(r=typeof c=="function"?c:Te(!!c),u):r},u.curve=function(c){return arguments.length?(o=c,s!=null&&(a=o(s)),u):o},u.context=function(c){return arguments.length?(c==null?s=a=null:a=o(s=c),u):s},u}var xU={draw:function(e,t){var n=Math.sqrt(t/_u);e.moveTo(n,0),e.arc(0,0,n,0,A$)}};function wU(e,t){var n=null;e=typeof e=="function"?e:Te(e||xU),t=typeof t=="function"?t:Te(t===void 0?64:+t);function i(){var r;if(n||(n=r=Jo()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return i.type=function(r){return arguments.length?(e=typeof r=="function"?r:Te(r),i):e},i.size=function(r){return arguments.length?(t=typeof r=="function"?r:Te(+r),i):t},i.context=function(r){return arguments.length?(n=r==null?null:r,i):n},i}function Bs(){}function Ph(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Ih(e){this._context=e}Ih.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Ph(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Ph(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function EU(e){return new Ih(e)}function M$(e){this._context=e}M$.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Ph(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function _U(e){return new M$(e)}function T$(e){this._context=e}T$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:Ph(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function AU(e){return new T$(e)}function N$(e,t){this._basis=new Ih(e),this._beta=t}N$.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],s=e[n]-i,o=t[n]-r,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(i+u*s),this._beta*t[a]+(1-this._beta)*(r+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var OU=function e(t){function n(i){return t===1?new Ih(i):new N$(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function Bh(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function mv(e,t){this._context=e,this._k=(1-t)/6}mv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Bh(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Bh(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var SU=function e(t){function n(i){return new mv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function yv(e,t){this._context=e,this._k=(1-t)/6}yv.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Bh(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var CU=function e(t){function n(i){return new yv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function vv(e,t){this._context=e,this._k=(1-t)/6}vv.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Bh(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var $U=function e(t){function n(i){return new vv(i,t)}return n.tension=function(i){return e(+i)},n}(0);function bv(e,t,n){var i=e._x1,r=e._y1,s=e._x2,o=e._y2;if(e._l01_a>Yt){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,r=(r*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>Yt){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,s,o,e._x2,e._y2)}function R$(e,t){this._context=e,this._alpha=t}R$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:bv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var FU=function e(t){function n(i){return t?new R$(i,t):new mv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function j$(e,t){this._context=e,this._alpha=t}j$.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:bv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var kU=function e(t){function n(i){return t?new j$(i,t):new yv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function L$(e,t){this._context=e,this._alpha=t}L$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:bv(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var DU=function e(t){function n(i){return t?new L$(i,t):new vv(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function P$(e){this._context=e}P$.prototype={areaStart:Bs,areaEnd:Bs,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function MU(e){return new P$(e)}function I$(e){return e<0?-1:1}function B$(e,t,n){var i=e._x1-e._x0,r=t-e._x1,s=(e._y1-e._y0)/(i||r<0&&-0),o=(n-e._y1)/(r||i<0&&-0),a=(s*r+o*i)/(i+r);return(I$(s)+I$(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function z$(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function xv(e,t,n){var i=e._x0,r=e._y0,s=e._x1,o=e._y1,a=(s-i)/3;e._context.bezierCurveTo(i+a,r+a*t,s-a,o-a*n,s,o)}function zh(e){this._context=e}zh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:xv(this,this._t0,z$(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,xv(this,z$(this,n=B$(this,e,t)),n);break;default:xv(this,this._t0,n=B$(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function U$(e){this._context=new q$(e)}(U$.prototype=Object.create(zh.prototype)).point=function(e,t){zh.prototype.point.call(this,t,e)};function q$(e){this._context=e}q$.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,s){this._context.bezierCurveTo(t,e,i,n,s,r)}};function TU(e){return new zh(e)}function NU(e){return new U$(e)}function W$(e){this._context=e}W$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=G$(e),r=G$(t),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(i[0][s],r[0][s],i[1][s],r[1][s],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function G$(e){var t,n=e.length-1,i,r=new Array(n),s=new Array(n),o=new Array(n);for(r[0]=0,s[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,s[t]=4,o[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,s[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/s[t-1],s[t]-=i,o[t]-=i*o[t-1];for(r[n-1]=o[n-1]/s[n-1],t=n-2;t>=0;--t)r[t]=(o[t]-r[t+1])/s[t];for(s[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-r[t+1];return[r,s]}function RU(e){return new W$(e)}function Uh(e,t){this._context=e,this._t=t}Uh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function jU(e){return new Uh(e,.5)}function LU(e){return new Uh(e,0)}function PU(e){return new Uh(e,1)}function Au(e,t){if(typeof document!="undefined"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const IU=()=>typeof Image!="undefined"?Image:null;function or(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function zs(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const wv=Symbol("implicit");function Ev(){var e=new Map,t=[],n=[],i=wv;function r(s){var o=s+"",a=e.get(o);if(!a){if(i!==wv)return i;e.set(o,a=t.push(s))}return n[(a-1)%n.length]}return r.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Map;for(const o of s){const a=o+"";e.has(a)||e.set(a,t.push(o))}return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return Ev(t,n).unknown(i)},or.apply(r,arguments),r}function Ou(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Cc(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Us(){}var Zo=.7,Su=1/Zo,Cu="\\s*([+-]?\\d+)\\s*",$c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ar="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",BU=/^#([0-9a-f]{3,8})$/,zU=new RegExp("^rgb\\("+[Cu,Cu,Cu]+"\\)$"),UU=new RegExp("^rgb\\("+[ar,ar,ar]+"\\)$"),qU=new RegExp("^rgba\\("+[Cu,Cu,Cu,$c]+"\\)$"),WU=new RegExp("^rgba\\("+[ar,ar,ar,$c]+"\\)$"),GU=new RegExp("^hsl\\("+[$c,ar,ar]+"\\)$"),HU=new RegExp("^hsla\\("+[$c,ar,ar,$c]+"\\)$"),H$={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ou(Us,Fc,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Y$,formatHex:Y$,formatHsl:YU,formatRgb:V$,toString:V$});function Y$(){return this.rgb().formatHex()}function YU(){return Z$(this).formatHsl()}function V$(){return this.rgb().formatRgb()}function Fc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=BU.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?X$(t):n===3?new Rt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?qh(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?qh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=zU.exec(e))?new Rt(t[1],t[2],t[3],1):(t=UU.exec(e))?new Rt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=qU.exec(e))?qh(t[1],t[2],t[3],t[4]):(t=WU.exec(e))?qh(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=GU.exec(e))?Q$(t[1],t[2]/100,t[3]/100,1):(t=HU.exec(e))?Q$(t[1],t[2]/100,t[3]/100,t[4]):H$.hasOwnProperty(e)?X$(H$[e]):e==="transparent"?new Rt(NaN,NaN,NaN,0):null}function X$(e){return new Rt(e>>16&255,e>>8&255,e&255,1)}function qh(e,t,n,i){return i<=0&&(e=t=n=NaN),new Rt(e,t,n,i)}function _v(e){return e instanceof Us||(e=Fc(e)),e?(e=e.rgb(),new Rt(e.r,e.g,e.b,e.opacity)):new Rt}function qs(e,t,n,i){return arguments.length===1?_v(e):new Rt(e,t,n,i==null?1:i)}function Rt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Ou(Rt,qs,Cc(Us,{brighter:function(e){return e=e==null?Su:Math.pow(Su,e),new Rt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Zo:Math.pow(Zo,e),new Rt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:K$,formatHex:K$,formatRgb:J$,toString:J$}));function K$(){return"#"+Av(this.r)+Av(this.g)+Av(this.b)}function J$(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Av(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Q$(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ur(e,t,n,i)}function Z$(e){if(e instanceof ur)return new ur(e.h,e.s,e.l,e.opacity);if(e instanceof Us||(e=Fc(e)),!e)return new ur;if(e instanceof ur)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,u=(s+r)/2;return a?(t===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-t)/a+2:o=(t-n)/a+4,a/=u<.5?s+r:2-s-r,o*=60):a=u>0&&u<1?0:o,new ur(o,a,u,e.opacity)}function Wh(e,t,n,i){return arguments.length===1?Z$(e):new ur(e,t,n,i==null?1:i)}function ur(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Ou(ur,Wh,Cc(Us,{brighter:function(e){return e=e==null?Su:Math.pow(Su,e),new ur(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Zo:Math.pow(Zo,e),new ur(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Rt(Ov(e>=240?e-240:e+120,r,i),Ov(e,r,i),Ov(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Ov(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const eF=Math.PI/180,tF=180/Math.PI,Gh=18,nF=.96422,iF=1,rF=.82521,sF=4/29,$u=6/29,oF=3*$u*$u,VU=$u*$u*$u;function aF(e){if(e instanceof lr)return new lr(e.l,e.a,e.b,e.opacity);if(e instanceof Vr)return uF(e);e instanceof Rt||(e=_v(e));var t=Fv(e.r),n=Fv(e.g),i=Fv(e.b),r=Sv((.2225045*t+.7168786*n+.0606169*i)/iF),s,o;return t===n&&n===i?s=o=r:(s=Sv((.4360747*t+.3850649*n+.1430804*i)/nF),o=Sv((.0139322*t+.0971045*n+.7141733*i)/rF)),new lr(116*r-16,500*(s-r),200*(r-o),e.opacity)}function Hh(e,t,n,i){return arguments.length===1?aF(e):new lr(e,t,n,i==null?1:i)}function lr(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}Ou(lr,Hh,Cc(Us,{brighter:function(e){return new lr(this.l+Gh*(e==null?1:e),this.a,this.b,this.opacity)},darker:function(e){return new lr(this.l-Gh*(e==null?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=nF*Cv(t),e=iF*Cv(e),n=rF*Cv(n),new Rt($v(3.1338561*t-1.6168667*e-.4906146*n),$v(-.9787684*t+1.9161415*e+.033454*n),$v(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Sv(e){return e>VU?Math.pow(e,1/3):e/oF+sF}function Cv(e){return e>$u?e*e*e:oF*(e-sF)}function $v(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Fv(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function XU(e){if(e instanceof Vr)return new Vr(e.h,e.c,e.l,e.opacity);if(e instanceof lr||(e=aF(e)),e.a===0&&e.b===0)return new Vr(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*tF;return new Vr(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Yh(e,t,n,i){return arguments.length===1?XU(e):new Vr(e,t,n,i==null?1:i)}function Vr(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function uF(e){if(isNaN(e.h))return new lr(e.l,0,0,e.opacity);var t=e.h*eF;return new lr(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Ou(Vr,Yh,Cc(Us,{brighter:function(e){return new Vr(this.h,this.c,this.l+Gh*(e==null?1:e),this.opacity)},darker:function(e){return new Vr(this.h,this.c,this.l-Gh*(e==null?1:e),this.opacity)},rgb:function(){return uF(this).rgb()}}));var lF=-.14861,kv=1.78277,Dv=-.29227,Vh=-.90649,kc=1.97294,cF=kc*Vh,fF=kc*kv,dF=kv*Dv-Vh*lF;function KU(e){if(e instanceof ea)return new ea(e.h,e.s,e.l,e.opacity);e instanceof Rt||(e=_v(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(dF*i+cF*t-fF*n)/(dF+cF-fF),s=i-r,o=(kc*(n-r)-Dv*s)/Vh,a=Math.sqrt(o*o+s*s)/(kc*r*(1-r)),u=a?Math.atan2(o,s)*tF-120:NaN;return new ea(u<0?u+360:u,a,r,e.opacity)}function Mv(e,t,n,i){return arguments.length===1?KU(e):new ea(e,t,n,i==null?1:i)}function ea(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Ou(ea,Mv,Cc(Us,{brighter:function(e){return e=e==null?Su:Math.pow(Su,e),new ea(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Zo:Math.pow(Zo,e),new ea(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*eF,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new Rt(255*(t+n*(lF*i+kv*r)),255*(t+n*(Dv*i+Vh*r)),255*(t+n*(kc*i)),this.opacity)}}));function hF(e,t,n,i,r){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*i+o*r)/6}function gF(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],s=e[i+1],o=i>0?e[i-1]:2*r-s,a=i<t-1?e[i+2]:2*s-r;return hF((n-i/t)*t,o,r,s,a)}}function pF(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],s=e[i%t],o=e[(i+1)%t],a=e[(i+2)%t];return hF((n-i/t)*t,r,s,o,a)}}var Xh=e=>()=>e;function mF(e,t){return function(n){return e+n*t}}function JU(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Kh(e,t){var n=t-e;return n?mF(e,n>180||n<-180?n-360*Math.round(n/360):n):Xh(isNaN(e)?t:e)}function QU(e){return(e=+e)==1?St:function(t,n){return n-t?JU(t,n,e):Xh(isNaN(t)?n:t)}}function St(e,t){var n=t-e;return n?mF(e,n):Xh(isNaN(e)?t:e)}var Tv=function e(t){var n=QU(t);function i(r,s){var o=n((r=qs(r)).r,(s=qs(s)).r),a=n(r.g,s.g),u=n(r.b,s.b),l=St(r.opacity,s.opacity);return function(c){return r.r=o(c),r.g=a(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function yF(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=qs(t[o]),i[o]=a.r||0,r[o]=a.g||0,s[o]=a.b||0;return i=e(i),r=e(r),s=e(s),a.opacity=1,function(u){return a.r=i(u),a.g=r(u),a.b=s(u),a+""}}}var ZU=yF(gF),eq=yF(pF);function Nv(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=e[r]*(1-s)+t[r]*s;return i}}function vF(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function tq(e,t){return(vF(t)?Nv:bF)(e,t)}function bF(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Ws(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<i;++o)s[o]=r[o](a);return s}}function xF(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Di(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function wF(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ws(e[r],t[r]):i[r]=t[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Rv=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,jv=new RegExp(Rv.source,"g");function nq(e){return function(){return e}}function iq(e){return function(t){return e(t)+""}}function EF(e,t){var n=Rv.lastIndex=jv.lastIndex=0,i,r,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(i=Rv.exec(e))&&(r=jv.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,u.push({i:o,x:Di(i,r)})),n=jv.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?iq(u[0].x):nq(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Ws(e,t){var n=typeof t,i;return t==null||n==="boolean"?Xh(t):(n==="number"?Di:n==="string"?(i=Fc(t))?(t=i,Tv):EF:t instanceof Fc?Tv:t instanceof Date?xF:vF(t)?Nv:Array.isArray(t)?bF:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?wF:Di)(e,t)}function rq(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function sq(e,t){var n=Kh(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function Dc(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var _F=180/Math.PI,Lv={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function AF(e,t,n,i,r,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,u/=a),e*i<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*_F,skewX:Math.atan(u)*_F,scaleX:o,scaleY:a}}var Jh;function oq(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Lv:AF(t.a,t.b,t.c,t.d,t.e,t.f)}function aq(e){return e==null||(Jh||(Jh=document.createElementNS("http://www.w3.org/2000/svg","g")),Jh.setAttribute("transform",e),!(e=Jh.transform.baseVal.consolidate()))?Lv:(e=e.matrix,AF(e.a,e.b,e.c,e.d,e.e,e.f))}function OF(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function s(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push("translate(",null,t,null,n);g.push({i:p-4,x:Di(l,f)},{i:p-2,x:Di(c,d)})}else(f||d)&&h.push("translate("+f+t+d+n)}function o(l,c,f,d){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:Di(l,c)})):c&&f.push(r(f)+"rotate("+c+i)}function a(l,c,f,d){l!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:Di(l,c)}):c&&f.push(r(f)+"skewX("+c+i)}function u(l,c,f,d,h,g){if(l!==f||c!==d){var p=h.push(r(h)+"scale(",null,",",null,")");g.push({i:p-4,x:Di(l,f)},{i:p-2,x:Di(c,d)})}else(f!==1||d!==1)&&h.push(r(h)+"scale("+f+","+d+")")}return function(l,c){var f=[],d=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,d),o(l.rotate,c.rotate,f,d),a(l.skewX,c.skewX,f,d),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,d),l=c=null,function(h){for(var g=-1,p=d.length,m;++g<p;)f[(m=d[g]).i]=m.x(h);return f.join("")}}}var uq=OF(oq,"px, ","px)","deg)"),lq=OF(aq,", ",")",")"),cq=1e-12;function SF(e){return((e=Math.exp(e))+1/e)/2}function fq(e){return((e=Math.exp(e))-1/e)/2}function dq(e){return((e=Math.exp(2*e))-1)/(e+1)}var hq=function e(t,n,i){function r(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],d=o[2],h=c-a,g=f-u,p=h*h+g*g,m,y;if(p<cq)y=Math.log(d/l)/t,m=function(w){return[a+w*h,u+w*g,l*Math.exp(t*w*y)]};else{var v=Math.sqrt(p),b=(d*d-l*l+i*p)/(2*l*n*v),x=(d*d-l*l-i*p)/(2*d*n*v),E=Math.log(Math.sqrt(b*b+1)-b),_=Math.log(Math.sqrt(x*x+1)-x);y=(_-E)/t,m=function(w){var A=w*y,S=SF(E),O=l/(n*v)*(S*dq(t*A+E)-fq(E));return[a+O*h,u+O*g,l*S/SF(t*A+E)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return r.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},r}(Math.SQRT2,2,4);function CF(e){return function(t,n){var i=e((t=Wh(t)).h,(n=Wh(n)).h),r=St(t.s,n.s),s=St(t.l,n.l),o=St(t.opacity,n.opacity);return function(a){return t.h=i(a),t.s=r(a),t.l=s(a),t.opacity=o(a),t+""}}}var gq=CF(Kh),pq=CF(St);function mq(e,t){var n=St((e=Hh(e)).l,(t=Hh(t)).l),i=St(e.a,t.a),r=St(e.b,t.b),s=St(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=i(o),e.b=r(o),e.opacity=s(o),e+""}}function $F(e){return function(t,n){var i=e((t=Yh(t)).h,(n=Yh(n)).h),r=St(t.c,n.c),s=St(t.l,n.l),o=St(t.opacity,n.opacity);return function(a){return t.h=i(a),t.c=r(a),t.l=s(a),t.opacity=o(a),t+""}}}var yq=$F(Kh),vq=$F(St);function FF(e){return function t(n){n=+n;function i(r,s){var o=e((r=Mv(r)).h,(s=Mv(s)).h),a=St(r.s,s.s),u=St(r.l,s.l),l=St(r.opacity,s.opacity);return function(c){return r.h=o(c),r.s=a(c),r.l=u(Math.pow(c,n)),r.opacity=l(c),r+""}}return i.gamma=t,i}(1)}var bq=FF(Kh),xq=FF(St);function Pv(e,t){t===void 0&&(t=e,e=Ws);for(var n=0,i=t.length-1,r=t[0],s=new Array(i<0?0:i);n<i;)s[n]=e(r,r=t[++n]);return function(o){var a=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return s[a](o-a)}}function wq(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}var Eq=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",interpolate:Ws,interpolateArray:tq,interpolateBasis:gF,interpolateBasisClosed:pF,interpolateDate:xF,interpolateDiscrete:rq,interpolateHue:sq,interpolateNumber:Di,interpolateNumberArray:Nv,interpolateObject:wF,interpolateRound:Dc,interpolateString:EF,interpolateTransformCss:uq,interpolateTransformSvg:lq,interpolateZoom:hq,interpolateRgb:Tv,interpolateRgbBasis:ZU,interpolateRgbBasisClosed:eq,interpolateHsl:gq,interpolateHslLong:pq,interpolateLab:mq,interpolateHcl:yq,interpolateHclLong:vq,interpolateCubehelix:bq,interpolateCubehelixLong:xq,piecewise:Pv,quantize:wq});function _q(e){return function(){return e}}function Iv(e){return+e}var kF=[0,1];function Dn(e){return e}function Bv(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:_q(isNaN(t)?NaN:.5)}function Aq(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function Oq(e,t,n){var i=e[0],r=e[1],s=t[0],o=t[1];return r<i?(i=Bv(r,i),s=n(o,s)):(i=Bv(i,r),s=n(s,o)),function(a){return s(i(a))}}function Sq(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=Bv(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=tc(e,a,1,i)-1;return s[u](r[u](a))}}function Mc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Qh(){var e=kF,t=kF,n=Ws,i,r,s,o=Dn,a,u,l;function c(){var d=Math.min(e.length,t.length);return o!==Dn&&(o=Aq(e[0],e[d-1])),a=d>2?Sq:Oq,u=l=null,f}function f(d){return d==null||isNaN(d=+d)?s:(u||(u=a(e.map(i),t,n)))(i(o(d)))}return f.invert=function(d){return o(r((l||(l=a(t,e.map(i),Di)))(d)))},f.domain=function(d){return arguments.length?(e=Array.from(d,Iv),c()):e.slice()},f.range=function(d){return arguments.length?(t=Array.from(d),c()):t.slice()},f.rangeRound=function(d){return t=Array.from(d),n=Dc,c()},f.clamp=function(d){return arguments.length?(o=d?!0:Dn,c()):o!==Dn},f.interpolate=function(d){return arguments.length?(n=d,c()):n},f.unknown=function(d){return arguments.length?(s=d,f):s},function(d,h){return i=d,r=h,c()}}function DF(){return Qh()(Dn,Dn)}function MF(e,t,n,i){var r=ks(e,t,n),s;switch(i=hu(i==null?",f":i),i.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(s=hS(r,o))&&(i.precision=s),L1(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=gS(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=dS(r))&&(i.precision=s-(i.type==="%")*2);break}}return dh(i)}function ta(e){var t=e.domain;return e.ticks=function(n){var i=t();return T1(i[0],i[i.length-1],n==null?10:n)},e.tickFormat=function(n,i){var r=t();return MF(r[0],r[r.length-1],n==null?10:n,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,s=i.length-1,o=i[r],a=i[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=r,r=s,s=l);c-- >0;){if(l=ZO(o,a,n),l===u)return i[r]=o,i[s]=a,t(i);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function TF(){var e=DF();return e.copy=function(){return Mc(e,TF())},or.apply(e,arguments),ta(e)}function NF(e){var t;function n(i){return i==null||isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,Iv),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return NF(e).unknown(t)},e=arguments.length?Array.from(e,Iv):[0,1],ta(n)}function RF(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],s=e[i],o;return s<r&&(o=n,n=i,i=o,o=r,r=s,s=o),e[n]=t.floor(r),e[i]=t.ceil(s),e}function jF(e){return Math.log(e)}function LF(e){return Math.exp(e)}function Cq(e){return-Math.log(-e)}function $q(e){return-Math.exp(-e)}function Fq(e){return isFinite(e)?+("1e"+e):e<0?0:e}function kq(e){return e===10?Fq:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function Dq(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function PF(e){return function(t){return-e(-t)}}function zv(e){var t=e(jF,LF),n=t.domain,i=10,r,s;function o(){return r=Dq(i),s=kq(i),n()[0]<0?(r=PF(r),s=PF(s),e(Cq,$q)):e(jF,LF),t}return t.base=function(a){return arguments.length?(i=+a,o()):i},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=function(a){var u=n(),l=u[0],c=u[u.length-1],f;(f=c<l)&&(d=l,l=c,c=d);var d=r(l),h=r(c),g,p,m,y=a==null?10:+a,v=[];if(!(i%1)&&h-d<y){if(d=Math.floor(d),h=Math.ceil(h),l>0){for(;d<=h;++d)for(p=1,g=s(d);p<i;++p)if(m=g*p,!(m<l)){if(m>c)break;v.push(m)}}else for(;d<=h;++d)for(p=i-1,g=s(d);p>=1;--p)if(m=g*p,!(m<l)){if(m>c)break;v.push(m)}v.length*2<y&&(v=T1(l,c,y))}else v=T1(d,h,Math.min(h-d,y)).map(s);return f?v.reverse():v},t.tickFormat=function(a,u){if(u==null&&(u=i===10?".0e":","),typeof u!="function"&&(u=dh(u)),a===1/0)return u;a==null&&(a=10);var l=Math.max(1,i*a/t.ticks().length);return function(c){var f=c/s(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=l?u(c):""}},t.nice=function(){return n(RF(n(),{floor:function(a){return s(Math.floor(r(a)))},ceil:function(a){return s(Math.ceil(r(a)))}}))},t}function IF(){var e=zv(Qh()).domain([1,10]);return e.copy=function(){return Mc(e,IF()).base(e.base())},or.apply(e,arguments),e}function BF(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function zF(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Uv(e){var t=1,n=e(BF(t),zF(t));return n.constant=function(i){return arguments.length?e(BF(t=+i),zF(t)):t},ta(n)}function UF(){var e=Uv(Qh());return e.copy=function(){return Mc(e,UF()).constant(e.constant())},or.apply(e,arguments)}function qF(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Mq(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Tq(e){return e<0?-e*e:e*e}function qv(e){var t=e(Dn,Dn),n=1;function i(){return n===1?e(Dn,Dn):n===.5?e(Mq,Tq):e(qF(n),qF(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},ta(t)}function Wv(){var e=qv(Qh());return e.copy=function(){return Mc(e,Wv()).exponent(e.exponent())},or.apply(e,arguments),e}function Nq(){return Wv.apply(null,arguments).exponent(.5)}function WF(){var e=[],t=[],n=[],i;function r(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=tS(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?i:t[tc(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(fu),r()},s.range=function(o){return arguments.length?(t=Array.from(o),r()):t.slice()},s.unknown=function(o){return arguments.length?(i=o,s):i},s.quantiles=function(){return n.slice()},s.copy=function(){return WF().domain(e).range(t).unknown(i)},or.apply(s,arguments)}function GF(){var e=0,t=1,n=1,i=[.5],r=[0,1],s;function o(u){return u!=null&&u<=u?r[tc(i,u,0,n)]:s}function a(){var u=-1;for(i=new Array(n);++u<n;)i[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(r=Array.from(u)).length-1,a()):r.slice()},o.invertExtent=function(u){var l=r.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,i[0]]:l>=n?[i[n-1],t]:[i[l-1],i[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return i.slice()},o.copy=function(){return GF().domain([e,t]).range(r).unknown(s)},or.apply(ta(o),arguments)}function HF(){var e=[.5],t=[0,1],n,i=1;function r(s){return s!=null&&s<=s?t[tc(e,s,0,i)]:n}return r.domain=function(s){return arguments.length?(e=Array.from(s),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(s){return arguments.length?(t=Array.from(s),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return HF().domain(e).range(t).unknown(n)},or.apply(r,arguments)}function Rq(e){return new Date(e)}function jq(e){return e instanceof Date?+e:+new Date(+e)}function Gv(e,t,n,i,r,s,o,a,u,l){var c=DF(),f=c.invert,d=c.domain,h=l(".%L"),g=l(":%S"),p=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),v=l("%b %d"),b=l("%B"),x=l("%Y");function E(_){return(u(_)<_?h:a(_)<_?g:o(_)<_?p:s(_)<_?m:i(_)<_?r(_)<_?y:v:n(_)<_?b:x)(_)}return c.invert=function(_){return new Date(f(_))},c.domain=function(_){return arguments.length?d(Array.from(_,jq)):d().map(Rq)},c.ticks=function(_){var w=d();return e(w[0],w[w.length-1],_==null?10:_)},c.tickFormat=function(_,w){return w==null?E:l(w)},c.nice=function(_){var w=d();return(!_||typeof _.range!="function")&&(_=t(w[0],w[w.length-1],_==null?10:_)),_?d(RF(w,_)):c},c.copy=function(){return Mc(c,Gv(e,t,n,i,r,s,o,a,u,l))},c}function Lq(){return or.apply(Gv(HP,YP,Ts,hh,ic,Ms,G1,W1,Ds,ay).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Pq(){return or.apply(Gv(WP,GP,Rs,gh,sc,Ns,V1,Y1,Ds,uy).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Zh(){var e=0,t=1,n,i,r,s,o=Dn,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(r===0?.5:(f=(s(f)-n)*r,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),i=s(t=+t),r=n===i?0:1/(i-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(d){var h,g;return arguments.length?([h,g]=d,o=f(h,g),l):[o(0),o(1)]}}return l.range=c(Ws),l.rangeRound=c(Dc),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),l}}function Gs(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Hv(){var e=ta(Zh()(Dn));return e.copy=function(){return Gs(e,Hv())},zs.apply(e,arguments)}function YF(){var e=zv(Zh()).domain([1,10]);return e.copy=function(){return Gs(e,YF()).base(e.base())},zs.apply(e,arguments)}function VF(){var e=Uv(Zh());return e.copy=function(){return Gs(e,VF()).constant(e.constant())},zs.apply(e,arguments)}function Yv(){var e=qv(Zh());return e.copy=function(){return Gs(e,Yv()).exponent(e.exponent())},zs.apply(e,arguments)}function Iq(){return Yv.apply(null,arguments).exponent(.5)}function eg(){var e=0,t=.5,n=1,i=1,r,s,o,a,u,l=Dn,c,f=!1,d;function h(p){return isNaN(p=+p)?d:(p=.5+((p=+c(p))-s)*(i*p<i*s?a:u),l(f?Math.max(0,Math.min(1,p)):p))}h.domain=function(p){return arguments.length?([e,t,n]=p,r=c(e=+e),s=c(t=+t),o=c(n=+n),a=r===s?0:.5/(s-r),u=s===o?0:.5/(o-s),i=s<r?-1:1,h):[e,t,n]},h.clamp=function(p){return arguments.length?(f=!!p,h):f},h.interpolator=function(p){return arguments.length?(l=p,h):l};function g(p){return function(m){var y,v,b;return arguments.length?([y,v,b]=m,l=Pv(p,[y,v,b]),h):[l(0),l(.5),l(1)]}}return h.range=g(Ws),h.rangeRound=g(Dc),h.unknown=function(p){return arguments.length?(d=p,h):d},function(p){return c=p,r=p(e),s=p(t),o=p(n),a=r===s?0:.5/(s-r),u=s===o?0:.5/(o-s),i=s<r?-1:1,h}}function XF(){var e=ta(eg()(Dn));return e.copy=function(){return Gs(e,XF())},zs.apply(e,arguments)}function KF(){var e=zv(eg()).domain([.1,1,10]);return e.copy=function(){return Gs(e,KF()).base(e.base())},zs.apply(e,arguments)}function JF(){var e=Uv(eg());return e.copy=function(){return Gs(e,JF()).constant(e.constant())},zs.apply(e,arguments)}function Vv(){var e=qv(eg());return e.copy=function(){return Gs(e,Vv()).exponent(e.exponent())},zs.apply(e,arguments)}function Bq(){return Vv.apply(null,arguments).exponent(.5)}function Xv(e,t,n){const i=e-t+n*2;return e?i>0?i:1:0}const zq="identity",Fu="linear",Xr="log",Tc="pow",Nc="sqrt",tg="symlog",na="time",ia="utc",cr="sequential",ku="diverging",Du="quantile",ng="quantize",ig="threshold",Kv="ordinal",Jv="point",QF="band",Qv="bin-ordinal",mt="continuous",Rc="discrete",jc="discretizing",ci="interpolating",Zv="temporal";function Uq(e){return function(t){let n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function qq(e){return function(t){const n=e.range();let i=t[0],r=t[1],s=-1,o,a,u,l;for(r<i&&(a=i,i=r,r=a),u=0,l=n.length;u<l;++u)n[u]>=i&&n[u]<=r&&(s<0&&(s=u),o=u);if(!(s<0))return i=e.invertExtent(n[s]),r=e.invertExtent(n[o]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]]}}function eb(){const e=Ev().unknown(void 0),t=e.domain,n=e.range;let i=[0,1],r,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,d=i[1]<i[0],h=i[1-d],g=Xv(f,a,u);let p=i[d-0];r=(h-p)/(g||1),o&&(r=Math.floor(r)),p+=(h-p-r*(f-a))*l,s=r*(1-a),o&&(p=Math.round(p),s=Math.round(s));const m=Yn(f).map(y=>p+r*y);return n(d?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return r},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const d=i[1]<i[0],h=d?n().reverse():n(),g=h.length-1;let p=+f[0],m=+f[1],y,v,b;if(!(p!==p||m!==m)&&(m<p&&(b=p,p=m,m=b),!(m<h[0]||p>i[1-d])))return y=Math.max(0,lh(h,p)-1),v=p===m?y:lh(h,m)-1,p-h[y]>s+1e-10&&++y,d&&(b=y,y=g-v,v=g-b),y>v?void 0:t().slice(y,v+1)},e.invert=function(f){const d=e.invertRange([f,f]);return d&&d[0]},e.copy=function(){return eb().domain(t()).range(i).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function ZF(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return ZF(t())},e}function Wq(){return ZF(eb().paddingInner(1))}var Gq=Array.prototype.map;function Hq(e){return Gq.call(e,Ut)}const Yq=Array.prototype.slice;function ek(){let e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(tc(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=Hq(i),n):e.slice()},n.range=function(i){return arguments.length?(t=Yq.call(i),n):t.slice()},n.tickFormat=function(i,r){return MF(e[0],be(e),i==null?10:i,r)},n.copy=function(){return ek().domain(n.domain()).range(n.range())},n}const rg={};function Vq(e,t,n){const i=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?Uq(s):s.invertExtent?qq(s):void 0),s.type=e,s};return i.metadata=Fi(re(n)),i}function $e(e,t,n){return arguments.length>1?(rg[e]=Vq(e,t,n),this):tk(e)?rg[e]:void 0}$e(zq,NF);$e(Fu,TF,mt);$e(Xr,IF,[mt,Xr]);$e(Tc,Wv,mt);$e(Nc,Nq,mt);$e(tg,UF,mt);$e(na,Lq,[mt,Zv]);$e(ia,Pq,[mt,Zv]);$e(cr,Hv,[mt,ci]);$e("".concat(cr,"-").concat(Fu),Hv,[mt,ci]);$e("".concat(cr,"-").concat(Xr),YF,[mt,ci,Xr]);$e("".concat(cr,"-").concat(Tc),Yv,[mt,ci]);$e("".concat(cr,"-").concat(Nc),Iq,[mt,ci]);$e("".concat(cr,"-").concat(tg),VF,[mt,ci]);$e("".concat(ku,"-").concat(Fu),XF,[mt,ci]);$e("".concat(ku,"-").concat(Xr),KF,[mt,ci,Xr]);$e("".concat(ku,"-").concat(Tc),Vv,[mt,ci]);$e("".concat(ku,"-").concat(Nc),Bq,[mt,ci]);$e("".concat(ku,"-").concat(tg),JF,[mt,ci]);$e(Du,WF,[jc,Du]);$e(ng,GF,jc);$e(ig,HF,jc);$e(Qv,ek,[Rc,jc]);$e(Kv,Ev,Rc);$e(QF,eb,Rc);$e(Jv,Wq,Rc);function tk(e){return se(rg,e)}function ra(e,t){const n=rg[e];return n&&n.metadata[t]}function tb(e){return ra(e,mt)}function Mu(e){return ra(e,Rc)}function nb(e){return ra(e,jc)}function nk(e){return ra(e,Xr)}function Xq(e){return ra(e,Zv)}function ik(e){return ra(e,ci)}function rk(e){return ra(e,Du)}const Kq=["clamp","base","constant","exponent"];function sk(e,t){const n=t[0],i=be(t)-n;return function(r){return e(n+r*i)}}function sg(e,t,n){return Pv(ib(t||"rgb",n),e)}function ok(e,t){const n=new Array(t),i=t+1;for(let r=0;r<t;)n[r]=e(++r/i);return n}function ak(e,t,n){const i=n-t;let r,s,o;return!i||!Number.isFinite(i)?qt(.5):(r=(s=e.type).indexOf("-"),s=r<0?s:s.slice(r+1),o=$e(s)().domain([t,n]).range([0,1]),Kq.forEach(a=>e[a]?o[a](e[a]()):0),o)}function ib(e,t){const n=Eq[Jq(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function Jq(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const Qq={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},Zq={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function uk(e){const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function lk(e,t){for(const n in e)rb(n,t(e[n]))}const ck={};lk(Zq,uk);lk(Qq,e=>sg(uk(e)));function rb(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(ck[e]=t,this):ck[e]}const og="symbol",eW="discrete",tW="gradient",nW=e=>K(e)?e.map(t=>String(t)):String(e),iW=(e,t)=>e[1]-t[1],rW=(e,t)=>t[1]-e[1];function sb(e,t,n){let i;return $s(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(Ql(e.domain())/n||1)))),ue(t)&&(i=t.step,t=t.interval),_e(t)&&(t=e.type===na?pu(t):e.type==ia?mu(t):N("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function fk(e,t,n){let i=e.range(),r=i[0],s=be(i),o=iW;if(r>s&&(i=s,s=r,r=i,o=rW),r=Math.floor(r),s=Math.ceil(s),t=t.map(a=>[a,e(a)]).filter(a=>r<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],be(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function ob(e,t){return e.bins?fk(e,e.bins):e.ticks?e.ticks(t):e.domain()}function dk(e,t,n,i,r,s){const o=t.type;let a=nW;if(o===na||r===na)a=e.timeFormat(i);else if(o===ia||r===ia)a=e.utcFormat(i);else if(nk(o)){const u=e.formatFloat(i);if(s||t.bins)a=u;else{const l=hk(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,i)}else i&&(a=e.format(i));return a}function hk(e,t,n){const i=ob(e,t),r=e.base(),s=Math.log(r),o=Math.max(1,r*t/i.length),a=u=>{let l=u/Math.pow(r,Math.round(Math.log(u)/s));return l*r<r-.5&&(l*=r),l<=o};return n?i.filter(a):a}const ab={[Du]:"quantiles",[ng]:"thresholds",[ig]:"domain"},gk={[Du]:"quantiles",[ng]:"domain"};function pk(e,t){return e.bins?aW(e.bins):e.type===Xr?hk(e,t,!0):ab[e.type]?oW(e[ab[e.type]]()):ob(e,t)}function sW(e,t,n){const i=t[gk[t.type]](),r=i.length;let s=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o)s=Math.min(s,i[o]-i[o-1]);return e.formatSpan(0,s,3*10,n)}function oW(e){const t=[-1/0].concat(e);return t.max=1/0,t}function aW(e){const t=e.slice(0,-1);return t.max=be(e),t}const uW=e=>ab[e.type]||e.bins;function mk(e,t,n,i,r,s,o){const a=gk[t.type]&&s!==na&&s!==ia?sW(e,t,r):dk(e,t,n,r,s,o);return i===og&&uW(t)?lW(a):i===eW?cW(a):fW(a)}const lW=e=>(t,n,i)=>{const r=yk(i[n+1],yk(i.max,1/0)),s=vk(t,e),o=vk(r,e);return s&&o?s+" \u2013 "+o:o?"< "+o:"\u2265 "+s},yk=(e,t)=>e!=null?e:t,cW=e=>(t,n)=>n?e(t):null,fW=e=>t=>e(t),vk=(e,t)=>Number.isFinite(e)?t(e):null;function dW(e){const t=e.domain(),n=t.length-1;let i=+t[0],r=+be(t),s=r-i;if(e.type===ig){const o=n?s/n:.1;i-=o,r+=o,s=r-i}return o=>(o-i)/s}function hW(e,t,n,i){const r=i||t.type;return _e(n)&&Xq(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===na?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===ia?e.utcFormat("%A, %d %B %Y, %X UTC"):mk(e,t,5,null,n,i,!0)}function bk(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=hW(e,t,n.format,n.formatType);if(nb(t.type)){const s=pk(t).slice(1).map(r),o=s.length;return"".concat(o," boundar").concat(o===1?"y":"ies",": ").concat(s.join(", "))}else if(Mu(t.type)){const s=t.domain(),o=s.length,a=o>i?s.slice(0,i-2).map(r).join(", ")+", ending with "+s.slice(-1).map(r):s.map(r).join(", ");return"".concat(o," value").concat(o===1?"":"s",": ").concat(a)}else{const s=t.domain();return"values from ".concat(r(s[0])," to ").concat(r(be(s)))}}let xk=0;function gW(){xk=0}const ag="p_";function ub(e){return e&&e.gradient}function wk(e,t,n){const i=e.gradient;let r=e.id,s=i==="radial"?ag:"";return r||(r=e.id="gradient_"+xk++,i==="radial"?(e.x1=fr(e.x1,.5),e.y1=fr(e.y1,.5),e.r1=fr(e.r1,0),e.x2=fr(e.x2,.5),e.y2=fr(e.y2,.5),e.r2=fr(e.r2,.5),s=ag):(e.x1=fr(e.x1,0),e.y1=fr(e.y1,0),e.x2=fr(e.x2,1),e.y2=fr(e.y2,0))),t[r]=e,"url("+(n||"")+"#"+s+r+")"}function fr(e,t){return e!=null?e:t}function Ek(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,s){return n.push({offset:r,color:s}),i}}}const _k={basis:{curve:EU},"basis-closed":{curve:_U},"basis-open":{curve:AU},bundle:{curve:OU,tension:"beta",value:.85},cardinal:{curve:SU,tension:"tension",value:0},"cardinal-open":{curve:$U,tension:"tension",value:0},"cardinal-closed":{curve:CU,tension:"tension",value:0},"catmull-rom":{curve:FU,tension:"alpha",value:.5},"catmull-rom-closed":{curve:kU,tension:"alpha",value:.5},"catmull-rom-open":{curve:DU,tension:"alpha",value:.5},linear:{curve:pv},"linear-closed":{curve:MU},monotone:{horizontal:NU,vertical:TU},natural:{curve:RU},step:{curve:jU},"step-after":{curve:PU},"step-before":{curve:LU}};function lb(e,t,n){var i=se(_k,e)&&_k[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}const pW={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Lc=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function Tu(e){const t=[];let n,i,r,s,o,a,u,l,c,f;const d=e.slice().replace(Lc[0],"###$1").split(Lc[1]).slice(1);for(u=0,c=d.length;u<c;++u){for(n=d[u],i=n.slice(1).trim().replace(Lc[2],"$1###$2").replace(Lc[3],"$1###$2").split(Lc[4]),o=n.charAt(0),r=[o],l=0,f=i.length;l<f;++l)(s=+i[l])===s&&r.push(s);if(a=pW[o.toLowerCase()],r.length-1>a){const h=r.length;for(l=1,t.push([o].concat(r.slice(l,l+=a))),o=o==="M"?"L":o==="m"?"l":o;l<h;l+=a)t.push([o].concat(r.slice(l,l+a)))}else t.push(r)}return t}const Hs=Math.PI/180,mW=1e-14,sa=Math.PI/2,dr=Math.PI*2,Nu=Math.sqrt(3)/2;var cb={},fb={},Ak=[].join;function yW(e,t,n,i,r,s,o,a,u){const l=Ak.call(arguments);if(cb[l])return cb[l];const c=o*Hs,f=Math.sin(c),d=Math.cos(c);n=Math.abs(n),i=Math.abs(i);const h=d*(a-e)*.5+f*(u-t)*.5,g=d*(u-t)*.5-f*(a-e)*.5;let p=h*h/(n*n)+g*g/(i*i);p>1&&(p=Math.sqrt(p),n*=p,i*=p);const m=d/n,y=f/n,v=-f/i,b=d/i,x=m*a+y*u,E=v*a+b*u,_=m*e+y*t,w=v*e+b*t,A=(_-x)*(_-x)+(w-E)*(w-E);let S=1/A-.25;S<0&&(S=0);let O=Math.sqrt(S);s==r&&(O=-O);const C=.5*(x+_)-O*(w-E),k=.5*(E+w)+O*(_-x),F=Math.atan2(E-k,x-C);let $=Math.atan2(w-k,_-C)-F;$<0&&s===1?$+=dr:$>0&&s===0&&($-=dr);const R=Math.ceil(Math.abs($/(sa+.001))),L=[];for(let U=0;U<R;++U){const H=F+U*$/R,ae=F+(U+1)*$/R;L[U]=[C,k,H,ae,n,i,f,d]}return cb[l]=L}function vW(e){const t=Ak.call(e);if(fb[t])return fb[t];var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7];const c=l*o,f=-u*a,d=u*o,h=l*a,g=Math.cos(r),p=Math.sin(r),m=Math.cos(s),y=Math.sin(s),v=.5*(s-r),b=Math.sin(v*.5),x=8/3*b*b/Math.sin(v),E=n+g-x*p,_=i+p+x*g,w=n+m,A=i+y,S=w+x*y,O=A-x*m;return fb[t]=[c*E+f*_,d*E+h*_,c*S+f*O,d*S+h*O,c*w+f*A,d*w+h*A]}const fi=["l",0,0,0,0,0,0,0];function bW(e,t,n){const i=fi[0]=e[0];if(i==="a"||i==="A")fi[1]=t*e[1],fi[2]=n*e[2],fi[3]=e[3],fi[4]=e[4],fi[5]=e[5],fi[6]=t*e[6],fi[7]=n*e[7];else if(i==="h"||i==="H")fi[1]=t*e[1];else if(i==="v"||i==="V")fi[1]=n*e[1];else for(var r=1,s=e.length;r<s;++r)fi[r]=(r%2==1?t:n)*e[r];return fi}function Pc(e,t,n,i,r,s){var o,a=null,u=0,l=0,c=0,f=0,d,h,g,p;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),s==null&&(s=r),e.beginPath&&e.beginPath();for(var m=0,y=t.length;m<y;++m){switch(o=t[m],(r!==1||s!==1)&&(o=bW(o,r,s)),o[0]){case"l":u+=o[1],l+=o[2],e.lineTo(u+n,l+i);break;case"L":u=o[1],l=o[2],e.lineTo(u+n,l+i);break;case"h":u+=o[1],e.lineTo(u+n,l+i);break;case"H":u=o[1],e.lineTo(u+n,l+i);break;case"v":l+=o[1],e.lineTo(u+n,l+i);break;case"V":l=o[1],e.lineTo(u+n,l+i);break;case"m":u+=o[1],l+=o[2],e.moveTo(u+n,l+i);break;case"M":u=o[1],l=o[2],e.moveTo(u+n,l+i);break;case"c":d=u+o[5],h=l+o[6],c=u+o[3],f=l+o[4],e.bezierCurveTo(u+o[1]+n,l+o[2]+i,c+n,f+i,d+n,h+i),u=d,l=h;break;case"C":u=o[5],l=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+i,c+n,f+i,u+n,l+i);break;case"s":d=u+o[3],h=l+o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,u+o[1]+n,l+o[2]+i,d+n,h+i),c=u+o[1],f=l+o[2],u=d,l=h;break;case"S":d=o[3],h=o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,o[1]+n,o[2]+i,d+n,h+i),u=d,l=h,c=o[1],f=o[2];break;case"q":d=u+o[3],h=l+o[4],c=u+o[1],f=l+o[2],e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"Q":d=o[3],h=o[4],e.quadraticCurveTo(o[1]+n,o[2]+i,d+n,h+i),u=d,l=h,c=o[1],f=o[2];break;case"t":d=u+o[1],h=l+o[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-g,f=2*l-p):a[0]==="q"&&(c=2*u-c,f=2*l-f),g=c,p=f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h,c=u+o[1],f=l+o[2];break;case"T":d=o[1],h=o[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+i,d+n,h+i),u=d,l=h;break;case"a":Ok(e,u+n,l+i,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+i]),u+=o[6],l+=o[7];break;case"A":Ok(e,u+n,l+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),u=o[6],l=o[7];break;case"z":case"Z":e.closePath();break}a=o}}function Ok(e,t,n,i){const r=yW(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let s=0;s<r.length;++s){const o=vW(r[s]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const Sk=.5773502691896257,Ck={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,dr)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,s=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-s),e.lineTo(r,-s),e.lineTo(0,-n),e.lineTo(-r,-s),e.lineTo(-i,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Nu*n,r=i-n*Sk,s=n/4;e.moveTo(0,-i-r),e.lineTo(-s,i-r),e.lineTo(s,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Nu*n,r=i-n*Sk;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Nu*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Nu*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Nu*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Nu*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function $k(e){return se(Ck,e)?Ck[e]:xW(e)}var db={};function xW(e){if(!se(db,e)){const t=Tu(e);db[e]={draw:function(n,i){Pc(n,t,0,0,Math.sqrt(i)/2)}}}return db[e]}const Ys=.448084975506;function wW(e){return e.x}function EW(e){return e.y}function _W(e){return e.width}function AW(e){return e.height}function Kr(e){return typeof e=="function"?e:()=>+e}function ug(e,t,n){return Math.max(t,Math.min(e,n))}function Fk(){var e=wW,t=EW,n=_W,i=AW,r=Kr(0),s=r,o=r,a=r,u=null;function l(c,f,d){var h,g=f!=null?f:+e.call(this,c),p=d!=null?d:+t.call(this,c),m=+n.call(this,c),y=+i.call(this,c),v=Math.min(m,y)/2,b=ug(+r.call(this,c),0,v),x=ug(+s.call(this,c),0,v),E=ug(+o.call(this,c),0,v),_=ug(+a.call(this,c),0,v);if(u||(u=h=Jo()),b<=0&&x<=0&&E<=0&&_<=0)u.rect(g,p,m,y);else{var w=g+m,A=p+y;u.moveTo(g+b,p),u.lineTo(w-x,p),u.bezierCurveTo(w-Ys*x,p,w,p+Ys*x,w,p+x),u.lineTo(w,A-_),u.bezierCurveTo(w,A-Ys*_,w-Ys*_,A,w-_,A),u.lineTo(g+E,A),u.bezierCurveTo(g+Ys*E,A,g,A-Ys*E,g,A-E),u.lineTo(g,p+b),u.bezierCurveTo(g,p+Ys*b,g+Ys*b,p,g+b,p),u.closePath()}if(h)return u=null,h+""||null}return l.x=function(c){return arguments.length?(e=Kr(c),l):e},l.y=function(c){return arguments.length?(t=Kr(c),l):t},l.width=function(c){return arguments.length?(n=Kr(c),l):n},l.height=function(c){return arguments.length?(i=Kr(c),l):i},l.cornerRadius=function(c,f,d,h){return arguments.length?(r=Kr(c),s=f!=null?Kr(f):r,a=d!=null?Kr(d):r,o=h!=null?Kr(h):s,l):r},l.context=function(c){return arguments.length?(u=c==null?null:c,l):u},l}function kk(){var e,t,n,i,r=null,s,o,a,u;function l(f,d,h){const g=h/2;if(s){var p=a-d,m=f-o;if(p||m){var y=Math.sqrt(p*p+m*m),v=(p/=y)*u,b=(m/=y)*u,x=Math.atan2(m,p);r.moveTo(o-v,a-b),r.lineTo(f-p*g,d-m*g),r.arc(f,d,g,x-Math.PI,x),r.lineTo(o+v,a+b),r.arc(o,a,u,x,x+Math.PI)}else r.arc(f,d,g,0,dr);r.closePath()}else s=1;o=f,a=d,u=g}function c(f){var d,h=f.length,g,p=!1,m;for(r==null&&(r=m=Jo()),d=0;d<=h;++d)!(d<h&&i(g=f[d],d,f))===p&&(p=!p)&&(s=0),p&&l(+e(g,d,f),+t(g,d,f),+n(g,d,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function Ic(e,t){return e!=null?e:t}const Bc=e=>e.x||0,zc=e=>e.y||0,OW=e=>e.width||0,SW=e=>e.height||0,CW=e=>(e.x||0)+(e.width||0),$W=e=>(e.y||0)+(e.height||0),FW=e=>e.startAngle||0,kW=e=>e.endAngle||0,DW=e=>e.padAngle||0,MW=e=>e.innerRadius||0,TW=e=>e.outerRadius||0,NW=e=>e.cornerRadius||0,RW=e=>Ic(e.cornerRadiusTopLeft,e.cornerRadius)||0,jW=e=>Ic(e.cornerRadiusTopRight,e.cornerRadius)||0,LW=e=>Ic(e.cornerRadiusBottomRight,e.cornerRadius)||0,PW=e=>Ic(e.cornerRadiusBottomLeft,e.cornerRadius)||0,IW=e=>Ic(e.size,64),BW=e=>e.size||1,lg=e=>e.defined!==!1,zW=e=>$k(e.shape||"circle"),UW=bU().startAngle(FW).endAngle(kW).padAngle(DW).innerRadius(MW).outerRadius(TW).cornerRadius(NW),qW=D$().x(Bc).y1(zc).y0($W).defined(lg),WW=D$().y(zc).x1(Bc).x0(CW).defined(lg),GW=k$().x(Bc).y(zc).defined(lg),HW=Fk().x(Bc).y(zc).width(OW).height(SW).cornerRadius(RW,jW,LW,PW),YW=wU().type(zW).size(IW),VW=kk().x(Bc).y(zc).defined(lg).size(BW);function hb(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function XW(e,t){return UW.context(e)(t)}function KW(e,t){const n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?WW:qW).curve(lb(i,n.orient,n.tension)).context(e)(t)}function JW(e,t){const n=t[0],i=n.interpolate||"linear";return GW.curve(lb(i,n.orient,n.tension)).context(e)(t)}function Ru(e,t,n,i){return HW.context(e)(t,n,i)}function QW(e,t){return(t.mark.shape||t.shape).context(e)(t)}function ZW(e,t){return YW.context(e)(t)}function eG(e,t){return VW.context(e)(t)}var Dk=1;function Mk(){Dk=1}function gb(e,t,n){var i=t.clip,r=e._defs,s=t.clip_id||(t.clip_id="clip"+Dk++),o=r.clipping[s]||(r.clipping[s]={id:s});return ge(i)?o.path=i(null):hb(n)?o.path=Ru(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function yt(e){this.clear(),e&&this.union(e)}yt.prototype={clone(){return new yt(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:r,x2:s,y2:o}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*i-u*r+l,u*i+a*r+c,a*i-u*o+l,u*i+a*o+c,a*s-u*r+l,u*s+a*r+c,a*s-u*o+l,u*s+a*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function cg(e){this.mark=e,this.bounds=this.bounds||new yt}function fg(e){cg.call(this,e),this.items=this.items||[]}z(fg,cg);function pb(e){this._pending=0,this._loader=e||bh()}function Tk(e){e._pending+=1}function Uc(e){e._pending-=1}pb.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return Tk(t),t._loader.sanitize(e,{context:"href"}).then(n=>(Uc(t),n)).catch(()=>(Uc(t),null))},loadImage(e){const t=this,n=IU();return Tk(t),t._loader.sanitize(e,{context:"image"}).then(i=>{const r=i.href;if(!r||!n)throw{url:r};const s=new n,o=se(i,"crossOrigin")?i.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>Uc(t),s.onerror=()=>Uc(t),s.src=r,s}).catch(i=>(Uc(t),{complete:!1,width:0,height:0,src:i&&i.url||""}))},ready(){const e=this;return new Promise(t=>{function n(i){e.pending()?setTimeout(()=>{n(!0)},10):t(i)}n(!1)})}};function Jr(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?tG(t,i):0))}return e}function tG(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const nG=dr-1e-8;let dg,hg,gg,oa,mb,pg,yb,vb;const Vs=(e,t)=>dg.add(e,t),mg=(e,t)=>Vs(hg=e,gg=t),Nk=e=>Vs(e,dg.y1),Rk=e=>Vs(dg.x1,e),aa=(e,t)=>mb*e+yb*t,ua=(e,t)=>pg*e+vb*t,bb=(e,t)=>Vs(aa(e,t),ua(e,t)),xb=(e,t)=>mg(aa(e,t),ua(e,t));function qc(e,t){return dg=e,t?(oa=t*Hs,mb=vb=Math.cos(oa),pg=Math.sin(oa),yb=-pg):(mb=vb=1,oa=pg=yb=0),iG}const iG={beginPath(){},closePath(){},moveTo:xb,lineTo:xb,rect(e,t,n,i){oa?(bb(e+n,t),bb(e+n,t+i),bb(e,t+i),xb(e,t)):(Vs(e+n,t+i),mg(e,t))},quadraticCurveTo(e,t,n,i){const r=aa(e,t),s=ua(e,t),o=aa(n,i),a=ua(n,i);jk(hg,r,o,Nk),jk(gg,s,a,Rk),mg(o,a)},bezierCurveTo(e,t,n,i,r,s){const o=aa(e,t),a=ua(e,t),u=aa(n,i),l=ua(n,i),c=aa(r,s),f=ua(r,s);Lk(hg,o,u,c,Nk),Lk(gg,a,l,f,Rk),mg(c,f)},arc(e,t,n,i,r,s){if(i+=oa,r+=oa,hg=n*Math.cos(r)+e,gg=n*Math.sin(r)+t,Math.abs(r-i)>nG)Vs(e-n,t-n),Vs(e+n,t+n);else{const o=l=>Vs(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(o(i),o(r),r!==i)if(i=i%dr,i<0&&(i+=dr),r=r%dr,r<0&&(r+=dr),r<i&&(s=!s,a=i,i=r,r=a),s)for(r-=dr,a=i-i%sa,u=0;u<4&&a>r;++u,a-=sa)o(a);else for(a=i-i%sa+sa,u=0;u<4&&a<r;++u,a=a+sa)o(a)}}};function jk(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function Lk(e,t,n,i,r){const s=i-e+3*t-3*n,o=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(s)>mW?(c=o*o+a*s,c>=0&&(c=Math.sqrt(c),u=(-o+c)/s,l=(-o-c)/s)):u=.5*a/o,0<u&&u<1&&r(Pk(u,e,t,n,i)),0<l&&l<1&&r(Pk(l,e,t,n,i))}function Pk(e,t,n,i,r){const s=1-e,o=s*s,a=e*e;return o*s*t+3*o*e*n+3*s*a*i+a*e*r}var Xs=(Xs=Au(1,1))?Xs.getContext("2d"):null;const wb=new yt;function Eb(e){return function(t,n){if(!Xs)return!0;e(Xs,t),wb.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:s,y2:o}=wb;for(let a=r;a<=o;++a)for(let u=i;u<=s;++u)if(Xs.isPointInPath(u,a))return!0;return!1}}function _b(e,t){return t.contains(e.x||0,e.y||0)}function Ik(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,s=e.height||0;return t.intersects(wb.set(n,i,n+r,i+s))}function Bk(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:i;return ju(t,n,i,r,s)}function ju(e,t,n,i,r){const{x1:s,y1:o,x2:a,y2:u}=e,l=i-t,c=r-n;let f=0,d=1,h,g,p,m;for(m=0;m<4;++m){if(m===0&&(h=-l,g=-(s-t)),m===1&&(h=l,g=a-t),m===2&&(h=-c,g=-(o-n)),m===3&&(h=c,g=u-n),Math.abs(h)<1e-10&&g<0)return!1;if(p=g/h,h<0){if(p>d)return!1;p>f&&(f=p)}else if(h>0){if(p<f)return!1;p<d&&(d=p)}}return!0}function Lu(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Mi(e,t){return e==null?t:e}function zk(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function rG(e,t,n){const i=n.width(),r=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+Mi(t.x1,.5)*i,n.y1+Mi(t.y1,.5)*r,Math.max(i,r)*Mi(t.r1,0),n.x1+Mi(t.x2,.5)*i,n.y1+Mi(t.y2,.5)*r,Math.max(i,r)*Mi(t.r2,.5));else{const o=Mi(t.x1,0),a=Mi(t.y1,0),u=Mi(t.x2,1),l=Mi(t.y2,0);if(o===u||a===l||i===r)s=e.createLinearGradient(n.x1+o*i,n.y1+a*r,n.x1+u*i,n.y1+l*r);else{const c=Au(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=zk(f.createLinearGradient(o,a,u,l),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return zk(s,t.stops)}function Uk(e,t,n){return ub(n)?rG(e,n,t.bounds):n}function yg(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=Uk(e,t,t.fill),!0):!1}var sG=[];function Pu(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=Uk(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||sG),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function oG(e,t){return e.zindex-t.zindex||e.index-t.index}function Ab(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,s;for(r=0,s=t.length;r<s;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(oG)}function Ti(e,t){var n=e.items,i,r;if(!n||!n.length)return;const s=Ab(e);if(s&&s.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=s}for(i=0,r=n.length;i<r;++i)t(n[i])}function vg(e,t){var n=e.items,i,r;if(!n||!n.length)return null;const s=Ab(e);for(s&&s.length&&(n=s),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===s){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function Ob(e){return function(t,n,i){Ti(n,r=>{(!i||i.intersects(r.bounds))&&qk(e,t,r,r)})}}function aG(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&qk(e,t,n.items[0],n.items)}}function qk(e,t,n,i){var r=n.opacity==null?1:n.opacity;r!==0&&(e(t,i)||(Lu(t,n),n.fill&&yg(t,n,r)&&t.fill(),n.stroke&&Pu(t,n,r)&&t.stroke()))}function bg(e){return e=e||oi,function(t,n,i,r,s,o){return i*=t.pixelRatio,r*=t.pixelRatio,vg(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&e(t,a,i,r,s,o))return a})}}function Wc(e,t){return function(n,i,r,s){var o=Array.isArray(i)?i[0]:i,a=t==null?o.fill:t,u=o.stroke&&n.isPointInStroke,l,c;return u&&(l=o.strokeWidth,c=o.strokeCap,n.lineWidth=l!=null?l:1,n.lineCap=c!=null?c:"butt"),e(n,i)?!1:a&&n.isPointInPath(r,s)||u&&n.isPointInStroke(r,s)}}function Sb(e){return bg(Wc(e))}function la(e,t){return"translate("+e+","+t+")"}function Cb(e){return"rotate("+e+")"}function uG(e,t){return"scale("+e+","+t+")"}function Wk(e){return la(e.x||0,e.y||0)}function lG(e){return la(e.x||0,e.y||0)+(e.angle?" "+Cb(e.angle):"")}function cG(e){return la(e.x||0,e.y||0)+(e.angle?" "+Cb(e.angle):"")+(e.scaleX||e.scaleY?" "+uG(e.scaleX||1,e.scaleY||1):"")}function $b(e,t,n){function i(o,a){o("transform",lG(a)),o("d",t(null,a))}function r(o,a){return t(qc(o,a.angle),a),Jr(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,l=a.y||0,c=a.angle||0;o.translate(u,l),c&&o.rotate(c*=Hs),o.beginPath(),t(o,a),c&&o.rotate(-c),o.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:Ob(s),pick:Sb(s),isect:n||Eb(s)}}var fG=$b("arc",XW);function dG(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,s=1/0,o,a;--r>=0;)e[r].defined!==!1&&(a=Math.abs(e[r][i]-n),a<s&&(s=a,o=e[r]));return o}function hG(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,s,o;--i>=0;)if(e[i].defined!==!1&&(r=e[i].x-t[0],s=e[i].y-t[1],o=r*r+s*s,o<n))return e[i];return null}function gG(e,t){for(var n=e.length,i,r,s;--n>=0;)if(e[n].defined!==!1&&(i=e[n].x-t[0],r=e[n].y-t[1],s=i*i+r*r,i=e[n].size||1,s<i*i))return e[n];return null}function Fb(e,t,n){function i(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function r(u,l){var c=l.items;return c.length===0?u:(t(qc(u),c),Jr(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const o=Wc(s);function a(u,l,c,f,d,h){var g=l.items,p=l.bounds;return!g||!g.length||p&&!p.contains(d,h)?null:(c*=u.pixelRatio,f*=u.pixelRatio,o(u,g,c,f)?g[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:aG(s),pick:a,isect:_b,tip:n}}var pG=Fb("area",KW,dG);function mG(e,t){var n=t.clip;e.save(),ge(n)?(e.beginPath(),n(e),e.clip()):Gk(e,t.group)}function Gk(e,t){e.beginPath(),hb(t)?Ru(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function Hk(e){const t=Mi(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function yG(e,t){e("transform",Wk(t))}function Yk(e,t){const n=Hk(t);e("d",Ru(null,t,n,n))}function vG(e,t){e("class","background"),e("aria-hidden",!0),Yk(e,t)}function bG(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?Yk(e,t):e("d","")}function xG(e,t,n){const i=t.clip?gb(n,t,t):null;e("clip-path",i)}function wG(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Jr(e,t),e.translate(t.x||0,t.y||0)}function Gc(e,t,n,i){const r=Hk(t);e.beginPath(),Ru(e,t,(n||0)+r,(i||0)+r)}const EG=Wc(Gc),_G=Wc(Gc,!1),AG=Wc(Gc,!0);function OG(e,t,n){Ti(t,i=>{const r=i.x||0,s=i.y||0,o=i.strokeForeground,a=i.opacity==null?1:i.opacity;(i.stroke||i.fill)&&a&&(Gc(e,i,r,s),Lu(e,i),i.fill&&yg(e,i,a)&&e.fill(),i.stroke&&!o&&Pu(e,i,a)&&e.stroke()),e.save(),e.translate(r,s),i.clip&&Gk(e,i),n&&n.translate(-r,-s),Ti(i,u=>{this.draw(e,u,n)}),n&&n.translate(r,s),e.restore(),o&&i.stroke&&a&&(Gc(e,i,r,s),Lu(e,i),Pu(e,i,a)&&e.stroke())})}function SG(e,t,n,i,r,s){if(t.bounds&&!t.bounds.contains(r,s)||!t.items)return null;const o=n*e.pixelRatio,a=i*e.pixelRatio;return vg(t,u=>{let l,c,f;const d=u.bounds;if(d&&!d.contains(r,s))return;c=u.x||0,f=u.y||0;const h=c+(u.width||0),g=f+(u.height||0),p=u.clip;if(p&&(r<c||r>h||s<f||s>g))return;if(e.save(),e.translate(c,f),c=r-c,f=s-f,p&&hb(u)&&!AG(e,u,o,a))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&_G(e,u,o,a)?(e.restore(),u):(l=vg(u,v=>CG(v,c,f)?this.pick(v,n,i,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&EG(e,u,o,a)&&(l=u),e.restore(),l||null)})}function CG(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var $G={type:"group",tag:"g",nested:!1,attr:yG,bound:wG,draw:OG,pick:SG,isect:Ik,content:xG,background:vG,foreground:bG},Hc={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function kb(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function Db(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function Mb(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function xg(e,t){return e==="center"?t/2:e==="right"?t:0}function wg(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function FG(e,t,n){const i=kb(t,n),r=Db(t,i),s=Mb(t,i),o=(t.x||0)-xg(t.align,r),a=(t.y||0)-wg(t.baseline,s),u=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",u,Hc["xmlns:xlink"],"xlink:href"),e("transform",la(o,a)),e("width",r),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function kG(e,t){const n=t.image,i=Db(t,n),r=Mb(t,n),s=(t.x||0)-xg(t.align,i),o=(t.y||0)-wg(t.baseline,r);return e.set(s,o,s+i,o+r)}function DG(e,t,n){Ti(t,i=>{if(n&&!n.intersects(i.bounds))return;const r=kb(i,this);let s=Db(i,r),o=Mb(i,r);if(s===0||o===0)return;let a=(i.x||0)-xg(i.align,s),u=(i.y||0)-wg(i.baseline,o),l,c,f,d;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(d=s/c,u+=(o-d)/2,o=d):(d=o*c,a+=(s-d)/2,s=d))),(r.complete||r.toDataURL)&&(Lu(e,i),e.globalAlpha=(l=i.opacity)!=null?l:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,a,u,s,o))})}var MG={type:"image",tag:"image",nested:!1,attr:FG,bound:kG,draw:DG,pick:bg(),isect:oi,get:kb,xOffset:xg,yOffset:wg},TG=Fb("line",JW,hG);function NG(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",cG(t)),e("d",t.path)}function Eg(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,s=t.scaleX||1,o=t.scaleY||1,a=(t.angle||0)*Hs,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=Tu(n)).path=n),a&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(a),Pc(e,u,0,0,s,o),e.rotate(-a),e.translate(-i,-r)):Pc(e,u,i,r,s,o)}function RG(e,t){return Eg(qc(e,t.angle),t)?e.set(0,0,0,0):Jr(e,t,!0)}var jG={type:"path",tag:"path",nested:!1,attr:NG,bound:RG,draw:Ob(Eg),pick:Sb(Eg),isect:Eb(Eg)};function LG(e,t){e("d",Ru(null,t))}function PG(e,t){var n,i;return Jr(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function Vk(e,t){e.beginPath(),Ru(e,t)}var IG={type:"rect",tag:"path",nested:!1,attr:LG,bound:PG,draw:Ob(Vk),pick:Sb(Vk),isect:Ik};function BG(e,t){e("transform",Wk(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function zG(e,t){var n,i;return Jr(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function Xk(e,t,n){var i,r,s,o;return t.stroke&&Pu(e,t,n)?(i=t.x||0,r=t.y||0,s=t.x2!=null?t.x2:i,o=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(s,o),!0):!1}function UG(e,t,n){Ti(t,i=>{if(!(n&&!n.intersects(i.bounds))){var r=i.opacity==null?1:i.opacity;r&&Xk(e,i,r)&&(Lu(e,i),e.stroke())}})}function qG(e,t,n,i){return e.isPointInStroke?Xk(e,t,1)&&e.isPointInStroke(n,i):!1}var WG={type:"rule",tag:"line",nested:!1,attr:BG,bound:zG,draw:UG,pick:bg(qG),isect:Bk},GG=$b("shape",QW),HG=$b("symbol",ZW,_b);const Kk=UO();var hr={height:gr,measureWidth:Nb,estimateWidth:Tb,width:Tb,canvas:Jk};Jk(!0);function Jk(e){hr.width=e&&Xs?Nb:Tb}function Tb(e,t){return Qk(Js(e,t),gr(e))}function Qk(e,t){return~~(.8*e.length*t)}function Nb(e,t){return gr(e)<=0||!(t=Js(e,t))?0:Zk(t,_g(e))}function Zk(e,t){const n=`(${t}) ${e}`;let i=Kk.get(n);return i===void 0&&(Xs.font=t,i=Xs.measureText(e).width,Kk.set(n,i)),i}function gr(e){return e.fontSize!=null?+e.fontSize||0:11}function Ks(e){return e.lineHeight!=null?e.lineHeight:gr(e)+2}function YG(e){return K(e)?e.length>1?e:e[0]:e}function Yc(e){return YG(e.lineBreak&&e.text&&!K(e.text)?e.text.split(e.lineBreak):e.text)}function Rb(e){const t=Yc(e);return(K(t)?t.length-1:0)*Ks(e)}function Js(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?XG(e,n):n}function VG(e){if(hr.width===Nb){const t=_g(e);return n=>Zk(n,t)}else{const t=gr(e);return n=>Qk(n,t)}}function XG(e,t){var n=+e.limit,i=VG(e);if(i(t)<n)return t;var r=e.ellipsis||"\u2026",s=e.dir==="rtl",o=0,a=t.length,u;if(n-=i(r),s){for(;o<a;)u=o+a>>>1,i(t.slice(u))>n?o=u+1:a=u;return r+t.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),i(t.slice(0,u))<n?o=u:a=u-1;return t.slice(0,o)+r}}function Vc(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function _g(e,t){return""+(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+gr(e)+"px "+Vc(e,t)}function jb(e){var t=e.baseline,n=gr(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Ks(e):t==="line-bottom"?.29*n-.5*Ks(e):0)}const KG={left:"start",center:"middle",right:"end"},Xc=new yt;function Ag(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-sa,t+=i*Math.cos(r),n+=i*Math.sin(r)),Xc.x1=t,Xc.y1=n,Xc}function JG(e,t){var n=t.dx||0,i=(t.dy||0)+jb(t),r=Ag(t),s=r.x1,o=r.y1,a=t.angle||0,u;e("text-anchor",KG[t.align]||"start"),a?(u=la(s,o)+" "+Cb(a),(n||i)&&(u+=" "+la(n,i))):u=la(s+n,o+i),e("transform",u)}function Lb(e,t,n){var i=hr.height(t),r=t.align,s=Ag(t),o=s.x1,a=s.y1,u=t.dx||0,l=(t.dy||0)+jb(t)-Math.round(.8*i),c=Yc(t),f;if(K(c)?(i+=Ks(t)*(c.length-1),f=c.reduce((d,h)=>Math.max(d,hr.width(t,h)),0)):f=hr.width(t,c),r==="center"?u-=f/2:r==="right"&&(u-=f),e.set(u+=o,l+=a,u+f,l+i),t.angle&&!n)e.rotate(t.angle*Hs,o,a);else if(n===2)return e.rotatedPoints(t.angle*Hs,o,a);return e}function QG(e,t,n){Ti(t,i=>{var r=i.opacity==null?1:i.opacity,s,o,a,u,l,c,f;if(!(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(e.font=_g(i),e.textAlign=i.align||"left",s=Ag(i),o=s.x1,a=s.y1,i.angle&&(e.save(),e.translate(o,a),e.rotate(i.angle*Hs),o=a=0),o+=i.dx||0,a+=(i.dy||0)+jb(i),c=Yc(i),Lu(e,i),K(c))for(l=Ks(i),u=0;u<c.length;++u)f=Js(i,c[u]),i.fill&&yg(e,i,r)&&e.fillText(f,o,a),i.stroke&&Pu(e,i,r)&&e.strokeText(f,o,a),a+=l;else f=Js(i,c),i.fill&&yg(e,i,r)&&e.fillText(f,o,a),i.stroke&&Pu(e,i,r)&&e.strokeText(f,o,a);i.angle&&e.restore()}})}function ZG(e,t,n,i,r,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=Ag(t),a=o.x1,u=o.y1,l=Lb(Xc,t,1),c=-t.angle*Hs,f=Math.cos(c),d=Math.sin(c),h=f*r-d*s+(a-f*a+d*u),g=d*r+f*s+(u-d*a-f*u);return l.contains(h,g)}function eH(e,t){const n=Lb(Xc,e,2);return ju(t,n[0],n[1],n[2],n[3])||ju(t,n[0],n[1],n[4],n[5])||ju(t,n[4],n[5],n[6],n[7])||ju(t,n[2],n[3],n[6],n[7])}var tH={type:"text",tag:"text",nested:!1,attr:JG,bound:Lb,draw:QG,pick:bg(ZG),isect:eH},nH=Fb("trail",eG,gG),Kn={arc:fG,area:pG,group:$G,image:MG,line:TG,path:jG,rect:IG,rule:WG,shape:GG,symbol:HG,text:tH,trail:nH};function Pb(e,t,n){var i=Kn[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new yt),e,n)}var eD={mark:null};function tD(e,t,n){var i=Kn[e.marktype],r=i.bound,s=e.items,o=s&&s.length,a,u,l,c;if(i.nested)return o?l=s[0]:(eD.mark=e,l=eD),c=Pb(l,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new yt,o)for(a=0,u=s.length;a<u;++a)t.union(Pb(s[a],r,n));return e.bounds=t}const iH=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function nD(e,t){return JSON.stringify(e,iH,t)}function iD(e){const t=typeof e=="string"?JSON.parse(e):e;return rD(t)}function rD(e){var t=e.marktype,n=e.items,i,r,s;if(n)for(r=0,s=n.length;r<s;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&rD(n[r]);return t&&tD(e),e}function Ib(e){arguments.length?this.root=iD(e):(this.root=sD({marktype:"group",name:"root",role:"frame"}),this.root.items=[new fg(this.root)])}Ib.prototype={toJSON(e){return nD(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const i=sD(e,t);return t.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}};function sD(e,t){const n={bounds:new yt,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function Qs(e,t,n){return!e&&typeof document!="undefined"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function Bb(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function Mn(e,t,n,i){var r=e.childNodes[t],s;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(s=r||null,r=Qs(e.ownerDocument,n,i),e.insertBefore(r,s)),r}function Ni(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function oD(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function Og(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function rH(e,t,n,i){var r=e&&e.mark,s,o;if(r&&(s=Kn[r.marktype]).tip){for(o=Og(t,n),o[0]-=i[0],o[1]-=i[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=s.tip(r.items,o)}return e}function Zs(e,t){this._active=null,this._handlers={},this._loader=e||bh(),this._tooltip=t||sH}function sH(e,t,n,i){e.element().setAttribute("title",i||"")}Zs.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let i=e?e.length:0;--i>=0;)if(e[i].type===t&&(!n||e[i].handler===n))return i;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const i in t)n.push(...t[i]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(i=>{const r=new MouseEvent(e.type,e),s=Qs(null,"a");for(const o in i)s.setAttribute(o,i[o]);s.dispatchEvent(r)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=rH(t,e,this.canvas(),this._origin);const i=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,i)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),i=this._origin,r=e.bounds,s=r.width(),o=r.height();let a=r.x1+i[0]+n.left,u=r.y1+i[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function pr(e){this._el=null,this._bgcolor=null,this._loader=new pb(e)}pr.prototype={initialize(e,t,n,i,r){return this._el=e,this.resize(t,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,i){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,i=n._loader[e](t);if(!n._ready){const r=n._call;n._ready=n._loader.ready().then(s=>{s&&r(),n._ready=null})}return i},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const oH="keydown",aH="keypress",uH="keyup",aD="dragenter",Sg="dragleave",uD="dragover",zb="mousedown",lH="mouseup",Cg="mousemove",Kc="mouseout",lD="mouseover",$g="click",cH="dblclick",fH="wheel",cD="mousewheel",Fg="touchstart",kg="touchmove",Dg="touchend",dH=[oH,aH,uH,aD,Sg,uD,zb,lH,Cg,Kc,lD,$g,cH,fH,cD,Fg,kg,Dg],Ub=Cg,Jc=Kc,qb=$g;function Qc(e,t){Zs.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const hH=e=>e===Fg||e===kg||e===Dg?[Fg,kg,Dg]:[e];function fD(e,t){hH(t).forEach(n=>gH(e,n))}function gH(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}function dD(e,t,n){return function(i){const r=this._active,s=this.pickEvent(i);s===r?this.fire(e,i):((!r||!r.exit)&&this.fire(n,i),this._active=s,this.fire(t,i),this.fire(e,i))}}function hD(e){return function(t){this.fire(e,t),this._active=null}}z(Qc,Zs,{initialize(e,t,n){return this._canvas=e&&Bb(e,"canvas"),[$g,zb,Cg,Kc,Sg].forEach(i=>fD(this,i)),Zs.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:dH,DOMMouseScroll(e){this.fire(cD,e)},mousemove:dD(Cg,lD,Kc),dragover:dD(uD,aD,Sg),mouseout:hD(Kc),dragleave:hD(Sg),mousedown(e){this._down=this._active,this.fire(zb,e)},click(e){this._down===this._active&&(this.fire($g,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(Fg,e,!0)},touchmove(e){this.fire(kg,e,!0)},touchend(e){this.fire(Dg,e,!0),this._touch=null},fire(e,t,n){const i=n?this._touch:this._active,r=this._handlers[e];if(t.vegaType=e,e===qb&&i&&i.href?this.handleHref(t,i,i.href):(e===Ub||e===Jc)&&this.handleTooltip(t,i,e!==Jc),r)for(let s=0,o=r.length;s<o;++s)r[s].handler.call(this._obj,t,i)},on(e,t){const n=this.eventName(e),i=this._handlers;return this._handlerIndex(i[n],e,t)<0&&(fD(this,e),(i[n]||(i[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&i.splice(r,1),this},pickEvent(e){const t=Og(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,i,r){const s=this.context();return Kn[e.marktype].pick.call(this,s,e,t,n,i,r)}});function pH(){return typeof window!="undefined"&&window.devicePixelRatio||1}var mH=pH();function yH(e,t,n,i,r,s){const o=typeof HTMLElement!="undefined"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=o?mH:r;e.width=t*u,e.height=n*u;for(const l in s)a[l]=s[l];return o&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*i[0],u*i[1]),e}function Mg(e){pr.call(this,e),this._options={},this._redraw=!1,this._dirty=new yt,this._tempb=new yt}const gD=pr.prototype,vH=(e,t,n)=>new yt().set(0,0,t,n).translate(-e[0],-e[1]);function bH(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}z(Mg,pr,{initialize(e,t,n,i,r,s){return this._options=s||{},this._canvas=this._options.externalContext?null:Au(1,1,this._options.type),e&&this._canvas&&(Ni(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),gD.initialize.call(this,e,t,n,i,r)},resize(e,t,n,i){if(gD.resize.call(this,e,t,n,i),this._canvas)yH(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const r=this._options.externalContext;r||N("CanvasRenderer is missing a valid canvas or context"),r.scale(this._scale,this._scale),r.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,i=this._width,r=this._height,s=this._dirty,o=vH(n,i,r);t.save();const a=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):bH(t,o.intersect(s),n);return this.clear(-n[0],-n[1],i,r),this.draw(t,e,a),t.restore(),s.clear(),this},draw(e,t,n){const i=Kn[t.marktype];t.clip&&mG(e,t),i.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,i){const r=this._options,s=this.context();r.type!=="pdf"&&!r.externalContext&&s.clearRect(e,t,n,i),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,i))}});function Wb(e,t){Zs.call(this,e,t);const n=this;n._hrefHandler=Gb(n,(i,r)=>{r&&r.href&&n.handleHref(i,r,r.href)}),n._tooltipHandler=Gb(n,(i,r)=>{n.handleTooltip(i,r,i.type!==Jc)})}const Gb=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)};z(Wb,Zs,{initialize(e,t,n){let i=this._svg;return i&&(i.removeEventListener(qb,this._hrefHandler),i.removeEventListener(Ub,this._tooltipHandler),i.removeEventListener(Jc,this._tooltipHandler)),this._svg=i=e&&Bb(e,"svg"),i&&(i.addEventListener(qb,this._hrefHandler),i.addEventListener(Ub,this._tooltipHandler),i.addEventListener(Jc,this._tooltipHandler)),Zs.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),i=this._handlers;if(this._handlerIndex(i[n],e,t)<0){const s={type:e,handler:t,listener:Gb(this,t)};(i[n]||(i[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(e,t){const n=this.eventName(e),i=this._handlers[n],r=this._handlerIndex(i,e,t);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});const pD="aria-hidden",Hb="aria-label",Yb="role",Vb="aria-roledescription",mD="graphics-object",Xb="graphics-symbol",yD=(e,t,n)=>({[Yb]:e,[Vb]:t,[Hb]:n||void 0}),xH=Fi(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),vD={axis:{desc:"axis",caption:_H},legend:{desc:"legend",caption:AH},"title-text":{desc:"title",caption:e=>`Title text '${ED(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${ED(e)}'`}},bD={ariaRole:Yb,ariaRoleDescription:Vb,description:Hb};function xD(e,t){const n=t.aria===!1;if(e(pD,n||void 0),n||t.description==null)for(const i in bD)e(bD[i],void 0);else{const i=t.mark.marktype;e(Hb,t.description),e(Yb,t.ariaRole||(i==="group"?mD:Xb)),e(Vb,t.ariaRoleDescription||`${i} mark`)}}function wD(e){return e.aria===!1?{[pD]:!0}:xH[e.role]?null:vD[e.role]?EH(e,vD[e.role]):wH(e)}function wH(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return yD(n?mD:Xb,`${t} mark container`,e.description)}function EH(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return yD(t.role||Xb,t.desc,n.description||i(n))}catch{return null}}function ED(e){return re(e.text).join(" ")}function _H(e){const t=e.datum,n=e.orient,i=t.title?_D(e):null,r=e.context,s=r.scales[t.scale].value,o=r.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(i?` titled '${i}'`:"")+` for a ${Mu(a)?"discrete":a} scale with ${bk(o,s,e)}`}function AH(e){const t=e.datum,n=t.title?_D(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,s=Object.keys(r),o=e.context,a=o.scales[r[s[0]]].value,u=o.dataflow.locale();return SH(i)+(n?` titled '${n}'`:"")+` for ${OH(s)} with ${bk(u,a,e)}`}function _D(e){try{return re(be(e.items).items[0].text).join(" ")}catch{return null}}function OH(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+be(e)}function SH(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const AD=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),CH=e=>AD(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Kb(){let e="",t="",n="";const i=[],r=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,r()),i.push(u)},o=(u,l)=>(l!=null&&(t+=` ${u}="${CH(l)}"`),a),a={open(u,...l){s(u),t="<"+u;for(const c of l)for(const f in c)o(f,c[f]);return a},close(){const u=i.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,r(),a},attr:o,text:u=>(n+=AD(u),a),toString:()=>e};return a}const OD=e=>SD(Kb(),e)+"";function SD(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,i=n.length;for(let r=0;r<i;++r)e.attr(n[r].name,n[r].value)}if(t.hasChildNodes()){const n=t.childNodes,i=n.length;for(let r=0;r<i;r++){const s=n[r];s.nodeType===3?e.text(s.nodeValue):SD(e,s)}}return e.close()}const Tg={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},CD={fill:"none","stroke-miterlimit":10},Zc=0,$D="http://www.w3.org/2000/xmlns/",vt=Hc.xmlns;function Jb(e){pr.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const Qb=pr.prototype;z(Jb,pr,{initialize(e,t,n,i,r){return this._defs={},this._clearDefs(),e&&(this._svg=Mn(e,0,"svg",vt),this._svg.setAttributeNS($D,"xmlns",vt),this._svg.setAttributeNS($D,"xmlns:xlink",Hc["xmlns:xlink"]),this._svg.setAttribute("version",Hc.version),this._svg.setAttribute("class","marks"),Ni(e,1),this._root=Mn(this._svg,Zc,"g",vt),eo(this._root,CD),Ni(this._svg,Zc+1)),this.background(this._bgcolor),Qb.initialize.call(this,e,t,n,i,r)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),Qb.background.apply(this,arguments)},resize(e,t,n,i){return Qb.resize.call(this,e,t,n,i),this._svg&&(eo(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=Mn(e,Zc,"rect",vt),eo(n,{width:this._width,height:this._height,fill:t}));const i=OD(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),i},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),Ni(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,i,r,s,o,a,u;for(o=0,a=e.length;o<a;++o)if(n=e[o],i=n.mark,i.marktype!==r&&(r=i.marktype,s=Kn[r]),i.zdirty&&i.dirty!==t&&(this._dirtyAll=!1,FD(n,t),i.items.forEach(l=>{l.dirty=t})),!i.zdirty){if(n.exit){s.nested&&i.items.length?(u=i.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?i.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,FD(n,t)):this._update(s,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const i=this._svg,r=Kn[t.marktype],s=t.interactive===!1?"none":null,o=r.tag==="g";let a=null,u=0;const l=kD(t,e,n,"g",i);l.setAttribute("class",oD(t));const c=wD(t);for(const d in c)cn(l,d,c[d]);o||cn(l,"pointer-events",s),cn(l,"clip-path",t.clip?gb(this,t,t.group):null);const f=d=>{const h=this.isDirty(d),g=kD(d,l,a,r.tag,i);h&&(this._update(r,g,d),o&&kH(this,g,d)),a=g,++u};return r.nested?t.items.length&&f(t.items[0]):Ti(t,f),Ni(l,u),l},_update(e,t,n){Qr=t,Vt=t.__values__,xD(ef,n),e.attr(ef,n,this);const i=MH[e.type];i&&i.call(this,e,t,n),Qr&&this.style(Qr,n)},style(e,t){if(t!=null)for(const n in Tg){let i=n==="font"?Vc(t):t[n];if(i===Vt[n])continue;const r=Tg[n];i==null?e.removeAttribute(r):(ub(i)&&(i=wk(i,this._defs.gradient,DD())),e.setAttribute(r,i+"")),Vt[n]=i}},defs(){const e=this._svg,t=this._defs;let n=t.el,i=0;for(const r in t.gradient)n||(t.el=n=Mn(e,Zc+1,"defs",vt)),i=$H(n,t.gradient[r],i);for(const r in t.clipping)n||(t.el=n=Mn(e,Zc+1,"defs",vt)),i=FH(n,t.clipping[r],i);n&&(i===0?(e.removeChild(n),t.el=null):Ni(n,i))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function FD(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function $H(e,t,n){let i,r,s;if(t.gradient==="radial"){let o=Mn(e,n++,"pattern",vt);eo(o,{id:ag+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=Mn(o,0,"rect",vt),eo(o,{width:1,height:1,fill:`url(${DD()}#${t.id})`}),e=Mn(e,n++,"radialGradient",vt),eo(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=Mn(e,n++,"linearGradient",vt),eo(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,r=t.stops.length;i<r;++i)s=Mn(e,i,"stop",vt),s.setAttribute("offset",t.stops[i].offset),s.setAttribute("stop-color",t.stops[i].color);return Ni(e,i),n}function FH(e,t,n){let i;return e=Mn(e,n,"clipPath",vt),e.setAttribute("id",t.id),t.path?(i=Mn(e,0,"path",vt),i.setAttribute("d",t.path)):(i=Mn(e,0,"rect",vt),eo(i,{x:0,y:0,width:t.width,height:t.height})),Ni(e,1),n+1}function kH(e,t,n){t=t.lastChild.previousSibling;let i,r=0;Ti(n,s=>{i=e.mark(t,s,i),++r}),Ni(t,1+r)}function kD(e,t,n,i,r){let s=e._svg,o;if(!s&&(o=t.ownerDocument,s=Qs(o,i,vt),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},i==="g"))){const a=Qs(o,"path",vt);s.appendChild(a),a.__data__=e;const u=Qs(o,"g",vt);s.appendChild(u),u.__data__=e;const l=Qs(o,"path",vt);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==r||DH(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function DH(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Qr=null,Vt=null;const MH={group(e,t,n){const i=Qr=t.childNodes[2];Vt=i.__values__,e.foreground(ef,n,this),Vt=t.__values__,Qr=t.childNodes[1],e.content(ef,n,this);const r=Qr=t.childNodes[0];e.background(ef,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==Vt.events&&(cn(i,"pointer-events",s),cn(r,"pointer-events",s),Vt.events=s),n.strokeForeground&&n.stroke){const o=n.fill;cn(i,"display",null),this.style(r,n),cn(r,"stroke",null),o&&(n.fill=null),Vt=i.__values__,this.style(i,n),o&&(n.fill=o),Qr=null}else cn(i,"display","none")},image(e,t,n){n.smooth===!1?(Zb(t,"image-rendering","optimizeSpeed"),Zb(t,"image-rendering","pixelated")):Zb(t,"image-rendering",null)},text(e,t,n){const i=Yc(n);let r,s,o,a;K(i)?(s=i.map(u=>Js(n,u)),r=s.join(`
`),r!==Vt.text&&(Ni(t,0),o=t.ownerDocument,a=Ks(n),s.forEach((u,l)=>{const c=Qs(o,"tspan",vt);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),Vt.text=r)):(s=Js(n,i),s!==Vt.text&&(t.textContent=s,Vt.text=s)),cn(t,"font-family",Vc(n)),cn(t,"font-size",gr(n)+"px"),cn(t,"font-style",n.fontStyle),cn(t,"font-variant",n.fontVariant),cn(t,"font-weight",n.fontWeight)}};function ef(e,t,n){t!==Vt[e]&&(n?TH(Qr,e,t,n):cn(Qr,e,t),Vt[e]=t)}function Zb(e,t,n){n!==Vt[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),Vt[t]=n)}function eo(e,t){for(const n in t)cn(e,n,t[n])}function cn(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function TH(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}function DD(){let e;return typeof window=="undefined"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function ex(e){pr.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}z(ex,pr,{svg(){return this._text},_render(e){const t=Kb();t.open("svg",de({},Hc,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",CD,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Kn[t.marktype],i=n.tag,r=[xD,n.attr];e.open("g",{class:oD(t),"clip-path":t.clip?gb(this,t,t.group):null},wD(t),{"pointer-events":i!=="g"&&t.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&e.open("a",a),e.open(i,this.attr(t,o,r,i!=="g"?i:null)),i==="text"){const u=Yc(o);if(K(u)){const l={x:0,dy:Ks(o)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(Js(o,u[c])).close()}else e.text(Js(o,u))}else if(i==="g"){const u=o.strokeForeground,l=o.fill,c=o.stroke;u&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),Ti(o,f=>this.mark(e,f)),e.close(),u&&c?(l&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),l&&(o.fill=l)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Ti(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(i=>{i["xlink:href"]=i.href,i.href=null,(this._hrefs||(this._hrefs={}))[t]=i})}return null},attr(e,t,n,i){const r={},s=(o,a,u,l)=>{r[l||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,t,this)):n(s,t,this),i&&NH(r,t,e,i,this._defs),r},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const r in t){const s=t[r],o=s.stops;s.gradient==="radial"?(e.open("pattern",{id:ag+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close(),e.close(),e.open("radialGradient",{id:r,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):e.open("linearGradient",{id:r,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)e.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();e.close()}for(const r in n){const s=n[r];e.open("clipPath",{id:r}),s.path?e.open("path",{d:s.path}).close():e.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),e.close()}e.close()}}});function NH(e,t,n,i,r){if(t==null||(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;i==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),i==="text"&&(e["font-family"]=Vc(t),e["font-size"]=gr(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const s in Tg){let o=t[s];const a=Tg[s];o==="transparent"&&(a==="fill"||a==="stroke")||o!=null&&(ub(o)&&(o=wk(o,r.gradient,"")),e[a]=o)}return e}const MD="canvas",TD="png",ND="svg",RD="none",to={Canvas:MD,PNG:TD,SVG:ND,None:RD},Iu={};Iu[MD]=Iu[TD]={renderer:Mg,headless:Mg,handler:Qc};Iu[ND]={renderer:Jb,headless:ex,handler:Wb};Iu[RD]={};function Ng(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(Iu[e]=t,this):Iu[e]}function jD(e,t,n){const i=[],r=new yt().union(t),s=e.marktype;return s?LD(e,r,n,i):s==="group"?PD(e,r,n,i):N("Intersect scene must be mark node or group item.")}function LD(e,t,n,i){if(RH(e,t,n)){const r=e.items,s=e.marktype,o=r.length;let a=0;if(s==="group")for(;a<o;++a)PD(r[a],t,n,i);else for(const u=Kn[s].isect;a<o;++a){const l=r[a];ID(l,t,u)&&i.push(l)}}return i}function RH(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function PD(e,t,n,i){n&&n(e.mark)&&ID(e,t,Kn.group.isect)&&i.push(e);const r=e.items,s=r&&r.length;if(s){const o=e.x||0,a=e.y||0;t.translate(-o,-a);for(let u=0;u<s;++u)LD(r[u],t,n,i);t.translate(o,a)}return i}function ID(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}const tx=new yt;function BD(e){const t=e.clip;if(ge(t))t(qc(tx.clear()));else if(t)tx.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(tx)}const jH=1e-9;function nx(e,t,n){return e===t?!0:n==="path"?zD(e,t):e instanceof Date&&t instanceof Date?+e==+t:$s(e)&&$s(t)?Math.abs(e-t)<=jH:!e||!t||!ue(e)&&!ue(t)?e==t:LH(e,t)}function zD(e,t){return nx(Tu(e),Tu(t))}function LH(e,t){var n=Object.keys(e),i=Object.keys(t),r,s;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),s=n.length-1;s>=0;s--)if(n[s]!=i[s])return!1;for(s=n.length-1;s>=0;s--)if(r=n[s],!nx(e[r],t[r],r))return!1;return typeof e==typeof t}function PH(){Mk(),gW()}const Bu="top",Ri="left",ji="right",no="bottom",IH="top-left",BH="top-right",zH="bottom-left",UH="bottom-right",ix="start",rx="middle",fn="end",qH="x",WH="y",Rg="group",sx="axis",ox="title",GH="frame",HH="scope",ax="legend",UD="row-header",qD="row-footer",WD="row-title",GD="column-header",HD="column-footer",YD="column-title",YH="padding",VH="symbol",VD="fit",XH="fit-x",KH="fit-y",JH="pad",ux="none",jg="all",lx="each",cx="flush",io="column",ro="row";function XD(e){D.call(this,null,e)}z(XD,D,{transform(e,t){const n=t.dataflow,i=e.mark,r=i.marktype,s=Kn[r],o=s.bound;let a=i.bounds,u;if(s.nested)i.items.length&&n.dirty(i.items[0]),a=Lg(i,o),i.items.forEach(l=>{l.bounds.clear().union(a)});else if(r===Rg||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),a.clear(),i.items.forEach(l=>a.union(Lg(l,o))),i.role){case sx:case ax:case ox:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{a.union(Lg(l,o))}),t.visit(t.MOD,l=>{u=u||a.alignsWith(l.bounds),n.dirty(l),a.union(Lg(l,o))}),u&&(a.clear(),i.items.forEach(l=>a.union(l.bounds)));return BD(i),t.modifies("bounds")}});function Lg(e,t,n){return t(e.bounds.clear(),e,n)}const KD=":vega_identifier:";function fx(e){D.call(this,0,e)}fx.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};z(fx,D,{transform(e,t){const n=QH(t.dataflow),i=e.as;let r=n.value;return t.visit(t.ADD,s=>s[i]=s[i]||++r),n.set(this.value=r),t}});function QH(e){return e._signals[KD]||(e._signals[KD]=e.add(0))}function JD(e){D.call(this,null,e)}z(JD,D,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,ZH(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===Rg?fg:cg;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function ZH(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function QD(e){D.call(this,null,e)}const ZD={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((i,r)=>!r||!e3(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}},e3=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),t3=(e,t)=>{for(var n=1,i=e.length,r=e[0].bounds,s;n<i;r=s,++n)if(e3(r,s=e[n].bounds,t))return!0},eY=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},tY=(e,t,n)=>{var i=e.range(),r=new yt;return t===Bu||t===no?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),s=>r.encloses(s.bounds)},n3=e=>(e.forEach(t=>t.opacity=1),e),i3=(e,t)=>e.reflow(t.modified()).modifies("opacity");z(QD,D,{transform(e,t){const n=ZD[e.method]||ZD.parity,i=e.separation||0;let r=t.materialize(t.SOURCE).source,s,o;if(!r||!r.length)return;if(!e.method)return e.modified("method")&&(n3(r),t=i3(t,e)),t;if(r=r.filter(eY),!r.length)return;if(e.sort&&(r=r.slice().sort(e.sort)),s=n3(r),t=i3(t,e),s.length>=3&&t3(s,i)){do s=n(s,i);while(s.length>=3&&t3(s,i));s.length<3&&!be(r).opacity&&(s.length>1&&(be(s).opacity=0),be(r).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(o=tY(e.boundScale,e.boundOrient,+e.boundTolerance),r.forEach(u=>{o(u)||(u.opacity=0)}));const a=s[0].mark.bounds.clear();return r.forEach(u=>{u.opacity&&a.union(u.bounds)}),t}});function r3(e){D.call(this,null,e)}z(r3,D,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,i=>n.dirty(i)),t.fields&&t.fields.zindex){const i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}}});const Xt=new yt;function zu(e,t,n){return e[t]===n?0:(e[t]=n,1)}function nY(e){var t=e.items[0].orient;return t===Ri||t===ji}function iY(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function rY(e,t,n,i){var r=t.items[0],s=r.datum,o=r.translate!=null?r.translate:.5,a=r.orient,u=iY(s),l=r.range,c=r.offset,f=r.position,d=r.minExtent,h=r.maxExtent,g=s.title&&r.items[u[2]].items[0],p=r.titlePadding,m=r.bounds,y=g&&Rb(g),v=0,b=0,x,E;switch(Xt.clear().union(m),m.clear(),(x=u[0])>-1&&m.union(r.items[x].bounds),(x=u[1])>-1&&m.union(r.items[x].bounds),a){case Bu:v=f||0,b=-c,E=Math.max(d,Math.min(h,-m.y1)),m.add(0,-E).add(l,0),g&&Pg(e,g,E,p,y,0,-1,m);break;case Ri:v=-c,b=f||0,E=Math.max(d,Math.min(h,-m.x1)),m.add(-E,0).add(0,l),g&&Pg(e,g,E,p,y,1,-1,m);break;case ji:v=n+c,b=f||0,E=Math.max(d,Math.min(h,m.x2)),m.add(0,0).add(E,l),g&&Pg(e,g,E,p,y,1,1,m);break;case no:v=f||0,b=i+c,E=Math.max(d,Math.min(h,m.y2)),m.add(0,0).add(l,E),g&&Pg(e,g,E,p,0,0,1,m);break;default:v=r.x,b=r.y}return Jr(m.translate(v,b),r),zu(r,"x",v+o)|zu(r,"y",b+o)&&(r.bounds=Xt,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function Pg(e,t,n,i,r,s,o,a){const u=t.bounds;if(t.auto){const l=o*(n+r+i);let c=0,f=0;e.dirty(t),s?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}a.union(u)}const s3=(e,t)=>Math.floor(Math.min(e,t)),o3=(e,t)=>Math.ceil(Math.max(e,t));function sY(e){var t=e.items,n=t.length,i=0,r,s;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(r=t[i],s=r.items,r.marktype===Rg)switch(r.role){case sx:case ax:case ox:break;case UD:o.rowheaders.push(...s);break;case qD:o.rowfooters.push(...s);break;case GD:o.colheaders.push(...s);break;case HD:o.colfooters.push(...s);break;case WD:o.rowtitle=s[0];break;case YD:o.coltitle=s[0];break;default:o.marks.push(...s)}return o}function oY(e){return new yt().set(0,0,e.width||0,e.height||0)}function aY(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function Ve(e,t,n){const i=ue(e)?e[t]:e;return i!=null?i:n!==void 0?n:0}function a3(e){return e<0?Math.ceil(-e):0}function u3(e,t,n){var i=!n.nodirty,r=n.bounds===cx?oY:aY,s=Xt.set(0,0,0,0),o=Ve(n.align,io),a=Ve(n.align,ro),u=Ve(n.padding,io),l=Ve(n.padding,ro),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),d=t.length,h=Array(d),g=Array(c),p=0,m=Array(d),y=Array(f),v=0,b=Array(d),x=Array(d),E=Array(d),_,w,A,S,O,C,k,F,j,$,R;for(w=0;w<c;++w)g[w]=0;for(w=0;w<f;++w)y[w]=0;for(w=0;w<d;++w)C=t[w],O=E[w]=r(C),C.x=C.x||0,b[w]=0,C.y=C.y||0,x[w]=0,A=w%c,S=~~(w/c),p=Math.max(p,k=Math.ceil(O.x2)),v=Math.max(v,F=Math.ceil(O.y2)),g[A]=Math.max(g[A],k),y[S]=Math.max(y[S],F),h[w]=u+a3(O.x1),m[w]=l+a3(O.y1),i&&e.dirty(t[w]);for(w=0;w<d;++w)w%c==0&&(h[w]=0),w<c&&(m[w]=0);if(o===lx)for(A=1;A<c;++A){for(R=0,w=A;w<d;w+=c)R<h[w]&&(R=h[w]);for(w=A;w<d;w+=c)h[w]=R+g[A-1]}else if(o===jg){for(R=0,w=0;w<d;++w)w%c&&R<h[w]&&(R=h[w]);for(w=0;w<d;++w)w%c&&(h[w]=R+p)}else for(o=!1,A=1;A<c;++A)for(w=A;w<d;w+=c)h[w]+=g[A-1];if(a===lx)for(S=1;S<f;++S){for(R=0,w=S*c,_=w+c;w<_;++w)R<m[w]&&(R=m[w]);for(w=S*c;w<_;++w)m[w]=R+y[S-1]}else if(a===jg){for(R=0,w=c;w<d;++w)R<m[w]&&(R=m[w]);for(w=c;w<d;++w)m[w]=R+v}else for(a=!1,S=1;S<f;++S)for(w=S*c,_=w+c;w<_;++w)m[w]+=y[S-1];for(j=0,w=0;w<d;++w)j=h[w]+(w%c?j:0),b[w]+=j-t[w].x;for(A=0;A<c;++A)for($=0,w=A;w<d;w+=c)$+=m[w],x[w]+=$-t[w].y;if(o&&Ve(n.center,io)&&f>1)for(w=0;w<d;++w)O=o===jg?p:g[w%c],j=O-E[w].x2-t[w].x-b[w],j>0&&(b[w]+=j/2);if(a&&Ve(n.center,ro)&&c!==1)for(w=0;w<d;++w)O=a===jg?v:y[~~(w/c)],$=O-E[w].y2-t[w].y-x[w],$>0&&(x[w]+=$/2);for(w=0;w<d;++w)s.union(E[w].translate(b[w],x[w]));switch(j=Ve(n.anchor,qH),$=Ve(n.anchor,WH),Ve(n.anchor,io)){case fn:j-=s.width();break;case rx:j-=s.width()/2}switch(Ve(n.anchor,ro)){case fn:$-=s.height();break;case rx:$-=s.height()/2}for(j=Math.round(j),$=Math.round($),s.clear(),w=0;w<d;++w)t[w].mark.bounds.clear();for(w=0;w<d;++w)C=t[w],C.x+=b[w]+=j,C.y+=x[w]+=$,s.union(C.mark.bounds.union(C.bounds.translate(b[w],x[w]))),i&&e.dirty(C);return s}function uY(e,t,n){var i=sY(t),r=i.marks,s=n.bounds===cx?lY:cY,o=n.offset,a=n.columns||r.length,u=a<=0?1:Math.ceil(r.length/a),l=u*a,c,f,d,h,g,p,m;const y=u3(e,r,n);y.empty()&&y.set(0,0,0,0),i.rowheaders&&(p=Ve(n.headerBand,ro,null),c=Ig(e,i.rowheaders,r,a,u,-Ve(o,"rowHeader"),s3,0,s,"x1",0,a,1,p)),i.colheaders&&(p=Ve(n.headerBand,io,null),f=Ig(e,i.colheaders,r,a,a,-Ve(o,"columnHeader"),s3,1,s,"y1",0,1,a,p)),i.rowfooters&&(p=Ve(n.footerBand,ro,null),d=Ig(e,i.rowfooters,r,a,u,Ve(o,"rowFooter"),o3,0,s,"x2",a-1,a,1,p)),i.colfooters&&(p=Ve(n.footerBand,io,null),h=Ig(e,i.colfooters,r,a,a,Ve(o,"columnFooter"),o3,1,s,"y2",l-a,1,a,p)),i.rowtitle&&(g=Ve(n.titleAnchor,ro),m=Ve(o,"rowTitle"),m=g===fn?d+m:c-m,p=Ve(n.titleBand,ro,.5),l3(e,i.rowtitle,m,0,y,p)),i.coltitle&&(g=Ve(n.titleAnchor,io),m=Ve(o,"columnTitle"),m=g===fn?h+m:f-m,p=Ve(n.titleBand,io,.5),l3(e,i.coltitle,m,1,y,p))}function lY(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function cY(e,t){return e.bounds[t]}function Ig(e,t,n,i,r,s,o,a,u,l,c,f,d,h){var g=n.length,p=0,m=0,y,v,b,x,E,_,w,A,S;if(!g)return p;for(y=c;y<g;y+=f)n[y]&&(p=o(p,u(n[y],l)));if(!t.length)return p;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),p+=s,v=0,x=t.length;v<x;++v)e.dirty(t[v]),t[v].mark.bounds.clear();for(y=c,v=0,x=t.length;v<x;++v,y+=f){for(_=t[v],E=_.mark.bounds,b=y;b>=0&&(w=n[b])==null;b-=d);a?(A=h==null?w.x:Math.round(w.bounds.x1+h*w.bounds.width()),S=p):(A=p,S=h==null?w.y:Math.round(w.bounds.y1+h*w.bounds.height())),E.union(_.bounds.translate(A-(_.x||0),S-(_.y||0))),_.x=A,_.y=S,e.dirty(_),m=o(m,E[l])}return m}function l3(e,t,n,i,r,s){if(!!t){e.dirty(t);var o=n,a=n;i?o=Math.round(r.x1+s*r.width()):a=Math.round(r.y1+s*r.height()),t.bounds.translate(o-(t.x||0),a-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=a,e.dirty(t)}}function fY(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function dY(e,t){let n=-1/0;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-1/0?n:t}function hY(e,t,n,i,r,s,o){const a=fY(n,t),u=dY(e,a("offset",0)),l=a("anchor",ix),c=l===fn?1:l===rx?.5:0,f={align:lx,bounds:a("bounds",cx),columns:a("direction")==="vertical"?1:e.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(t){case Ri:f.anchor={x:Math.floor(i.x1)-u,column:fn,y:c*(o||i.height()+2*i.y1),row:l};break;case ji:f.anchor={x:Math.ceil(i.x2)+u,y:c*(o||i.height()+2*i.y1),row:l};break;case Bu:f.anchor={y:Math.floor(r.y1)-u,row:fn,x:c*(s||r.width()+2*r.x1),column:l};break;case no:f.anchor={y:Math.ceil(r.y2)+u,x:c*(s||r.width()+2*r.x1),column:l};break;case IH:f.anchor={x:u,y:u};break;case BH:f.anchor={x:s-u,y:u,column:fn};break;case zH:f.anchor={x:u,y:o-u,row:fn};break;case UH:f.anchor={x:s-u,y:o-u,column:fn,row:fn};break}return f}function gY(e,t){var n=t.items[0],i=n.datum,r=n.orient,s=n.bounds,o=n.x,a=n.y,u,l;return n._bounds?n._bounds.clear().union(s):n._bounds=s.clone(),s.clear(),mY(e,n,n.items[0].items[0]),s=pY(n,s),u=2*n.padding,l=2*n.padding,s.empty()||(u=Math.ceil(s.width()+u),l=Math.ceil(s.height()+l)),i.type===VH&&yY(n.items[0].items[0].items[0].items),r!==ux&&(n.x=o=0,n.y=a=0),n.width=u,n.height=l,Jr(s.set(o,a,o+u,a+l),n),n.mark.bounds.clear().union(s),n}function pY(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function mY(e,t,n){var i=t.padding,r=i-n.x,s=i-n.y;if(!t.datum.title)(r||s)&&tf(e,n,r,s);else{var o=t.items[1].items[0],a=o.anchor,u=t.titlePadding||0,l=i-o.x,c=i-o.y;switch(o.orient){case Ri:r+=Math.ceil(o.bounds.width())+u;break;case ji:case no:break;default:s+=o.bounds.height()+u}switch((r||s)&&tf(e,n,r,s),o.orient){case Ri:c+=Uu(t,n,o,a,1,1);break;case ji:l+=Uu(t,n,o,fn,0,0)+u,c+=Uu(t,n,o,a,1,1);break;case no:l+=Uu(t,n,o,a,0,0),c+=Uu(t,n,o,fn,-1,0,1)+u;break;default:l+=Uu(t,n,o,a,0,0)}(l||c)&&tf(e,o,l,c),(l=Math.round(o.bounds.x1-i))<0&&(tf(e,n,-l,0),tf(e,o,-l,0))}}function Uu(e,t,n,i,r,s,o){const a=e.datum.type!=="symbol",u=n.datum.vgrad,l=a&&(s||!u)&&!o?t.items[0]:t,c=l.bounds[r?"y2":"x2"]-e.padding,f=u&&s?c:0,d=u&&s?0:c,h=r<=0?0:Rb(n);return Math.round(i===ix?f:i===fn?d-h:.5*(c-h))}function tf(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function yY(e){const t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function vY(e,t,n,i,r){var s=t.items[0],o=s.frame,a=s.orient,u=s.anchor,l=s.offset,c=s.padding,f=s.items[0].items[0],d=s.items[1]&&s.items[1].items[0],h=a===Ri||a===ji?i:n,g=0,p=0,m=0,y=0,v=0,b;if(o!==Rg?a===Ri?(g=r.y2,h=r.y1):a===ji?(g=r.y1,h=r.y2):(g=r.x1,h=r.x2):a===Ri&&(g=i,h=0),b=u===ix?g:u===fn?h:(g+h)/2,d&&d.text){switch(a){case Bu:case no:v=f.bounds.height()+c;break;case Ri:y=f.bounds.width()+c;break;case ji:y=-f.bounds.width()-c;break}Xt.clear().union(d.bounds),Xt.translate(y-(d.x||0),v-(d.y||0)),zu(d,"x",y)|zu(d,"y",v)&&(e.dirty(d),d.bounds.clear().union(Xt),d.mark.bounds.clear().union(Xt),e.dirty(d)),Xt.clear().union(d.bounds)}else Xt.clear();switch(Xt.union(f.bounds),a){case Bu:p=b,m=r.y1-Xt.height()-l;break;case Ri:p=r.x1-Xt.width()-l,m=b;break;case ji:p=r.x2+Xt.width()+l,m=b;break;case no:p=b,m=r.y2+l;break;default:p=s.x,m=s.y}return zu(s,"x",p)|zu(s,"y",m)&&(Xt.translate(p,m),e.dirty(s),s.bounds.clear().union(Xt),t.bounds.clear().union(Xt),e.dirty(s)),s.bounds}function c3(e){D.call(this,null,e)}z(c3,D,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&uY(n,i,e.layout),xY(n,i,e)}),bY(e.mark.group)?t.reflow():t}});function bY(e){return e&&e.mark.role!=="legend-entry"}function xY(e,t,n){var i=t.items,r=Math.max(0,t.width||0),s=Math.max(0,t.height||0),o=new yt().set(0,0,r,s),a=o.clone(),u=o.clone(),l=[],c,f,d,h,g,p;for(g=0,p=i.length;g<p;++g)switch(f=i[g],f.role){case sx:h=nY(f)?a:u,h.union(rY(e,f,r,s));break;case ox:c=f;break;case ax:l.push(gY(e,f));break;case GH:case HH:case UD:case qD:case WD:case GD:case HD:case YD:a.union(f.bounds),u.union(f.bounds);break;default:o.union(f.bounds)}if(l.length){const m={};l.forEach(y=>{d=y.orient||ji,d!==ux&&(m[d]||(m[d]=[])).push(y)});for(const y in m){const v=m[y];u3(e,v,hY(v,y,n.legends,a,u,r,s))}l.forEach(y=>{const v=y.bounds;if(v.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=v,e.dirty(y)),n.autosize&&n.autosize.type===VD)switch(y.orient){case Ri:case ji:o.add(v.x1,0).add(v.x2,0);break;case Bu:case no:o.add(0,v.y1).add(0,v.y2)}else o.union(v)})}o.union(a).union(u),c&&o.union(vY(e,c,r,s,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),wY(e,t,o,n)}function wY(e,t,n,i){const r=i.autosize||{},s=r.type;if(e._autosize<1||!s)return;let o=e._width,a=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-u)),h=Math.max(0,Math.ceil(n.y2-c));if(r.contains===YH){const g=e.padding();o-=g.left+g.right,a-=g.top+g.bottom}s===ux?(l=0,f=0,u=o,c=a):s===VD?(u=Math.max(0,o-l-d),c=Math.max(0,a-f-h)):s===XH?(u=Math.max(0,o-l-d),a=c+f+h):s===KH?(o=u+l+d,c=Math.max(0,a-f-h)):s===JH&&(o=u+l+d,a=c+f+h),e._resizeView(o,a,u,c,[l,f],r.resize)}var EY=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",bound:XD,identifier:fx,mark:JD,overlap:QD,render:r3,viewlayout:c3});function f3(e){D.call(this,null,e)}z(f3,D,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,s=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,a=sb(s,o,e.minstep),u=e.format||dk(n,s,a,e.formatSpecifier,e.formatType,!!e.values),l=e.values?fk(s,e.values,a):ob(s,a);return r&&(i.rem=r),r=l.map((c,f)=>Me({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&r.length&&r.push(Me({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}});function d3(e){D.call(this,null,e)}function _Y(){return Me({})}function AY(e){const t=lu().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}z(d3,D,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||_Y,s=e.key||J,o=this.value;return K(i.encode)&&(i.encode=null),o&&(e.modified("key")||t.modified(s))&&N("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=AY(s)),t.visit(t.ADD,a=>{const u=s(a);let l=o.get(u);l?l.exit?(o.empty--,i.add.push(l)):i.mod.push(l):(l=r(a),o.set(u,l),i.add.push(l)),l.datum=a,l.exit=!1}),t.visit(t.MOD,a=>{const u=s(a),l=o.get(u);l&&(l.datum=a,i.mod.push(l))}),t.visit(t.REM,a=>{const u=s(a),l=o.get(u);a===l.datum&&!l.exit&&(i.rem.push(l),l.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i}});function h3(e){D.call(this,null,e)}z(h3,D,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,s=t.encode;if(K(s))if(n.changed()||s.every(f=>r[f]))s=s[0],n.encode=null;else return t.StopPropagation;var o=s==="enter",a=r.update||Ss,u=r.enter||Ss,l=r.exit||Ss,c=(s&&!o?r[s]:a)||Ss;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),a(f,e)}),n.modifies(u.output),n.modifies(a.output),c!==Ss&&c!==a&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==Ss&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),o||c!==Ss){const f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,d=>{const h=u(d,e)||i;(c(d,e)||h)&&n.mod.push(d)}),n.mod.length&&n.modifies(u.output)):t.visit(f,d=>{(c(d,e)||i)&&n.mod.push(d)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function g3(e){D.call(this,[],e)}z(g3,D,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,s=e.type||og,o=e.scale,a=+e.limit,u=sb(o,e.count==null?5:e.count,e.minstep),l=!!e.values||s===og,c=e.format||mk(n,o,u,s,e.formatSpecifier,e.formatType,l),f=e.values||pk(o,u),d,h,g,p,m;return r&&(i.rem=r),s===og?(a&&f.length>a?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,a-1),m=!0):r=f,ge(g=e.size)?(!e.values&&o(r[0])===0&&(r=r.slice(1)),p=r.reduce((y,v)=>Math.max(y,g(v,e)),0)):g=qt(p=g||8),r=r.map((y,v)=>Me({index:v,label:c(y,v,r),value:y,offset:p,size:g(y,e)})),m&&(m=f[r.length],r.push(Me({index:r.length,label:"\u2026".concat(f.length-r.length," entries"),value:m,offset:p,size:g(m,e)})))):s===tW?(d=o.domain(),h=ak(o,d[0],be(d)),f.length<3&&!e.values&&d[0]!==be(d)&&(f=[d[0],be(d)]),r=f.map((y,v)=>Me({index:v,label:c(y,v,f),value:y,perc:h(y)}))):(g=f.length-1,h=dW(o),r=f.map((y,v)=>Me({index:v,label:c(y,v,f),value:y,perc:v?h(y):0,perc2:v===g?1:h(f[v+1])}))),i.source=r,i.add=r,this.value=r,i}});const OY=e=>e.source.x,SY=e=>e.source.y,CY=e=>e.target.x,$Y=e=>e.target.y;function dx(e){D.call(this,{},e)}dx.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};z(dx,D,{transform(e,t){var n=e.sourceX||OY,i=e.sourceY||SY,r=e.targetX||CY,s=e.targetY||$Y,o=e.as||"path",a=e.orient||"vertical",u=e.shape||"line",l=v3.get(u+"-"+a)||v3.get(u);return l||N("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[o]=l(n(c),i(c),r(c),s(c))}),t.reflow(e.modified()).modifies(o)}});const p3=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,FY=(e,t,n,i)=>p3(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),m3=(e,t,n,i)=>{var r=n-e,s=i-t,o=Math.sqrt(r*r+s*s)/2,a=180*Math.atan2(s,r)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+a+" 0 1 "+n+","+i},kY=(e,t,n,i)=>m3(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),y3=(e,t,n,i)=>{const r=n-e,s=i-t,o=.2*(r+s),a=.2*(s-r);return"M"+e+","+t+"C"+(e+o)+","+(t+a)+" "+(n+a)+","+(i-o)+" "+n+","+i},DY=(e,t,n,i)=>y3(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),MY=(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,TY=(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,NY=(e,t,n,i)=>{const r=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*s+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*o+","+t*a+"L"+i*o+","+i*a},RY=(e,t,n,i)=>{const r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i},jY=(e,t,n,i)=>{const r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i},LY=(e,t,n,i)=>{const r=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=(t+i)/2;return"M"+t*r+","+t*s+"C"+u*r+","+u*s+" "+u*o+","+u*a+" "+i*o+","+i*a},v3=lu({line:p3,"line-radial":FY,arc:m3,"arc-radial":kY,curve:y3,"curve-radial":DY,"orthogonal-horizontal":MY,"orthogonal-vertical":TY,"orthogonal-radial":NY,"diagonal-horizontal":RY,"diagonal-vertical":jY,"diagonal-radial":LY});function hx(e){D.call(this,null,e)}hx.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};z(hx,D,{transform(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],s=e.field||uu,o=e.startAngle||0,a=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(s),c=l.length,f=o,d=(a-o)/rS(l),h=Yn(c),g,p,m;for(e.sort&&h.sort((y,v)=>l[y]-l[v]),g=0;g<c;++g)m=l[h[g]],p=u[h[g]],p[i]=f,p[r]=f+=m*d;return this.value=l,t.reflow(e.modified()).modifies(n)}});const PY=5;function IY(e){const t=e.type;return!e.bins&&(t===Fu||t===Tc||t===Nc)}function b3(e){return tb(e)&&e!==cr}const BY=Fi(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function x3(e){D.call(this,null,e),this.modified(!0)}z(x3,D,{transform(e,t){var n=t.dataflow,i=this.value,r=zY(e);(!i||r!==i.type)&&(this.value=i=$e(r)());for(r in e)if(!BY[r]){if(r==="padding"&&b3(i.type))continue;ge(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return YY(i,e,HY(i,e,qY(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function zY(e){var t=e.type,n="",i;return t===cr?cr+"-"+Fu:(UY(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?cr+"-":i===3?ku+"-":""),(n+t||Fu).toLowerCase())}function UY(e){const t=e.type;return tb(t)&&t!==na&&t!==ia&&(e.scheme||e.range&&e.range.length&&e.range.every(_e))}function qY(e,t,n){const i=WY(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,s=e.type,o=t.zero||t.zero===void 0&&IY(e),a,u;if(!r)return 0;if(b3(s)&&t.padding&&r[0]!==be(r)&&(r=GY(s,r,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(a=(r=r.slice()).length-1||1,o&&(r[0]>0&&(r[0]=0),r[a]<0&&(r[a]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[a]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>r[a]?a+1:u<r[0]?0:a;l!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),r.splice(l,0,u)}return e.domain(w3(s,r,n)),s===Kv&&e.unknown(t.domainImplicit?wv:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&sb(e,t.nice)||null),r.length}function WY(e,t,n){return t?(e.domain(w3(e.type,t,n)),t.length):-1}function GY(e,t,n,i,r,s){var o=Math.abs(be(n)-n[0]),a=o/(o-2*i),u=e===Xr?v1(t,null,a):e===Nc?oh(t,null,a,.5):e===Tc?oh(t,null,a,r||1):e===tg?b1(t,null,a,s||1):y1(t,null,a);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function w3(e,t,n){if(nk(e)){var i=Math.abs(t.reduce((r,s)=>r+(s<0?-1:s>0?1:0),0));i!==t.length&&n.warn("Log scale domain includes zero: "+ee(t))}return t}function HY(e,t,n){let i=t.bins;if(i&&!K(i)){const r=e.domain(),s=r[0],o=be(r),a=i.step;let u=i.start==null?s:i.start,l=i.stop==null?o:i.stop;a||N("Scale bins parameter missing step property."),u<s&&(u=a*Math.ceil(s/a)),l>o&&(l=a*Math.floor(o/a)),i=Yn(u,l+a/2,a)}return i?e.bins=i:e.bins&&delete e.bins,e.type===Qv&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function YY(e,t,n){var i=e.type,r=t.round||!1,s=t.range;if(t.rangeStep!=null)s=VY(i,t,n);else if(t.scheme&&(s=XY(i,t,n),ge(s))){if(e.interpolator)return e.interpolator(s);N("Scale type ".concat(i," does not support interpolating color schemes."))}if(s&&ik(i))return e.interpolator(sg(gx(s,t.reverse),t.interpolate,t.interpolateGamma));s&&t.interpolate&&e.interpolate?e.interpolate(ib(t.interpolate,t.interpolateGamma)):ge(e.round)?e.round(r):ge(e.rangeRound)&&e.interpolate(r?Dc:Ws),s&&e.range(gx(s,t.reverse))}function VY(e,t,n){e!==QF&&e!==Jv&&N("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===Jv?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*Xv(n,r,i)]}function XY(e,t,n){var i=t.schemeExtent,r,s;return K(t.scheme)?s=sg(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),s=rb(r),s||N("Unrecognized scheme name: ".concat(t.scheme))),n=e===ig?n+1:e===Qv?n-1:e===Du||e===ng?+t.schemeCount||PY:n,ik(e)?E3(s,i,t.reverse):ge(s)?ok(E3(s,i),n):e===Kv?s:s.slice(0,n)}function E3(e,t,n){return ge(e)&&(t||n)?sk(e,gx(t||[0,1],n)):e}function gx(e,t){return t?e.slice().reverse():e}function _3(e){D.call(this,null,e)}z(_3,D,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Vo(e.sort)),this.modified(n),t}});const A3="zero",O3="center",S3="normalize",C3=["y0","y1"];function px(e){D.call(this,null,e)}px.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:A3,values:[A3,O3,S3]},{name:"as",type:"string",array:!0,length:2,default:C3}]};z(px,D,{transform(e,t){var n=e.as||C3,i=n[0],r=n[1],s=Vo(e.sort),o=e.field||uu,a=e.offset===O3?KY:e.offset===S3?JY:QY,u,l,c,f;for(u=ZY(t.source,e.groupby,s,o),l=0,c=u.length,f=u.max;l<c;++l)a(u[l],f,o,i,r);return t.reflow(e.modified()).modifies(n)}});function KY(e,t,n,i,r){for(var s=(t-e.sum)/2,o=e.length,a=0,u;a<o;++a)u=e[a],u[i]=s,u[r]=s+=Math.abs(n(u))}function JY(e,t,n,i,r){for(var s=1/e.sum,o=0,a=e.length,u=0,l=0,c;u<a;++u)c=e[u],c[i]=o,c[r]=o=s*(l+=Math.abs(n(c)))}function QY(e,t,n,i,r){for(var s=0,o=0,a=e.length,u=0,l,c;u<a;++u)c=e[u],l=+n(c),l<0?(c[i]=o,c[r]=o+=l):(c[i]=s,c[r]=s+=l)}function ZY(e,t,n,i){var r=[],s=p=>p(c),o,a,u,l,c,f,d,h,g;if(t==null)r.push(e.slice());else for(o={},a=0,u=e.length;a<u;++a)c=e[a],f=t.map(s),d=o[f],d||(o[f]=d=[],r.push(d)),d.push(c);for(f=0,g=0,l=r.length;f<l;++f){for(d=r[f],a=0,h=0,u=d.length;a<u;++a)h+=Math.abs(i(d[a]));d.sum=h,h>g&&(g=h),n&&d.sort(n)}return r.max=g,r}var eV=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",axisticks:f3,datajoin:d3,encode:h3,legendentries:g3,linkpath:dx,pie:hx,scale:x3,sortitems:_3,stack:px}),ne=1e-6,Bg=1e-12,me=Math.PI,nt=me/2,zg=me/4,dn=me*2,ut=180/me,ye=me/180,we=Math.abs,qu=Math.atan,di=Math.atan2,ie=Math.cos,Ug=Math.ceil,$3=Math.exp,mx=Math.hypot,qg=Math.log,yx=Math.pow,Q=Math.sin,hi=Math.sign||function(e){return e>0?1:e<0?-1:0},hn=Math.sqrt,vx=Math.tan;function F3(e){return e>1?0:e<-1?me:Math.acos(e)}function Tn(e){return e>1?nt:e<-1?-nt:Math.asin(e)}function jt(){}function Wg(e,t){e&&D3.hasOwnProperty(e.type)&&D3[e.type](e,t)}var k3={Feature:function(e,t){Wg(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)Wg(n[i].geometry,t)}},D3={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){bx(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)bx(n[i],t,0)},Polygon:function(e,t){M3(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)M3(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)Wg(n[i],t)}};function bx(e,t,n){var i=-1,r=e.length-n,s;for(t.lineStart();++i<r;)s=e[i],t.point(s[0],s[1],s[2]);t.lineEnd()}function M3(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)bx(e[n],t,1);t.polygonEnd()}function Zr(e,t){e&&k3.hasOwnProperty(e.type)?k3[e.type](e,t):Wg(e,t)}var Gg=new ln,Hg=new ln,T3,N3,xx,wx,Ex,mr={point:jt,lineStart:jt,lineEnd:jt,polygonStart:function(){Gg=new ln,mr.lineStart=tV,mr.lineEnd=nV},polygonEnd:function(){var e=+Gg;Hg.add(e<0?dn+e:e),this.lineStart=this.lineEnd=this.point=jt},sphere:function(){Hg.add(dn)}};function tV(){mr.point=iV}function nV(){R3(T3,N3)}function iV(e,t){mr.point=R3,T3=e,N3=t,e*=ye,t*=ye,xx=e,wx=ie(t=t/2+zg),Ex=Q(t)}function R3(e,t){e*=ye,t*=ye,t=t/2+zg;var n=e-xx,i=n>=0?1:-1,r=i*n,s=ie(t),o=Q(t),a=Ex*o,u=wx*s+a*ie(r),l=a*i*Q(r);Gg.add(di(l,u)),xx=e,wx=s,Ex=o}function rV(e){return Hg=new ln,Zr(e,mr),Hg*2}function Yg(e){return[di(e[1],e[0]),Tn(e[2])]}function ca(e){var t=e[0],n=e[1],i=ie(n);return[i*ie(t),i*Q(t),Q(n)]}function Vg(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Wu(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function _x(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Xg(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Kg(e){var t=hn(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Je,Nn,it,Jn,fa,j3,L3,Gu,nf,so,es,ts={point:Ax,lineStart:I3,lineEnd:B3,polygonStart:function(){ts.point=z3,ts.lineStart=sV,ts.lineEnd=oV,nf=new ln,mr.polygonStart()},polygonEnd:function(){mr.polygonEnd(),ts.point=Ax,ts.lineStart=I3,ts.lineEnd=B3,Gg<0?(Je=-(it=180),Nn=-(Jn=90)):nf>ne?Jn=90:nf<-ne&&(Nn=-90),es[0]=Je,es[1]=it},sphere:function(){Je=-(it=180),Nn=-(Jn=90)}};function Ax(e,t){so.push(es=[Je=e,it=e]),t<Nn&&(Nn=t),t>Jn&&(Jn=t)}function P3(e,t){var n=ca([e*ye,t*ye]);if(Gu){var i=Wu(Gu,n),r=[i[1],-i[0],0],s=Wu(r,i);Kg(s),s=Yg(s);var o=e-fa,a=o>0?1:-1,u=s[0]*ut*a,l,c=we(o)>180;c^(a*fa<u&&u<a*e)?(l=s[1]*ut,l>Jn&&(Jn=l)):(u=(u+360)%360-180,c^(a*fa<u&&u<a*e)?(l=-s[1]*ut,l<Nn&&(Nn=l)):(t<Nn&&(Nn=t),t>Jn&&(Jn=t))),c?e<fa?Qn(Je,e)>Qn(Je,it)&&(it=e):Qn(e,it)>Qn(Je,it)&&(Je=e):it>=Je?(e<Je&&(Je=e),e>it&&(it=e)):e>fa?Qn(Je,e)>Qn(Je,it)&&(it=e):Qn(e,it)>Qn(Je,it)&&(Je=e)}else so.push(es=[Je=e,it=e]);t<Nn&&(Nn=t),t>Jn&&(Jn=t),Gu=n,fa=e}function I3(){ts.point=P3}function B3(){es[0]=Je,es[1]=it,ts.point=Ax,Gu=null}function z3(e,t){if(Gu){var n=e-fa;nf.add(we(n)>180?n+(n>0?360:-360):n)}else j3=e,L3=t;mr.point(e,t),P3(e,t)}function sV(){mr.lineStart()}function oV(){z3(j3,L3),mr.lineEnd(),we(nf)>ne&&(Je=-(it=180)),es[0]=Je,es[1]=it,Gu=null}function Qn(e,t){return(t-=e)<0?t+360:t}function aV(e,t){return e[0]-t[0]}function U3(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function uV(e){var t,n,i,r,s,o,a;if(Jn=it=-(Je=Nn=1/0),so=[],Zr(e,ts),n=so.length){for(so.sort(aV),t=1,i=so[0],s=[i];t<n;++t)r=so[t],U3(i,r[0])||U3(i,r[1])?(Qn(i[0],r[1])>Qn(i[0],i[1])&&(i[1]=r[1]),Qn(r[0],i[1])>Qn(i[0],i[1])&&(i[0]=r[0])):s.push(i=r);for(o=-1/0,n=s.length-1,t=0,i=s[n];t<=n;i=r,++t)r=s[t],(a=Qn(i[1],r[0]))>o&&(o=a,Je=r[0],it=i[1])}return so=es=null,Je===1/0||Nn===1/0?[[NaN,NaN],[NaN,NaN]]:[[Je,Nn],[it,Jn]]}var rf,Jg,Qg,Zg,e0,t0,n0,i0,Ox,Sx,Cx,q3,W3,gn,pn,mn,Li={sphere:jt,point:$x,lineStart:G3,lineEnd:H3,polygonStart:function(){Li.lineStart=fV,Li.lineEnd=dV},polygonEnd:function(){Li.lineStart=G3,Li.lineEnd=H3}};function $x(e,t){e*=ye,t*=ye;var n=ie(t);sf(n*ie(e),n*Q(e),Q(t))}function sf(e,t,n){++rf,Qg+=(e-Qg)/rf,Zg+=(t-Zg)/rf,e0+=(n-e0)/rf}function G3(){Li.point=lV}function lV(e,t){e*=ye,t*=ye;var n=ie(t);gn=n*ie(e),pn=n*Q(e),mn=Q(t),Li.point=cV,sf(gn,pn,mn)}function cV(e,t){e*=ye,t*=ye;var n=ie(t),i=n*ie(e),r=n*Q(e),s=Q(t),o=di(hn((o=pn*s-mn*r)*o+(o=mn*i-gn*s)*o+(o=gn*r-pn*i)*o),gn*i+pn*r+mn*s);Jg+=o,t0+=o*(gn+(gn=i)),n0+=o*(pn+(pn=r)),i0+=o*(mn+(mn=s)),sf(gn,pn,mn)}function H3(){Li.point=$x}function fV(){Li.point=hV}function dV(){Y3(q3,W3),Li.point=$x}function hV(e,t){q3=e,W3=t,e*=ye,t*=ye,Li.point=Y3;var n=ie(t);gn=n*ie(e),pn=n*Q(e),mn=Q(t),sf(gn,pn,mn)}function Y3(e,t){e*=ye,t*=ye;var n=ie(t),i=n*ie(e),r=n*Q(e),s=Q(t),o=pn*s-mn*r,a=mn*i-gn*s,u=gn*r-pn*i,l=mx(o,a,u),c=Tn(l),f=l&&-c/l;Ox.add(f*o),Sx.add(f*a),Cx.add(f*u),Jg+=c,t0+=c*(gn+(gn=i)),n0+=c*(pn+(pn=r)),i0+=c*(mn+(mn=s)),sf(gn,pn,mn)}function gV(e){rf=Jg=Qg=Zg=e0=t0=n0=i0=0,Ox=new ln,Sx=new ln,Cx=new ln,Zr(e,Li);var t=+Ox,n=+Sx,i=+Cx,r=mx(t,n,i);return r<Bg&&(t=t0,n=n0,i=i0,Jg<ne&&(t=Qg,n=Zg,i=e0),r=mx(t,n,i),r<Bg)?[NaN,NaN]:[di(n,t)*ut,Tn(i/r)*ut]}function Fx(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function kx(e,t){return[we(e)>me?e+Math.round(-e/dn)*dn:e,t]}kx.invert=kx;function V3(e,t,n){return(e%=dn)?t||n?Fx(K3(e),J3(t,n)):K3(e):t||n?J3(t,n):kx}function X3(e){return function(t,n){return t+=e,[t>me?t-dn:t<-me?t+dn:t,n]}}function K3(e){var t=X3(e);return t.invert=X3(-e),t}function J3(e,t){var n=ie(e),i=Q(e),r=ie(t),s=Q(t);function o(a,u){var l=ie(u),c=ie(a)*l,f=Q(a)*l,d=Q(u),h=d*n+c*i;return[di(f*r-h*s,c*n-d*i),Tn(h*r+f*s)]}return o.invert=function(a,u){var l=ie(u),c=ie(a)*l,f=Q(a)*l,d=Q(u),h=d*r-f*s;return[di(f*r+d*s,c*n+h*i),Tn(h*n-c*i)]},o}function pV(e){e=V3(e[0]*ye,e[1]*ye,e.length>2?e[2]*ye:0);function t(n){return n=e(n[0]*ye,n[1]*ye),n[0]*=ut,n[1]*=ut,n}return t.invert=function(n){return n=e.invert(n[0]*ye,n[1]*ye),n[0]*=ut,n[1]*=ut,n},t}function mV(e,t,n,i,r,s){if(!!n){var o=ie(t),a=Q(t),u=i*n;r==null?(r=t+i*dn,s=t-u/2):(r=Q3(o,r),s=Q3(o,s),(i>0?r<s:r>s)&&(r+=i*dn));for(var l,c=r;i>0?c>s:c<s;c-=u)l=Yg([o,-a*ie(c),-a*Q(c)]),e.point(l[0],l[1])}}function Q3(e,t){t=ca(t),t[0]-=e,Kg(t);var n=F3(-t[1]);return((-t[2]<0?-n:n)+dn-ne)%dn}function Z3(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:jt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function r0(e,t){return we(e[0]-t[0])<ne&&we(e[1]-t[1])<ne}function s0(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function eM(e,t,n,i,r){var s=[],o=[],a,u;if(e.forEach(function(g){if(!((p=g.length-1)<=0)){var p,m=g[0],y=g[p],v;if(r0(m,y)){if(!m[2]&&!y[2]){for(r.lineStart(),a=0;a<p;++a)r.point((m=g[a])[0],m[1]);r.lineEnd();return}y[0]+=2*ne}s.push(v=new s0(m,g,null,!0)),o.push(v.o=new s0(m,null,v,!1)),s.push(v=new s0(y,g,null,!1)),o.push(v.o=new s0(y,null,v,!0))}}),!!s.length){for(o.sort(t),tM(s),tM(o),a=0,u=o.length;a<u;++a)o[a].e=n=!n;for(var l=s[0],c,f;;){for(var d=l,h=!0;d.v;)if((d=d.n)===l)return;c=d.z,r.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,u=c.length;a<u;++a)r.point((f=c[a])[0],f[1]);else i(d.x,d.n.x,1,r);d=d.n}else{if(h)for(c=d.p.z,a=c.length-1;a>=0;--a)r.point((f=c[a])[0],f[1]);else i(d.x,d.p.x,-1,r);d=d.p}d=d.o,c=d.z,h=!h}while(!d.v);r.lineEnd()}}}function tM(e){if(!!(t=e.length)){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function Dx(e){return we(e[0])<=me?e[0]:hi(e[0])*((we(e[0])+me)%dn-me)}function yV(e,t){var n=Dx(t),i=t[1],r=Q(i),s=[Q(n),-ie(n),0],o=0,a=0,u=new ln;r===1?i=nt+ne:r===-1&&(i=-nt-ne);for(var l=0,c=e.length;l<c;++l)if(!!(d=(f=e[l]).length))for(var f,d,h=f[d-1],g=Dx(h),p=h[1]/2+zg,m=Q(p),y=ie(p),v=0;v<d;++v,g=x,m=_,y=w,h=b){var b=f[v],x=Dx(b),E=b[1]/2+zg,_=Q(E),w=ie(E),A=x-g,S=A>=0?1:-1,O=S*A,C=O>me,k=m*_;if(u.add(di(k*S*Q(O),y*w+k*ie(O))),o+=C?A+S*dn:A,C^g>=n^x>=n){var F=Wu(ca(h),ca(b));Kg(F);var j=Wu(s,F);Kg(j);var $=(C^A>=0?-1:1)*Tn(j[2]);(i>$||i===$&&(F[0]||F[1]))&&(a+=C^A>=0?1:-1)}}return(o<-ne||o<ne&&u<-Bg)^a&1}function nM(e,t,n,i){return function(r){var s=t(r),o=Z3(),a=t(o),u=!1,l,c,f,d={point:h,lineStart:p,lineEnd:m,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,c=[],l=[]},polygonEnd:function(){d.point=h,d.lineStart=p,d.lineEnd=m,c=iS(c);var x=yV(l,i);c.length?(u||(r.polygonStart(),u=!0),eM(c,bV,x,n,r)):x&&(u||(r.polygonStart(),u=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),u&&(r.polygonEnd(),u=!1),c=l=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function h(x,E){e(x,E)&&r.point(x,E)}function g(x,E){s.point(x,E)}function p(){d.point=g,s.lineStart()}function m(){d.point=h,s.lineEnd()}function y(x,E){f.push([x,E]),a.point(x,E)}function v(){a.lineStart(),f=[]}function b(){y(f[0][0],f[0][1]),a.lineEnd();var x=a.clean(),E=o.result(),_,w=E.length,A,S,O;if(f.pop(),l.push(f),f=null,!!w){if(x&1){if(S=E[0],(A=S.length-1)>0){for(u||(r.polygonStart(),u=!0),r.lineStart(),_=0;_<A;++_)r.point((O=S[_])[0],O[1]);r.lineEnd()}return}w>1&&x&2&&E.push(E.pop().concat(E.shift())),c.push(E.filter(vV))}}return d}}function vV(e){return e.length>1}function bV(e,t){return((e=e.x)[0]<0?e[1]-nt-ne:nt-e[1])-((t=t.x)[0]<0?t[1]-nt-ne:nt-t[1])}var iM=nM(function(){return!0},xV,EV,[-me,-nt]);function xV(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(s,o){var a=s>0?me:-me,u=we(s-t);we(u-me)<ne?(e.point(t,n=(n+o)/2>0?nt:-nt),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),r=0):i!==a&&u>=me&&(we(t-i)<ne&&(t-=i*ne),we(s-a)<ne&&(s-=a*ne),n=wV(t,n,s,o),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(a,n),r=0),e.point(t=s,n=o),i=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function wV(e,t,n,i){var r,s,o=Q(e-n);return we(o)>ne?qu((Q(t)*(s=ie(i))*Q(n)-Q(i)*(r=ie(t))*Q(e))/(r*s*o)):(t+i)/2}function EV(e,t,n,i){var r;if(e==null)r=n*nt,i.point(-me,r),i.point(0,r),i.point(me,r),i.point(me,0),i.point(me,-r),i.point(0,-r),i.point(-me,-r),i.point(-me,0),i.point(-me,r);else if(we(e[0]-t[0])>ne){var s=e[0]<t[0]?me:-me;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])}function _V(e){var t=ie(e),n=6*ye,i=t>0,r=we(t)>ne;function s(c,f,d,h){mV(h,e,n,d,c,f)}function o(c,f){return ie(c)*ie(f)>t}function a(c){var f,d,h,g,p;return{lineStart:function(){g=h=!1,p=1},point:function(m,y){var v=[m,y],b,x=o(m,y),E=i?x?0:l(m,y):x?l(m+(m<0?me:-me),y):0;if(!f&&(g=h=x)&&c.lineStart(),x!==h&&(b=u(f,v),(!b||r0(f,b)||r0(v,b))&&(v[2]=1)),x!==h)p=0,x?(c.lineStart(),b=u(v,f),c.point(b[0],b[1])):(b=u(f,v),c.point(b[0],b[1],2),c.lineEnd()),f=b;else if(r&&f&&i^x){var _;!(E&d)&&(_=u(v,f,!0))&&(p=0,i?(c.lineStart(),c.point(_[0][0],_[0][1]),c.point(_[1][0],_[1][1]),c.lineEnd()):(c.point(_[1][0],_[1][1]),c.lineEnd(),c.lineStart(),c.point(_[0][0],_[0][1],3)))}x&&(!f||!r0(f,v))&&c.point(v[0],v[1]),f=v,h=x,d=E},lineEnd:function(){h&&c.lineEnd(),f=null},clean:function(){return p|(g&&h)<<1}}}function u(c,f,d){var h=ca(c),g=ca(f),p=[1,0,0],m=Wu(h,g),y=Vg(m,m),v=m[0],b=y-v*v;if(!b)return!d&&c;var x=t*y/b,E=-t*v/b,_=Wu(p,m),w=Xg(p,x),A=Xg(m,E);_x(w,A);var S=_,O=Vg(w,S),C=Vg(S,S),k=O*O-C*(Vg(w,w)-1);if(!(k<0)){var F=hn(k),j=Xg(S,(-O-F)/C);if(_x(j,w),j=Yg(j),!d)return j;var $=c[0],R=f[0],L=c[1],U=f[1],H;R<$&&(H=$,$=R,R=H);var ae=R-$,De=we(ae-me)<ne,Oe=De||ae<ne;if(!De&&U<L&&(H=L,L=U,U=H),Oe?De?L+U>0^j[1]<(we(j[0]-$)<ne?L:U):L<=j[1]&&j[1]<=U:ae>me^($<=j[0]&&j[0]<=R)){var Ze=Xg(S,(-O+F)/C);return _x(Ze,w),[j,Yg(Ze)]}}}function l(c,f){var d=i?e:me-e,h=0;return c<-d?h|=1:c>d&&(h|=2),f<-d?h|=4:f>d&&(h|=8),h}return nM(o,a,s,i?[0,-e]:[-me,e-me])}function AV(e,t,n,i,r,s){var o=e[0],a=e[1],u=t[0],l=t[1],c=0,f=1,d=u-o,h=l-a,g;if(g=n-o,!(!d&&g>0)){if(g/=d,d<0){if(g<c)return;g<f&&(f=g)}else if(d>0){if(g>f)return;g>c&&(c=g)}if(g=r-o,!(!d&&g<0)){if(g/=d,d<0){if(g>f)return;g>c&&(c=g)}else if(d>0){if(g<c)return;g<f&&(f=g)}if(g=i-a,!(!h&&g>0)){if(g/=h,h<0){if(g<c)return;g<f&&(f=g)}else if(h>0){if(g>f)return;g>c&&(c=g)}if(g=s-a,!(!h&&g<0)){if(g/=h,h<0){if(g>f)return;g>c&&(c=g)}else if(h>0){if(g<c)return;g<f&&(f=g)}return c>0&&(e[0]=o+c*d,e[1]=a+c*h),f<1&&(t[0]=o+f*d,t[1]=a+f*h),!0}}}}}var of=1e9,o0=-of;function rM(e,t,n,i){function r(l,c){return e<=l&&l<=n&&t<=c&&c<=i}function s(l,c,f,d){var h=0,g=0;if(l==null||(h=o(l,f))!==(g=o(c,f))||u(l,c)<0^f>0)do d.point(h===0||h===3?e:n,h>1?i:t);while((h=(h+f+4)%4)!==g);else d.point(c[0],c[1])}function o(l,c){return we(l[0]-e)<ne?c>0?0:3:we(l[0]-n)<ne?c>0?2:1:we(l[1]-t)<ne?c>0?1:0:c>0?3:2}function a(l,c){return u(l.x,c.x)}function u(l,c){var f=o(l,1),d=o(c,1);return f!==d?f-d:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=Z3(),d,h,g,p,m,y,v,b,x,E,_,w={point:A,lineStart:k,lineEnd:F,polygonStart:O,polygonEnd:C};function A($,R){r($,R)&&c.point($,R)}function S(){for(var $=0,R=0,L=h.length;R<L;++R)for(var U=h[R],H=1,ae=U.length,De=U[0],Oe,Ze,Be=De[0],st=De[1];H<ae;++H)Oe=Be,Ze=st,De=U[H],Be=De[0],st=De[1],Ze<=i?st>i&&(Be-Oe)*(i-Ze)>(st-Ze)*(e-Oe)&&++$:st<=i&&(Be-Oe)*(i-Ze)<(st-Ze)*(e-Oe)&&--$;return $}function O(){c=f,d=[],h=[],_=!0}function C(){var $=S(),R=_&&$,L=(d=iS(d)).length;(R||L)&&(l.polygonStart(),R&&(l.lineStart(),s(null,null,1,l),l.lineEnd()),L&&eM(d,a,$,s,l),l.polygonEnd()),c=l,d=h=g=null}function k(){w.point=j,h&&h.push(g=[]),E=!0,x=!1,v=b=NaN}function F(){d&&(j(p,m),y&&x&&f.rejoin(),d.push(f.result())),w.point=A,x&&c.lineEnd()}function j($,R){var L=r($,R);if(h&&g.push([$,R]),E)p=$,m=R,y=L,E=!1,L&&(c.lineStart(),c.point($,R));else if(L&&x)c.point($,R);else{var U=[v=Math.max(o0,Math.min(of,v)),b=Math.max(o0,Math.min(of,b))],H=[$=Math.max(o0,Math.min(of,$)),R=Math.max(o0,Math.min(of,R))];AV(U,H,e,t,n,i)?(x||(c.lineStart(),c.point(U[0],U[1])),c.point(H[0],H[1]),L||c.lineEnd(),_=!1):L&&(c.lineStart(),c.point($,R),_=!1)}v=$,b=R,x=L}return w}}function sM(e,t,n){var i=Yn(e,t-ne,n).concat(t);return function(r){return i.map(function(s){return[r,s]})}}function oM(e,t,n){var i=Yn(e,t-ne,n).concat(t);return function(r){return i.map(function(s){return[s,r]})}}function OV(){var e,t,n,i,r,s,o,a,u=10,l=u,c=90,f=360,d,h,g,p,m=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return Yn(Ug(i/c)*c,n,c).map(g).concat(Yn(Ug(a/f)*f,o,f).map(p)).concat(Yn(Ug(t/u)*u,e,u).filter(function(b){return we(b%c)>ne}).map(d)).concat(Yn(Ug(s/l)*l,r,l).filter(function(b){return we(b%f)>ne}).map(h))}return y.lines=function(){return v().map(function(b){return{type:"LineString",coordinates:b}})},y.outline=function(){return{type:"Polygon",coordinates:[g(i).concat(p(o).slice(1),g(n).reverse().slice(1),p(a).reverse().slice(1))]}},y.extent=function(b){return arguments.length?y.extentMajor(b).extentMinor(b):y.extentMinor()},y.extentMajor=function(b){return arguments.length?(i=+b[0][0],n=+b[1][0],a=+b[0][1],o=+b[1][1],i>n&&(b=i,i=n,n=b),a>o&&(b=a,a=o,o=b),y.precision(m)):[[i,a],[n,o]]},y.extentMinor=function(b){return arguments.length?(t=+b[0][0],e=+b[1][0],s=+b[0][1],r=+b[1][1],t>e&&(b=t,t=e,e=b),s>r&&(b=s,s=r,r=b),y.precision(m)):[[t,s],[e,r]]},y.step=function(b){return arguments.length?y.stepMajor(b).stepMinor(b):y.stepMinor()},y.stepMajor=function(b){return arguments.length?(c=+b[0],f=+b[1],y):[c,f]},y.stepMinor=function(b){return arguments.length?(u=+b[0],l=+b[1],y):[u,l]},y.precision=function(b){return arguments.length?(m=+b,d=sM(s,r,90),h=oM(t,e,m),g=sM(a,o,90),p=oM(i,n,m),y):m},y.extentMajor([[-180,-90+ne],[180,90-ne]]).extentMinor([[-180,-80-ne],[180,80+ne]])}var af=e=>e,Mx=new ln,Tx=new ln,aM,uM,Nx,Rx,oo={point:jt,lineStart:jt,lineEnd:jt,polygonStart:function(){oo.lineStart=SV,oo.lineEnd=$V},polygonEnd:function(){oo.lineStart=oo.lineEnd=oo.point=jt,Mx.add(we(Tx)),Tx=new ln},result:function(){var e=Mx/2;return Mx=new ln,e}};function SV(){oo.point=CV}function CV(e,t){oo.point=lM,aM=Nx=e,uM=Rx=t}function lM(e,t){Tx.add(Rx*e-Nx*t),Nx=e,Rx=t}function $V(){lM(aM,uM)}var cM=oo,Hu=1/0,a0=Hu,uf=-Hu,u0=uf,FV={point:kV,lineStart:jt,lineEnd:jt,polygonStart:jt,polygonEnd:jt,result:function(){var e=[[Hu,a0],[uf,u0]];return uf=u0=-(a0=Hu=1/0),e}};function kV(e,t){e<Hu&&(Hu=e),e>uf&&(uf=e),t<a0&&(a0=t),t>u0&&(u0=t)}var l0=FV,jx=0,Lx=0,lf=0,c0=0,f0=0,Yu=0,Px=0,Ix=0,cf=0,fM,dM,yr,vr,Pi={point:da,lineStart:hM,lineEnd:gM,polygonStart:function(){Pi.lineStart=TV,Pi.lineEnd=NV},polygonEnd:function(){Pi.point=da,Pi.lineStart=hM,Pi.lineEnd=gM},result:function(){var e=cf?[Px/cf,Ix/cf]:Yu?[c0/Yu,f0/Yu]:lf?[jx/lf,Lx/lf]:[NaN,NaN];return jx=Lx=lf=c0=f0=Yu=Px=Ix=cf=0,e}};function da(e,t){jx+=e,Lx+=t,++lf}function hM(){Pi.point=DV}function DV(e,t){Pi.point=MV,da(yr=e,vr=t)}function MV(e,t){var n=e-yr,i=t-vr,r=hn(n*n+i*i);c0+=r*(yr+e)/2,f0+=r*(vr+t)/2,Yu+=r,da(yr=e,vr=t)}function gM(){Pi.point=da}function TV(){Pi.point=RV}function NV(){pM(fM,dM)}function RV(e,t){Pi.point=pM,da(fM=yr=e,dM=vr=t)}function pM(e,t){var n=e-yr,i=t-vr,r=hn(n*n+i*i);c0+=r*(yr+e)/2,f0+=r*(vr+t)/2,Yu+=r,r=vr*e-yr*t,Px+=r*(yr+e),Ix+=r*(vr+t),cf+=r*3,da(yr=e,vr=t)}var mM=Pi;function yM(e){this._context=e}yM.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,dn);break}}},result:jt};var Bx=new ln,zx,vM,bM,ff,df,d0={point:jt,lineStart:function(){d0.point=jV},lineEnd:function(){zx&&xM(vM,bM),d0.point=jt},polygonStart:function(){zx=!0},polygonEnd:function(){zx=null},result:function(){var e=+Bx;return Bx=new ln,e}};function jV(e,t){d0.point=xM,vM=ff=e,bM=df=t}function xM(e,t){ff-=e,df-=t,Bx.add(hn(ff*ff+df*df)),ff=e,df=t}var wM=d0;function EM(){this._string=[]}EM.prototype={_radius:4.5,_circle:_M(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=_M(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function _M(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function AM(e,t){var n=4.5,i,r;function s(o){return o&&(typeof n=="function"&&r.pointRadius(+n.apply(this,arguments)),Zr(o,i(r))),r.result()}return s.area=function(o){return Zr(o,i(cM)),cM.result()},s.measure=function(o){return Zr(o,i(wM)),wM.result()},s.bounds=function(o){return Zr(o,i(l0)),l0.result()},s.centroid=function(o){return Zr(o,i(mM)),mM.result()},s.projection=function(o){return arguments.length?(i=o==null?(e=null,af):(e=o).stream,s):e},s.context=function(o){return arguments.length?(r=o==null?(t=null,new EM):new yM(t=o),typeof n!="function"&&r.pointRadius(n),s):t},s.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(r.pointRadius(+o),+o),s):n},s.projection(e).context(t)}function h0(e){return function(t){var n=new Ux;for(var i in e)n[i]=e[i];return n.stream=t,n}}function Ux(){}Ux.prototype={constructor:Ux,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function qx(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Zr(n,e.stream(l0)),t(l0.result()),i!=null&&e.clipExtent(i),e}function g0(e,t,n){return qx(e,function(i){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,u=+t[0][1]+(s-o*(i[1][1]+i[0][1]))/2;e.scale(150*o).translate([a,u])},n)}function Wx(e,t,n){return g0(e,[[0,0],t],n)}function Gx(e,t,n){return qx(e,function(i){var r=+t,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];e.scale(150*s).translate([o,a])},n)}function Hx(e,t,n){return qx(e,function(i){var r=+t,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var OM=16,LV=ie(30*ye);function SM(e,t){return+t?IV(e,t):PV(e)}function PV(e){return h0({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function IV(e,t){function n(i,r,s,o,a,u,l,c,f,d,h,g,p,m){var y=l-i,v=c-r,b=y*y+v*v;if(b>4*t&&p--){var x=o+d,E=a+h,_=u+g,w=hn(x*x+E*E+_*_),A=Tn(_/=w),S=we(we(_)-1)<ne||we(s-f)<ne?(s+f)/2:di(E,x),O=e(S,A),C=O[0],k=O[1],F=C-i,j=k-r,$=v*F-y*j;($*$/b>t||we((y*F+v*j)/b-.5)>.3||o*d+a*h+u*g<LV)&&(n(i,r,s,o,a,u,C,k,S,x/=w,E/=w,_,p,m),m.point(C,k),n(C,k,S,x,E,_,l,c,f,d,h,g,p,m))}}return function(i){var r,s,o,a,u,l,c,f,d,h,g,p,m={point:y,lineStart:v,lineEnd:x,polygonStart:function(){i.polygonStart(),m.lineStart=E},polygonEnd:function(){i.polygonEnd(),m.lineStart=v}};function y(A,S){A=e(A,S),i.point(A[0],A[1])}function v(){f=NaN,m.point=b,i.lineStart()}function b(A,S){var O=ca([A,S]),C=e(A,S);n(f,d,c,h,g,p,f=C[0],d=C[1],c=A,h=O[0],g=O[1],p=O[2],OM,i),i.point(f,d)}function x(){m.point=y,i.lineEnd()}function E(){v(),m.point=_,m.lineEnd=w}function _(A,S){b(r=A,S),s=f,o=d,a=h,u=g,l=p,m.point=b}function w(){n(f,d,c,h,g,p,s,o,r,a,u,l,OM,i),m.lineEnd=x,x()}return m}}var BV=h0({point:function(e,t){this.stream.point(e*ye,t*ye)}});function zV(e){return h0({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function UV(e,t,n,i,r){function s(o,a){return o*=i,a*=r,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*i,(n-a)/e*r]},s}function CM(e,t,n,i,r,s){if(!s)return UV(e,t,n,i,r);var o=ie(s),a=Q(s),u=o*e,l=a*e,c=o/e,f=a/e,d=(a*n-o*t)/e,h=(a*t+o*n)/e;function g(p,m){return p*=i,m*=r,[u*p-l*m+t,n-l*p-u*m]}return g.invert=function(p,m){return[i*(c*p-f*m+d),r*(h-f*p-c*m)]},g}function br(e){return $M(function(){return e})()}function $M(e){var t,n=150,i=480,r=250,s=0,o=0,a=0,u=0,l=0,c,f=0,d=1,h=1,g=null,p=iM,m=null,y,v,b,x=af,E=.5,_,w,A,S,O;function C($){return A($[0]*ye,$[1]*ye)}function k($){return $=A.invert($[0],$[1]),$&&[$[0]*ut,$[1]*ut]}C.stream=function($){return S&&O===$?S:S=BV(zV(c)(p(_(x(O=$)))))},C.preclip=function($){return arguments.length?(p=$,g=void 0,j()):p},C.postclip=function($){return arguments.length?(x=$,m=y=v=b=null,j()):x},C.clipAngle=function($){return arguments.length?(p=+$?_V(g=$*ye):(g=null,iM),j()):g*ut},C.clipExtent=function($){return arguments.length?(x=$==null?(m=y=v=b=null,af):rM(m=+$[0][0],y=+$[0][1],v=+$[1][0],b=+$[1][1]),j()):m==null?null:[[m,y],[v,b]]},C.scale=function($){return arguments.length?(n=+$,F()):n},C.translate=function($){return arguments.length?(i=+$[0],r=+$[1],F()):[i,r]},C.center=function($){return arguments.length?(s=$[0]%360*ye,o=$[1]%360*ye,F()):[s*ut,o*ut]},C.rotate=function($){return arguments.length?(a=$[0]%360*ye,u=$[1]%360*ye,l=$.length>2?$[2]%360*ye:0,F()):[a*ut,u*ut,l*ut]},C.angle=function($){return arguments.length?(f=$%360*ye,F()):f*ut},C.reflectX=function($){return arguments.length?(d=$?-1:1,F()):d<0},C.reflectY=function($){return arguments.length?(h=$?-1:1,F()):h<0},C.precision=function($){return arguments.length?(_=SM(w,E=$*$),j()):hn(E)},C.fitExtent=function($,R){return g0(C,$,R)},C.fitSize=function($,R){return Wx(C,$,R)},C.fitWidth=function($,R){return Gx(C,$,R)},C.fitHeight=function($,R){return Hx(C,$,R)};function F(){var $=CM(n,0,0,d,h,f).apply(null,t(s,o)),R=CM(n,i-$[0],r-$[1],d,h,f);return c=V3(a,u,l),w=Fx(t,R),A=Fx(c,w),_=SM(w,E),j()}function j(){return S=O=null,C}return function(){return t=e.apply(this,arguments),C.invert=t.invert&&k,F()}}function Yx(e){var t=0,n=me/3,i=$M(e),r=i(t,n);return r.parallels=function(s){return arguments.length?i(t=s[0]*ye,n=s[1]*ye):[t*ut,n*ut]},r}function qV(e){var t=ie(e);function n(i,r){return[i*t,Q(r)/t]}return n.invert=function(i,r){return[i/t,Tn(r*t)]},n}function WV(e,t){var n=Q(e),i=(n+Q(t))/2;if(we(i)<ne)return qV(e);var r=1+n*(2*i-n),s=hn(r)/i;function o(a,u){var l=hn(r-2*i*Q(u))/i;return[l*Q(a*=i),s-l*ie(a)]}return o.invert=function(a,u){var l=s-u,c=di(a,we(l))*hi(l);return l*i<0&&(c-=me*hi(a)*hi(l)),[c/i,Tn((r-(a*a+l*l)*i*i)/(2*i))]},o}function p0(){return Yx(WV).scale(155.424).center([0,33.6442])}function FM(){return p0().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function GV(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function HV(){var e,t,n=FM(),i,r=p0().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=p0().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,l={point:function(d,h){u=[d,h]}};function c(d){var h=d[0],g=d[1];return u=null,i.point(h,g),u||(s.point(h,g),u)||(a.point(h,g),u)}c.invert=function(d){var h=n.scale(),g=n.translate(),p=(d[0]-g[0])/h,m=(d[1]-g[1])/h;return(m>=.12&&m<.234&&p>=-.425&&p<-.214?r:m>=.166&&m<.234&&p>=-.214&&p<-.115?o:n).invert(d)},c.stream=function(d){return e&&t===d?e:e=GV([n.stream(t=d),r.stream(d),o.stream(d)])},c.precision=function(d){return arguments.length?(n.precision(d),r.precision(d),o.precision(d),f()):n.precision()},c.scale=function(d){return arguments.length?(n.scale(d),r.scale(d*.35),o.scale(d),c.translate(n.translate())):n.scale()},c.translate=function(d){if(!arguments.length)return n.translate();var h=n.scale(),g=+d[0],p=+d[1];return i=n.translate(d).clipExtent([[g-.455*h,p-.238*h],[g+.455*h,p+.238*h]]).stream(l),s=r.translate([g-.307*h,p+.201*h]).clipExtent([[g-.425*h+ne,p+.12*h+ne],[g-.214*h-ne,p+.234*h-ne]]).stream(l),a=o.translate([g-.205*h,p+.212*h]).clipExtent([[g-.214*h+ne,p+.166*h+ne],[g-.115*h-ne,p+.234*h-ne]]).stream(l),f()},c.fitExtent=function(d,h){return g0(c,d,h)},c.fitSize=function(d,h){return Wx(c,d,h)},c.fitWidth=function(d,h){return Gx(c,d,h)},c.fitHeight=function(d,h){return Hx(c,d,h)};function f(){return e=t=null,c}return c.scale(1070)}function kM(e){return function(t,n){var i=ie(t),r=ie(n),s=e(i*r);return s===1/0?[2,0]:[s*r*Q(t),s*Q(n)]}}function hf(e){return function(t,n){var i=hn(t*t+n*n),r=e(i),s=Q(r),o=ie(r);return[di(t*s,i*o),Tn(i&&n*s/i)]}}var DM=kM(function(e){return hn(2/(1+e))});DM.invert=hf(function(e){return 2*Tn(e/2)});function YV(){return br(DM).scale(124.75).clipAngle(180-.001)}var MM=kM(function(e){return(e=F3(e))&&e/Q(e)});MM.invert=hf(function(e){return e});function VV(){return br(MM).scale(79.4188).clipAngle(180-.001)}function m0(e,t){return[e,qg(vx((nt+t)/2))]}m0.invert=function(e,t){return[e,2*qu($3(t))-nt]};function XV(){return TM(m0).scale(961/dn)}function TM(e){var t=br(e),n=t.center,i=t.scale,r=t.translate,s=t.clipExtent,o=null,a,u,l;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=a=u=l=null:(o=+f[0][0],a=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):o==null?null:[[o,a],[u,l]]};function c(){var f=me*i(),d=t(pV(t.rotate()).invert([0,0]));return s(o==null?[[d[0]-f,d[1]-f],[d[0]+f,d[1]+f]]:e===m0?[[Math.max(d[0]-f,o),a],[Math.min(d[0]+f,u),l]]:[[o,Math.max(d[1]-f,a)],[u,Math.min(d[1]+f,l)]])}return c()}function y0(e){return vx((nt+e)/2)}function KV(e,t){var n=ie(e),i=e===t?Q(e):qg(n/ie(t))/qg(y0(t)/y0(e)),r=n*yx(y0(e),i)/i;if(!i)return m0;function s(o,a){r>0?a<-nt+ne&&(a=-nt+ne):a>nt-ne&&(a=nt-ne);var u=r/yx(y0(a),i);return[u*Q(i*o),r-u*ie(i*o)]}return s.invert=function(o,a){var u=r-a,l=hi(i)*hn(o*o+u*u),c=di(o,we(u))*hi(u);return u*i<0&&(c-=me*hi(o)*hi(u)),[c/i,2*qu(yx(r/l,1/i))-nt]},s}function JV(){return Yx(KV).scale(109.5).parallels([30,30])}function v0(e,t){return[e,t]}v0.invert=v0;function QV(){return br(v0).scale(152.63)}function ZV(e,t){var n=ie(e),i=e===t?Q(e):(n-ie(t))/(t-e),r=n/i+e;if(we(i)<ne)return v0;function s(o,a){var u=r-a,l=i*o;return[u*Q(l),r-u*ie(l)]}return s.invert=function(o,a){var u=r-a,l=di(o,we(u))*hi(u);return u*i<0&&(l-=me*hi(o)*hi(u)),[l/i,r-hi(i)*hn(o*o+u*u)]},s}function eX(){return Yx(ZV).scale(131.154).center([0,13.9389])}var gf=1.340264,pf=-.081106,mf=893e-6,yf=.003796,b0=hn(3)/2,tX=12;function NM(e,t){var n=Tn(b0*Q(t)),i=n*n,r=i*i*i;return[e*ie(n)/(b0*(gf+3*pf*i+r*(7*mf+9*yf*i))),n*(gf+pf*i+r*(mf+yf*i))]}NM.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,s=0,o,a,u;s<tX&&(a=n*(gf+pf*i+r*(mf+yf*i))-t,u=gf+3*pf*i+r*(7*mf+9*yf*i),n-=o=a/u,i=n*n,r=i*i*i,!(we(o)<Bg));++s);return[b0*e*(gf+3*pf*i+r*(7*mf+9*yf*i))/ie(n),Tn(Q(n)/b0)]};function nX(){return br(NM).scale(177.158)}function RM(e,t){var n=ie(t),i=ie(e)*n;return[n*Q(e)/i,Q(t)/i]}RM.invert=hf(qu);function iX(){return br(RM).scale(144.049).clipAngle(60)}function rX(){var e=1,t=0,n=0,i=1,r=1,s=0,o,a,u=null,l,c,f,d=1,h=1,g=h0({point:function(x,E){var _=b([x,E]);this.stream.point(_[0],_[1])}}),p=af,m,y;function v(){return d=e*i,h=e*r,m=y=null,b}function b(x){var E=x[0]*d,_=x[1]*h;if(s){var w=_*o-E*a;E=E*o+_*a,_=w}return[E+t,_+n]}return b.invert=function(x){var E=x[0]-t,_=x[1]-n;if(s){var w=_*o+E*a;E=E*o-_*a,_=w}return[E/d,_/h]},b.stream=function(x){return m&&y===x?m:m=g(p(y=x))},b.postclip=function(x){return arguments.length?(p=x,u=l=c=f=null,v()):p},b.clipExtent=function(x){return arguments.length?(p=x==null?(u=l=c=f=null,af):rM(u=+x[0][0],l=+x[0][1],c=+x[1][0],f=+x[1][1]),v()):u==null?null:[[u,l],[c,f]]},b.scale=function(x){return arguments.length?(e=+x,v()):e},b.translate=function(x){return arguments.length?(t=+x[0],n=+x[1],v()):[t,n]},b.angle=function(x){return arguments.length?(s=x%360*ye,a=Q(s),o=ie(s),v()):s*ut},b.reflectX=function(x){return arguments.length?(i=x?-1:1,v()):i<0},b.reflectY=function(x){return arguments.length?(r=x?-1:1,v()):r<0},b.fitExtent=function(x,E){return g0(b,x,E)},b.fitSize=function(x,E){return Wx(b,x,E)},b.fitWidth=function(x,E){return Gx(b,x,E)},b.fitHeight=function(x,E){return Hx(b,x,E)},b}function jM(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}jM.invert=function(e,t){var n=t,i=25,r;do{var s=n*n,o=s*s;n-=r=(n*(1.007226+s*(.015085+o*(-.044475+.028874*s-.005916*o)))-t)/(1.007226+s*(.015085*3+o*(-.044475*7+.028874*9*s-.005916*11*o)))}while(we(r)>ne&&--i>0);return[e/(.8707+(s=n*n)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),n]};function sX(){return br(jM).scale(175.295)}function LM(e,t){return[ie(t)*Q(e),Q(t)]}LM.invert=hf(Tn);function oX(){return br(LM).scale(249.5).clipAngle(90+ne)}function PM(e,t){var n=ie(t),i=1+ie(e)*n;return[n*Q(e)/i,Q(t)/i]}PM.invert=hf(function(e){return 2*qu(e)});function aX(){return br(PM).scale(250).clipAngle(142)}function IM(e,t){return[qg(vx((nt+t)/2)),-e]}IM.invert=function(e,t){return[-t,2*qu($3(e))-nt]};function uX(){var e=TM(IM),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var lX=Math.abs,Vx=Math.cos,x0=Math.sin,cX=1e-6,BM=Math.PI,Xx=BM/2,zM=fX(2);function UM(e){return e>1?Xx:e<-1?-Xx:Math.asin(e)}function fX(e){return e>0?Math.sqrt(e):0}function dX(e,t){var n=e*x0(t),i=30,r;do t-=r=(t+x0(t)-n)/(1+Vx(t));while(lX(r)>cX&&--i>0);return t/2}function hX(e,t,n){function i(r,s){return[e*r*Vx(s=dX(n,s)),t*x0(s)]}return i.invert=function(r,s){return s=UM(s/t),[r/(e*Vx(s)),UM((2*s+x0(2*s))/n)]},i}var gX=hX(zM/Xx,zM,BM);function pX(){return br(gX).scale(169.529)}const mX=AM(),Kx=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function yX(e,t){return function n(){const i=t();return i.type=e,i.path=AM().projection(i),i.copy=i.copy||function(){const r=n();return Kx.forEach(s=>{i[s]&&r[s](i[s]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function Jx(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(w0[e]=yX(e,t),this):w0[e]||null}function qM(e){return e&&e.path||mX}const w0={albers:FM,albersusa:HV,azimuthalequalarea:YV,azimuthalequidistant:VV,conicconformal:JV,conicequalarea:p0,conicequidistant:eX,equalEarth:nX,equirectangular:QV,gnomonic:iX,identity:rX,mercator:XV,mollweide:pX,naturalEarth1:sX,orthographic:oX,stereographic:aX,transversemercator:uX};for(const e in w0)Jx(e,w0[e]);function vX(){}const ns=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function WM(){var e=1,t=1,n=a;function i(u,l){return l.map(c=>r(u,c))}function r(u,l){var c=[],f=[];return s(u,l,d=>{n(d,u,l),bX(d)>0?c.push([d]):f.push(d)}),f.forEach(d=>{for(var h=0,g=c.length,p;h<g;++h)if(xX((p=c[h])[0],d)!==-1){p.push(d);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function s(u,l,c){var f=new Array,d=new Array,h,g,p,m,y,v;for(h=g=-1,m=u[0]>=l,ns[m<<1].forEach(b);++h<e-1;)p=m,m=u[h+1]>=l,ns[p|m<<1].forEach(b);for(ns[m<<0].forEach(b);++g<t-1;){for(h=-1,m=u[g*e+e]>=l,y=u[g*e]>=l,ns[m<<1|y<<2].forEach(b);++h<e-1;)p=m,m=u[g*e+e+h+1]>=l,v=y,y=u[g*e+h+1]>=l,ns[p|m<<1|y<<2|v<<3].forEach(b);ns[m|y<<3].forEach(b)}for(h=-1,y=u[g*e]>=l,ns[y<<2].forEach(b);++h<e-1;)v=y,y=u[g*e+h+1]>=l,ns[y<<2|v<<3].forEach(b);ns[y<<3].forEach(b);function b(x){var E=[x[0][0]+h,x[0][1]+g],_=[x[1][0]+h,x[1][1]+g],w=o(E),A=o(_),S,O;(S=d[w])?(O=f[A])?(delete d[S.end],delete f[O.start],S===O?(S.ring.push(_),c(S.ring)):f[S.start]=d[O.end]={start:S.start,end:O.end,ring:S.ring.concat(O.ring)}):(delete d[S.end],S.ring.push(_),d[S.end=A]=S):(S=f[A])?(O=d[w])?(delete f[S.start],delete d[O.end],S===O?(S.ring.push(_),c(S.ring)):f[O.start]=d[S.end]={start:O.start,end:S.end,ring:O.ring.concat(S.ring)}):(delete f[S.start],S.ring.unshift(E),f[S.start=w]=S):f[w]=d[A]={start:w,end:A,ring:[E,_]}}}function o(u){return u[0]*2+u[1]*(e+1)*4}function a(u,l,c){u.forEach(f=>{var d=f[0],h=f[1],g=d|0,p=h|0,m,y=l[p*e+g];d>0&&d<e&&g===d&&(m=l[p*e+g-1],f[0]=d+(c-m)/(y-m)-.5),h>0&&h<t&&p===h&&(m=l[(p-1)*e+g],f[1]=h+(c-m)/(y-m)-.5)})}return i.contour=r,i.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||N("invalid size"),e=l,t=c,i},i.smooth=function(u){return arguments.length?(n=u?a:vX,i):n===a},i}function bX(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function xX(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=wX(e,t[n]))return r;return 0}function wX(e,t){for(var n=t[0],i=t[1],r=-1,s=0,o=e.length,a=o-1;s<o;a=s++){var u=e[s],l=u[0],c=u[1],f=e[a],d=f[0],h=f[1];if(EX(u,f,t))return 0;c>i!=h>i&&n<(d-l)*(i-c)/(h-c)+l&&(r=-r)}return r}function EX(e,t,n){var i;return _X(e,t,n)&&AX(e[i=+(e[0]===t[0])],n[i],t[i])}function _X(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}function AX(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function GM(e,t,n){return function(i){var r=nr(i),s=n?Math.min(r[0],0):r[0],o=r[1],a=o-s,u=t?ks(s,o,e):a/(e+1);return Yn(s+u,o,u)}}function Qx(e){D.call(this,null,e)}Qx.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};z(Qx,D,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||un,s=WM().smooth(e.smooth!==!1),o=e.thresholds||OX(i,r,e),a=e.as===null?null:e.as||"contour",u=[];return i.forEach(l=>{const c=r(l),f=s.size([c.width,c.height])(c.values,K(o)?o:o(c.values));SX(f,c,l,e),f.forEach(d=>{u.push(_h(l,Me(a!=null?{[a]:d}:d)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function OX(e,t,n){const i=GM(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>qo(t(r).values)))}function SX(e,t,n,i){let r=i.scale||t.scale,s=i.translate||t.translate;if(ge(r)&&(r=r(n,i)),ge(s)&&(s=s(n,i)),(r===1||r==null)&&!s)return;const o=($s(r)?r:r[0])||1,a=($s(r)?r:r[1])||1,u=s&&s[0]||0,l=s&&s[1]||0;e.forEach(HM(t,o,a,u,l))}function HM(e,t,n,i,r){const s=e.x1||0,o=e.y1||0,a=t*n<0;function u(f){f.forEach(l)}function l(f){a&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-s)*t+i,f[1]=(f[1]-o)*n+r}return function(f){return f.coordinates.forEach(u),f}}function YM(e,t,n){const i=e>=0?e:_y(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Zx(e){return ge(e)?e:qt(+e)}function VM(){var e=u=>u[0],t=u=>u[1],n=uu,i=[-1,-1],r=960,s=500,o=2;function a(u,l){const c=YM(i[0],u,e)>>o,f=YM(i[1],u,t)>>o,d=c?c+2:0,h=f?f+2:0,g=2*d+(r>>o),p=2*h+(s>>o),m=new Float32Array(g*p),y=new Float32Array(g*p);let v=m;u.forEach(x=>{const E=d+(+e(x)>>o),_=h+(+t(x)>>o);E>=0&&E<g&&_>=0&&_<p&&(m[E+_*g]+=+n(x))}),c>0&&f>0?(Vu(g,p,m,y,c),Xu(g,p,y,m,f),Vu(g,p,m,y,c),Xu(g,p,y,m,f),Vu(g,p,m,y,c),Xu(g,p,y,m,f)):c>0?(Vu(g,p,m,y,c),Vu(g,p,y,m,c),Vu(g,p,m,y,c),v=y):f>0&&(Xu(g,p,m,y,f),Xu(g,p,y,m,f),Xu(g,p,m,y,f),v=y);const b=l?Math.pow(2,-2*o):1/rS(v);for(let x=0,E=g*p;x<E;++x)v[x]*=b;return{values:v,scale:1<<o,width:g,height:p,x1:d,y1:h,x2:d+(r>>o),y2:h+(s>>o)}}return a.x=function(u){return arguments.length?(e=Zx(u),a):e},a.y=function(u){return arguments.length?(t=Zx(u),a):t},a.weight=function(u){return arguments.length?(n=Zx(u),a):n},a.size=function(u){if(!arguments.length)return[r,s];var l=+u[0],c=+u[1];return l>=0&&c>=0||N("invalid size"),r=l,s=c,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||N("invalid cell size"),o=Math.floor(Math.log(u)/Math.LN2),a):1<<o},a.bandwidth=function(u){return arguments.length?(u=re(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&N("invalid bandwidth"),i=u,a):i},a}function Vu(e,t,n,i,r){const s=(r<<1)+1;for(let o=0;o<t;++o)for(let a=0,u=0;a<e+r;++a)a<e&&(u+=n[a+o*e]),a>=r&&(a>=s&&(u-=n[a-s+o*e]),i[a-r+o*e]=u/Math.min(a+1,e-1+s-a,s))}function Xu(e,t,n,i,r){const s=(r<<1)+1;for(let o=0;o<e;++o)for(let a=0,u=0;a<t+r;++a)a<t&&(u+=n[o+a*e]),a>=r&&(a>=s&&(u-=n[o+(a-s)*e]),i[o+(a-r)*e]=u/Math.min(a+1,t-1+s-a,s))}function e2(e){D.call(this,null,e)}e2.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const CX=["x","y","weight","size","cellSize","bandwidth"];function XM(e,t){return CX.forEach(n=>t[n]!=null?e[n](t[n]):0),e}z(e2,D,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=$X(i,e.groupby),s=(e.groupby||[]).map(tt),o=XM(VM(),e),a=e.as||"grid",u=[];function l(c,f){for(let d=0;d<s.length;++d)c[s[d]]=f[d];return c}return u=r.map(c=>Me(l({[a]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function $X(e,t){var n=[],i=c=>c(a),r,s,o,a,u,l;if(t==null)n.push(e);else for(r={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function t2(e){D.call(this,null,e)}t2.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};z(t2,D,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=WM().smooth(e.smooth!==!1),r=e.values,s=e.thresholds||GM(e.count||10,e.nice,!!r),o=e.size,a,u;return r||(r=t.materialize(t.SOURCE).source,a=XM(VM(),e)(r,!0),u=HM(a,a.scale||1,a.scale||1,0,0),o=[a.width,a.height],r=a.values),s=K(s)?s:s(r),r=i.size(o)(r,s),u&&r.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(Me),n}});const n2="Feature",i2="FeatureCollection",FX="MultiPoint";function r2(e){D.call(this,null,e)}r2.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};z(r2,D,{transform(e,t){var n=this._features,i=this._points,r=e.fields,s=r&&r[0],o=r&&r[1],a=e.geojson||!r&&un,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(zt(a))||s&&t.modified(zt(s))||o&&t.modified(zt(o)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=i=[]),a&&t.visit(u,c=>n.push(a(c))),s&&o&&(t.visit(u,c=>{var f=s(c),d=o(c);f!=null&&d!=null&&(f=+f)===f&&(d=+d)===d&&i.push([f,d])}),n=n.concat({type:n2,geometry:{type:FX,coordinates:i}})),this.value={type:i2,features:n}}});function s2(e){D.call(this,null,e)}s2.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};z(s2,D,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||un,s=e.as||"path",o=n.SOURCE;!i||e.modified()?(this.value=i=qM(e.projection),n.materialize().reflow()):o=r===un||t.modified(r.fields)?n.ADD_MOD:n.ADD;const a=kX(i,e.pointRadius);return n.visit(o,u=>u[s]=i(r(u))),i.pointRadius(a),n.modifies(s)}});function kX(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function o2(e){D.call(this,null,e)}o2.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};z(o2,D,{transform(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],s=e.as||["x","y"],o=s[0],a=s[1],u;function l(c){const f=n([i(c),r(c)]);f?(c[o]=f[0],c[a]=f[1]):(c[o]=void 0,c[a]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(i.fields)||t.modified(r.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(s)}});function a2(e){D.call(this,null,e)}a2.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};z(a2,D,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",s=n.ADD;return(!i||e.modified())&&(this.value=i=DX(qM(e.projection),e.field||Cn("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,o=>o[r]=i),n.modifies(r)}});function DX(e,t,n){const i=n==null?r=>e(t(r)):r=>{var s=e.pointRadius(),o=e.pointRadius(n)(t(r));return e.pointRadius(s),o};return i.context=r=>(e.context(r),i),i}function u2(e){D.call(this,[],e),this.generator=OV()}u2.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};z(u2,D,{transform(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(const s in e)ge(i[s])&&i[s](e[s]);return r=i(),n.length?t.mod.push(wC(n[0],r)):t.add.push(Me(r)),n[0]=r,t}});function l2(e){D.call(this,null,e)}l2.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};z(l2,D,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||un,s=TX(e.opacity,e),o=MX(e.color,e),a=e.as||"image",u={$x:0,$y:0,$value:0,$max:i?qo(n.map(l=>qo(r(l).values))):0};return n.forEach(l=>{const c=r(l),f=de({},l,u);i||(f.$max=qo(c.values||[])),l[a]=NX(c,f,o.dep?o:qt(o(f)),s.dep?s:qt(s(f)))}),t.reflow(!0).modifies(a)}});function MX(e,t){let n;return ge(e)?(n=i=>qs(e(i,t)),n.dep=KM(e)):n=qt(qs(e||"#888")),n}function TX(e,t){let n;return ge(e)?(n=i=>e(i,t),n.dep=KM(e)):e?n=qt(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function KM(e){if(!ge(e))return!1;const t=Fi(zt(e));return t.$x||t.$y||t.$value||t.$max}function NX(e,t,n,i){const r=e.width,s=e.height,o=e.x1||0,a=e.y1||0,u=e.x2||r,l=e.y2||s,c=e.values,f=c?m=>c[m]:Os,d=Au(u-o,l-a),h=d.getContext("2d"),g=h.getImageData(0,0,u-o,l-a),p=g.data;for(let m=a,y=0;m<l;++m){t.$y=m-a;for(let v=o,b=m*r;v<u;++v,y+=4){t.$x=v-o,t.$value=f(v+b);const x=n(t);p[y+0]=x.r,p[y+1]=x.g,p[y+2]=x.b,p[y+3]=~~(255*i(t))}}return h.putImageData(g,0,0),d}function JM(e){D.call(this,null,e),this.modified(!0)}z(JM,D,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=jX(e.type),Kx.forEach(i=>{e[i]!=null&&QM(n,i,e[i])})):Kx.forEach(i=>{e.modified(i)&&QM(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&RX(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function RX(e,t){const n=LX(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function jX(e){const t=Jx((e||"mercator").toLowerCase());return t||N("Unrecognized projection type: "+e),t()}function QM(e,t,n){ge(e[t])&&e[t](n)}function LX(e){return e=re(e),e.length===1?e[0]:{type:i2,features:e.reduce((t,n)=>t.concat(PX(n)),[])}}function PX(e){return e.type===i2?e.features:re(e).filter(t=>t!=null).map(t=>t.type===n2?t:{type:n2,geometry:t})}var IX=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",contour:t2,geojson:r2,geopath:s2,geopoint:o2,geoshape:a2,graticule:u2,heatmap:l2,isocontour:Qx,kde2d:e2,projection:JM});function BX(e,t){var n,i=1;e==null&&(e=0),t==null&&(t=0);function r(){var s,o=n.length,a,u=0,l=0;for(s=0;s<o;++s)a=n[s],u+=a.x,l+=a.y;for(u=(u/o-e)*i,l=(l/o-t)*i,s=0;s<o;++s)a=n[s],a.x-=u,a.y-=l}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(e=+s,r):e},r.y=function(s){return arguments.length?(t=+s,r):t},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function zX(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return ZM(this.cover(t,n),t,n,e)}function ZM(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,s=e._root,o={data:i},a=e._x0,u=e._y0,l=e._x1,c=e._y1,f,d,h,g,p,m,y,v;if(!s)return e._root=o,e;for(;s.length;)if((p=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d,r=s,!(s=s[y=m<<1|p]))return r[y]=o,e;if(h=+e._x.call(null,s.data),g=+e._y.call(null,s.data),t===h&&n===g)return o.next=s,r?r[y]=o:e._root=o,e;do r=r?r[y]=new Array(4):e._root=new Array(4),(p=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(d=(u+c)/2))?u=d:c=d;while((y=m<<1|p)==(v=(g>=d)<<1|h>=f));return r[v]=s,r[y]=o,e}function UX(e){var t,n,i=e.length,r,s,o=new Array(i),a=new Array(i),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(s=+this._y.call(null,t))||(o[n]=r,a[n]=s,r<u&&(u=r),r>c&&(c=r),s<l&&(l=s),s>f&&(f=s));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<i;++n)ZM(this,o[n],a[n],e[n]);return this}function qX(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,s=(i=Math.floor(t))+1;else{for(var o=r-n||1,a=this._root,u,l;n>e||e>=r||i>t||t>=s;)switch(l=(t<i)<<1|e<n,u=new Array(4),u[l]=a,a=u,o*=2,l){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function WX(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function GX(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function yn(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function HX(e,t,n){var i,r=this._x0,s=this._y0,o,a,u,l,c=this._x1,f=this._y1,d=[],h=this._root,g,p;for(h&&d.push(new yn(h,r,s,c,f)),n==null?n=1/0:(r=e-n,s=t-n,c=e+n,f=t+n,n*=n);g=d.pop();)if(!(!(h=g.node)||(o=g.x0)>c||(a=g.y0)>f||(u=g.x1)<r||(l=g.y1)<s))if(h.length){var m=(o+u)/2,y=(a+l)/2;d.push(new yn(h[3],m,y,u,l),new yn(h[2],o,y,m,l),new yn(h[1],m,a,u,y),new yn(h[0],o,a,m,y)),(p=(t>=y)<<1|e>=m)&&(g=d[d.length-1],d[d.length-1]=d[d.length-1-p],d[d.length-1-p]=g)}else{var v=e-+this._x.call(null,h.data),b=t-+this._y.call(null,h.data),x=v*v+b*b;if(x<n){var E=Math.sqrt(n=x);r=e-E,s=t-E,c=e+E,f=t+E,i=h.data}}return i}function YX(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,s,o=this._x0,a=this._y0,u=this._x1,l=this._y1,c,f,d,h,g,p,m,y;if(!n)return this;if(n.length)for(;;){if((g=c>=(d=(o+u)/2))?o=d:u=d,(p=f>=(h=(a+l)/2))?a=h:l=h,t=n,!(n=n[m=p<<1|g]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,y=m)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):t?(s?t[m]=s:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=s,this)}function VX(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function XX(){return this._root}function KX(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function JX(e){var t=[],n,i=this._root,r,s,o,a,u;for(i&&t.push(new yn(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,s=n.x0,o=n.y0,a=n.x1,u=n.y1)&&i.length){var l=(s+a)/2,c=(o+u)/2;(r=i[3])&&t.push(new yn(r,l,c,a,u)),(r=i[2])&&t.push(new yn(r,s,c,l,u)),(r=i[1])&&t.push(new yn(r,l,o,a,c)),(r=i[0])&&t.push(new yn(r,s,o,l,c))}return this}function QX(e){var t=[],n=[],i;for(this._root&&t.push(new yn(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.y0,u=i.x1,l=i.y1,c=(o+u)/2,f=(a+l)/2;(s=r[0])&&t.push(new yn(s,o,a,c,f)),(s=r[1])&&t.push(new yn(s,c,a,u,f)),(s=r[2])&&t.push(new yn(s,o,f,c,l)),(s=r[3])&&t.push(new yn(s,c,f,u,l))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function ZX(e){return e[0]}function eK(e){return arguments.length?(this._x=e,this):this._x}function tK(e){return e[1]}function nK(e){return arguments.length?(this._y=e,this):this._y}function c2(e,t,n){var i=new f2(t==null?ZX:t,n==null?tK:n,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function f2(e,t,n,i,r,s){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function e5(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var vn=c2.prototype=f2.prototype;vn.copy=function(){var e=new f2(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=e5(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=e5(i));return e};vn.add=zX;vn.addAll=UX;vn.cover=qX;vn.data=WX;vn.extent=GX;vn.find=HX;vn.remove=YX;vn.removeAll=VX;vn.root=XX;vn.size=KX;vn.visit=JX;vn.visitAfter=QX;vn.x=eK;vn.y=nK;function bn(e){return function(){return e}}function ao(e){return(e()-.5)*1e-6}function iK(e){return e.x+e.vx}function rK(e){return e.y+e.vy}function sK(e){var t,n,i,r=1,s=1;typeof e!="function"&&(e=bn(e==null?1:+e));function o(){for(var l,c=t.length,f,d,h,g,p,m,y=0;y<s;++y)for(f=c2(t,iK,rK).visitAfter(a),l=0;l<c;++l)d=t[l],p=n[d.index],m=p*p,h=d.x+d.vx,g=d.y+d.vy,f.visit(v);function v(b,x,E,_,w){var A=b.data,S=b.r,O=p+S;if(A){if(A.index>d.index){var C=h-A.x-A.vx,k=g-A.y-A.vy,F=C*C+k*k;F<O*O&&(C===0&&(C=ao(i),F+=C*C),k===0&&(k=ao(i),F+=k*k),F=(O-(F=Math.sqrt(F)))/F*r,d.vx+=(C*=F)*(O=(S*=S)/(m+S)),d.vy+=(k*=F)*O,A.vx-=C*(O=1-O),A.vy-=k*O)}return}return x>h+O||_<h-O||E>g+O||w<g-O}}function a(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(!!t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return o.initialize=function(l,c){t=l,i=c,u()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(r=+l,o):r},o.radius=function(l){return arguments.length?(e=typeof l=="function"?l:bn(+l),u(),o):e},o}function oK(e){return e.index}function t5(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function aK(e){var t=oK,n=f,i,r=bn(30),s,o,a,u,l,c=1;e==null&&(e=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function d(m){for(var y=0,v=e.length;y<c;++y)for(var b=0,x,E,_,w,A,S,O;b<v;++b)x=e[b],E=x.source,_=x.target,w=_.x+_.vx-E.x-E.vx||ao(l),A=_.y+_.vy-E.y-E.vy||ao(l),S=Math.sqrt(w*w+A*A),S=(S-s[b])/S*m*i[b],w*=S,A*=S,_.vx-=w*(O=u[b]),_.vy-=A*O,E.vx+=w*(O=1-O),E.vy+=A*O}function h(){if(!!o){var m,y=o.length,v=e.length,b=new Map(o.map((E,_)=>[t(E,_,o),E])),x;for(m=0,a=new Array(y);m<v;++m)x=e[m],x.index=m,typeof x.source!="object"&&(x.source=t5(b,x.source)),typeof x.target!="object"&&(x.target=t5(b,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(m=0,u=new Array(v);m<v;++m)x=e[m],u[m]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);i=new Array(v),g(),s=new Array(v),p()}}function g(){if(!!o)for(var m=0,y=e.length;m<y;++m)i[m]=+n(e[m],m,e)}function p(){if(!!o)for(var m=0,y=e.length;m<y;++m)s[m]=+r(e[m],m,e)}return d.initialize=function(m,y){o=m,l=y,h()},d.links=function(m){return arguments.length?(e=m,h(),d):e},d.id=function(m){return arguments.length?(t=m,d):t},d.iterations=function(m){return arguments.length?(c=+m,d):c},d.strength=function(m){return arguments.length?(n=typeof m=="function"?m:bn(+m),g(),d):n},d.distance=function(m){return arguments.length?(r=typeof m=="function"?m:bn(+m),p(),d):r},d}var uK={value:()=>{}};function n5(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new E0(n)}function E0(e){this._=e}function lK(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}E0.prototype=n5.prototype={constructor:E0,on:function(e,t){var n=this._,i=lK(e+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(e=i[s]).type)&&(r=cK(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(r=(e=i[s]).type)n[r]=i5(n[r],e.name,t);else if(t==null)for(r in n)n[r]=i5(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new E0(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function cK(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function i5(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=uK,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var Ku=0,vf=0,bf=0,r5=1e3,_0,xf,A0=0,ha=0,O0=0,wf=typeof performance=="object"&&performance.now?performance:Date,s5=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function d2(){return ha||(s5(fK),ha=wf.now()+O0)}function fK(){ha=0}function S0(){this._call=this._time=this._next=null}S0.prototype=o5.prototype={constructor:S0,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?d2():+n)+(t==null?0:+t),!this._next&&xf!==this&&(xf?xf._next=this:_0=this,xf=this),this._call=e,this._time=n,h2()},stop:function(){this._call&&(this._call=null,this._time=1/0,h2())}};function o5(e,t,n){var i=new S0;return i.restart(e,t,n),i}function dK(){d2(),++Ku;for(var e=_0,t;e;)(t=ha-e._time)>=0&&e._call.call(null,t),e=e._next;--Ku}function a5(){ha=(A0=wf.now())+O0,Ku=vf=0;try{dK()}finally{Ku=0,gK(),ha=0}}function hK(){var e=wf.now(),t=e-A0;t>r5&&(O0-=t,A0=e)}function gK(){for(var e,t=_0,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:_0=n);xf=e,h2(i)}function h2(e){if(!Ku){vf&&(vf=clearTimeout(vf));var t=e-ha;t>24?(e<1/0&&(vf=setTimeout(a5,e-wf.now()-O0)),bf&&(bf=clearInterval(bf))):(bf||(A0=wf.now(),bf=setInterval(hK,r5)),Ku=1,s5(a5))}}function pK(e,t,n){var i=new S0,r=t;return t==null?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(s,o,a){o=+o,a=a==null?d2():+a,i._restart(function u(l){l+=r,i._restart(u,r+=o,a),s(l)},o,a)},i.restart(e,t,n),i)}const mK=1664525,yK=1013904223,u5=4294967296;function vK(){let e=1;return()=>(e=(mK*e+yK)%u5)/u5}function bK(e){return e.x}function xK(e){return e.y}var wK=10,EK=Math.PI*(3-Math.sqrt(5));function _K(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,a=new Map,u=o5(f),l=n5("tick","end"),c=vK();e==null&&(e=[]);function f(){d(),l.call("tick",t),n<i&&(u.stop(),l.call("end",t))}function d(p){var m,y=e.length,v;p===void 0&&(p=1);for(var b=0;b<p;++b)for(n+=(s-n)*r,a.forEach(function(x){x(n)}),m=0;m<y;++m)v=e[m],v.fx==null?v.x+=v.vx*=o:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=o:(v.y=v.fy,v.vy=0);return t}function h(){for(var p=0,m=e.length,y;p<m;++p){if(y=e[p],y.index=p,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var v=wK*Math.sqrt(.5+p),b=p*EK;y.x=v*Math.cos(b),y.y=v*Math.sin(b)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function g(p){return p.initialize&&p.initialize(e,c),p}return h(),t={tick:d,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(p){return arguments.length?(e=p,h(),a.forEach(g),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(s=+p,t):s},velocityDecay:function(p){return arguments.length?(o=1-p,t):1-o},randomSource:function(p){return arguments.length?(c=p,a.forEach(g),t):c},force:function(p,m){return arguments.length>1?(m==null?a.delete(p):a.set(p,g(m)),t):a.get(p)},find:function(p,m,y){var v=0,b=e.length,x,E,_,w,A;for(y==null?y=1/0:y*=y,v=0;v<b;++v)w=e[v],x=p-w.x,E=m-w.y,_=x*x+E*E,_<y&&(A=w,y=_);return A},on:function(p,m){return arguments.length>1?(l.on(p,m),t):l.on(p)}}}function AK(){var e,t,n,i,r=bn(-30),s,o=1,a=1/0,u=.81;function l(h){var g,p=e.length,m=c2(e,bK,xK).visitAfter(f);for(i=h,g=0;g<p;++g)t=e[g],m.visit(d)}function c(){if(!!e){var h,g=e.length,p;for(s=new Array(g),h=0;h<g;++h)p=e[h],s[p.index]=+r(p,h,e)}}function f(h){var g=0,p,m,y=0,v,b,x;if(h.length){for(v=b=x=0;x<4;++x)(p=h[x])&&(m=Math.abs(p.value))&&(g+=p.value,y+=m,v+=m*p.x,b+=m*p.y);h.x=v/y,h.y=b/y}else{p=h,p.x=p.data.x,p.y=p.data.y;do g+=s[p.data.index];while(p=p.next)}h.value=g}function d(h,g,p,m){if(!h.value)return!0;var y=h.x-t.x,v=h.y-t.y,b=m-g,x=y*y+v*v;if(b*b/u<x)return x<a&&(y===0&&(y=ao(n),x+=y*y),v===0&&(v=ao(n),x+=v*v),x<o&&(x=Math.sqrt(o*x)),t.vx+=y*h.value*i/x,t.vy+=v*h.value*i/x),!0;if(h.length||x>=a)return;(h.data!==t||h.next)&&(y===0&&(y=ao(n),x+=y*y),v===0&&(v=ao(n),x+=v*v),x<o&&(x=Math.sqrt(o*x)));do h.data!==t&&(b=s[h.data.index]*i/x,t.vx+=y*b,t.vy+=v*b);while(h=h.next)}return l.initialize=function(h,g){e=h,n=g,c()},l.strength=function(h){return arguments.length?(r=typeof h=="function"?h:bn(+h),c(),l):r},l.distanceMin=function(h){return arguments.length?(o=h*h,l):Math.sqrt(o)},l.distanceMax=function(h){return arguments.length?(a=h*h,l):Math.sqrt(a)},l.theta=function(h){return arguments.length?(u=h*h,l):Math.sqrt(u)},l}function OK(e){var t=bn(.1),n,i,r;typeof e!="function"&&(e=bn(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(r[u]-c.x)*i[u]*a}function o(){if(!!n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:bn(+a),o(),s):t},s.x=function(a){return arguments.length?(e=typeof a=="function"?a:bn(+a),o(),s):e},s}function SK(e){var t=bn(.1),n,i,r;typeof e!="function"&&(e=bn(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(r[u]-c.y)*i[u]*a}function o(){if(!!n){var a,u=n.length;for(i=new Array(u),r=new Array(u),a=0;a<u;++a)i[a]=isNaN(r[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:bn(+a),o(),s):t},s.y=function(a){return arguments.length?(e=typeof a=="function"?a:bn(+a),o(),s):e},s}const l5={center:BX,collide:sK,nbody:AK,link:aK,x:OK,y:SK},Ef="forces",g2=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],CK=["static","iterations"],c5=["x","y","vx","vy"];function p2(e){D.call(this,null,e)}p2.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:c5}]};z(p2,D,{transform(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(g2),s=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&f5(n,e,0,t)):(this.value=n=FK(t.source,e),n.on("tick",$K(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(CK)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let a=this._argops,u=0,l=a.length,c;u<l;++u)if(c=a[u],!(c.name!==Ef||c.op._argval.force!=="link")){for(var i=c.op._argops,r=0,s=i.length,o;r<s;++r)if(i[r].name==="links"&&(o=i[r].op.source)){n.pulse(o,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(c5)}});function $K(e,t){return()=>e.touch(t).run()}function FK(e,t){const n=_K(e),i=n.stop,r=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,r()),n.stop=()=>(s=!0,i()),f5(n,t,!0).on("end",()=>s=!0)}function f5(e,t,n,i){var r=re(t.forces),s,o,a,u;for(s=0,o=g2.length;s<o;++s)a=g2[s],a!==Ef&&t.modified(a)&&e[a](t[a]);for(s=0,o=r.length;s<o;++s)u=Ef+s,a=n||t.modified(Ef,s)?DK(r[s]):i&&kK(r[s],i)?e.force(u):null,a&&e.force(u,a);for(o=e.numForces||0;s<o;++s)e.force(Ef+s,null);return e.numForces=r.length,e}function kK(e,t){var n,i;for(n in e)if(ge(i=e[n])&&t.modified(zt(i)))return 1;return 0}function DK(e){var t,n;se(l5,e.force)||N("Unrecognized force: "+e.force),t=l5[e.force]();for(n in e)ge(t[n])&&MK(t[n],e[n],e);return t}function MK(e,t,n){e(ge(t)?i=>t(i,n):t)}var TK=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",force:p2});function NK(e,t){return e.parent===t.parent?1:2}function RK(e){return e.reduce(jK,0)/e.length}function jK(e,t){return e+t.x}function LK(e){return 1+e.reduce(PK,0)}function PK(e,t){return Math.max(e,t.y)}function IK(e){for(var t;t=e.children;)e=t[0];return e}function BK(e){for(var t;t=e.children;)e=t[t.length-1];return e}function zK(){var e=NK,t=1,n=1,i=!1;function r(s){var o,a=0;s.eachAfter(function(d){var h=d.children;h?(d.x=RK(h),d.y=LK(h)):(d.x=o?a+=e(d,o):0,d.y=0,o=d)});var u=IK(s),l=BK(s),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return s.eachAfter(i?function(d){d.x=(d.x-s.x)*t,d.y=(s.y-d.y)*n}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(s.y?d.y/s.y:1))*n})}return r.separation=function(s){return arguments.length?(e=s,r):e},r.size=function(s){return arguments.length?(i=!1,t=+s[0],n=+s[1],r):i?null:[t,n]},r.nodeSize=function(s){return arguments.length?(i=!0,t=+s[0],n=+s[1],r):i?[t,n]:null},r}function UK(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function qK(){return this.eachAfter(UK)}function WK(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this}function GK(e,t){for(var n=this,i=[n],r,s,o=-1;n=i.pop();)if(e.call(t,n,++o,this),r=n.children)for(s=r.length-1;s>=0;--s)i.push(r[s]);return this}function HK(e,t){for(var n=this,i=[n],r=[],s,o,a,u=-1;n=i.pop();)if(r.push(n),s=n.children)for(o=0,a=s.length;o<a;++o)i.push(s[o]);for(;n=r.pop();)e.call(t,n,++u,this);return this}function YK(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i}function VK(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function XK(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function KK(e){for(var t=this,n=JK(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function JK(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function QK(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function ZK(){return Array.from(this)}function eJ(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function tJ(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*nJ(){var e=this,t,n=[e],i,r,s;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(r=0,s=i.length;r<s;++r)n.push(i[r]);while(n.length)}function m2(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=sJ)):t===void 0&&(t=rJ);for(var n=new Ju(e),i,r=[n],s,o,a,u;i=r.pop();)if((o=t(i.data))&&(u=(o=Array.from(o)).length))for(i.children=o,a=u-1;a>=0;--a)r.push(s=o[a]=new Ju(o[a])),s.parent=i,s.depth=i.depth+1;return n.eachBefore(d5)}function iJ(){return m2(this).eachBefore(oJ)}function rJ(e){return e.children}function sJ(e){return Array.isArray(e)?e[1]:null}function oJ(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function d5(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function Ju(e){this.data=e,this.depth=this.height=0,this.parent=null}Ju.prototype=m2.prototype={constructor:Ju,count:qK,each:WK,eachAfter:HK,eachBefore:GK,find:YK,sum:VK,sort:XK,path:KK,ancestors:QK,descendants:ZK,leaves:eJ,links:tJ,copy:iJ,[Symbol.iterator]:nJ};function aJ(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function uJ(e){for(var t=e.length,n,i;t;)i=Math.random()*t--|0,n=e[t],e[t]=e[i],e[i]=n;return e}function lJ(e){for(var t=0,n=(e=uJ(Array.from(e))).length,i=[],r,s;t<n;)r=e[t],s&&h5(s,r)?++t:(s=fJ(i=cJ(i,r)),t=0);return s}function cJ(e,t){var n,i;if(y2(t,e))return[t];for(n=0;n<e.length;++n)if(C0(t,e[n])&&y2(_f(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(C0(_f(e[n],e[i]),t)&&C0(_f(e[n],t),e[i])&&C0(_f(e[i],t),e[n])&&y2(g5(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function C0(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function h5(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function y2(e,t){for(var n=0;n<t.length;++n)if(!h5(e,t[n]))return!1;return!0}function fJ(e){switch(e.length){case 1:return dJ(e[0]);case 2:return _f(e[0],e[1]);case 3:return g5(e[0],e[1],e[2])}}function dJ(e){return{x:e.x,y:e.y,r:e.r}}function _f(e,t){var n=e.x,i=e.y,r=e.r,s=t.x,o=t.y,a=t.r,u=s-n,l=o-i,c=a-r,f=Math.sqrt(u*u+l*l);return{x:(n+s+u/f*c)/2,y:(i+o+l/f*c)/2,r:(f+r+a)/2}}function g5(e,t,n){var i=e.x,r=e.y,s=e.r,o=t.x,a=t.y,u=t.r,l=n.x,c=n.y,f=n.r,d=i-o,h=i-l,g=r-a,p=r-c,m=u-s,y=f-s,v=i*i+r*r-s*s,b=v-o*o-a*a+u*u,x=v-l*l-c*c+f*f,E=h*g-d*p,_=(g*x-p*b)/(E*2)-i,w=(p*m-g*y)/E,A=(h*b-d*x)/(E*2)-r,S=(d*y-h*m)/E,O=w*w+S*S-1,C=2*(s+_*w+A*S),k=_*_+A*A-s*s,F=-(O?(C+Math.sqrt(C*C-4*O*k))/(2*O):k/C);return{x:i+_+w*F,y:r+A+S*F,r:F}}function p5(e,t,n){var i=e.x-t.x,r,s,o=e.y-t.y,a,u,l=i*i+o*o;l?(s=t.r+n.r,s*=s,u=e.r+n.r,u*=u,s>u?(r=(l+u-s)/(2*l),a=Math.sqrt(Math.max(0,u/l-r*r)),n.x=e.x-r*i-a*o,n.y=e.y-r*o+a*i):(r=(l+s-u)/(2*l),a=Math.sqrt(Math.max(0,s/l-r*r)),n.x=t.x+r*i-a*o,n.y=t.y+r*o+a*i)):(n.x=t.x+n.r,n.y=t.y)}function m5(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function y5(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,s=(t.y*n.r+n.y*t.r)/i;return r*r+s*s}function $0(e){this._=e,this.next=null,this.previous=null}function hJ(e){if(!(r=(e=aJ(e)).length))return 0;var t,n,i,r,s,o,a,u,l,c,f;if(t=e[0],t.x=0,t.y=0,!(r>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(r>2))return t.r+n.r;p5(n,t,i=e[2]),t=new $0(t),n=new $0(n),i=new $0(i),t.next=i.previous=n,n.next=t.previous=i,i.next=n.previous=t;e:for(a=3;a<r;++a){p5(t._,n._,i=e[a]),i=new $0(i),u=n.next,l=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(m5(u._,i._)){n=u,t.next=n,n.previous=t,--a;continue e}c+=u._.r,u=u.next}else{if(m5(l._,i._)){t=l,t.next=n,n.previous=t,--a;continue e}f+=l._.r,l=l.previous}while(u!==l.next);for(i.previous=t,i.next=n,t.next=n.previous=n=i,s=y5(t);(i=i.next)!==n;)(o=y5(i))<s&&(t=i,s=o);n=t.next}for(t=[n._],i=n;(i=i.next)!==n;)t.push(i._);for(i=lJ(t),a=0;a<r;++a)t=e[a],t.x-=i.x,t.y-=i.y;return i.r}function gJ(e){return e==null?null:F0(e)}function F0(e){if(typeof e!="function")throw new Error;return e}function ga(){return 0}function Qu(e){return function(){return e}}function pJ(e){return Math.sqrt(e.value)}function mJ(){var e=null,t=1,n=1,i=ga;function r(s){return s.x=t/2,s.y=n/2,e?s.eachBefore(v5(e)).eachAfter(v2(i,.5)).eachBefore(b5(1)):s.eachBefore(v5(pJ)).eachAfter(v2(ga,1)).eachAfter(v2(i,s.r/Math.min(t,n))).eachBefore(b5(Math.min(t,n)/(2*s.r))),s}return r.radius=function(s){return arguments.length?(e=gJ(s),r):e},r.size=function(s){return arguments.length?(t=+s[0],n=+s[1],r):[t,n]},r.padding=function(s){return arguments.length?(i=typeof s=="function"?s:Qu(+s),r):i},r}function v5(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function v2(e,t){return function(n){if(i=n.children){var i,r,s=i.length,o=e(n)*t||0,a;if(o)for(r=0;r<s;++r)i[r].r+=o;if(a=hJ(i),o)for(r=0;r<s;++r)i[r].r-=o;n.r=a+o}}}function b5(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function x5(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Af(e,t,n,i,r){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(i-t)/e.value;++a<u;)o=s[a],o.y0=n,o.y1=r,o.x0=t,o.x1=t+=o.value*l}function yJ(){var e=1,t=1,n=0,i=!1;function r(o){var a=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/a,o.eachBefore(s(t,a)),i&&o.eachBefore(x5),o}function s(o,a){return function(u){u.children&&Af(u,u.x0,o*(u.depth+1)/a,u.x1,o*(u.depth+2)/a);var l=u.x0,c=u.y0,f=u.x1-n,d=u.y1-n;f<l&&(l=f=(l+f)/2),d<c&&(c=d=(c+d)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=d}}return r.round=function(o){return arguments.length?(i=!!o,r):i},r.size=function(o){return arguments.length?(e=+o[0],t=+o[1],r):[e,t]},r.padding=function(o){return arguments.length?(n=+o,r):n},r}var vJ={depth:-1},w5={};function bJ(e){return e.id}function xJ(e){return e.parentId}function E5(){var e=bJ,t=xJ;function n(i){var r=Array.from(i),s=r.length,o,a,u,l,c,f,d,h=new Map;for(a=0;a<s;++a)o=r[a],c=r[a]=new Ju(o),(f=e(o,a,i))!=null&&(f+="")&&(d=c.id=f,h.set(d,h.has(d)?w5:c)),(f=t(o,a,i))!=null&&(f+="")&&(c.parent=f);for(a=0;a<s;++a)if(c=r[a],f=c.parent){if(l=h.get(f),!l)throw new Error("missing: "+f);if(l===w5)throw new Error("ambiguous: "+f);l.children?l.children.push(c):l.children=[c],c.parent=l}else{if(u)throw new Error("multiple roots");u=c}if(!u)throw new Error("no root");if(u.parent=vJ,u.eachBefore(function(g){g.depth=g.parent.depth+1,--s}).eachBefore(d5),u.parent=null,s>0)throw new Error("cycle");return u}return n.id=function(i){return arguments.length?(e=F0(i),n):e},n.parentId=function(i){return arguments.length?(t=F0(i),n):t},n}function wJ(e,t){return e.parent===t.parent?1:2}function b2(e){var t=e.children;return t?t[0]:e.t}function x2(e){var t=e.children;return t?t[t.length-1]:e.t}function EJ(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function _J(e){for(var t=0,n=0,i=e.children,r=i.length,s;--r>=0;)s=i[r],s.z+=t,s.m+=t,t+=s.s+(n+=s.c)}function AJ(e,t,n){return e.a.parent===t.parent?e.a:n}function k0(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}k0.prototype=Object.create(Ju.prototype);function OJ(e){for(var t=new k0(e,0),n,i=[t],r,s,o,a;n=i.pop();)if(s=n._.children)for(n.children=new Array(a=s.length),o=a-1;o>=0;--o)i.push(r=n.children[o]=new k0(s[o],o)),r.parent=n;return(t.parent=new k0(null,0)).children=[t],t}function SJ(){var e=wJ,t=1,n=1,i=null;function r(l){var c=OJ(l);if(c.eachAfter(s),c.parent.m=-c.z,c.eachBefore(o),i)l.eachBefore(u);else{var f=l,d=l,h=l;l.eachBefore(function(v){v.x<f.x&&(f=v),v.x>d.x&&(d=v),v.depth>h.depth&&(h=v)});var g=f===d?1:e(f,d)/2,p=g-f.x,m=t/(d.x+g+p),y=n/(h.depth||1);l.eachBefore(function(v){v.x=(v.x+p)*m,v.y=v.depth*y})}return l}function s(l){var c=l.children,f=l.parent.children,d=l.i?f[l.i-1]:null;if(c){_J(l);var h=(c[0].z+c[c.length-1].z)/2;d?(l.z=d.z+e(l._,d._),l.m=l.z-h):l.z=h}else d&&(l.z=d.z+e(l._,d._));l.parent.A=a(l,d,l.parent.A||f[0])}function o(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,c,f){if(c){for(var d=l,h=l,g=c,p=d.parent.children[0],m=d.m,y=h.m,v=g.m,b=p.m,x;g=x2(g),d=b2(d),g&&d;)p=b2(p),h=x2(h),h.a=l,x=g.z+v-d.z-m+e(g._,d._),x>0&&(EJ(AJ(g,l,f),l,x),m+=x,y+=x),v+=g.m,m+=d.m,b+=p.m,y+=h.m;g&&!x2(h)&&(h.t=g,h.m+=v-y),d&&!b2(p)&&(p.t=d,p.m+=m-b,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return r.separation=function(l){return arguments.length?(e=l,r):e},r.size=function(l){return arguments.length?(i=!1,t=+l[0],n=+l[1],r):i?null:[t,n]},r.nodeSize=function(l){return arguments.length?(i=!0,t=+l[0],n=+l[1],r):i?[t,n]:null},r}function D0(e,t,n,i,r){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(r-n)/e.value;++a<u;)o=s[a],o.x0=t,o.x1=i,o.y0=n,o.y1=n+=o.value*l}var _5=(1+Math.sqrt(5))/2;function A5(e,t,n,i,r,s){for(var o=[],a=t.children,u,l,c=0,f=0,d=a.length,h,g,p=t.value,m,y,v,b,x,E,_;c<d;){h=r-n,g=s-i;do m=a[f++].value;while(!m&&f<d);for(y=v=m,E=Math.max(g/h,h/g)/(p*e),_=m*m*E,x=Math.max(v/_,_/y);f<d;++f){if(m+=l=a[f].value,l<y&&(y=l),l>v&&(v=l),_=m*m*E,b=Math.max(v/_,_/y),b>x){m-=l;break}x=b}o.push(u={value:m,dice:h<g,children:a.slice(c,f)}),u.dice?Af(u,n,i,r,p?i+=g*m/p:s):D0(u,n,i,p?n+=h*m/p:r,s),p-=m,c=f}return o}var O5=function e(t){function n(i,r,s,o,a){A5(t,i,r,s,o,a)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(_5);function CJ(){var e=O5,t=!1,n=1,i=1,r=[0],s=ga,o=ga,a=ga,u=ga,l=ga;function c(d){return d.x0=d.y0=0,d.x1=n,d.y1=i,d.eachBefore(f),r=[0],t&&d.eachBefore(x5),d}function f(d){var h=r[d.depth],g=d.x0+h,p=d.y0+h,m=d.x1-h,y=d.y1-h;m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),d.x0=g,d.y0=p,d.x1=m,d.y1=y,d.children&&(h=r[d.depth+1]=s(d)/2,g+=l(d)-h,p+=o(d)-h,m-=a(d)-h,y-=u(d)-h,m<g&&(g=m=(g+m)/2),y<p&&(p=y=(p+y)/2),e(d,g,p,m,y))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(n=+d[0],i=+d[1],c):[n,i]},c.tile=function(d){return arguments.length?(e=F0(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(s=typeof d=="function"?d:Qu(+d),c):s},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:Qu(+d),c):o},c.paddingRight=function(d){return arguments.length?(a=typeof d=="function"?d:Qu(+d),c):a},c.paddingBottom=function(d){return arguments.length?(u=typeof d=="function"?d:Qu(+d),c):u},c.paddingLeft=function(d){return arguments.length?(l=typeof d=="function"?d:Qu(+d),c):l},c}function $J(e,t,n,i,r){var s=e.children,o,a=s.length,u,l=new Array(a+1);for(l[0]=u=o=0;o<a;++o)l[o+1]=u+=s[o].value;c(0,a,e.value,t,n,i,r);function c(f,d,h,g,p,m,y){if(f>=d-1){var v=s[f];v.x0=g,v.y0=p,v.x1=m,v.y1=y;return}for(var b=l[f],x=h/2+b,E=f+1,_=d-1;E<_;){var w=E+_>>>1;l[w]<x?E=w+1:_=w}x-l[E-1]<l[E]-x&&f+1<E&&--E;var A=l[E]-b,S=h-A;if(m-g>y-p){var O=h?(g*S+m*A)/h:m;c(f,E,A,g,p,O,y),c(E,d,S,O,p,m,y)}else{var C=h?(p*S+y*A)/h:y;c(f,E,A,g,p,m,C),c(E,d,S,g,C,m,y)}}}function FJ(e,t,n,i,r){(e.depth&1?D0:Af)(e,t,n,i,r)}var kJ=function e(t){function n(i,r,s,o,a){if((u=i._squarify)&&u.ratio===t)for(var u,l,c,f,d=-1,h,g=u.length,p=i.value;++d<g;){for(l=u[d],c=l.children,f=l.value=0,h=c.length;f<h;++f)l.value+=c[f].value;l.dice?Af(l,r,s,o,p?s+=(a-s)*l.value/p:a):D0(l,r,s,p?r+=(o-r)*l.value/p:o,a),p-=l.value}else i._squarify=u=A5(t,i,r,s,o,a),u.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(_5);function w2(e,t,n){const i={};return e.each(r=>{const s=r.data;n(s)&&(i[t(s)]=r)}),e.lookup=i,e}function E2(e){D.call(this,null,e)}E2.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const DJ=e=>e.values;z(E2,D,{transform(e,t){t.source||N("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),s=this.value;return(!s||i||t.changed())&&(s&&s.each(o=>{o.children&&Eh(o.data)&&r.rem.push(o.data)}),this.value=s=m2({values:re(e.keys).reduce((o,a)=>(o.key(a),o),MJ()).entries(r.source)},DJ),n&&s.each(o=>{o.children&&(o=Me(o.data),r.add.push(o),r.source.push(o))}),w2(s,J,J)),r.source.root=s,r}});function MJ(){const e=[],t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)};function n(r,s){if(s>=e.length)return r;const o=r.length,a=e[s++],u={},l={};let c=-1,f,d,h;for(;++c<o;)f=a(d=r[c])+"",(h=u[f])?h.push(d):u[f]=[d];for(f in u)l[f]=n(u[f],s);return l}function i(r,s){if(++s>e.length)return r;const o=[];for(const a in r)o.push({key:a,values:i(r[a],s)});return o}return t}function is(e){D.call(this,null,e)}const TJ=(e,t)=>e.parent===t.parent?1:2;z(is,D,{transform(e,t){(!t.source||!t.source.root)&&N(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,r=t.source.root,s=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(Vo(e.sort,o=>o.data)),NJ(n,this.params,e),n.separation&&n.separation(e.separation!==!1?TJ:uu);try{this.value=n(r)}catch(o){N(o)}return r.each(o=>RJ(o,i,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});function NJ(e,t,n){for(let i,r=0,s=t.length;r<s;++r)i=t[r],i in n&&e[i](n[i])}function RJ(e,t,n){const i=e.data,r=t.length-1;for(let s=0;s<r;++s)i[n[s]]=e[t[s]];i[n[r]]=e.children?e.children.length:0}const _2=["x","y","r","depth","children"];function A2(e){is.call(this,e)}A2.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:_2.length,default:_2}]};z(A2,is,{layout:mJ,params:["radius","size","padding"],fields:_2});const O2=["x0","y0","x1","y1","depth","children"];function S2(e){is.call(this,e)}S2.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:O2.length,default:O2}]};z(S2,is,{layout:yJ,params:["size","round","padding"],fields:O2});function C2(e){D.call(this,null,e)}C2.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};z(C2,D,{transform(e,t){t.source||N("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),s=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),s&&(n=r.source.length?w2(E5().id(e.key).parentId(e.parentKey)(r.source),e.key,oi):w2(E5()([{}]),e.key,e.key)),r.source.root=this.value=n,r}});const S5={tidy:SJ,cluster:zK},$2=["x","y","depth","children"];function F2(e){is.call(this,e)}F2.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:$2.length,default:$2}]};z(F2,is,{layout(e){const t=e||"tidy";if(se(S5,t))return S5[t]();N("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:$2});function k2(e){D.call(this,[],e)}k2.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};z(k2,D,{transform(e,t){const n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),s={};return i||N("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,o=>s[J(o)]=1),i.each(o=>{const a=o.data,u=o.parent&&o.parent.data;u&&s[J(a)]&&s[J(u)]&&r.add.push(Me({source:u,target:a}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,o=>s[J(o)]=1),n.forEach(o=>{(s[J(o.source)]||s[J(o.target)])&&r.mod.push(o)})),r}});const C5={binary:$J,dice:Af,slice:D0,slicedice:FJ,squarify:O5,resquarify:kJ},D2=["x0","y0","x1","y1","depth","children"];function M2(e){is.call(this,e)}M2.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:D2.length,default:D2}]};z(M2,is,{layout(){const e=CJ();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{se(C5,t)?e.tile(C5[t]):N("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:D2});var jJ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",nest:E2,pack:A2,partition:S2,stratify:C2,tree:F2,treelinks:k2,treemap:M2});const LJ=4278190080,PJ=268435456,IJ=.0625;function BJ(e,t){const n=e.bitmap();return(t||[]).forEach(i=>n.set(e(i.boundary[0]),e(i.boundary[3]))),[n,void 0]}function zJ(e,t,n,i){const r=e.width,s=e.height,o=n||i,a=Au(r,s).getContext("2d");t.forEach(m=>$5(a,m,o));const u=new Uint32Array(a.getImageData(0,0,r,s).data.buffer),l=e.bitmap(),c=o&&e.bitmap();let f,d,h,g,p;for(d=0;d<s;++d)for(f=0;f<r;++f)p=u[d*r+f]&LJ,p&&(h=e(f),g=e(d),i||l.set(h,g),o&&p^PJ&&c.set(h,g));return[l,c]}function $5(e,t,n){if(!t.length)return;const i=t[0].mark.marktype;i==="group"?t.forEach(r=>{r.items.forEach(s=>$5(e,s.items,n))}):Kn[i].draw(e,{items:n?t.map(UJ):t})}function UJ(e){const t=_h(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=IJ,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const rs=5,xn=31,Of=32,uo=new Uint32Array(Of+1),Ii=new Uint32Array(Of+1);Ii[0]=0;uo[0]=~Ii[0];for(let e=1;e<=Of;++e)Ii[e]=Ii[e-1]<<1|1,uo[e]=~Ii[e];function qJ(e,t){const n=new Uint32Array(~~((e*t+Of)/Of));function i(s,o){n[s]|=o}function r(s,o){n[s]&=o}return{array:n,get:(s,o)=>{const a=o*e+s;return n[a>>>rs]&1<<(a&xn)},set:(s,o)=>{const a=o*e+s;i(a>>>rs,1<<(a&xn))},clear:(s,o)=>{const a=o*e+s;r(a>>>rs,~(1<<(a&xn)))},getRange:(s,o,a,u)=>{let l=u,c,f,d,h;for(;l>=o;--l)if(c=l*e+s,f=l*e+a,d=c>>>rs,h=f>>>rs,d===h){if(n[d]&uo[c&xn]&Ii[(f&xn)+1])return!0}else{if(n[d]&uo[c&xn]||n[h]&Ii[(f&xn)+1])return!0;for(let g=d+1;g<h;++g)if(n[g])return!0}return!1},setRange:(s,o,a,u)=>{let l,c,f,d,h;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>rs,d=c>>>rs,f===d)i(f,uo[l&xn]&Ii[(c&xn)+1]);else for(i(f,uo[l&xn]),i(d,Ii[(c&xn)+1]),h=f+1;h<d;++h)i(h,4294967295)},clearRange:(s,o,a,u)=>{let l,c,f,d,h;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>rs,d=c>>>rs,f===d)r(f,Ii[l&xn]|uo[(c&xn)+1]);else for(r(f,Ii[l&xn]),r(d,uo[(c&xn)+1]),h=f+1;h<d;++h)r(h,0)},outOfBounds:(s,o,a,u)=>s<0||o<0||u>=t||a>=e}}function WJ(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),r=~~((e+2*n+i)/i),s=~~((t+2*n+i)/i),o=a=>~~((a+n)/i);return o.invert=a=>a*i-n,o.bitmap=()=>qJ(r,s),o.ratio=i,o.padding=n,o.width=e,o.height=t,o}function GJ(e,t,n,i){const r=e.width,s=e.height;return function(o){const a=o.datum.datum.items[i].items,u=a.length,l=o.datum.fontSize,c=hr.width(o.datum,o.datum.text);let f=0,d,h,g,p,m,y,v;for(let b=0;b<u;++b)d=a[b].x,g=a[b].y,h=a[b].x2===void 0?d:a[b].x2,p=a[b].y2===void 0?g:a[b].y2,m=(d+h)/2,y=(g+p)/2,v=Math.abs(h-d+p-g),v>=f&&(f=v,o.x=m,o.y=y);return m=c/2,y=l/2,d=o.x-m,h=o.x+m,g=o.y-y,p=o.y+y,o.align="center",d<0&&h<=r?o.align="left":0<=d&&r<h&&(o.align="right"),o.baseline="middle",g<0&&p<=s?o.baseline="top":0<=g&&s<p&&(o.baseline="bottom"),!0}}function HJ(e,t,n,i,r,s){let o=n/2;return e-o<0||e+o>r||t-(o=i/2)<0||t+o>s}function YJ(){return!1}function VJ(e,t,n,i,r,s,o,a){const u=r*s/(i*2),l=e(t-u),c=e(t+u),f=e(n-(s=s/2)),d=e(n+s);return o.outOfBounds(l,f,c,d)||o.getRange(l,f,c,d)||a&&a.getRange(l,f,c,d)}function XJ(e,t,n,i,r,s,o,a){const u=r*s/(i*2);let l=e(t-u),c=e(t+u),f=e(n-(s=s/2)),d=e(n+s);return l=l>0?l:0,f=f>0?f:0,c=c<e.width?c:e.width-1,d=d<e.height?d:e.height-1,o.getRange(l,f,c,d)||a&&a.getRange(l,f,c,d)}function F5(e){return e?[XJ,YJ]:[VJ,HJ]}function KJ(e,t,n,i,r){const s=e.width,o=e.height,[a,u]=F5(r),l=t[0],c=t[1];function f(d,h,g,p,m){const y=e.invert(d),v=e.invert(h);let b=g,x=o,E;if(!u(y,v,p,m,s,o)&&!a(e,y,v,m,p,b,l,c)&&!a(e,y,v,m,p,m,l,null)){for(;x-b>=1;)E=(b+x)/2,a(e,y,v,m,p,E,l,c)?x=E:b=E;if(b>g)return[y,v,b,!0]}}return function(d){const h=d.datum.datum.items[i].items,g=h.length,p=d.datum.fontSize,m=hr.width(d.datum,d.datum.text);let y=n?p:0,v=!1,b=!1,x=0,E,_,w,A,S,O,C,k,F,j,$,R,L,U,H,ae,De;for(let Oe=0;Oe<g;++Oe){for(E=h[Oe].x,w=h[Oe].y,_=h[Oe].x2===void 0?E:h[Oe].x2,A=h[Oe].y2===void 0?w:h[Oe].y2,E>_&&(De=E,E=_,_=De),w>A&&(De=w,w=A,A=De),F=e(E),$=e(_),j=~~((F+$)/2),R=e(w),U=e(A),L=~~((R+U)/2),C=j;C>=F;--C)for(k=L;k>=R;--k)ae=f(C,k,y,m,p),ae&&([d.x,d.y,y,v]=ae);for(C=j;C<=$;++C)for(k=L;k<=U;++k)ae=f(C,k,y,m,p),ae&&([d.x,d.y,y,v]=ae);!v&&!n&&(H=Math.abs(_-E+A-w),S=(E+_)/2,O=(w+A)/2,H>=x&&!u(S,O,m,p,s,o)&&!a(e,S,O,p,m,p,l,null)&&(x=H,d.x=S,d.y=O,b=!0))}return v||b?(S=m/2,O=p/2,l.setRange(e(d.x-S),e(d.y-O),e(d.x+S),e(d.y+O)),d.align="center",d.baseline="middle",!0):!1}}const JJ=[-1,-1,1,1],QJ=[-1,1,-1,1];function ZJ(e,t,n,i,r){const s=e.width,o=e.height,[a,u]=F5(r),l=t[0],c=t[1],f=e.bitmap();return function(d){const h=d.datum.datum.items[i].items,g=h.length,p=d.datum.fontSize,m=hr.width(d.datum,d.datum.text),y=[];let v=n?p:0,b=!1,x=!1,E=0,_,w,A,S,O,C,k,F,j,$,R,L;for(let U=0;U<g;++U){for(_=h[U].x,A=h[U].y,w=h[U].x2===void 0?_:h[U].x2,S=h[U].y2===void 0?A:h[U].y2,y.push([e((_+w)/2),e((A+S)/2)]);y.length;)if([k,F]=y.pop(),!(l.get(k,F)||c.get(k,F)||f.get(k,F))){f.set(k,F);for(let H=0;H<4;++H)O=k+JJ[H],C=F+QJ[H],f.outOfBounds(O,C,O,C)||y.push([O,C]);if(O=e.invert(k),C=e.invert(F),j=v,$=o,!u(O,C,m,p,s,o)&&!a(e,O,C,p,m,j,l,c)&&!a(e,O,C,p,m,p,l,null)){for(;$-j>=1;)R=(j+$)/2,a(e,O,C,p,m,R,l,c)?$=R:j=R;j>v&&(d.x=O,d.y=C,v=j,b=!0)}}!b&&!n&&(L=Math.abs(w-_+S-A),O=(_+w)/2,C=(A+S)/2,L>=E&&!u(O,C,m,p,s,o)&&!a(e,O,C,p,m,p,l,null)&&(E=L,d.x=O,d.y=C,x=!0))}return b||x?(O=m/2,C=p/2,l.setRange(e(d.x-O),e(d.y-C),e(d.x+O),e(d.y+C)),d.align="center",d.baseline="middle",!0):!1}}const eQ=["right","center","left"],tQ=["bottom","middle","top"];function nQ(e,t,n,i,r){const s=e.width,o=e.height,a=t[0],u=t[1],l=i.length;return function(c){const f=c.boundary,d=c.datum.fontSize;if(!r&&(f[2]<0||f[5]<0||f[0]>s||f[3]>o))return!1;let h=0,g,p,m,y,v,b,x,E,_,w,A,S,O,C,k;for(let F=0;F<l;++F){if(g=(n[F]&3)-1,p=(n[F]>>>2&3)-1,m=g===0&&p===0||i[F]<0,y=g&&p?Math.SQRT1_2:1,v=i[F]<0?-1:1,b=f[1+g]+i[F]*g*y,A=f[4+p]+v*d*p/2+i[F]*p*y,E=A-d/2,_=A+d/2,S=e(b),C=e(E),k=e(_),r&&(S=S<0?0:S,C=C<0?0:C,k=k>=e.height?e.height-1:k),!h)if(k5(S,S,C,k,a,u,b,b,E,_,f,m))h=hr.width(c.datum,c.datum.text);else continue;if(w=b+v*h*g/2,b=w-h/2,x=w+h/2,S=e(b),O=e(x),r&&(S=S<0?0:S,O=O>=e.width?e.width-1:O),k5(S,O,C,k,a,u,b,x,E,_,f,m))return c.x=g?g*v<0?x:b:w,c.y=p?p*v<0?_:E:A,c.align=eQ[g*v+1],c.baseline=tQ[p*v+1],a.setRange(S,C,O,k),!0}return!1}}function k5(e,t,n,i,r,s,o,a,u,l,c,f){return!(r.outOfBounds(e,n,t,i)||(f&&s?s.getRange(e,n,t,i)||!iQ(o,u,a,l,c):r.getRange(e,n,t,i)))}function iQ(e,t,n,i,r){return r[0]<=e&&n<=r[2]&&r[3]<=t&&i<=r[5]}const T2=0,N2=4,R2=8,j2=0,L2=1,P2=2,rQ={"top-left":T2+j2,top:T2+L2,"top-right":T2+P2,left:N2+j2,middle:N2+L2,right:N2+P2,"bottom-left":R2+j2,bottom:R2+L2,"bottom-right":R2+P2},sQ={naive:GJ,"reduced-search":KJ,floodfill:ZJ};function oQ(e,t,n,i,r,s,o,a,u,l,c){if(!e.length)return e;const f=Math.max(i.length,r.length),d=aQ(i,f),h=uQ(r,f),g=lQ(e[0].datum),p=g==="group"&&e[0].datum.items[u].marktype,m=p==="area",y=cQ(g,p,a,u),v=l===null||l===1/0,b=WJ(t[0],t[1],v?0:l),x=m&&c==="naive",E=e.map(A=>({datum:A,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(A)}));let _;if(!x){n&&E.sort((S,O)=>n(S.datum,O.datum));let A=!1;for(let S=0;S<h.length&&!A;++S)A=h[S]===5||d[S]<0;g&&(o||m)&&(s=[e.map(S=>S.datum)].concat(s)),_=s.length?zJ(b,s,A,m):BJ(b,o&&E)}const w=m?sQ[c](b,_,o,u,v):nQ(b,_,h,d,v);return E.forEach(A=>A.opacity=+w(A)),E}function aQ(e,t){const n=new Float64Array(t),i=e.length;for(let r=0;r<i;++r)n[r]=e[r]||0;for(let r=i;r<t;++r)n[r]=n[i-1];return n}function uQ(e,t){const n=new Int8Array(t),i=e.length;for(let r=0;r<i;++r)n[r]|=rQ[e[r]];for(let r=i;r<t;++r)n[r]=n[i-1];return n}function lQ(e){return e&&e.mark&&e.mark.marktype}function cQ(e,t,n,i){const r=s=>[s.x,s.x,s.x,s.y,s.y,s.y];return e?e==="line"||e==="area"?s=>r(s.datum):t==="line"?s=>{const o=s.datum.items[i].items;return r(o.length?o[n==="start"?0:o.length-1]:{x:NaN,y:NaN})}:s=>{const o=s.datum.bounds;return[o.x1,(o.x1+o.x2)/2,o.x2,o.y1,(o.y1+o.y2)/2,o.y2]}:r}const I2=["x","y","opacity","align","baseline"],D5=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function B2(e){D.call(this,null,e)}B2.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:D5},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:I2.length,default:I2}]};z(B2,D,{transform(e,t){function n(s){const o=e[s];return ge(o)&&t.modified(o.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&N("Size parameter should be specified as a [width, height] array.");const r=e.as||I2;return oQ(t.materialize(t.SOURCE).source||[],e.size,e.sort,re(e.offset==null?1:e.offset),re(e.anchor||D5),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding===void 0?0:e.padding,e.method||"naive").forEach(s=>{const o=s.datum;o[r[0]]=s.x,o[r[1]]=s.y,o[r[2]]=s.opacity,o[r[3]]=s.align,o[r[4]]=s.baseline}),t.reflow(i).modifies(r)}});var fQ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",label:B2});function M5(e,t){var n=[],i=function(c){return c(a)},r,s,o,a,u,l;if(t==null)n.push(e);else for(r={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function z2(e){D.call(this,null,e)}z2.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};z(z2,D,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=M5(i,e.groupby),s=(e.groupby||[]).map(tt),o=s.length,a=e.as||[tt(e.x),tt(e.y)],u=[];r.forEach(l=>{YC(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let d=0;d<o;++d)f[s[d]]=l.dims[d];f[a[0]]=c[0],f[a[1]]=c[1],u.push(Me(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const U2={linear:Ry,log:zC,exp:UC,pow:qC,quad:jy,poly:WC},dQ=(e,t)=>e==="poly"?t:e==="quad"?2:1;function q2(e){D.call(this,null,e)}q2.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(U2)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};z(q2,D,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=M5(i,e.groupby),s=(e.groupby||[]).map(tt),o=e.method||"linear",a=e.order||3,u=dQ(o,a),l=e.as||[tt(e.x),tt(e.y)],c=U2[o],f=[];let d=e.extent;se(U2,o)||N("Invalid regression method: "+o),d!=null&&o==="log"&&d[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),d=null),r.forEach(h=>{if(h.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const p=c(h,e.x,e.y,a);if(e.params){f.push(Me({keys:h.dims,coef:p.coef,rSquared:p.rSquared}));return}const m=d||nr(h,e.x),y=v=>{const b={};for(let x=0;x<s.length;++x)b[s[x]]=h.dims[x];b[l[0]]=v[0],b[l[1]]=v[1],f.push(Me(b))};o==="linear"?m.forEach(v=>y([v,p.predict(v)])):Th(p.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});var hQ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",loess:z2,regression:q2});const T5=Math.pow(2,-52),M0=new Uint32Array(512);class T0{static from(t,n=vQ,i=bQ){const r=t.length,s=new Float64Array(r*2);for(let o=0;o<r;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=i(a)}return new T0(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:s}=this,o=t.length>>1;let a=1/0,u=1/0,l=-1/0,c=-1/0;for(let O=0;O<o;O++){const C=t[2*O],k=t[2*O+1];C<a&&(a=C),k<u&&(u=k),C>l&&(l=C),k>c&&(c=k),this._ids[O]=O}const f=(a+l)/2,d=(u+c)/2;let h=1/0,g,p,m;for(let O=0;O<o;O++){const C=W2(f,d,t[2*O],t[2*O+1]);C<h&&(g=O,h=C)}const y=t[2*g],v=t[2*g+1];h=1/0;for(let O=0;O<o;O++){if(O===g)continue;const C=W2(y,v,t[2*O],t[2*O+1]);C<h&&C>0&&(p=O,h=C)}let b=t[2*p],x=t[2*p+1],E=1/0;for(let O=0;O<o;O++){if(O===g||O===p)continue;const C=mQ(y,v,b,x,t[2*O],t[2*O+1]);C<E&&(m=O,E=C)}let _=t[2*m],w=t[2*m+1];if(E===1/0){for(let k=0;k<o;k++)this._dists[k]=t[2*k]-t[0]||t[2*k+1]-t[1];Zu(this._ids,this._dists,0,o-1);const O=new Uint32Array(o);let C=0;for(let k=0,F=-1/0;k<o;k++){const j=this._ids[k];this._dists[j]>F&&(O[C++]=j,F=this._dists[j])}this.hull=O.subarray(0,C),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(N0(y,v,b,x,_,w)){const O=p,C=b,k=x;p=m,b=_,x=w,m=O,_=C,w=k}const A=yQ(y,v,b,x,_,w);this._cx=A.x,this._cy=A.y;for(let O=0;O<o;O++)this._dists[O]=W2(t[2*O],t[2*O+1],A.x,A.y);Zu(this._ids,this._dists,0,o-1),this._hullStart=g;let S=3;i[g]=n[m]=p,i[p]=n[g]=m,i[m]=n[p]=g,r[g]=0,r[p]=1,r[m]=2,s.fill(-1),s[this._hashKey(y,v)]=g,s[this._hashKey(b,x)]=p,s[this._hashKey(_,w)]=m,this.trianglesLen=0,this._addTriangle(g,p,m,-1,-1,-1);for(let O=0,C,k;O<this._ids.length;O++){const F=this._ids[O],j=t[2*F],$=t[2*F+1];if(O>0&&Math.abs(j-C)<=T5&&Math.abs($-k)<=T5||(C=j,k=$,F===g||F===p||F===m))continue;let R=0;for(let De=0,Oe=this._hashKey(j,$);De<this._hashSize&&(R=s[(Oe+De)%this._hashSize],!(R!==-1&&R!==i[R]));De++);R=n[R];let L=R,U;for(;U=i[L],!N0(j,$,t[2*L],t[2*L+1],t[2*U],t[2*U+1]);)if(L=U,L===R){L=-1;break}if(L===-1)continue;let H=this._addTriangle(L,F,i[L],-1,-1,r[L]);r[F]=this._legalize(H+2),r[L]=H,S++;let ae=i[L];for(;U=i[ae],N0(j,$,t[2*ae],t[2*ae+1],t[2*U],t[2*U+1]);)H=this._addTriangle(ae,F,U,r[F],-1,r[ae]),r[F]=this._legalize(H+2),i[ae]=ae,S--,ae=U;if(L===R)for(;U=n[L],N0(j,$,t[2*U],t[2*U+1],t[2*L],t[2*L+1]);)H=this._addTriangle(U,F,L,-1,r[L],r[U]),this._legalize(H+2),r[U]=H,i[L]=L,S--,L=U;this._hullStart=n[F]=L,i[L]=n[ae]=F,i[F]=ae,s[this._hashKey(j,$)]=F,s[this._hashKey(t[2*L],t[2*L+1])]=L}this.hull=new Uint32Array(S);for(let O=0,C=this._hullStart;O<S;O++)this.hull[O]=C,C=i[C];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(gQ(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let s=0,o=0;for(;;){const a=i[t],u=t-t%3;if(o=u+(t+2)%3,a===-1){if(s===0)break;t=M0[--s];continue}const l=a-a%3,c=u+(t+1)%3,f=l+(a+2)%3,d=n[o],h=n[t],g=n[c],p=n[f];if(pQ(r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*g],r[2*g+1],r[2*p],r[2*p+1])){n[t]=p,n[a]=d;const y=i[f];if(y===-1){let b=this._hullStart;do{if(this._hullTri[b]===f){this._hullTri[b]=t;break}b=this._hullPrev[b]}while(b!==this._hullStart)}this._link(t,y),this._link(a,i[o]),this._link(o,f);const v=l+(a+1)%3;s<M0.length&&(M0[s++]=v)}else{if(s===0)break;t=M0[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=i,this._link(a,r),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function gQ(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function W2(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}function G2(e,t,n,i,r,s){const o=(i-t)*(r-e),a=(n-e)*(s-t);return Math.abs(o-a)>=33306690738754716e-32*Math.abs(o+a)?o-a:0}function N0(e,t,n,i,r,s){return(G2(r,s,e,t,n,i)||G2(e,t,n,i,r,s)||G2(n,i,r,s,e,t))<0}function pQ(e,t,n,i,r,s,o,a){const u=e-o,l=t-a,c=n-o,f=i-a,d=r-o,h=s-a,g=u*u+l*l,p=c*c+f*f,m=d*d+h*h;return u*(f*m-p*h)-l*(c*m-p*d)+g*(c*h-f*d)<0}function mQ(e,t,n,i,r,s){const o=n-e,a=i-t,u=r-e,l=s-t,c=o*o+a*a,f=u*u+l*l,d=.5/(o*l-a*u),h=(l*c-a*f)*d,g=(o*f-u*c)*d;return h*h+g*g}function yQ(e,t,n,i,r,s){const o=n-e,a=i-t,u=r-e,l=s-t,c=o*o+a*a,f=u*u+l*l,d=.5/(o*l-a*u),h=e+(l*c-a*f)*d,g=t+(o*f-u*c)*d;return{x:h,y:g}}function Zu(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const s=e[r],o=t[s];let a=r-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const r=n+i>>1;let s=n+1,o=i;Sf(e,r,s),t[e[n]]>t[e[i]]&&Sf(e,n,i),t[e[s]]>t[e[i]]&&Sf(e,s,i),t[e[n]]>t[e[s]]&&Sf(e,n,s);const a=e[s],u=t[a];for(;;){do s++;while(t[e[s]]<u);do o--;while(t[e[o]]>u);if(o<s)break;Sf(e,s,o)}e[n+1]=e[o],e[o]=a,i-s+1>=o-n?(Zu(e,t,s,i),Zu(e,t,n,o-1)):(Zu(e,t,n,o-1),Zu(e,t,s,i))}}function Sf(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function vQ(e){return e[0]}function bQ(e){return e[1]}const N5=1e-6;class pa{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>N5||Math.abs(this._y1-s)>N5)&&(this._+="L"+r+","+s),!!i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class H2{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}class xQ{constructor(t,[n,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this,s=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let h=0,g=0,p=i.length,m,y;h<p;h+=3,g+=2){const v=i[h]*2,b=i[h+1]*2,x=i[h+2]*2,E=t[v],_=t[v+1],w=t[b],A=t[b+1],S=t[x],O=t[x+1],C=w-E,k=A-_,F=S-E,j=O-_,$=C*C+k*k,R=F*F+j*j,L=(C*j-k*F)*2;if(!L)m=(E+S)/2-1e8*j,y=(_+O)/2+1e8*F;else if(Math.abs(L)<1e-8)m=(E+S)/2,y=(_+O)/2;else{const U=1/L;m=E+(j*$-k*R)*U,y=_+(C*R-F*$)*U}s[g]=m,s[g+1]=y}let o=n[n.length-1],a,u=o*4,l,c=t[2*o],f,d=t[2*o+1];r.fill(0);for(let h=0;h<n.length;++h)o=n[h],a=u,l=c,f=d,u=o*4,c=t[2*o],d=t[2*o+1],r[a+2]=r[u]=f-d,r[a+3]=r[u+1]=c-l}render(t){const n=t==null?t=new pa:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let c=0,f=i.length;c<f;++c){const d=i[c];if(d<c)continue;const h=Math.floor(c/3)*2,g=Math.floor(d/3)*2,p=o[h],m=o[h+1],y=o[g],v=o[g+1];this._renderSegment(p,m,y,v,t)}let u,l=s[s.length-1];for(let c=0;c<s.length;++c){u=l,l=s[c];const f=Math.floor(r[l]/3)*2,d=o[f],h=o[f+1],g=u*4,p=this._project(d,h,a[g+2],a[g+3]);p&&this._renderSegment(d,h,p[0],p[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new pa:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new pa:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(r[o]!==r[o-2]||r[o+1]!==r[o-1])&&n.lineTo(r[o],r[o+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new H2;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,s){let o;const a=this._regioncode(t,n),u=this._regioncode(i,r);a===0&&u===0?(s.moveTo(t,n),s.lineTo(i,r)):(o=this._clipSegment(t,n,i,r,a,u))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r)e:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,u=r.length;a<u;a+=2)if(n[s]==r[a]&&n[s+1]==r[a+1]&&n[(s+2)%o]==r[(a+u-2)%u]&&n[(s+3)%o]==r[(a+u-1)%u]){yield i;break e}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,o=i[t];if(o===-1)return null;const a=[];let u=o;do{const l=Math.floor(u/3);if(a.push(n[l*2],n[l*2+1]),u=u%3==2?u-2:u+1,s[u]!==t)break;u=r[u]}while(u!==o&&u!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n)}_clipFinite(t,n){const i=n.length;let r=null,s,o,a=n[i-2],u=n[i-1],l,c=this._regioncode(a,u),f,d;for(let h=0;h<i;h+=2)if(s=a,o=u,a=n[h],u=n[h+1],l=c,c=this._regioncode(a,u),l===0&&c===0)f=d,d=0,r?r.push(a,u):r=[a,u];else{let g,p,m,y,v;if(l===0){if((g=this._clipSegment(s,o,a,u,l,c))===null)continue;[p,m,y,v]=g}else{if((g=this._clipSegment(a,u,s,o,c,l))===null)continue;[y,v,p,m]=g,f=d,d=this._edgecode(p,m),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(p,m):r=[p,m]}f=d,d=this._edgecode(y,v),f&&d&&this._edge(t,f,d,r,r.length),r?r.push(y,v):r=[y,v]}if(r)f=d,d=this._edgecode(r[0],r[1]),f&&d&&this._edge(t,f,d,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,s,o){for(;;){if(s===0&&o===0)return[t,n,i,r];if(s&o)return null;let a,u,l=s||o;l&8?(a=t+(i-t)*(this.ymax-n)/(r-n),u=this.ymax):l&4?(a=t+(i-t)*(this.ymin-n)/(r-n),u=this.ymin):l&2?(u=n+(r-n)*(this.xmax-t)/(i-t),a=this.xmax):(u=n+(r-n)*(this.xmin-t)/(i-t),a=this.xmin),s?(t=a,n=u,s=this._regioncode(t,n)):(i=a,r=u,o=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,s,o){let a=Array.from(n),u;if((u=this._project(a[0],a[1],i,r))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(u[0],u[1]),a=this._clipFinite(t,a))for(let l=0,c=a.length,f,d=this._edgecode(a[c-2],a[c-1]);l<c;l+=2)f=d,d=this._edgecode(a[l],a[l+1]),f&&d&&(l=this._edge(t,f,d,a,l),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,i,r,s){for(;n!==i;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(r[s]!==o||r[s+1]!==a)&&this.contains(t,o,a)&&(r.splice(s,0,o,a),s+=2)}if(r.length>4)for(let o=0;o<r.length;o+=2){const a=(o+2)%r.length,u=(o+4)%r.length;(r[o]===r[a]&&r[a]===r[u]||r[o+1]===r[a+1]&&r[a+1]===r[u+1])&&(r.splice(a,2),o-=2)}return s}_project(t,n,i,r){let s=1/0,o,a,u;if(r<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/r)<s&&(u=this.ymin,a=t+(s=o)*i)}else if(r>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/r)<s&&(u=this.ymax,a=t+(s=o)*i)}if(i>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/i)<s&&(a=this.xmax,u=n+(s=o)*r)}else if(i<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/i)<s&&(a=this.xmin,u=n+(s=o)*r)}return[a,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}}const wQ=2*Math.PI,el=Math.pow;function EQ(e){return e[0]}function _Q(e){return e[1]}function AQ(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],s=2*t[i+1],o=2*t[i+2];if((n[o]-n[r])*(n[s+1]-n[r+1])-(n[s]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}function OQ(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Y2{static from(t,n=EQ,i=_Q,r){return new Y2("length"in t?SQ(t,n,i,r):Float64Array.from(CQ(t,n,i,r)))}constructor(t){this._delaunator=new T0(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&AQ(t)){this.collinear=Int32Array.from({length:n.length/2},(d,h)=>h).sort((d,h)=>n[2*d]-n[2*h]||n[2*d+1]-n[2*h+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let d=0,h=n.length/2;d<h;++d){const g=OQ(n[2*d],n[2*d+1],f);n[2*d]=g[0],n[2*d+1]=g[1]}this._delaunator=new T0(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,l=i.length;u<l;++u){const c=s[u%3==2?u-2:u+1];(i[u]===-1||o[c]===-1)&&(o[c]=u)}for(let u=0,l=r.length;u<l;++u)a[r[u]]=u;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],o[r[0]]=1,r.length===2&&(o[r[1]]=0))}voronoi(t){return new xQ(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:s,triangles:o,collinear:a}=this;if(a){const f=a.indexOf(t);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=o[l],l=l%3==2?l-2:l+1,o[l]!==t)return;if(l=s[l],l===-1){const f=i[(r[t]+1)%i.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let s;for(;(s=this._step(i,t,n))>=0&&s!==i&&s!==r;)i=s;return s}_step(t,n,i){const{inedges:r,hull:s,_hullIndex:o,halfedges:a,triangles:u,points:l}=this;if(r[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=el(n-l[t*2],2)+el(i-l[t*2+1],2);const d=r[t];let h=d;do{let g=u[h];const p=el(n-l[g*2],2)+el(i-l[g*2+1],2);if(p<f&&(f=p,c=g),h=h%3==2?h-2:h+1,u[h]!==t)break;if(h=a[h],h===-1){if(h=s[(o[t]+1)%s.length],h!==g&&el(n-l[h*2],2)+el(i-l[h*2+1],2)<f)return h;break}}while(h!==d);return c}render(t){const n=t==null?t=new pa:void 0,{points:i,halfedges:r,triangles:s}=this;for(let o=0,a=r.length;o<a;++o){const u=r[o];if(u<o)continue;const l=s[o]*2,c=s[u]*2;t.moveTo(i[l],i[l+1]),t.lineTo(i[c],i[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const i=t==null?t=new pa:void 0,{points:r}=this;for(let s=0,o=r.length;s<o;s+=2){const a=r[s],u=r[s+1];t.moveTo(a+n,u),t.arc(a,u,n,0,wQ)}return i&&i.value()}renderHull(t){const n=t==null?t=new pa:void 0,{hull:i,points:r}=this,s=i[0]*2,o=i.length;t.moveTo(r[s],r[s+1]);for(let a=1;a<o;++a){const u=2*i[a];t.lineTo(r[u],r[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new H2;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new pa:void 0,{points:r,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,u=s[t+2]*2;return n.moveTo(r[o],r[o+1]),n.lineTo(r[a],r[a+1]),n.lineTo(r[u],r[u+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new H2;return this.renderTriangle(t,n),n.value()}}function SQ(e,t,n,i){const r=e.length,s=new Float64Array(r*2);for(let o=0;o<r;++o){const a=e[o];s[o*2]=t.call(i,a,o,e),s[o*2+1]=n.call(i,a,o,e)}return s}function*CQ(e,t,n,i){let r=0;for(const s of e)yield t.call(i,s,r,e),yield n.call(i,s,r,e),++r}function V2(e){D.call(this,null,e)}V2.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const $Q=[-1e5,-1e5,1e5,1e5];z(V2,D,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:$Q;const s=this.value=Y2.from(i,e.x,e.y).voronoi(r);for(let o=0,a=i.length;o<a;++o){const u=s.cellPolygon(o);i[o][n]=u?FQ(u):null}return t.reflow(e.modified()).modifies(n)}});function FQ(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}var kQ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",voronoi:V2}),X2=Math.PI/180,Cf=1<<11>>5,R0=1<<11;function DQ(){var e=[256,256],t,n,i,r,s,o,a,u=R5,l=[],c=Math.random,f={};f.layout=function(){for(var g=d(Au()),p=LQ((e[0]>>5)*e[1]),m=null,y=l.length,v=-1,b=[],x=l.map(_=>({text:t(_),font:n(_),style:r(_),weight:s(_),rotate:o(_),size:~~(i(_)+1e-14),padding:a(_),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:_})).sort((_,w)=>w.size-_.size);++v<y;){var E=x[v];E.x=e[0]*(c()+.5)>>1,E.y=e[1]*(c()+.5)>>1,MQ(g,E,x,v),E.hasText&&h(p,E,m)&&(b.push(E),m?NQ(m,E):m=[{x:E.x+E.x0,y:E.y+E.y0},{x:E.x+E.x1,y:E.y+E.y1}],E.x-=e[0]>>1,E.y-=e[1]>>1)}return b};function d(g){g.width=g.height=1;var p=Math.sqrt(g.getContext("2d").getImageData(0,0,1,1).data.length>>2);g.width=(Cf<<5)/p,g.height=R0/p;var m=g.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:p}}function h(g,p,m){for(var y=p.x,v=p.y,b=Math.sqrt(e[0]*e[0]+e[1]*e[1]),x=u(e),E=c()<.5?1:-1,_=-E,w,A,S;(w=x(_+=E))&&(A=~~w[0],S=~~w[1],!(Math.min(Math.abs(A),Math.abs(S))>=b));)if(p.x=y+A,p.y=v+S,!(p.x+p.x0<0||p.y+p.y0<0||p.x+p.x1>e[0]||p.y+p.y1>e[1])&&(!m||!TQ(p,g,e[0]))&&(!m||RQ(p,m))){for(var O=p.sprite,C=p.width>>5,k=e[0]>>5,F=p.x-(C<<4),j=F&127,$=32-j,R=p.y1-p.y0,L=(p.y+p.y0)*k+(F>>5),U,H=0;H<R;H++){U=0;for(var ae=0;ae<=C;ae++)g[L+ae]|=U<<$|(ae<C?(U=O[H*C+ae])>>>j:0);L+=k}return p.sprite=null,!0}return!1}return f.words=function(g){return arguments.length?(l=g,f):l},f.size=function(g){return arguments.length?(e=[+g[0],+g[1]],f):e},f.font=function(g){return arguments.length?(n=ma(g),f):n},f.fontStyle=function(g){return arguments.length?(r=ma(g),f):r},f.fontWeight=function(g){return arguments.length?(s=ma(g),f):s},f.rotate=function(g){return arguments.length?(o=ma(g),f):o},f.text=function(g){return arguments.length?(t=ma(g),f):t},f.spiral=function(g){return arguments.length?(u=PQ[g]||g,f):u},f.fontSize=function(g){return arguments.length?(i=ma(g),f):i},f.padding=function(g){return arguments.length?(a=ma(g),f):a},f.random=function(g){return arguments.length?(c=g,f):c},f}function MQ(e,t,n,i){if(!t.sprite){var r=e.context,s=e.ratio;r.clearRect(0,0,(Cf<<5)/s,R0/s);var o=0,a=0,u=0,l=n.length,c,f,d,h,g;for(--i;++i<l;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,c=r.measureText(t.text+"m").width*s,d=t.size<<1,t.rotate){var p=Math.sin(t.rotate*X2),m=Math.cos(t.rotate*X2),y=c*m,v=c*p,b=d*m,x=d*p;c=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,d=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else c=c+31>>5<<5;if(d>u&&(u=d),o+c>=Cf<<5&&(o=0,a+=u,u=0),a+d>=R0)break;r.translate((o+(c>>1))/s,(a+(d>>1))/s),t.rotate&&r.rotate(t.rotate*X2),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=d,t.xoff=o,t.yoff=a,t.x1=c>>1,t.y1=d>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var E=r.getImageData(0,0,(Cf<<5)/s,R0/s).data,_=[];--i>=0;)if(t=n[i],!!t.hasText){for(c=t.width,f=c>>5,d=t.y1-t.y0,h=0;h<d*f;h++)_[h]=0;if(o=t.xoff,o==null)return;a=t.yoff;var w=0,A=-1;for(g=0;g<d;g++){for(h=0;h<c;h++){var S=f*g+(h>>5),O=E[(a+g)*(Cf<<5)+(o+h)<<2]?1<<31-h%32:0;_[S]|=O,w|=O}w?A=g:(t.y0++,d--,g--,a++)}t.y1=t.y0+A,t.sprite=_.slice(0,(t.y1-t.y0)*f)}}}function TQ(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,s=e.x-(r<<4),o=s&127,a=32-o,u=e.y1-e.y0,l=(e.y+e.y0)*n+(s>>5),c,f=0;f<u;f++){c=0;for(var d=0;d<=r;d++)if((c<<a|(d<r?(c=i[f*r+d])>>>o:0))&t[l+d])return!0;l+=n}return!1}function NQ(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function RQ(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function R5(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function jQ(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(s){var o=s<0?-1:1;switch(Math.sqrt(1+4*o*s)-o&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function LQ(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function ma(e){return typeof e=="function"?e:function(){return e}}var PQ={archimedean:R5,rectangular:jQ};const j5=["x","y","font","fontSize","fontStyle","fontWeight","angle"],IQ=["text","font","rotate","fontSize","fontStyle","fontWeight"];function K2(e){D.call(this,DQ(),e)}K2.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:j5}]};z(K2,D,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&N("Wordcloud size dimensions must be non-zero.");function n(g){const p=e[g];return ge(p)&&t.modified(p.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||IQ.some(n)))return;const r=t.materialize(t.SOURCE).source,s=this.value,o=e.as||j5;let a=e.fontSize||14,u;if(ge(a)?u=e.fontSizeRange:a=qt(a),u){const g=a,p=$e("sqrt")().domain(nr(r,g)).range(u);a=m=>p(g(m))}r.forEach(g=>{g[o[0]]=NaN,g[o[1]]=NaN,g[o[3]]=0});const l=s.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(a).random(li).layout(),c=s.size(),f=c[0]>>1,d=c[1]>>1,h=l.length;for(let g=0,p,m;g<h;++g)p=l[g],m=p.datum,m[o[0]]=p.x+f,m[o[1]]=p.y+d,m[o[2]]=p.font,m[o[3]]=p.size,m[o[4]]=p.style,m[o[5]]=p.weight,m[o[6]]=p.rotate;return t.reflow(i).modifies(o)}});var BQ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",wordcloud:K2});const zQ=e=>new Uint8Array(e),UQ=e=>new Uint16Array(e),$f=e=>new Uint32Array(e);function qQ(){let e=8,t=[],n=$f(0),i=j0(0,e),r=j0(0,e);return{data:()=>t,seen:()=>n=WQ(n,t.length),add(s){for(let o=0,a=t.length,u=s.length,l;o<u;++o)l=s[o],l._index=a++,t.push(l)},remove(s,o){const a=t.length,u=Array(a-s),l=t;let c,f,d;for(f=0;!o[f]&&f<a;++f)u[f]=t[f],l[f]=f;for(d=f;f<a;++f)c=t[f],o[f]?l[f]=-1:(l[f]=d,i[d]=i[f],r[d]=r[f],u[d]=c,c._index=d++),i[f]=0;return t=u,l},size:()=>t.length,curr:()=>i,prev:()=>r,reset:s=>r[s]=i[s],all:()=>e<257?255:e<65537?65535:4294967295,set(s,o){i[s]|=o},clear(s,o){i[s]&=~o},resize(s,o){const a=i.length;(s>a||o>e)&&(e=Math.max(o,e),i=j0(s,e,i),r=j0(s,e))}}}function WQ(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function j0(e,t,n){const i=(t<257?zQ:t<65537?UQ:$f)(e);return n&&i.set(n),i}function L5(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(r,s){const o=this,a=o.bisect(o.range,r.value),u=r.index,l=a[0],c=a[1],f=u.length;let d;for(d=0;d<l;++d)s[u[d]]|=i;for(d=c;d<f;++d)s[u[d]]|=i;return o}}}function P5(){let e=$f(0),t=[],n=0;function i(a,u,l){if(!u.length)return[];const c=n,f=u.length,d=$f(f);let h=Array(f),g,p,m;for(m=0;m<f;++m)h[m]=a(u[m]),d[m]=m;if(h=GQ(h,d),c)g=t,p=e,t=Array(c+f),e=$f(c+f),HQ(l,g,p,c,h,d,f,t,e);else{if(l>0)for(m=0;m<f;++m)d[m]+=l;t=h,e=d}return n=c+f,{index:d,value:h}}function r(a,u){const l=n;let c,f,d;for(f=0;!u[e[f]]&&f<l;++f);for(d=f;f<l;++f)u[c=e[f]]||(e[d]=c,t[d]=t[f],++d);n=l-a}function s(a){for(let u=0,l=n;u<l;++u)e[u]=a[e[u]]}function o(a,u){let l;return u?l=u.length:(u=t,l=n),[EP(u,a[0],0,l),lh(u,a[1],0,l)]}return{insert:i,remove:r,bisect:o,reindex:s,index:()=>e,size:()=>n}}function GQ(e,t){return e.sort.call(t,(n,i)=>{const r=e[n],s=e[i];return r<s?-1:r>s?1:0}),OP(e,t)}function HQ(e,t,n,i,r,s,o,a,u){let l=0,c=0,f;for(f=0;l<i&&c<o;++f)t[l]<r[c]?(a[f]=t[l],u[f]=n[l++]):(a[f]=r[c],u[f]=s[c++]+e);for(;l<i;++l,++f)a[f]=t[l],u[f]=n[l];for(;c<o;++c,++f)a[f]=r[c],u[f]=s[c]+e}function J2(e){D.call(this,qQ(),e),this._indices=null,this._dims=null}J2.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};z(J2,D,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(i=>t.modified(i.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,i=e.query,r=this._indices={},s=this._dims=[],o=i.length;let a=0,u,l;for(;a<o;++a)u=n[a].fname,l=r[u]||(r[u]=P5()),s.push(L5(l,a,i[a]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,r=e.query,s=this._indices,o=this._dims,a=this.value,u=a.curr(),l=a.prev(),c=a.all(),f=n.rem=n.add,d=n.mod,h=r.length,g={};let p,m,y,v,b,x,E,_,w;if(l.set(u),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&a.add(t.add),t.mod.length)for(x={},v=t.mod,E=0,_=v.length;E<_;++E)x[v[E]._index]=1;for(E=0;E<h;++E)w=i[E],(!o[E]||e.modified("fields",E)||t.modified(w.fields))&&(y=w.fname,(p=g[y])||(s[y]=m=P5(),g[y]=p=m.insert(w,t.source,0)),o[E]=L5(m,E,r[E]).onAdd(p,u));for(E=0,_=a.data().length;E<_;++E)b[E]||(l[E]!==u[E]?f.push(E):x[E]&&u[E]!==c&&d.push(E));return a.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},insert(e,t,n){const i=t.add,r=this.value,s=this._dims,o=this._indices,a=e.fields,u={},l=n.add,c=r.size()+i.length,f=s.length;let d=r.size(),h,g,p;r.resize(c,f),r.add(i);const m=r.curr(),y=r.prev(),v=r.all();for(h=0;h<f;++h)g=a[h].fname,p=u[g]||(u[g]=o[g].insert(a[h],i,d)),s[h].onAdd(p,m);for(;d<c;++d)y[d]=v,m[d]!==v&&l.push(d)},modify(e,t){const n=t.mod,i=this.value,r=i.curr(),s=i.all(),o=e.mod;let a,u,l;for(a=0,u=o.length;a<u;++a)l=o[a]._index,r[l]!==s&&n.push(l)},remove(e,t,n){const i=this._indices,r=this.value,s=r.curr(),o=r.prev(),a=r.all(),u={},l=n.rem,c=t.rem;let f,d,h,g;for(f=0,d=c.length;f<d;++f)h=c[f]._index,u[h]=1,o[h]=g=s[h],s[h]=a,g!==a&&l.push(h);for(h in i)i[h].remove(d,u);return this.reindex(t,d,u),u},reindex(e,t,n){const i=this._indices,r=this.value;e.runAfter(()=>{const s=r.remove(t,n);for(const o in i)i[o].reindex(s)})},update(e,t,n){const i=this._dims,r=e.query,s=t.stamp,o=i.length;let a=0,u,l;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(u=l,++a);if(a===1)a=i[u].one,this.incrementOne(i[u],r[u],n.add,n.rem);else for(l=0,a=0;l<o;++l)!e.modified("query",l)||(a|=i[l].one,this.incrementAll(i[l],r[l],s,n.add),n.rem=n.add);return a},incrementAll(e,t,n,i){const r=this.value,s=r.seen(),o=r.curr(),a=r.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=l[0],g=l[1],p=e.one;let m,y,v;if(f<h)for(m=f,y=Math.min(h,d);m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=p;else if(f>h)for(m=h,y=Math.min(f,g);m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=p;if(d>g)for(m=Math.max(f,g),y=d;m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=p;else if(d<g)for(m=Math.max(h,d),y=g;m<y;++m)v=u[m],s[v]!==n&&(a[v]=o[v],s[v]=n,i.push(v)),o[v]^=p;e.range=t.slice()},incrementOne(e,t,n,i){const r=this.value,s=r.curr(),o=e.index(),a=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=a[0],d=a[1],h=e.one;let g,p,m;if(l<f)for(g=l,p=Math.min(f,c);g<p;++g)m=o[g],s[m]^=h,n.push(m);else if(l>f)for(g=f,p=Math.min(l,d);g<p;++g)m=o[g],s[m]^=h,i.push(m);if(c>d)for(g=Math.max(l,d),p=c;g<p;++g)m=o[g],s[m]^=h,n.push(m);else if(c<d)for(g=Math.max(f,c),p=d;g<p;++g)m=o[g],s[m]^=h,i.push(m);e.range=t.slice()}});function Q2(e){D.call(this,null,e)}Q2.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};z(Q2,D,{transform(e,t){const n=~(e.ignore||0),i=e.filter,r=i.mask;if((r&n)==0)return t.StopPropagation;const s=t.fork(t.ALL),o=i.data(),a=i.curr(),u=i.prev(),l=c=>a[c]&n?null:o[c];return s.filter(s.MOD,l),r&r-1?(s.filter(s.ADD,c=>{const f=a[c]&n;return!f&&f^u[c]&n?o[c]:null}),s.filter(s.REM,c=>{const f=a[c]&n;return f&&!(f^(f^u[c]&n))?o[c]:null})):(s.filter(s.ADD,l),s.filter(s.REM,c=>(a[c]&n)===r?o[c]:null)),s.filter(s.SOURCE,c=>l(c._index))}});var YQ=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",crossfilter:J2,resolvefilter:Q2});const VQ="RawCode",ya="Literal",XQ="Property",KQ="Identifier",JQ="ArrayExpression",QQ="BinaryExpression",I5="CallExpression",ZQ="ConditionalExpression",eZ="LogicalExpression",tZ="MemberExpression",nZ="ObjectExpression",iZ="UnaryExpression";function Bi(e){this.type=e}Bi.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=rZ(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function rZ(e){switch(e.type){case JQ:return e.elements;case QQ:case eZ:return[e.left,e.right];case I5:return[e.callee].concat(e.arguments);case ZQ:return[e.test,e.consequent,e.alternate];case tZ:return[e.object,e.property];case nZ:return e.properties;case XQ:return[e.key,e.value];case iZ:return[e.argument];case KQ:case ya:case VQ:default:return[]}}var xr,Y,M,Kt,Re,L0=1,Ff=2,va=3,lo=4,P0=5,ba=6,Rn=7,kf=8,sZ=9;xr={};xr[L0]="Boolean";xr[Ff]="<end>";xr[va]="Identifier";xr[lo]="Keyword";xr[P0]="Null";xr[ba]="Numeric";xr[Rn]="Punctuator";xr[kf]="String";xr[sZ]="RegularExpression";var oZ="ArrayExpression",aZ="BinaryExpression",uZ="CallExpression",lZ="ConditionalExpression",B5="Identifier",cZ="Literal",fZ="LogicalExpression",dZ="MemberExpression",hZ="ObjectExpression",gZ="Property",pZ="UnaryExpression",Ct="Unexpected token %0",mZ="Unexpected number",yZ="Unexpected string",vZ="Unexpected identifier",bZ="Unexpected reserved word",xZ="Unexpected end of input",Z2="Invalid regular expression",ew="Invalid regular expression: missing /",z5="Octal literals are not allowed in strict mode.",wZ="Duplicate data property in object literal not allowed in strict mode",Lt="ILLEGAL",Df="Disabled.",EZ=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),_Z=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function I0(e,t){if(!e)throw new Error("ASSERT: "+t)}function ss(e){return e>=48&&e<=57}function tw(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Mf(e){return"01234567".indexOf(e)>=0}function AZ(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Tf(e){return e===10||e===13||e===8232||e===8233}function Nf(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&EZ.test(String.fromCharCode(e))}function B0(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&_Z.test(String.fromCharCode(e))}const OZ={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function U5(){for(;M<Kt;){const e=Y.charCodeAt(M);if(AZ(e)||Tf(e))++M;else break}}function nw(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)M<Kt&&tw(Y[M])?(i=Y[M++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):Fe({},Ct,Lt);return String.fromCharCode(r)}function SZ(){var e,t,n,i;for(e=Y[M],t=0,e==="}"&&Fe({},Ct,Lt);M<Kt&&(e=Y[M++],!!tw(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Fe({},Ct,Lt),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function q5(){var e,t;for(e=Y.charCodeAt(M++),t=String.fromCharCode(e),e===92&&(Y.charCodeAt(M)!==117&&Fe({},Ct,Lt),++M,e=nw("u"),(!e||e==="\\"||!Nf(e.charCodeAt(0)))&&Fe({},Ct,Lt),t=e);M<Kt&&(e=Y.charCodeAt(M),!!B0(e));)++M,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Y.charCodeAt(M)!==117&&Fe({},Ct,Lt),++M,e=nw("u"),(!e||e==="\\"||!B0(e.charCodeAt(0)))&&Fe({},Ct,Lt),t+=e);return t}function CZ(){var e,t;for(e=M++;M<Kt;){if(t=Y.charCodeAt(M),t===92)return M=e,q5();if(B0(t))++M;else break}return Y.slice(e,M)}function $Z(){var e,t,n;return e=M,t=Y.charCodeAt(M)===92?q5():CZ(),t.length===1?n=va:OZ.hasOwnProperty(t)?n=lo:t==="null"?n=P0:t==="true"||t==="false"?n=L0:n=va,{type:n,value:t,start:e,end:M}}function iw(){var e=M,t=Y.charCodeAt(M),n,i=Y[M],r,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++M,{type:Rn,value:String.fromCharCode(t),start:e,end:M};default:if(n=Y.charCodeAt(M+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return M+=2,{type:Rn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:M};case 33:case 61:return M+=2,Y.charCodeAt(M)===61&&++M,{type:Rn,value:Y.slice(e,M),start:e,end:M}}}if(o=Y.substr(M,4),o===">>>=")return M+=4,{type:Rn,value:o,start:e,end:M};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return M+=3,{type:Rn,value:s,start:e,end:M};if(r=s.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return M+=2,{type:Rn,value:r,start:e,end:M};if(r==="//"&&Fe({},Ct,Lt),"<>=!+-*%&|^/".indexOf(i)>=0)return++M,{type:Rn,value:i,start:e,end:M};Fe({},Ct,Lt)}function FZ(e){let t="";for(;M<Kt&&tw(Y[M]);)t+=Y[M++];return t.length===0&&Fe({},Ct,Lt),Nf(Y.charCodeAt(M))&&Fe({},Ct,Lt),{type:ba,value:parseInt("0x"+t,16),start:e,end:M}}function kZ(e){let t="0"+Y[M++];for(;M<Kt&&Mf(Y[M]);)t+=Y[M++];return(Nf(Y.charCodeAt(M))||ss(Y.charCodeAt(M)))&&Fe({},Ct,Lt),{type:ba,value:parseInt(t,8),octal:!0,start:e,end:M}}function W5(){var e,t,n;if(n=Y[M],I0(ss(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=M,e="",n!=="."){if(e=Y[M++],n=Y[M],e==="0"){if(n==="x"||n==="X")return++M,FZ(t);if(Mf(n))return kZ(t);n&&ss(n.charCodeAt(0))&&Fe({},Ct,Lt)}for(;ss(Y.charCodeAt(M));)e+=Y[M++];n=Y[M]}if(n==="."){for(e+=Y[M++];ss(Y.charCodeAt(M));)e+=Y[M++];n=Y[M]}if(n==="e"||n==="E")if(e+=Y[M++],n=Y[M],(n==="+"||n==="-")&&(e+=Y[M++]),ss(Y.charCodeAt(M)))for(;ss(Y.charCodeAt(M));)e+=Y[M++];else Fe({},Ct,Lt);return Nf(Y.charCodeAt(M))&&Fe({},Ct,Lt),{type:ba,value:parseFloat(e),start:t,end:M}}function DZ(){var e="",t,n,i,r,s=!1;for(t=Y[M],I0(t==="'"||t==='"',"String literal must starts with a quote"),n=M,++M;M<Kt;)if(i=Y[M++],i===t){t="";break}else if(i==="\\")if(i=Y[M++],!i||!Tf(i.charCodeAt(0)))switch(i){case"u":case"x":Y[M]==="{"?(++M,e+=SZ()):e+=nw(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Mf(i)?(r="01234567".indexOf(i),r!==0&&(s=!0),M<Kt&&Mf(Y[M])&&(s=!0,r=r*8+"01234567".indexOf(Y[M++]),"0123".indexOf(i)>=0&&M<Kt&&Mf(Y[M])&&(r=r*8+"01234567".indexOf(Y[M++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&Y[M]===`
`&&++M;else{if(Tf(i.charCodeAt(0)))break;e+=i}return t!==""&&Fe({},Ct,Lt),{type:kf,value:e,octal:s,start:n,end:M}}function MZ(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";Fe({},Z2)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Fe({},Z2)}try{return new RegExp(e,t)}catch{return null}}function TZ(){var e,t,n,i,r;for(e=Y[M],I0(e==="/","Regular expression literal must start with a slash"),t=Y[M++],n=!1,i=!1;M<Kt;)if(e=Y[M++],t+=e,e==="\\")e=Y[M++],Tf(e.charCodeAt(0))&&Fe({},ew),t+=e;else if(Tf(e.charCodeAt(0)))Fe({},ew);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||Fe({},ew),r=t.substr(1,t.length-2),{value:r,literal:t}}function NZ(){var e,t,n;for(t="",n="";M<Kt&&(e=Y[M],!!B0(e.charCodeAt(0)));)++M,e==="\\"&&M<Kt?Fe({},Ct,Lt):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Fe({},Z2,n),{value:n,literal:t}}function RZ(){var e,t,n,i;return Re=null,U5(),e=M,t=TZ(),n=NZ(),i=MZ(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:M}}function jZ(e){return e.type===va||e.type===lo||e.type===L0||e.type===P0}function G5(){if(U5(),M>=Kt)return{type:Ff,start:M,end:M};const e=Y.charCodeAt(M);return Nf(e)?$Z():e===40||e===41||e===59?iw():e===39||e===34?DZ():e===46?ss(Y.charCodeAt(M+1))?W5():iw():ss(e)?W5():iw()}function jn(){const e=Re;return M=e.end,Re=G5(),M=e.end,e}function H5(){const e=M;Re=G5(),M=e}function LZ(e){const t=new Bi(oZ);return t.elements=e,t}function Y5(e,t,n){const i=new Bi(e==="||"||e==="&&"?fZ:aZ);return i.operator=e,i.left=t,i.right=n,i}function PZ(e,t){const n=new Bi(uZ);return n.callee=e,n.arguments=t,n}function IZ(e,t,n){const i=new Bi(lZ);return i.test=e,i.consequent=t,i.alternate=n,i}function rw(e){const t=new Bi(B5);return t.name=e,t}function Rf(e){const t=new Bi(cZ);return t.value=e.value,t.raw=Y.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function V5(e,t,n){const i=new Bi(dZ);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function BZ(e){const t=new Bi(hZ);return t.properties=e,t}function X5(e,t,n){const i=new Bi(gZ);return i.key=t,i.value=n,i.kind=e,i}function zZ(e,t){const n=new Bi(pZ);return n.operator=e,n.argument=t,n.prefix=!0,n}function Fe(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(s,o)=>(I0(o<i.length,"Message reference must be in range"),i[o]));throw n=new Error(r),n.index=M,n.description=r,n}function z0(e){e.type===Ff&&Fe(e,xZ),e.type===ba&&Fe(e,mZ),e.type===kf&&Fe(e,yZ),e.type===va&&Fe(e,vZ),e.type===lo&&Fe(e,bZ),Fe(e,Ct,e.value)}function Jt(e){const t=jn();(t.type!==Rn||t.value!==e)&&z0(t)}function He(e){return Re.type===Rn&&Re.value===e}function sw(e){return Re.type===lo&&Re.value===e}function UZ(){const e=[];for(M=Re.start,Jt("[");!He("]");)He(",")?(jn(),e.push(null)):(e.push(xa()),He("]")||Jt(","));return jn(),LZ(e)}function K5(){M=Re.start;const e=jn();return e.type===kf||e.type===ba?(e.octal&&Fe(e,z5),Rf(e)):rw(e.value)}function qZ(){var e,t,n,i;if(M=Re.start,e=Re,e.type===va)return n=K5(),Jt(":"),i=xa(),X5("init",n,i);if(e.type===Ff||e.type===Rn)z0(e);else return t=K5(),Jt(":"),i=xa(),X5("init",t,i)}function WZ(){var e=[],t,n,i,r={},s=String;for(M=Re.start,Jt("{");!He("}");)t=qZ(),t.key.type===B5?n=t.key.name:n=s(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?Fe({},wZ):r[i]=!0,e.push(t),He("}")||Jt(",");return Jt("}"),BZ(e)}function GZ(){Jt("(");const e=ow();return Jt(")"),e}const HZ={if:1};function YZ(){var e,t,n;if(He("("))return GZ();if(He("["))return UZ();if(He("{"))return WZ();if(e=Re.type,M=Re.start,e===va||HZ[Re.value])n=rw(jn().value);else if(e===kf||e===ba)Re.octal&&Fe(Re,z5),n=Rf(jn());else{if(e===lo)throw new Error(Df);e===L0?(t=jn(),t.value=t.value==="true",n=Rf(t)):e===P0?(t=jn(),t.value=null,n=Rf(t)):He("/")||He("/=")?(n=Rf(RZ()),H5()):z0(jn())}return n}function VZ(){const e=[];if(Jt("("),!He(")"))for(;M<Kt&&(e.push(xa()),!He(")"));)Jt(",");return Jt(")"),e}function XZ(){M=Re.start;const e=jn();return jZ(e)||z0(e),rw(e.value)}function KZ(){return Jt("."),XZ()}function JZ(){Jt("[");const e=ow();return Jt("]"),e}function QZ(){var e,t,n;for(e=YZ();;)if(He("."))n=KZ(),e=V5(".",e,n);else if(He("("))t=VZ(),e=PZ(e,t);else if(He("["))n=JZ(),e=V5("[",e,n);else break;return e}function J5(){const e=QZ();if(Re.type===Rn&&(He("++")||He("--")))throw new Error(Df);return e}function U0(){var e,t;if(Re.type!==Rn&&Re.type!==lo)t=J5();else{if(He("++")||He("--"))throw new Error(Df);if(He("+")||He("-")||He("~")||He("!"))e=jn(),t=U0(),t=zZ(e.value,t);else{if(sw("delete")||sw("void")||sw("typeof"))throw new Error(Df);t=J5()}}return t}function Q5(e){let t=0;if(e.type!==Rn&&e.type!==lo)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function ZZ(){var e,t,n,i,r,s,o,a,u,l;if(e=Re,u=U0(),i=Re,r=Q5(i),r===0)return u;for(i.prec=r,jn(),t=[e,Re],o=U0(),s=[u,i,o];(r=Q5(Re))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=Y5(a,u,o),s.push(n);i=jn(),i.prec=r,s.push(i),t.push(Re),n=U0(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=Y5(s[l-1].value,s[l-2],n),l-=2;return n}function xa(){var e,t,n;return e=ZZ(),He("?")&&(jn(),t=xa(),Jt(":"),n=xa(),e=IZ(e,t,n)),e}function ow(){const e=xa();if(He(","))throw new Error(Df);return e}function Z5(e){Y=e,M=0,Kt=Y.length,Re=null,H5();const t=ow();if(Re.type!==Ff)throw new Error("Unexpect token after expression.");return t}var eT={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function tT(e){function t(o,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(o,a,u){return l=>t(o,l,a,u)}const i="new Date",r="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&N("Missing arguments to clamp function."),o.length>3&&N("Too many arguments to clamp function.");const a=o.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&N("Missing arguments to if function."),o.length>3&&N("Too many arguments to if function.");const a=o.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function eee(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function nT(e){e=e||{};const t=e.allowed?Fi(e.allowed):{},n=e.forbidden?Fi(e.forbidden):{},i=e.constants||eT,r=(e.functions||tT)(f),s=e.globalvar,o=e.fieldvar,a=ge(s)?s:g=>`${s}["${g}"]`;let u={},l={},c=0;function f(g){if(_e(g))return g;const p=d[g.type];return p==null&&N("Unsupported type: "+g.type),p(g)}const d={Literal:g=>g.raw,Identifier:g=>{const p=g.name;return c>0?p:se(n,p)?N("Illegal identifier: "+p):se(i,p)?i[p]:se(t,p)?p:(u[p]=1,a(p))},MemberExpression:g=>{const p=!g.computed,m=f(g.object);p&&(c+=1);const y=f(g.property);return m===o&&(l[eee(y)]=1),p&&(c-=1),m+(p?"."+y:"["+y+"]")},CallExpression:g=>{g.callee.type!=="Identifier"&&N("Illegal callee type: "+g.callee.type);const p=g.callee.name,m=g.arguments,y=se(r,p)&&r[p];return y||N("Unrecognized function: "+p),ge(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:g=>"["+g.elements.map(f).join(",")+"]",BinaryExpression:g=>"("+f(g.left)+" "+g.operator+" "+f(g.right)+")",UnaryExpression:g=>"("+g.operator+f(g.argument)+")",ConditionalExpression:g=>"("+f(g.test)+"?"+f(g.consequent)+":"+f(g.alternate)+")",LogicalExpression:g=>"("+f(g.left)+g.operator+f(g.right)+")",ObjectExpression:g=>"{"+g.properties.map(f).join(",")+"}",Property:g=>{c+=1;const p=f(g.key);return c-=1,p+":"+f(g.value)}};function h(g){const p={code:f(g),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},p}return h.functions=r,h.constants=i,h}function tee(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function nee(e){let t=e,n=e;e.length===1&&(t=(o,a)=>e(o)-a,n=iee(e));function i(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)<0?u=c+1:l=c}return u}function r(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)>0?l=c:u=c+1}return u}function s(o,a,u,l){u==null&&(u=0),l==null&&(l=o.length);const c=i(o,a,u,l-1);return c>u&&t(o[c-1],a)>-t(o[c],a)?c-1:c}return{left:i,center:s,right:r}}function iee(e){return(t,n)=>tee(e(t),n)}const aw="intersect",iT="union",ree="vlMulti",see="vlPoint",rT="or",oee="and",aee="_vgsid_",uee="E",lee="R",cee="R-E",fee="R-LE",dee="R-RE",q0="index:unit";function sT(e,t){for(var n=t.fields,i=t.values,r=n.length,s=0,o,a;s<r;++s)if(a=n[s],a.getter=Cn.getter||Cn(a.field),o=a.getter(e),Cs(o)&&(o=Ut(o)),Cs(i[s])&&(i[s]=Ut(i[s])),Cs(i[s][0])&&(i[s]=i[s].map(Ut)),a.type===uee){if(K(i[s])?i[s].indexOf(o)<0:o!==i[s])return!1}else if(a.type===lee){if(!cu(o,i[s]))return!1}else if(a.type===dee){if(!cu(o,i[s],!0,!1))return!1}else if(a.type===cee){if(!cu(o,i[s],!1,!1))return!1}else if(a.type===fee&&!cu(o,i[s],!1,!0))return!1;return!0}function hee(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],s=i?i[q0]&&i[q0].value:void 0,o=n===aw,a=r.length,u=0,l,c,f,d,h;u<a;++u)if(l=r[u],s&&o){if(c=c||{},f=c[d=l.unit]||0,f===-1)continue;if(h=sT(t,l),c[d]=h?-1:++f,h&&s.size===1)return!0;if(!h&&f===s.get(d).count)return!1}else if(h=sT(t,l),o^h)return h;return a&&o}const uw=Cn(aee),oT=nee(uw),gee=oT.left,pee=oT.right;function mee(e,t,n){const i=this.context.data[e],r=i?i.values.value:[],s=i?i[q0]&&i[q0].value:void 0,o=n===aw,a=uw(t),u=gee(r,a);if(u===r.length||uw(r[u])!==a)return!1;if(s&&o){if(s.size===1)return!0;if(pee(r,a)-u<s.size)return!1}return!0}function yee(e,t){return e.map(n=>de({values:t.fields.map(i=>(i.getter||(i.getter=Cn(i.field)))(n.datum))},t))}function vee(e,t,n,i){for(var r=this.context.data[e],s=r?r.values.value:[],o={},a={},u={},l,c,f,d,h,g,p,m,y,v=s.length,b=0,x,E;b<v;++b){for(l=s[b],d=l.unit,c=l.fields,f=l.values,x=0,E=c.length;x<E;++x)h=c[x],g=o[h.field]||(o[h.field]={}),p=g[d]||(g[d]=[]),u[h.field]=m=h.type.charAt(0),y=aT[m+"_union"],g[d]=y(p,re(f[x]));n&&(p=a[d]||(a[d]=[]),p.push(re(f).reduce((_,w,A)=>(_[c[A].field]=w,_),{})))}if(t=t||iT,Object.keys(o).forEach(_=>{o[_]=Object.keys(o[_]).map(w=>o[_][w]).reduce((w,A)=>w===void 0?A:aT[u[_]+"_"+t](w,A))}),s=Object.keys(a),n&&s.length){const _=i?see:ree;o[_]=t===iT?{[rT]:s.reduce((w,A)=>(w.push(...a[A]),w),[])}:{[oee]:s.map(w=>({[rT]:a[w]}))}}return o}var aT={E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Ut(t[0]),i=Ut(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=Ut(t[0]),i=Ut(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const bee=":",xee="@";function lw(e,t,n,i){t[0].type!==ya&&N("First argument to selection functions must be a string literal.");const r=t[0].value,s=t.length>=2&&be(t).value,o="unit",a=xee+o,u=bee+r;s===aw&&!se(i,a)&&(i[a]=n.getData(r).indataRef(n,o)),se(i,u)||(i[u]=n.getData(r).tuplesRef())}function uT(e){const t=this.context.data[e];return t?t.values.value:[]}function wee(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function Eee(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(oi).insert(t)),1}function _ee(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const jf=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},Aee=jf("format"),lT=jf("timeFormat"),Oee=jf("utcFormat"),See=jf("timeParse"),Cee=jf("utcParse"),W0=new Date(2e3,0,1);function G0(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(W0.setYear(2e3),W0.setMonth(e),W0.setDate(t),lT.call(this,W0,n))}function $ee(e){return G0.call(this,e,1,"%B")}function Fee(e){return G0.call(this,e,1,"%b")}function kee(e){return G0.call(this,0,2+e,"%A")}function Dee(e){return G0.call(this,0,2+e,"%a")}const Mee=":",Tee="@",cw="%",cT="$";function fw(e,t,n,i){t[0].type!==ya&&N("First argument to data functions must be a string literal.");const r=t[0].value,s=Mee+r;if(!se(s,i))try{i[s]=n.getData(r).tuplesRef()}catch{}}function Nee(e,t,n,i){t[0].type!==ya&&N("First argument to indata must be a string literal."),t[1].type!==ya&&N("Second argument to indata must be a string literal.");const r=t[0].value,s=t[1].value,o=Tee+s;se(o,i)||(i[o]=n.getData(r).indataRef(n,s))}function Ln(e,t,n,i){if(t[0].type===ya)fT(n,i,t[0].value);else for(e in n.scales)fT(n,i,e)}function fT(e,t,n){const i=cw+n;if(!se(t,i))try{t[i]=e.scaleRef(n)}catch{}}function os(e,t){let n;return ge(e)?e:_e(e)?(n=t.scales[e])&&n.value:void 0}function Ree(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=Ln,n._range=Ln,n._scale=Ln;const i=r=>"_["+(r.type===ya?ee(cw+r.value):ee(cw)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function dw(e,t){return function(n,i,r){if(n){const s=os(n,(r||this).context);return s&&s.path[e](i)}else return t(i)}}const jee=dw("area",rV),Lee=dw("bounds",uV),Pee=dw("centroid",gV);function Iee(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function hw(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function Bee(){return hw(this.context.dataflow,"warn",arguments)}function zee(){return hw(this.context.dataflow,"info",arguments)}function Uee(){return hw(this.context.dataflow,"debug",arguments)}function gw(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function pw(e){const t=qs(e),n=gw(t.r),i=gw(t.g),r=gw(t.b);return .2126*n+.7152*i+.0722*r}function qee(e,t){const n=pw(e),i=pw(t),r=Math.max(n,i),s=Math.min(n,i);return(r+.05)/(s+.05)}function Wee(){const e=[].slice.call(arguments);return e.unshift({}),de(...e)}function dT(e,t){return e===t||e!==e&&t!==t?!0:K(e)?K(t)&&e.length===t.length?Gee(e,t):!1:ue(e)&&ue(t)?hT(e,t):!1}function Gee(e,t){for(let n=0,i=e.length;n<i;++n)if(!dT(e[n],t[n]))return!1;return!0}function hT(e,t){for(const n in e)if(!dT(e[n],t[n]))return!1;return!0}function gT(e){return t=>hT(e,t)}function Hee(e,t,n,i,r,s){const o=this.context.dataflow,a=this.context.data[e],u=a.input,l=o.stamp();let c=a.changes,f,d;if(o._trigger===!1||!(u.value.length||t||i))return 0;if((!c||c.stamp<l)&&(a.changes=c=o.changeset(),c.stamp=l,o.runAfter(()=>{a.modified=!0,o.pulse(u,c).run()},!0,1)),n&&(f=n===!0?oi:K(n)||Eh(n)?n:gT(n),c.remove(f)),t&&c.insert(t),i&&(f=gT(i),u.value.some(f)?c.remove(f):c.insert(i)),r)for(d in s)c.modify(r,d,s[d]);return 1}function Yee(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+i*i)}function Vee(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const pT={};function Xee(e,t){const n=pT[t]||(pT[t]=Cn(t));return K(e)?e.map(n):n(e)}function mw(e){return K(e)||ArrayBuffer.isView(e)?e:null}function yw(e){return mw(e)||(_e(e)?e:null)}function Kee(e,...t){return mw(e).join(...t)}function Jee(e,...t){return yw(e).indexOf(...t)}function Qee(e,...t){return yw(e).lastIndexOf(...t)}function Zee(e,...t){return yw(e).slice(...t)}function ete(e,t,n){return ge(n)&&N("Function argument passed to replace."),String(e).replace(t,n)}function tte(e){return mw(e).slice().reverse()}function nte(e,t,n){return Xv(e||0,t||0,n||0)}function ite(e,t){const n=os(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function rte(e,t){const n=os(e,(t||this).context);return n?n.copy():void 0}function ste(e,t){const n=os(e,(t||this).context);return n?n.domain():[]}function ote(e,t,n){const i=os(e,(n||this).context);return i?K(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function ate(e,t){const n=os(e,(t||this).context);return n&&n.range?n.range():[]}function ute(e,t,n){const i=os(e,(n||this).context);return i?i(t):void 0}function lte(e,t,n,i,r){e=os(e,(r||this).context);const s=Ek(t,n);let o=e.domain(),a=o[0],u=be(o),l=un;return u-a?l=ak(e,a,u):e=(e.interpolator?$e("sequential")().interpolator(e.interpolator()):$e("linear")().interpolate(e.interpolate()).range(e.range())).domain([a=0,u=1]),e.ticks&&(o=e.ticks(+i||15),a!==o[0]&&o.unshift(a),u!==be(o)&&o.push(u)),o.forEach(c=>s.stop(l(c),e(c))),s}function cte(e,t,n){const i=os(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function fte(e){let t=null;return function(n){return n?Pc(n,t=t||Tu(e)):e}}const mT=e=>e.data;function yT(e,t){const n=uT.call(t,e);return n.root&&n.root.lookup||{}}function dte(e,t,n){const i=yT(e,this),r=i[t],s=i[n];return r&&s?r.path(s).map(mT):void 0}function hte(e,t){const n=yT(e,this)[t];return n?n.ancestors().map(mT):void 0}const vT=()=>typeof window!="undefined"&&window||null;function gte(){const e=vT();return e?e.screen:{}}function pte(){const e=vT();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function mte(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function yte(e,t,n){if(!e)return[];const[i,r]=e,s=new yt().set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return jD(o,s,vte(t))}function vte(e){let t=null;if(e){const n=re(e.marktype),i=re(e.markname);t=r=>(!n.length||n.some(s=>r.marktype===s))&&(!i.length||i.some(s=>r.name===s))}return t}const Lf={random(){return li()},cumulativeNormal:kh,cumulativeLogNormal:Fy,cumulativeUniform:Ty,densityNormal:Ay,densityLogNormal:$y,densityUniform:My,quantileNormal:Dh,quantileLogNormal:ky,quantileUniform:Ny,sampleNormal:Fh,sampleLogNormal:Cy,sampleUniform:Dy,isArray:K,isBoolean:E1,isDate:Cs,isDefined(e){return e!==void 0},isNumber:$s,isObject:ue,isRegExp:BO,isString:_e,isTuple:Eh,isValid(e){return e!=null&&e===e},toBoolean:A1,toDate:O1,toNumber:Ut,toString:S1,indexof:Jee,join:Kee,lastindexof:Qee,replace:ete,reverse:tte,slice:Zee,flush:PO,lerp:zO,merge:Wee,pad:WO,peek:be,pluck:Xee,span:Ql,inrange:cu,truncate:GO,rgb:qs,lab:Hh,hcl:Yh,hsl:Wh,luminance:pw,contrast:qee,sequence:Yn,format:Aee,utcFormat:Oee,utcParse:Cee,utcOffset:DS,utcSequence:NS,timeFormat:lT,timeParse:See,timeOffset:kS,timeSequence:TS,timeUnitSpecifier:bS,monthFormat:$ee,monthAbbrevFormat:Fee,dayFormat:kee,dayAbbrevFormat:Dee,quarter:NO,utcquarter:RO,week:wS,utcweek:AS,dayofyear:xS,utcdayofyear:_S,warn:Bee,info:zee,debug:Uee,extent:nr,inScope:Iee,intersect:yte,clampRange:jO,pinchDistance:Yee,pinchAngle:Vee,screen:gte,containerSize:mte,windowSize:pte,bandspace:nte,setdata:Eee,pathShape:fte,panLinear:kO,panLog:DO,panPow:MO,panSymlog:TO,zoomLinear:y1,zoomLog:v1,zoomPow:oh,zoomSymlog:b1,encode:_ee,modify:Hee},bte=["view","item","group","xy","x","y"],xte="event.vega.",bT="this.",vw={},xT={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${ee(cT+e)}]`,functions:wte,constants:eT,visitors:vw},bw=nT(xT);function wte(e){const t=tT(e);bte.forEach(n=>t[n]=xte+n);for(const n in Lf)t[n]=bT+n;return de(t,Ree(e,Lf,vw)),t}function ct(e,t,n){return arguments.length===1?Lf[e]:(Lf[e]=t,n&&(vw[e]=n),bw&&(bw.functions[e]=bT+e),this)}ct("bandwidth",ite,Ln);ct("copy",rte,Ln);ct("domain",ste,Ln);ct("range",ate,Ln);ct("invert",ote,Ln);ct("scale",ute,Ln);ct("gradient",lte,Ln);ct("geoArea",jee,Ln);ct("geoBounds",Lee,Ln);ct("geoCentroid",Pee,Ln);ct("geoShape",cte,Ln);ct("indata",wee,Nee);ct("data",uT,fw);ct("treePath",dte,fw);ct("treeAncestors",hte,fw);ct("vlSelectionTest",hee,lw);ct("vlSelectionIdTest",mee,lw);ct("vlSelectionResolve",vee,lw);ct("vlSelectionTuples",yee);function wr(e,t){const n={};let i;try{e=_e(e)?e:ee(e)+"",i=Z5(e)}catch{N("Expression parse error: "+e)}i.visit(s=>{if(s.type!==I5)return;const o=s.callee.name,a=xT.visitors[o];a&&a(o,s.arguments,t,n)});const r=bw(i);return r.globals.forEach(s=>{const o=cT+s;!se(n,o)&&t.getSignal(s)&&(n[o]=t.signalRef(s))}),{$expr:de({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function Ete(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const _te=Fi(["rule"]),wT=Fi(["group","image","rect"]);function Ate(e,t){let n="";return _te[t]||(e.x2&&(e.x?(wT[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(wT[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function xw(e){return(e+"").toLowerCase()}function Ote(e){return xw(e)==="operator"}function Ste(e){return xw(e)==="collect"}function Pf(e,t,n){n[n.length-1]!==";"&&(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}function Cte(e,t,n,i){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,`
  : (u > v || v == null) && u != null ? `).concat(i,`
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? `).concat(n,`
  : v !== v && u === u ? `).concat(i," : ")}var $te={operator:(e,t)=>Pf(e,["_"],t.code),parameter:(e,t)=>Pf(e,["datum","_"],t.code),event:(e,t)=>Pf(e,["event"],t.code),handler:(e,t)=>{const n="var datum=event.item&&event.item.datum;return ".concat(t.code,";");return Pf(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const s in i){const o="o["+ee(s)+"]";r+="$=".concat(i[s].code,";if(").concat(o,"!==$)").concat(o,"=$,m=1;")}return r+=Ate(i,n),r+="return m;",Pf(e,["item","_"],r)},codegen:{get(e){const t="[".concat(e.map(ee).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const i=(s,o)=>{const a=t[o];let u,l;return s.path?(u="a".concat(s.path),l="b".concat(s.path)):((n=n||{})["f"+o]=s,u="this.f".concat(o,"(a)"),l="this.f".concat(o,"(b)")),Cte(u,l,-a,a)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function Fte(e){const t=this;Ote(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function kte(e){const t=this;if(e.params){const n=t.get(e.id);n||N("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function Dte(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=K(r)?r.map(s=>ET(s,n,t)):ET(r,n,t)}return t}function ET(e,t,n){if(!e||!ue(e))return e;for(let i=0,r=_T.length,s;i<r;++i)if(s=_T[i],se(e,s.key))return s.parse(e,t,n);return e}var _T=[{key:"$ref",parse:Mte},{key:"$key",parse:Nte},{key:"$expr",parse:Tte},{key:"$field",parse:Rte},{key:"$encode",parse:Lte},{key:"$compare",parse:jte},{key:"$context",parse:Pte},{key:"$subflow",parse:Ite},{key:"$tupleid",parse:Bte}];function Mte(e,t){return t.get(e.$ref)||N("Operator not defined: "+e.$ref)}function Tte(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code+"_"+e.$name;return t.fn[i]||(t.fn[i]=Sn(t.parameterExpression(e.$expr),e.$fields,e.$name))}function Nte(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=_1(e.$key,e.$flat,t.expr.codegen))}function Rte(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Cn(e.$field,e.$name,t.expr.codegen))}function jte(e,t){const n="c:"+e.$compare+"_"+e.$order,i=re(e.$compare).map(r=>r&&r.$tupleid?J:r);return t.fn[n]||(t.fn[n]=x1(i,e.$order,t.expr.codegen))}function Lte(e,t){const n=e.$encode,i={};for(const r in n){const s=n[r];i[r]=Sn(t.encodeExpression(s.$expr),s.$fields),i[r].output=s.$output}return i}function Pte(e,t){return t}function Ite(e,t){const n=e.$subflow;return function(i,r,s){const o=t.fork().parse(n),a=o.get(n.operators[0].id),u=o.signals.parent;return u&&u.set(s),a.detachSubflow=()=>t.detach(o),a}}function Bte(){return J}function zte(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(s=>t.get(s)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(s=>t.get(s)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&N("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function Ute(e){var t=this,n=ue(n=e.source)?n.$ref:n,i=t.get(n),r=null,s=e.update,o=void 0;i||N("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),s&&s.$expr&&(s.$params&&(o=t.parseParameters(s.$params)),s=t.handlerExpression(s.$expr)),t.update(e,i,r,s,o)}const qte={skip:!0};function Wte(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(s=>{const o=t.signals[s];e.signals(s,o)&&(i[s]=o.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(s=>{const o=t.data[s];e.data(s,o)&&(r[s]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n}function Gte(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(s=>{n.update(t.signals[s],r[s],qte)}),Object.keys(i||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(oi).insert(i[s]))}),(e.subcontext||[]).forEach((s,o)=>{const a=t.subcontext[o];a&&a.setState(s)})}function AT(e,t,n,i){return new OT(e,t,n,i)}function OT(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||$te,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function ST(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}OT.prototype=ST.prototype={fork(){const e=new ST(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),Ste(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(i.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),i.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const o=n.data[s]||(n.data[s]={});e.data[s].forEach(a=>o[a]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[xw(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:Ete,parseOperator:Fte,parseOperatorParameters:kte,parseParameters:Dte,parseStream:zte,parseUpdate:Ute,getState:Wte,setState:Gte};function Hte(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),CT(t,e.description()))}function CT(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function Yte(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const ww="default";function Vte(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:ww,item:null}));e.on(e.events("view","mousemove"),t,(n,i)=>{const r=t.value,s=r?_e(r)?r:r.user:ww,o=i.item&&i.item.cursor||null;return r&&s===r.user&&o==r.item?r:{user:s,item:o}}),e.add(null,function(n){let i=n.cursor,r=this.value;return _e(i)||(r=i.item,i=i.user),Ew(e,i&&i!==ww?i:r||i),r},{cursor:t})}function Ew(e,t){const n=e.globalCursor()?typeof document!="undefined"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function H0(e,t){var n=e._runtime.data;return se(n,t)||N("Unrecognized data set: "+t),n[t]}function Xte(e,t){return arguments.length<2?H0(this,e).values.value:Y0.call(this,e,Xo().remove(oi).insert(t))}function Y0(e,t){EC(t)||N("Second argument to changes must be a changeset.");const n=H0(this,e);return n.modified=!0,this.pulse(n.input,t)}function Kte(e,t){return Y0.call(this,e,Xo().insert(t))}function Jte(e,t){return Y0.call(this,e,Xo().remove(t))}function $T(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function FT(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function V0(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function Qte(e){var t=V0(e),n=$T(e),i=FT(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(r=>{try{r(n,i)}catch(s){e.error(s)}})}function Zte(e,t,n){var i=e._renderer,r=i&&i.canvas(),s,o,a;return r&&(a=V0(e),o=t.changedTouches?t.changedTouches[0]:t,s=Og(o,r),s[0]-=a[0],s[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=ene(e,n,s),t}function ene(e,t,n){const i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(o){var a=i,u;if(o){for(u=t;u;u=u.mark.group)if(u.mark.name===o){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function s(o){if(!o)return n;_e(o)&&(o=r(o));const a=n.slice();for(;o;)a[0]-=o.x||0,a[1]-=o.y||0,o=o.mark&&o.mark.group;return a}return{view:qt(e),item:qt(t||{}),group:r,xy:s,x:o=>s(o)[0],y:o=>s(o)[1]}}const kT="view",tne="timer",nne="window",ine={trap:!1};function rne(e){const t=de({defaults:{}},e),n=(i,r)=>{r.forEach(s=>{K(i[s])&&(i[s]=Fi(i[s]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function DT(e,t,n,i){e._eventListeners.push({type:n,sources:re(t),handler:i})}function sne(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function X0(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||ue(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function one(e,t,n){var i=this,r=new Sh(n),s=function(l,c){i.runAsync(null,()=>{e===kT&&sne(i,t)&&l.preventDefault(),r.receive(Zte(i,l,c))})},o;if(e===tne)X0(i,"timer",t)&&i.timer(s,t);else if(e===kT)X0(i,"view",t)&&i.addEventListener(t,s,ine);else if(e===nne?X0(i,"window",t)&&typeof window!="undefined"&&(o=[window]):typeof document!="undefined"&&X0(i,"selector",t)&&(o=document.querySelectorAll(e)),!o)i.warn("Can not resolve event source: "+e);else{for(var a=0,u=o.length;a<u;++a)o[a].addEventListener(t,s);DT(i,o,t,s)}return r}function MT(e){return e.item}function TT(e){return e.item.mark.source}function NT(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function ane(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",MT),TT,NT(e)),this.on(this.events("view","mouseout",MT),TT,NT(t)),this}function une(){var e=this._tooltip,t=this._timers,n=this._eventListeners,i,r,s;for(i=t.length;--i>=0;)t[i].stop();for(i=n.length;--i>=0;)for(s=n[i],r=s.sources.length;--r>=0;)s.sources[r].removeEventListener(s.type,s.handler);return e&&e.call(this,this._handler,null,null,null),this}function Zn(e,t,n){const i=document.createElement(e);for(const r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const lne="vega-bind",cne="vega-bind-name",fne="vega-bind-radio";function dne(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:o=>{o!=e.signal(i.signal)&&e.runAsync(null,()=>{r.source=!0,e.signal(i.signal,o)})}},i.debounce&&(r.update=w1(i.debounce,r.update))),(i.input==null&&i.element?hne:pne)(r,t,i,e),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function hne(e,t,n,i){const r=n.event||"input",s=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(r,s),DT(i,t,r,s),e.set=o=>{t.value=o,t.dispatchEvent(gne(r))}}function gne(e){return typeof Event!="undefined"?new Event(e):{type:e}}function pne(e,t,n,i){const r=i.signal(n.signal),s=Zn("div",{class:lne}),o=n.input==="radio"?s:s.appendChild(Zn("label"));o.appendChild(Zn("span",{class:cne},n.name||n.signal)),t.appendChild(s);let a=mne;switch(n.input){case"checkbox":a=yne;break;case"select":a=vne;break;case"radio":a=bne;break;case"range":a=xne;break}a(e,o,n,r)}function mne(e,t,n,i){const r=Zn("input");for(const s in n)s!=="signal"&&s!=="element"&&r.setAttribute(s==="input"?"type":s,n[s]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=s=>r.value=s}function yne(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const s=Zn("input",r);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=o=>s.checked=!!o||null}function vne(e,t,n,i){const r=Zn("select",{name:n.signal}),s=n.labels||[];n.options.forEach((o,a)=>{const u={value:o};K0(o,i)&&(u.selected=!0),r.appendChild(Zn("option",u,(s[a]||o)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=o=>{for(let a=0,u=n.options.length;a<u;++a)if(K0(n.options[a],o)){r.selectedIndex=a;return}}}function bne(e,t,n,i){const r=Zn("span",{class:fne}),s=n.labels||[];t.appendChild(r),e.elements=n.options.map((o,a)=>{const u={type:"radio",name:n.signal,value:o};K0(o,i)&&(u.checked=!0);const l=Zn("input",u);l.addEventListener("change",()=>e.update(o));const c=Zn("label",{},(s[a]||o)+"");return c.prepend(l),r.appendChild(c),l}),e.set=o=>{const a=e.elements,u=a.length;for(let l=0;l<u;++l)K0(a[l].value,o)&&(a[l].checked=!0)}}function xne(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,s=n.min||Math.min(0,r,+i)||0,o=n.step||ks(s,r,100),a=Zn("input",{type:"range",name:n.signal,min:s,max:r,step:o});a.value=i;const u=Zn("span",{},+i);t.appendChild(a),t.appendChild(u);const l=()=>{u.textContent=a.value,e.update(+a.value)};a.addEventListener("input",l),a.addEventListener("change",l),e.elements=[a],e.set=c=>{a.value=c,u.textContent=c}}function K0(e,t){return e===t||e+""==t+""}function RT(e,t,n,i,r,s){return t=t||new i(e.loader()),t.initialize(n,$T(e),FT(e),V0(e),r,s).background(e.background())}function _w(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function wne(e,t,n,i){const r=new i(e.loader(),_w(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,V0(e),e);return t&&t.handlers().forEach(s=>{r.on(s.type,s.handler)}),r}function Ene(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,s=Ng(i);e=n._el=e?Aw(n,e,!0):null,Hte(n),s||n.error("Unrecognized renderer type: "+i);const o=s.handler||Qc,a=e?s.renderer:s.headless;return n._renderer=a?RT(n,n._renderer,e,a):null,n._handler=wne(n,n._handler,e,o),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=Aw(n,t,!0):e.appendChild(Zn("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&r!=="container"&&(u.element=Aw(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{dne(n,u.element||t,u)})),n}function Aw(e,t,n){if(typeof t=="string")if(typeof document!="undefined"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.innerHTML=""}catch(i){t=null,e.error(i)}return t}const If=e=>+e||0,_ne=e=>({top:e,bottom:e,left:e,right:e});function jT(e){return ue(e)?{top:If(e.top),bottom:If(e.bottom),left:If(e.left),right:If(e.right)}:_ne(If(e))}async function Ow(e,t,n,i){const r=Ng(t),s=r&&r.headless;return s||N("Unrecognized renderer type: "+t),await e.runAsync(),RT(e,null,null,s,n,i).renderAsync(e._scenegraph.root)}async function Ane(e,t){e!==to.Canvas&&e!==to.SVG&&e!==to.PNG&&N("Unrecognized image type: "+e);const n=await Ow(this,e,t);return e===to.SVG?One(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function One(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function Sne(e,t){return(await Ow(this,to.Canvas,e,t)).canvas()}async function Cne(e){return(await Ow(this,to.SVG,e)).svg()}function $ne(e,t,n){return AT(e,xu,Lf,n).parse(t)}function Fne(e){var t=this._runtime.scales;return se(t,e)||N("Unrecognized scale or projection: "+e),t[e].value}var LT="width",PT="height",Sw="padding",IT={skip:!0};function BT(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===Sw?i.left+i.right:0)}function zT(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===Sw?i.top+i.bottom:0)}function kne(e){var t=e._signals,n=t[LT],i=t[PT],r=t[Sw];function s(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,a=>{e._width=a.size,e._viewWidth=BT(e,a.size),s()},{size:n}),e._resizeHeight=e.add(null,a=>{e._height=a.size,e._viewHeight=zT(e,a.size),s()},{size:i});const o=e.add(null,s,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}function Dne(e,t,n,i,r,s){this.runAfter(o=>{let a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal(LT,n,IT),o._resizeWidth.skip(!0)),o.height()!==i&&(a=1,o.signal(PT,i,IT),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==r[0]||o._origin[1]!==r[1])&&(o._resize=1,o._origin=r),a&&o.run("enter"),s&&o.runAfter(u=>u.resize())},!1,1)}function Mne(e){return this._runtime.getState(e||{data:Tne,signals:Nne,recurse:!0})}function Tne(e,t){return t.modified&&K(t.input.value)&&e.indexOf("_:vega:_")}function Nne(e,t){return!(e==="parent"||t instanceof xu.proxy)}function Rne(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function jne(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(pK(n,t))}function Lne(e,t,n,i){const r=e.element();r&&r.setAttribute("title",Pne(i))}function Pne(e){return e==null?"":K(e)?UT(e):ue(e)&&!Cs(e)?Ine(e):e+""}function Ine(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(K(n)?UT(n):qT(n))}).join(`
`)}function UT(e){return"["+e.map(qT).join(", ")+"]"}function qT(e){return K(e)?"[\u2026]":ue(e)&&!Cs(e)?"{\u2026}":e}function WT(e,t){const n=this;if(t=t||{},bu.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=de({},e.locale,t.locale);n.locale(cC(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||to.Canvas,n._scenegraph=new Ib;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||Lne,n._redraw=!0,n._handler=new Qc().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=rne(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=$ne(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:de({},s)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=BT(n,n._width),n._viewHeight=zT(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,kne(n),Yte(n),Vte(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function J0(e,t){return se(e._signals,t)?e._signals[t]:N("Unrecognized signal name: "+ee(t))}function GT(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function HT(e,t,n,i){let r=GT(n,i);return r||(r=_w(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function YT(e,t,n){const i=GT(t,n);return i&&t._targets.remove(i),e}z(WT,bu,{async evaluate(e,t,n){if(await bu.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,Qte(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&wh(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&CT(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=J0(this,e);return arguments.length===1?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",jT(e)):jT(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(Ng(e)||N("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(bu.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(J0(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:Dne,addEventListener(e,t,n){let i=t;return n&&n.trap===!1||(i=_w(this,t),i.raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),i=n.length,r,s;--i>=0;)if(s=n[i].type,r=n[i].handler,e===s&&(t===r||t===r.raw)){this._handler.off(s,r);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return HT(this,e,J0(this,e),t)},removeSignalListener(e,t){return YT(this,J0(this,e),t)},addDataListener(e,t){return HT(this,e,H0(this,e).values,t)},removeDataListener(e,t){return YT(this,H0(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=Ew(this,null);this._globalCursor=!!e,t&&Ew(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:jne,events:one,finalize:une,hover:ane,data:Xte,change:Y0,insert:Kte,remove:Jte,scale:Fne,initialize:Ene,toImageURL:Ane,toCanvas:Sne,toSVG:Cne,getState:Mne,setState:Rne});const Bne="view",Q0="[",Z0="]",VT="{",XT="}",zne=":",KT=",",Une="@",qne=">",Wne=/[[\]{}]/,Gne={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let JT,QT;function ZT(e,t,n){return JT=t||Bne,QT=n||Gne,eN(e.trim()).map(Cw)}function Hne(e){return QT[e]}function Bf(e,t,n,i,r){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return t}function eN(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=Bf(e,r,KT,Q0+VT,Z0+XT),t.push(e.substring(i,r).trim()),i=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function Cw(e){return e[0]==="["?Yne(e):Vne(e)}function Yne(e){const t=e.length;let n=1,i;if(n=Bf(e,n,Z0,Q0,Z0),n===t)throw"Empty between selector: "+e;if(i=eN(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==qne)throw"Expected '>' after between selector: "+e;i=i.map(Cw);const r=Cw(e.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}function Vne(e){const t={source:JT},n=[];let i=[0,0],r=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===XT){if(a=e.lastIndexOf(VT),a>=0){try{i=Xne(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===Une&&(r=++a),u=Bf(e,a,zne),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=Bf(e,a,Q0),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=Bf(e,a,Z0),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==Q0)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||Wne.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],r?t.markname=n[0].slice(1):Hne(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function Xne(e){const t=e.split(KT);if(!e.length||t.length>2)throw e;return t.map(n=>{const i=+n;if(i!==i)throw e;return i})}function Kne(e){return ue(e)?e:{type:e||"pad"}}const zf=e=>+e||0,Jne=e=>({top:e,bottom:e,left:e,right:e});function Qne(e){return ue(e)?e.signal?e:{top:zf(e.top),bottom:zf(e.bottom),left:zf(e.left),right:zf(e.right)}:Jne(zf(e))}const $t=e=>ue(e)&&!K(e)?de({},e):{value:e};function tN(e,t,n,i){return n!=null?(ue(n)&&!K(n)||K(n)&&n.length&&ue(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function Pt(e,t,n){for(const i in t)tN(e,i,t[i]);for(const i in n)tN(e,i,n[i],"update")}function tl(e,t,n){for(const i in t)n&&se(n,i)||(e[i]=de(e[i]||{},t[i]));return e}function nl(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const $w="mark",Fw="frame",kw="scope",Zne="axis",eie="axis-domain",tie="axis-grid",nie="axis-label",iie="axis-tick",rie="axis-title",sie="legend",oie="legend-band",aie="legend-entry",uie="legend-gradient",nN="legend-label",lie="legend-symbol",cie="legend-title",fie="title",die="title-text",hie="title-subtitle";function gie(e,t,n,i,r){const s={},o={};let a,u,l,c;u="lineBreak",t==="text"&&r[u]!=null&&!nl(u,e)&&Dw(s,u,r[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===Fw?r.group:n===$w?de({},r.mark,r[t]):null;for(u in c)l=nl(u,e)||(u==="fill"||u==="stroke")&&(nl("fill",e)||nl("stroke",e)),l||Dw(s,u,c[u]);re(i).forEach(f=>{const d=r.style&&r.style[f];for(const h in d)nl(h,e)||Dw(s,h,d[h])}),e=de({},e);for(u in s)c=s[u],c.signal?(a=a||{})[u]=c:o[u]=c;return e.enter=de(o,e.enter),a&&(e.update=de(a,e.update)),e}function Dw(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const iN=e=>_e(e)?ee(e):e.signal?`(${e.signal})`:rN(e);function ep(e){if(e.gradient!=null)return mie(e);let t=e.signal?`(${e.signal})`:e.color?pie(e.color):e.field!=null?rN(e.field):e.value!==void 0?ee(e.value):void 0;return e.scale!=null&&(t=yie(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${np(e.exponent)})`),e.mult!=null&&(t+=`*${np(e.mult)}`),e.offset!=null&&(t+=`+${np(e.offset)}`),e.round&&(t=`round(${t})`),t}const tp=(e,t,n,i)=>`(${e}(${[t,n,i].map(ep).join(",")})+'')`;function pie(e){return e.c?tp("hcl",e.h,e.c,e.l):e.h||e.s?tp("hsl",e.h,e.s,e.l):e.l||e.a?tp("lab",e.l,e.a,e.b):e.r||e.g||e.b?tp("rgb",e.r,e.g,e.b):null}function mie(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:ee(n));for(;t.length&&be(t)==null;)t.pop();return t.unshift(iN(e.gradient)),`gradient(${t.join(",")})`}function np(e){return ue(e)?"("+ep(e)+")":e}function rN(e){return sN(ue(e)?e:{datum:e})}function sN(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):N("Invalid field reference: "+ee(e));return e.signal||(i=_e(i)?th(i).map(ee).join("]["):sN(i)),t+"["+i+"]"}function yie(e,t){const n=iN(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+np(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function vie(e){let t="";return e.forEach(n=>{const i=ep(n);t+=n.test?`(${n.test})?${i}:`:i}),be(t)===":"&&(t+="null"),t}function oN(e,t,n,i,r,s){const o={};s=s||{},s.encoders={$encode:o},e=gie(e,t,n,i,r.config);for(const a in e)o[a]=bie(e[a],t,s,r);return s}function bie(e,t,n,i){const r={},s={};for(const o in e)e[o]!=null&&(r[o]=wie(xie(e[o]),i,n,s));return{$expr:{marktype:t,channels:r},$fields:Object.keys(s),$output:Object.keys(e)}}function xie(e){return K(e)?vie(e):ep(e)}function wie(e,t,n,i){const r=wr(e,t);return r.$fields.forEach(s=>i[s]=1),de(n,r.$params),r.$expr}const Eie="outer",_ie=["value","update","init","react","bind"];function aN(e,t){N(e+' for "outer" push: '+ee(t))}function uN(e,t){const n=e.name;if(e.push===Eie)t.signals[n]||aN("No prior signal definition",n),_ie.forEach(i=>{e[i]!==void 0&&aN("Invalid property ",i)});else{const i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Mw(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function ip(e,t,n,i){return new Mw(e,t,n,i)}function rp(e,t){return ip("operator",e,t)}function Z(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Uf(e,t){return t?{$field:e,$name:t}:{$field:e}}const Tw=Uf("key");function lN(e,t){return{$compare:e,$order:t}}function Aie(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const Oie="ascending",Sie="descending";function Cie(e){return ue(e)?(e.order===Sie?"-":"+")+sp(e.op,e.field):""}function sp(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const Nw="scope",Rw="view";function bt(e){return e&&e.signal}function $ie(e){return e&&e.expr}function op(e){if(bt(e))return!0;if(ue(e)){for(const t in e)if(op(e[t]))return!0}return!1}function zi(e,t){return e!=null?e:t}function wa(e){return e&&e.signal||e}const cN="timer";function qf(e,t){return(e.merge?kie:e.stream?Die:e.type?Mie:N("Invalid stream specification: "+ee(e)))(e,t)}function Fie(e){return e===Nw?Rw:e||Rw}function kie(e,t){const n=e.merge.map(r=>qf(r,t)),i=jw({merge:n},e,t);return t.addStream(i).id}function Die(e,t){const n=qf(e.stream,t),i=jw({stream:n},e,t);return t.addStream(i).id}function Mie(e,t){let n;e.type===cN?(n=t.event(cN,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(Fie(e.source),e.type);const i=jw({stream:n},e,t);return Object.keys(i).length===1?n:t.addStream(i).id}function jw(e,t,n){let i=t.between;return i&&(i.length!==2&&N('Stream "between" parameter must have 2 entries: '+ee(t)),e.between=[qf(i[0],n),qf(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(Tie(t.marktype,t.markname,t.markrole)),t.source===Nw&&i.push("inScope(event.item)"),i.length&&(e.filter=wr("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function Tie(e,t,n){const i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}const Nie={code:"_.$value",ast:{type:"Identifier",value:"value"}};function Rie(e,t,n){const i=e.encode,r={target:n};let s=e.events,o=e.update,a=[];s||N("Signal update missing events specification."),_e(s)&&(s=ZT(s,t.isSubscope()?Nw:Rw)),s=re(s).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[Lie(a)]),s.length&&a.push(s.length>1?{merge:s}:s[0]),i!=null&&(o&&N("Signal encode and update are mutually exclusive."),o="encode(item(),"+ee(i)+")"),r.update=_e(o)?wr(o,t):o.expr!=null?wr(o.expr,t):o.value!=null?o.value:o.signal!=null?{$expr:Nie,$params:{$value:t.signalRef(o.signal)}}:N("Invalid signal update specification."),e.force&&(r.options={force:!0}),a.forEach(u=>t.addUpdate(de(jie(u,t),r)))}function jie(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):qf(e,t)}}function Lie(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function Pie(e,t){const n=t.getSignal(e.name);let i=e.update;e.init&&(i?N("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=wr(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(r=>Rie(r,t,n.id))}const Le=e=>(t,n,i)=>ip(e,n,t||void 0,i),fN=Le("aggregate"),Iie=Le("axisticks"),dN=Le("bound"),Ui=Le("collect"),hN=Le("compare"),Bie=Le("datajoin"),gN=Le("encode"),zie=Le("expression"),Uie=Le("facet"),qie=Le("field"),Wie=Le("key"),Gie=Le("legendentries"),Hie=Le("load"),Yie=Le("mark"),Vie=Le("multiextent"),Xie=Le("multivalues"),Kie=Le("overlap"),Jie=Le("params"),pN=Le("prefacet"),Qie=Le("projection"),Zie=Le("proxy"),ere=Le("relay"),mN=Le("render"),tre=Le("scale"),Ea=Le("sieve"),nre=Le("sortitems"),yN=Le("viewlayout"),ire=Le("values");let rre=0;const vN={min:"min",max:"max",count:"sum"};function sre(e,t){const n=e.type||"linear";tk(n)||N("Unrecognized scale type: "+ee(n)),t.addScale(e.name,{type:n,domain:void 0})}function ore(e,t){const n=t.getScale(e.name).params;let i;n.domain=bN(e.domain,e,t),e.range!=null&&(n.range=wN(e,t,n)),e.interpolate!=null&&mre(e.interpolate,n),e.nice!=null&&(n.nice=pre(e.nice)),e.bins!=null&&(n.bins=gre(e.bins,t));for(i in e)se(n,i)||i==="name"||(n[i]=gi(e[i],t))}function gi(e,t){return ue(e)?e.signal?t.signalRef(e.signal):N("Unsupported object: "+ee(e)):e}function ap(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>gi(n,t))}function up(e){N("Can not find data set: "+ee(e))}function bN(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&N("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(K(e)?are:e.fields?lre:ure)(e,t,n)}function are(e,t,n){return e.map(i=>gi(i,n))}function ure(e,t,n){const i=n.getData(e.data);return i||up(e.data),Mu(t.type)?i.valuesRef(n,e.field,xN(e.sort,!1)):rk(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function lre(e,t,n){const i=e.data,r=e.fields.reduce((s,o)=>(o=_e(o)?{data:i,field:o}:K(o)||o.signal?cre(o,n):o,s.push(o),s),[]);return(Mu(t.type)?fre:rk(t.type)?dre:hre)(e,n,r)}function cre(e,t){const n="_:vega:_"+rre++,i=Ui({});if(K(e))i.value={$ingest:e};else if(e.signal){const r="setdata("+ee(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,Ea({})]),{data:n,field:"data"}}function fre(e,t,n){const i=xN(e.sort,!0);let r,s;const o=n.map(l=>{const c=t.getData(l.data);return c||up(l.data),c.countsRef(t,l.field,i)}),a={groupby:Tw,pulse:o};i&&(r=i.op||"count",s=i.field?sp(r,i.field):"count",a.ops=[vN[r]],a.fields=[t.fieldRef(s)],a.as=[s]),r=t.add(fN(a));const u=t.add(Ui({pulse:Z(r)}));return s=t.add(ire({field:Tw,sort:t.sortRef(i),pulse:Z(u)})),Z(s)}function xN(e,t){return e&&(!e.field&&!e.op?ue(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?N("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!vN[e.op]&&N("Multiple domain scales can not be sorted using "+e.op)),e}function dre(e,t,n){const i=n.map(r=>{const s=t.getData(r.data);return s||up(r.data),s.domainRef(t,r.field)});return Z(t.add(Xie({values:i})))}function hre(e,t,n){const i=n.map(r=>{const s=t.getData(r.data);return s||up(r.data),s.extentRef(t,r.field)});return Z(t.add(Vie({extents:i})))}function gre(e,t){return e.signal||K(e)?ap(e,t):t.objectProperty(e)}function pre(e){return ue(e)?{interval:gi(e.interval),step:gi(e.step)}:gi(e)}function mre(e,t){t.interpolate=gi(e.type||e),e.gamma!=null&&(t.interpolateGamma=gi(e.gamma))}function wN(e,t,n){const i=t.config.range;let r=e.range;if(r.signal)return t.signalRef(r.signal);if(_e(r)){if(i&&se(i,r))return e=de({},e,{range:i[r]}),wN(e,t,n);r==="width"?r=[0,{signal:"width"}]:r==="height"?r=Mu(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:N("Unrecognized scale range value: "+ee(r))}else if(r.scheme){n.scheme=K(r.scheme)?ap(r.scheme,t):gi(r.scheme,t),r.extent&&(n.schemeExtent=ap(r.extent,t)),r.count&&(n.schemeCount=gi(r.count,t));return}else if(r.step){n.rangeStep=gi(r.step,t);return}else{if(Mu(e.type)&&!K(r))return bN(r,e,t);K(r)||N("Unsupported range type: "+ee(r))}return r.map(s=>(K(s)?ap:gi)(s,t))}function yre(e,t){const n=t.config.projection||{},i={};for(const r in e)r!=="name"&&(i[r]=Lw(e[r],r,t));for(const r in n)i[r]==null&&(i[r]=Lw(n[r],r,t));t.addProjection(e.name,i)}function Lw(e,t,n){return K(e)?e.map(i=>Lw(i,t,n)):ue(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:N("Unsupported parameter object: "+ee(e)):e}const qi="top",il="left",rl="right",co="bottom",EN="center",vre="vertical",bre="start",xre="middle",wre="end",Pw="index",Iw="label",Ere="offset",sl="perc",_re="perc2",pi="value",Wf="guide-label",Bw="guide-title",Are="group-title",Ore="group-subtitle",_N="symbol",lp="gradient",zw="discrete",Uw="size",Sre="shape",Cre="fill",$re="stroke",Fre="strokeWidth",kre="strokeDash",Dre="opacity",qw=[Uw,Sre,Cre,$re,Fre,kre,Dre],Gf={name:1,style:1,interactive:1},Ee={value:0},mi={value:1},cp="group",AN="rect",Ww="rule",Mre="symbol",_a="text";function Hf(e){return e.type=cp,e.interactive=e.interactive||!1,e}function Pn(e,t){const n=(i,r)=>zi(e[i],zi(t[i],r));return n.isVertical=i=>vre===zi(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>zi(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>zi(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>zi(e.columns,zi(t.columns,+n.isVertical(!0))),n}function ON(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Tre(e,t,n){const i=t.config.style[n];return i&&i[e]}function fp(e,t,n){return`item.anchor === '${bre}' ? ${e} : item.anchor === '${wre}' ? ${t} : ${n}`}const Gw=fp(ee(il),ee(rl),ee(EN));function Nre(e){const t=e("tickBand");let n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},ue(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function SN(e,t){return t?e?ue(e)?Object.assign({},e,{offset:SN(e.offset,t)}):{value:e,offset:t}:t:e}function ei(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=tl(e.encode,t,Gf)):e.interactive=!1,e}function Rre(e,t,n,i){const r=Pn(e,n),s=r.isVertical(),o=r.gradientThickness(),a=r.gradientLength();let u,l,c,f,d;s?(l=[0,1],c=[0,0],f=o,d=a):(l=[0,0],c=[1,0],f=a,d=o);const h={enter:u={opacity:Ee,x:Ee,y:Ee,width:$t(f),height:$t(d)},update:de({},u,{opacity:mi,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:Ee}};return Pt(h,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),ei({type:AN,role:uie,encode:h},i)}function jre(e,t,n,i,r){const s=Pn(e,n),o=s.isVertical(),a=s.gradientThickness(),u=s.gradientLength();let l,c,f,d,h="";o?(l="y",f="y2",c="x",d="width",h="1-"):(l="x",f="x2",c="y",d="height");const g={opacity:Ee,fill:{scale:t,field:pi}};g[l]={signal:h+"datum."+sl,mult:u},g[c]=Ee,g[f]={signal:h+"datum."+_re,mult:u},g[d]=$t(a);const p={enter:g,update:de({},g,{opacity:mi}),exit:{opacity:Ee}};return Pt(p,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),ei({type:AN,role:oie,key:pi,from:r,encode:p},i)}const Lre=`datum.${sl}<=0?"${il}":datum.${sl}>=1?"${rl}":"${EN}"`,Pre=`datum.${sl}<=0?"${co}":datum.${sl}>=1?"${qi}":"${xre}"`;function CN(e,t,n,i){const r=Pn(e,t),s=r.isVertical(),o=$t(r.gradientThickness()),a=r.gradientLength();let u=r("labelOverlap"),l,c,f,d,h="";const g={enter:l={opacity:Ee},update:c={opacity:mi,text:{field:Iw}},exit:{opacity:Ee}};return Pt(g,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:zi(e.labelLimit,t.gradientLabelLimit)}),s?(l.align={value:"left"},l.baseline=c.baseline={signal:Pre},f="y",d="x",h="1-"):(l.align=c.align={signal:Lre},l.baseline={value:"top"},f="x",d="y"),l[f]=c[f]={signal:h+"datum."+sl,mult:a},l[d]=c[d]=o,o.offset=zi(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:r("labelSeparation"),method:u,order:"datum."+Pw}:void 0,ei({type:_a,role:nN,style:Wf,key:pi,from:i,encode:g,overlap:u},n)}function Ire(e,t,n,i,r){const s=Pn(e,t),o=n.entries,a=!!(o&&o.interactive),u=o?o.name:void 0,l=s("clipHeight"),c=s("symbolOffset"),f={data:"value"},d=`(${r}) ? datum.${Ere} : datum.${Uw}`,h=l?$t(l):{field:Uw},g=`datum.${Pw}`,p=`max(1, ${r})`;let m,y,v,b,x;h.mult=.5,m={enter:y={opacity:Ee,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:mi,x:y.x,y:y.y},exit:{opacity:Ee}};let E=null,_=null;e.fill||(E=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),Pt(m,{fill:s("symbolFillColor",E),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",_),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),qw.forEach(O=>{e[O]&&(v[O]=y[O]={scale:e[O],field:pi})});const w=ei({type:Mre,role:lie,key:pi,from:f,clip:l?!0:void 0,encode:m},n.symbols),A=$t(c);A.offset=s("labelOffset"),m={enter:y={opacity:Ee,x:{signal:d,offset:A},y:h},update:v={opacity:mi,text:{field:Iw},x:y.x,y:y.y},exit:{opacity:Ee}},Pt(m,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const S=ei({type:_a,role:nN,style:Wf,key:pi,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:Ee,height:l?$t(l):Ee,opacity:Ee},exit:{opacity:Ee},update:v={opacity:mi,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(b=`ceil(item.mark.items.length / ${p})`,v.row.signal=`${g}%${b}`,v.column.signal=`floor(${g} / ${b})`,x={field:["row",g]}):(v.row.signal=`floor(${g} / ${p})`,v.column.signal=`${g} % ${p}`,x={field:g}),v.column.signal=`(${r})?${v.column.signal}:${g}`,i={facet:{data:i,name:"value",groupby:Pw}},Hf({role:kw,from:i,encode:tl(m,o,Gf),marks:[w,S],name:u,interactive:a,sort:x})}function Bre(e,t){const n=Pn(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const Hw='item.orient === "left"',Yw='item.orient === "right"',dp=`(${Hw} || ${Yw})`,zre=`datum.vgrad && ${dp}`,Ure=fp('"top"','"bottom"','"middle"'),qre=fp('"right"','"left"','"center"'),Wre=`datum.vgrad && ${Yw} ? (${qre}) : (${dp} && !(datum.vgrad && ${Hw})) ? "left" : ${Gw}`,Gre=`item._anchor || (${dp} ? "middle" : "start")`,Hre=`${zre} ? (${Hw} ? -90 : 90) : 0`,Yre=`${dp} ? (datum.vgrad ? (${Yw} ? "bottom" : "top") : ${Ure}) : "top"`;function Vre(e,t,n,i){const r=Pn(e,t),s={enter:{opacity:Ee},update:{opacity:mi,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Ee}};return Pt(s,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:Gre},angle:{signal:Hre},align:{signal:Wre},baseline:{signal:Yre},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),ei({type:_a,role:cie,style:Bw,from:i,encode:s},n)}function Xre(e,t){let n;return ue(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+$N(e.path)+")":e.sphere&&(n="geoShape("+$N(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function $N(e){return ue(e)&&e.signal?e.signal:ee(e)}function FN(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===cp?kw:t||$w}function Kre(e){return{marktype:e.type,name:e.name||void 0,role:e.role||FN(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function Jre(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function Vw(e,t){const n=DC(e.type);n||N("Unrecognized transform type: "+ee(e.type));const i=ip(n.type.toLowerCase(),null,kN(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function kN(e,t,n){const i={},r=e.params.length;for(let s=0;s<r;++s){const o=e.params[s];i[o.name]=Qre(o,t,n)}return i}function Qre(e,t,n){const i=e.type,r=t[e.name];if(i==="index")return Zre(e,t,n);if(r===void 0){e.required&&N("Missing required "+ee(t.type)+" parameter: "+ee(e.name));return}else{if(i==="param")return ese(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!bt(r)?r.map(s=>DN(e,s,n)):DN(e,r,n)}function DN(e,t,n){const i=e.type;if(bt(t))return TN(i)?N("Expression references can not be signals."):Xw(i)?n.fieldRef(t):NN(i)?n.compareRef(t):n.signalRef(t.signal);{const r=e.expr||Xw(i);return r&&tse(t)?n.exprRef(t.expr,t.as):r&&nse(t)?Uf(t.field,t.as):TN(i)?wr(t,n):ise(i)?Z(n.getData(t).values):Xw(i)?Uf(t):NN(i)?n.compareRef(t):t}}function Zre(e,t,n){return _e(t.from)||N('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function ese(e,t,n){const i=t[e.name];return e.array?(K(i)||N("Expected an array of sub-parameters. Instead: "+ee(i)),i.map(r=>MN(e,r,n))):MN(e,i,n)}function MN(e,t,n){const i=e.params.length;let r;for(let o=0;o<i;++o){r=e.params[o];for(const a in r.key)if(r.key[a]!==t[a]){r=null;break}if(r)break}r||N("Unsupported parameter: "+ee(t));const s=de(kN(r,t,n),r.key);return Z(n.add(Jie(s)))}const tse=e=>e&&e.expr,nse=e=>e&&e.field,ise=e=>e==="data",TN=e=>e==="expr",Xw=e=>e==="field",NN=e=>e==="compare";function rse(e,t,n){let i,r,s,o,a;return e?(i=e.facet)&&(t||N("Only group marks can be faceted."),i.field!=null?o=a=hp(i,n):(e.data?a=Z(n.getData(e.data).aggregate):(s=Vw(de({type:"aggregate",groupby:re(i.groupby)},i.aggregate),n),s.params.key=n.keyRef(i.groupby),s.params.pulse=hp(i,n),o=a=Z(n.add(s))),r=n.keyRef(i.groupby,!0))):o=Z(n.add(Ui(null,[{}]))),o||(o=hp(e,n)),{key:r,pulse:o,parent:a}}function hp(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Z(t.getData(e.data).output)}function Aa(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}Aa.fromEntries=function(e,t){const n=t.length,i=t[n-1],r=t[n-2];let s=t[0],o=null,a=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);a<n;++a)t[a].params.pulse=Z(t[a-1]),e.add(t[a]),t[a].type==="aggregate"&&(o=t[a]);return new Aa(e,s,r,i,o)};function RN(e){return _e(e)?e:null}function jN(e,t,n){const i=sp(n.op,n.field);let r;if(t.ops){for(let s=0,o=t.as.length;s<o;++s)if(t.as[s]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Yf(e,t,n,i,r,s,o){const a=t[n]||(t[n]={}),u=Cie(s);let l=RN(r),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=a[l]),!c){const d=s?{field:Tw,pulse:t.countsRef(e,r,s)}:{field:e.fieldRef(r),pulse:Z(t.output)};u&&(d.sort=e.sortRef(s)),f=e.add(ip(i,void 0,d)),o&&(t.index[r]=f),c=Z(f),l!=null&&(a[l]=c)}return c}Aa.prototype={countsRef(e,t,n){const i=this,r=i.counts||(i.counts={}),s=RN(t);let o,a,u;return s!=null&&(e=i.scope,o=r[s]),o?n&&n.field&&jN(e,o.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:Z(i.output)},n&&n.field&&jN(e,u,n),a=e.add(fN(u)),o=e.add(Ui({pulse:Z(a)})),o={agg:a,ref:Z(o)},s!=null&&(r[s]=o)),o.ref},tuplesRef(){return Z(this.values)},extentRef(e,t){return Yf(e,this,"extent","extent",t,!1)},domainRef(e,t){return Yf(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return Yf(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return Yf(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Yf(e,this,"indata","tupleindex",t,!0,!0)}};function sse(e,t,n){const i=e.from.facet,r=i.name,s=hp(i,t);let o;i.name||N("Facet must have a name: "+ee(i)),i.data||N("Facet must reference a data set: "+ee(i)),i.field?o=t.add(pN({field:t.fieldRef(i.field),pulse:s})):i.groupby?o=t.add(Uie({key:t.keyRef(i.groupby),group:Z(t.proxy(n.parent)),pulse:s})):N("Facet must specify groupby or field: "+ee(i));const a=t.fork(),u=a.add(Ui()),l=a.add(Ea({pulse:Z(u)}));a.addData(r,new Aa(a,u,u,l)),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(e).toRuntime()}}function ose(e,t,n){const i=t.add(pN({pulse:n.pulse})),r=t.fork();r.add(Ea()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function LN(e,t,n){const i=e.remove,r=e.insert,s=e.toggle,o=e.modify,a=e.values,u=t.add(rp()),l="if("+e.trigger+',modify("'+n+'",'+[r,i,s,o,a].map(f=>f==null?"null":f).join(",")+"),0)",c=wr(l,t);u.update=c.$expr,u.params=c.$params}function gp(e,t){const n=FN(e),i=e.type===cp,r=e.from&&e.from.facet,s=e.overlap;let o=e.layout||n===kw||n===Fw,a,u,l,c,f,d,h;const g=n===$w||o||r,p=rse(e.from,i,t);u=t.add(Bie({key:p.key||(e.key?Uf(e.key):void 0),pulse:p.pulse,clean:!i}));const m=Z(u);u=l=t.add(Ui({pulse:m})),u=t.add(Yie({markdef:Kre(e),interactive:Jre(e.interactive,t),clip:Xre(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Z(u)}));const y=Z(u);u=c=t.add(gN(oN(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(_=>{const w=Vw(_,t),A=w.metadata;(A.generates||A.changes)&&N("Mark transforms should not generate new data."),A.nomod||(c.params.mod=!0),w.params.pulse=Z(u),t.add(u=w)}),e.sort&&(u=t.add(nre({sort:t.compareRef(e.sort),pulse:Z(u)})));const v=Z(u);(r||o)&&(o=t.add(yN({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),d=Z(o));const b=t.add(dN({mark:y,pulse:d||v}));h=Z(b),i&&(g&&(a=t.operators,a.pop(),o&&a.pop()),t.pushState(v,d||h,m),r?sse(e,t,p):g?ose(e,t,p):t.parse(e),t.popState(),g&&(o&&a.push(o),a.push(b))),s&&(h=ase(s,h,t));const x=t.add(mN({pulse:h})),E=t.add(Ea({pulse:Z(x)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new Aa(t,l,x,E)),e.on&&e.on.forEach(_=>{(_.insert||_.remove||_.toggle)&&N("Marks only support modify triggers."),LN(_,t,f)}))}function ase(e,t,n){const i=e.method,r=e.bound,s=e.separation,o={separation:bt(s)?n.signalRef(s.signal):s,method:bt(i)?n.signalRef(i.signal):i,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),r){const a=r.tolerance;o.boundTolerance=bt(a)?n.signalRef(a.signal):+a,o.boundScale=n.scaleRef(r.scale),o.boundOrient=r.orient}return Z(n.add(Kie(o)))}function use(e,t){const n=t.config.legend,i=e.encode||{},r=Pn(e,n),s=i.legend||{},o=s.name||void 0,a=s.interactive,u=s.style,l={};let c=0,f,d,h;qw.forEach(b=>e[b]?(l[b]=e[b],c=c||e[b]):0),c||N("Missing valid scale for legend.");const g=lse(e,t.scaleType(c)),p={title:e.title!=null,scales:l,type:g,vgrad:g!=="symbol"&&r.isVertical()},m=Z(t.add(Ui(null,[p]))),y={enter:{x:{value:0},y:{value:0}}},v=Z(t.add(Gie(d={type:g,scale:t.scaleRef(c),count:t.objectProperty(r("tickCount")),limit:t.property(r("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return g===lp?(h=[Rre(e,c,n,i.gradient),CN(e,n,i.labels,v)],d.count=d.count||t.signalRef(`max(2,2*floor((${wa(r.gradientLength())})/100))`)):g===zw?h=[jre(e,c,n,i.gradient,v),CN(e,n,i.labels,v)]:(f=Bre(e,n),h=[Ire(e,n,i,v,wa(f.columns))],d.size=dse(e,t,h[0].marks)),h=[Hf({role:aie,from:m,encode:y,marks:h,layout:f,interactive:a})],p.title&&h.push(Vre(e,n,i.title,m)),gp(Hf({role:sie,from:m,encode:tl(fse(r,e,n),s,Gf),marks:h,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:a,style:u}),t)}function lse(e,t){let n=e.type||_N;return!e.type&&cse(e)===1&&(e.fill||e.stroke)&&(n=tb(t)?lp:nb(t)?zw:_N),n!==lp?n:nb(t)?zw:lp}function cse(e){return qw.reduce((t,n)=>t+(e[n]?1:0),0)}function fse(e,t,n){const i={enter:{},update:{}};return Pt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function dse(e,t,n){const i=wa(PN("size",e,n)),r=wa(PN("strokeWidth",e,n)),s=wa(hse(n[1].encode,t,Wf));return wr(`max(ceil(sqrt(${i})+${r}),${s})`,t)}function PN(e,t,n){return t[e]?`scale("${t[e]}",datum)`:ON(e,n[0].encode)}function hse(e,t,n){return ON("fontSize",e)||Tre("fontSize",t,n)}const gse=`item.orient==="${il}"?-90:item.orient==="${rl}"?90:0`;function pse(e,t){e=_e(e)?{text:e}:e;const n=Pn(e,t.config.title),i=e.encode||{},r=i.group||{},s=r.name||void 0,o=r.interactive,a=r.style,u=[],l={},c=Z(t.add(Ui(null,[l])));return u.push(vse(e,n,mse(e),c)),e.subtitle&&u.push(bse(e,n,i.subtitle,c)),gp(Hf({role:fie,from:c,encode:yse(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:o,style:a}),t)}function mse(e){const t=e.encode;return t&&t.title||de({name:e.name,interactive:e.interactive,style:e.style},t)}function yse(e,t){const n={enter:{},update:{}};return Pt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:Gw},angle:{signal:gse},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),tl(n,t,Gf)}function vse(e,t,n,i){const r={value:0},s=e.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Pt(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),ei({type:_a,role:die,style:Are,from:i,encode:o},n)}function bse(e,t,n,i){const r={value:0},s=e.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Pt(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),ei({type:_a,role:hie,style:Ore,from:i,encode:o},n)}function xse(e,t){const n=[];e.transform&&e.transform.forEach(i=>{n.push(Vw(i,t))}),e.on&&e.on.forEach(i=>{LN(i,t,e.name)}),t.addDataPipeline(e.name,wse(e,t,n))}function wse(e,t,n){const i=[];let r=null,s=!1,o=!1,a,u,l,c,f;for(e.values?bt(e.values)||op(e.format)?(i.push(IN(t,e)),i.push(r=Oa())):i.push(r=Oa({$ingest:e.values,$format:e.format})):e.url?op(e.url)||op(e.format)?(i.push(IN(t,e)),i.push(r=Oa())):i.push(r=Oa({$request:e.url,$format:e.format})):e.source&&(r=a=re(e.source).map(d=>Z(t.getData(d).output)),i.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!r&&!f.source&&i.push(r=Oa()),i.push(c),f.generates&&(o=!0),f.modifies&&!o&&(s=!0),f.source?r=c:f.changes&&(r=null);return a&&(l=a.length-1,i[0]=ere({derive:s,pulse:l?a:a[0]}),(s||l)&&i.splice(1,0,Oa())),r||i.push(Oa()),i.push(Ea({})),i}function Oa(e){const t=Ui({},e);return t.metadata={source:!0},t}function IN(e,t){return Hie({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const BN=e=>e===co||e===qi,pp=(e,t,n)=>bt(e)?Ose(e.signal,t,n):e===il||e===qi?t:n,Ft=(e,t,n)=>bt(e)?_se(e.signal,t,n):BN(e)?t:n,Wi=(e,t,n)=>bt(e)?Ase(e.signal,t,n):BN(e)?n:t,zN=(e,t,n)=>bt(e)?Sse(e.signal,t,n):e===qi?{value:t}:{value:n},Ese=(e,t,n)=>bt(e)?Cse(e.signal,t,n):e===rl?{value:t}:{value:n},_se=(e,t,n)=>UN(`${e} === '${qi}' || ${e} === '${co}'`,t,n),Ase=(e,t,n)=>UN(`${e} !== '${qi}' && ${e} !== '${co}'`,t,n),Ose=(e,t,n)=>Kw(`${e} === '${il}' || ${e} === '${qi}'`,t,n),Sse=(e,t,n)=>Kw(`${e} === '${qi}'`,t,n),Cse=(e,t,n)=>Kw(`${e} === '${rl}'`,t,n),UN=(e,t,n)=>(t=t!=null?$t(t):t,n=n!=null?$t(n):n,qN(t)&&qN(n)?(t=t?t.signal||ee(t.value):null,n=n?n.signal||ee(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[de({test:e},t)].concat(n||[])),qN=e=>e==null||Object.keys(e).length===1,Kw=(e,t,n)=>({signal:`${e} ? (${ol(t)}) : (${ol(n)})`}),$se=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${il}' ? (${ol(i)}) : `:"")+(n!=null?`${e} === '${co}' ? (${ol(n)}) : `:"")+(r!=null?`${e} === '${rl}' ? (${ol(r)}) : `:"")+(t!=null?`${e} === '${qi}' ? (${ol(t)}) : `:"")+"(null)"}),ol=e=>bt(e)?e.signal:e==null?null:ee(e),Fse=(e,t)=>t===0?0:bt(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},al=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function ul(e,t,n,i){let r;if(t&&se(t,e))return t[e];if(se(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[Bw][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[Wf][r]}return null}function WN(e){const t={};for(const n of e)if(!!n)for(const i in n)t[i]=1;return Object.keys(t)}function kse(e,t){var n=t.config,i=n.style,r=n.axis,s=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,a,u,l;if(bt(o)){const f=WN([n.axisX,n.axisY]),d=WN([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(l of f)a[l]=Ft(o,ul(l,n.axisX,r,i),ul(l,n.axisY,r,i));u={};for(l of d)u[l]=$se(o.signal,ul(l,n.axisTop,r,i),ul(l,n.axisBottom,r,i),ul(l,n.axisLeft,r,i),ul(l,n.axisRight,r,i))}else a=o===qi||o===co?n.axisX:n.axisY,u=n["axis"+o[0].toUpperCase()+o.slice(1)];return a||u||s?de({},r,a,u,s):r}function Dse(e,t,n,i){const r=Pn(e,t),s=e.orient;let o,a;const u={enter:o={opacity:Ee},update:a={opacity:mi},exit:{opacity:Ee}};Pt(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const l=GN(e,0),c=GN(e,1);return o.x=a.x=Ft(s,l,Ee),o.x2=a.x2=Ft(s,c),o.y=a.y=Wi(s,l,Ee),o.y2=a.y2=Wi(s,c),ei({type:Ww,role:eie,from:i,encode:u},n)}function GN(e,t){return{scale:e.scale,range:t}}function Mse(e,t,n,i,r){const s=Pn(e,t),o=e.orient,a=e.gridScale,u=pp(o,1,-1),l=Tse(e.offset,u);let c,f,d;const h={enter:c={opacity:Ee},update:d={opacity:mi},exit:f={opacity:Ee}};Pt(h,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const g={scale:e.scale,field:pi,band:r.band,extra:r.extra,offset:r.offset,round:s("tickRound")},p=Ft(o,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:l}:{value:0,offset:l},y=a?{scale:a,range:1,mult:u,offset:l}:de(p,{mult:u,offset:l});return c.x=d.x=Ft(o,g,m),c.y=d.y=Wi(o,g,m),c.x2=d.x2=Wi(o,y),c.y2=d.y2=Ft(o,y),f.x=Ft(o,g),f.y=Wi(o,g),ei({type:Ww,role:tie,key:pi,from:i,encode:h},n)}function Tse(e,t){if(t!==1)if(!ue(e))e=bt(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=de({},e);for(;n.mult!=null;)if(ue(n.mult))n=n.mult=de({},n.mult);else return n.mult=bt(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function Nse(e,t,n,i,r,s){const o=Pn(e,t),a=e.orient,u=pp(a,-1,1);let l,c,f;const d={enter:l={opacity:Ee},update:f={opacity:mi},exit:c={opacity:Ee}};Pt(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=$t(r);h.mult=u;const g={scale:e.scale,field:pi,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")};return f.y=l.y=Ft(a,Ee,g),f.y2=l.y2=Ft(a,h),c.x=Ft(a,g),f.x=l.x=Wi(a,Ee,g),f.x2=l.x2=Wi(a,h),c.y=Wi(a,g),ei({type:Ww,role:iie,key:pi,from:i,encode:d},n)}function Jw(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function Rse(e,t,n,i,r,s){const o=Pn(e,t),a=e.orient,u=e.scale,l=pp(a,-1,1),c=wa(o("labelFlush")),f=wa(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let g=c===0||!!c,p;const m=$t(r);m.mult=l,m.offset=$t(o("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:pi,band:.5,offset:SN(s.offset,o("labelOffset"))},v=Ft(a,g?Jw(u,c,'"left"','"right"','"center"'):{value:"center"},Ese(a,"left","right")),b=Ft(a,zN(a,"bottom","top"),g?Jw(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=Jw(u,c,`-(${f})`,f,0);g=g&&f;const E={opacity:Ee,x:Ft(a,y,m),y:Wi(a,y,m)},_={enter:E,update:p={opacity:mi,text:{field:Iw},x:E.x,y:E.y,align:v,baseline:b},exit:{opacity:Ee,x:E.x,y:E.y}};Pt(_,{dx:!d&&g?Ft(a,x):null,dy:!h&&g?Wi(a,x):null}),Pt(_,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const w=o("labelBound");let A=o("labelOverlap");return A=A||w?{separation:o("labelSeparation"),method:A,order:"datum.index",bound:w?{scale:u,orient:a,tolerance:w}:null}:void 0,p.align!==v&&(p.align=al(p.align,v)),p.baseline!==b&&(p.baseline=al(p.baseline,b)),ei({type:_a,role:nie,style:Wf,key:pi,from:i,encode:_,overlap:A},n)}function jse(e,t,n,i){const r=Pn(e,t),s=e.orient,o=pp(s,-1,1);let a,u;const l={enter:a={opacity:Ee,anchor:$t(r("titleAnchor",null)),align:{signal:Gw}},update:u=de({},a,{opacity:mi,text:$t(e.title)}),exit:{opacity:Ee}},c={signal:`lerp(range("${e.scale}"), ${fp(0,1,.5)})`};return u.x=Ft(s,c),u.y=Wi(s,c),a.angle=Ft(s,Ee,Fse(o,90)),a.baseline=Ft(s,zN(s,co,qi),{value:co}),u.angle=a.angle,u.baseline=a.baseline,Pt(l,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),Lse(r,s,l,n),l.update.align=al(l.update.align,a.align),l.update.angle=al(l.update.angle,a.angle),l.update.baseline=al(l.update.baseline,a.baseline),ei({type:_a,role:rie,style:Bw,from:i,encode:l},n)}function Lse(e,t,n,i){const r=(a,u)=>a!=null?(n.update[u]=al($t(a),n.update[u]),!1):!nl(u,i),s=r(e("titleX"),"x"),o=r(e("titleY"),"y");n.enter.auto=o===s?$t(o):Ft(t,$t(o),$t(s))}function Pse(e,t){const n=kse(e,t),i=e.encode||{},r=i.axis||{},s=r.name||void 0,o=r.interactive,a=r.style,u=Pn(e,n),l=Nre(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=Z(t.add(Ui({},[c]))),d=Z(t.add(Iie({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let g;return c.grid&&h.push(Mse(e,n,i.grid,d,l)),c.ticks&&(g=u("tickSize"),h.push(Nse(e,n,i.ticks,d,g,l))),c.labels&&(g=c.ticks?g:0,h.push(Rse(e,n,i.labels,d,g,l))),c.domain&&h.push(Dse(e,n,i.domain,f)),c.title&&h.push(jse(e,n,i.title,f)),gp(Hf({role:Zne,from:f,encode:tl(Ise(u,e),r,Gf),marks:h,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:o,style:a}),t)}function Ise(e,t){const n={enter:{},update:{}};return Pt(n,{orient:e("orient"),offset:e("offset")||0,position:zi(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function HN(e,t,n){const i=re(e.signals),r=re(e.scales);return n||i.forEach(s=>uN(s,t)),re(e.projections).forEach(s=>yre(s,t)),r.forEach(s=>sre(s,t)),re(e.data).forEach(s=>xse(s,t)),r.forEach(s=>ore(s,t)),(n||i).forEach(s=>Pie(s,t)),re(e.axes).forEach(s=>Pse(s,t)),re(e.marks).forEach(s=>gp(s,t)),re(e.legends).forEach(s=>use(s,t)),e.title&&pse(e.title,t),t.parseLambdas(),t}const Bse=e=>tl({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function zse(e,t){const n=t.config,i=Z(t.root=t.add(rp())),r=Use(e,n);r.forEach(l=>uN(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(Ui()),o=t.add(gN(oN(Bse(e.encode),cp,Fw,e.style,t,{pulse:Z(s)}))),a=t.add(yN({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:Z(o)}));t.operators.pop(),t.pushState(Z(o),Z(a),null),HN(e,t,r),t.operators.push(a);let u=t.add(dN({mark:i,pulse:Z(a)}));return u=t.add(mN({pulse:Z(u)})),u=t.add(Ea({pulse:Z(u)})),t.addData("root",new Aa(t,s,s,u)),t}function Vf(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Use(e,t){const n=o=>zi(e[o],t[o]),i=[Vf("background",n("background")),Vf("autosize",Kne(n("autosize"))),Vf("padding",Qne(n("padding"))),Vf("width",n("width")||0),Vf("height",n("height")||0)],r=i.reduce((o,a)=>(o[a.name]=a,o),{}),s={};return re(e.signals).forEach(o=>{se(r,o.name)?o=de(r[o.name],o):i.push(o),s[o.name]=o}),re(t.signals).forEach(o=>{!se(s,o.name)&&!se(r,o.name)&&i.push(o)}),i}function YN(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function VN(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}YN.prototype=VN.prototype={parse(e){return HN(e,this)},fork(){return new VN(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof Mw?Z(e):e;return this.add(Zie({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(i,r,s){let o,a;i&&(o=i.data||(i.data={}),a=o[r]||(o[r]=[]),a.push(s))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(Z(this.add(Ea({pulse:e})))),this._parent.push(t),this._lookup.push(n?Z(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return be(this._parent)},encode(){return be(this._encode)},lookup(){return be(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(_e(e))return Uf(e,t);e.signal||N("Unsupported field reference: "+ee(e));const n=e.signal;let i=this.field[n];if(!i){const r={name:this.signalRef(n)};t&&(r.as=t),this.field[n]=i=Z(this.add(qie(r)))}return i},compareRef(e){let t=!1;const n=s=>bt(s)?(t=!0,this.signalRef(s.signal)):$ie(s)?(t=!0,this.exprRef(s.expr)):s,i=re(e.field).map(n),r=re(e.order).map(n);return t?Z(this.add(hN({fields:i,orders:r}))):lN(i,r)},keyRef(e,t){let n=!1;const i=s=>bt(s)?(n=!0,Z(r[s.signal])):s,r=this.signals;return e=re(e).map(i),n?Z(this.add(Wie({fields:e,flat:t}))):Aie(e,t)},sortRef(e){if(!e)return e;const t=sp(e.op,e.field),n=e.order||Oie;return n.signal?Z(this.add(hN({fields:t,orders:this.signalRef(n.signal)}))):lN(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return se(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&N("Duplicate signal name: "+ee(e));const n=t instanceof Mw?t:this.add(rp(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||N("Unrecognized signal name: "+ee(e)),this.signals[e]},signalRef(e){return this.signals[e]?Z(this.signals[e]):(se(this.lambdas,e)||(this.lambdas[e]=this.add(rp(null))),Z(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const i=e[t],r=wr(i,this),s=this.lambdas[i];s.params=r.$params,s.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!ue(e)?e:this.signalRef(e.signal||Qw(e))},exprRef(e,t){const n={expr:wr(e,this)};return t&&(n.expr.$name=t),Z(this.add(zie(n)))},addBinding(e,t){this.bindings||N("Nested signals do not support binding: "+ee(e)),this.bindings.push(de({signal:e},t))},addScaleProj(e,t){se(this.scales,e)&&N("Duplicate scale or projection name: "+ee(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,tre(t))},addProjection(e,t){this.addScaleProj(e,Qie(t))},getScale(e){return this.scales[e]||N("Unrecognized scale name: "+ee(e)),this.scales[e]},scaleRef(e){return Z(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return se(this.data,e)&&N("Duplicate data set name: "+ee(e)),this.data[e]=t},getData(e){return this.data[e]||N("Undefined data set name: "+ee(e)),this.data[e]},addDataPipeline(e,t){return se(this.data,e)&&N("Duplicate data set name: "+ee(e)),this.addData(e,Aa.fromEntries(this,t))}};function Qw(e){return(K(e)?qse:Wse)(e)}function qse(e){const t=e.length;let n="[";for(let i=0;i<t;++i){const r=e[i];n+=(i>0?",":"")+(ue(r)?r.signal||Qw(r):ee(r))}return n+"]"}function Wse(e){let t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+ee(i)+":"+(ue(r)?r.signal||Qw(r):ee(r));return t+"}"}function Gse(){const e="sans-serif",t=30,n=2,i="#4c78a8",r="#000",s="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:n},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:n},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:t,strokeWidth:n,shape:"circle"},circle:{size:t,strokeWidth:n},square:{size:t,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:s,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:s,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:s,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Hse(e,t,n){return ue(e)||N("Input Vega specification must be an object."),t=nh(Gse(),t,e.config),zse(e,new YN(t,n)).toRuntime()}var Yse="vega",Vse="5.21.0",Xse="The Vega visualization grammar.",Kse=["vega","visualization","interaction","dataflow","library","data","d3"],Jse="BSD-3-Clause",Qse="UW Interactive Data Lab (http://idl.cs.washington.edu)",Zse="build/vega-node.js",eoe="build/vega.module.js",toe="build/vega.min.js",noe="build/vega.min.js",ioe="index.d.ts",roe="vega/vega",soe={bundle:"rollup -c --config-bundle",prebuild:"rimraf build && rimraf build-es5",build:"rollup -c --config-core --config-bundle --config-ie",postbuild:"node schema-copy",pretest:"yarn build --config-test",test:"TZ=America/Los_Angeles tape 'test/**/*-test.js'",prepublishOnly:"yarn test && yarn build",postpublish:"./schema-deploy.sh"},ooe={"vega-crossfilter":"~4.0.5","vega-dataflow":"~5.7.4","vega-encode":"~4.8.3","vega-event-selector":"~3.0.0","vega-expression":"~5.0.0","vega-force":"~4.0.7","vega-format":"~1.0.4","vega-functions":"~5.12.1","vega-geo":"~4.3.8","vega-hierarchy":"~4.0.9","vega-label":"~1.1.0","vega-loader":"~4.4.1","vega-parser":"~6.1.4","vega-projection":"~1.4.5","vega-regression":"~1.0.9","vega-runtime":"~6.1.3","vega-scale":"~7.1.1","vega-scenegraph":"~4.9.4","vega-statistics":"~1.7.10","vega-time":"~2.0.4","vega-transforms":"~4.9.4","vega-typings":"~0.22.0","vega-util":"~1.17.0","vega-view":"~5.10.1","vega-view-transforms":"~4.5.8","vega-voronoi":"~4.1.5","vega-wordcloud":"~4.1.3"},aoe={"vega-schema":"*"},uoe="774165e29850b66ec8b79ba52a7955f1ab936ea6",loe={name:Yse,version:Vse,description:Xse,keywords:Kse,license:Jse,author:Qse,main:Zse,module:eoe,unpkg:toe,jsdelivr:noe,types:ioe,repository:roe,scripts:soe,dependencies:ooe,devDependencies:aoe,gitHead:uoe};de(xu,lU,EY,eV,IX,TK,fQ,jJ,hQ,kQ,BQ,YQ);const coe=loe.version;var foe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",version:coe,Dataflow:bu,EventStream:Sh,MultiPulse:by,Operator:ze,Parameters:Oh,Pulse:Ps,Transform:D,changeset:Xo,definition:DC,ingest:Me,isTuple:Eh,transform:MC,transforms:xu,tupleid:J,interpolate:ib,interpolateColors:sg,interpolateRange:sk,quantizeInterpolator:ok,scale:$e,scheme:rb,projection:Jx,View:WT,defaultLocale:dy,formatLocale:mh,locale:cC,resetDefaultLocale:lB,timeFormatLocale:vc,expressionFunction:ct,parse:Hse,runtimeContext:AT,codegenExpression:nT,parseExpression:Z5,parseSelector:ZT,Debug:_O,Error:m1,Info:EO,None:xO,Warn:wO,accessor:Sn,accessorFields:zt,accessorName:tt,array:re,ascending:ah,clampRange:jO,compare:x1,constant:qt,debounce:w1,error:N,extend:de,extent:nr,extentIndex:LO,falsy:Ss,fastmap:lu,field:Cn,flush:PO,hasOwnProperty:se,id:Xl,identity:un,inherits:z,inrange:cu,isArray:K,isBoolean:E1,isDate:Cs,isFunction:ge,isIterable:IO,isNumber:$s,isObject:ue,isRegExp:BO,isString:_e,key:_1,lerp:zO,logger:AO,lruCache:UO,merge:qO,mergeConfig:nh,one:uu,pad:WO,panLinear:kO,panLog:DO,panPow:MO,panSymlog:TO,peek:be,quarter:NO,repeat:Jl,span:Ql,splitAccessPath:th,stringValue:ee,toBoolean:A1,toDate:O1,toNumber:Ut,toSet:Fi,toString:S1,truncate:GO,truthy:oi,utcquarter:RO,visitArray:Fs,writeConfig:Kl,zero:Os,zoomLinear:y1,zoomLog:v1,zoomPow:oh,zoomSymlog:b1,bandwidthNRD:_y,bin:NC,bootstrapCI:RC,cumulativeLogNormal:Fy,cumulativeNormal:kh,cumulativeUniform:Ty,densityLogNormal:$y,densityNormal:Ay,densityUniform:My,dotbin:jC,quantileLogNormal:ky,quantileNormal:Dh,quantileUniform:Ny,quantiles:wy,quartiles:Ey,get random(){return li},randomInteger:hz,randomKDE:Sy,randomLCG:dz,randomLogNormal:PC,randomMixture:IC,randomNormal:Oy,randomUniform:BC,regressionExp:UC,regressionLinear:Ry,regressionLoess:YC,regressionLog:zC,regressionPoly:WC,regressionPow:qC,regressionQuad:jy,sampleCurve:Th,sampleLogNormal:Cy,sampleNormal:Fh,sampleUniform:Dy,setRandom:cz,DATE:kn,DAY:Gt,DAYOFYEAR:ir,HOURS:Vn,MILLISECONDS:ki,MINUTES:Xn,MONTH:Wt,QUARTER:Fn,SECONDS:ui,TIME_UNITS:K1,WEEK:pt,YEAR:Tt,dayofyear:xS,timeBin:IS,timeFloor:CS,timeInterval:pu,timeOffset:kS,timeSequence:TS,timeUnitSpecifier:bS,timeUnits:Q1,utcFloor:$S,utcInterval:mu,utcOffset:DS,utcSequence:NS,utcdayofyear:_S,utcweek:AS,week:wS,format:vh,formats:my,inferType:hC,inferTypes:gC,loader:bh,read:vC,responseType:yC,typeParsers:hy,Bounds:yt,CanvasHandler:Qc,CanvasRenderer:Mg,Gradient:Ek,GroupItem:fg,Handler:Zs,Item:cg,Marks:Kn,RenderType:to,Renderer:pr,ResourceLoader:pb,SVGHandler:Wb,SVGRenderer:Jb,SVGStringRenderer:ex,Scenegraph:Ib,boundClip:BD,boundContext:qc,boundItem:Pb,boundMark:tD,boundStroke:Jr,domChild:Mn,domClear:Ni,domCreate:Qs,domFind:Bb,font:_g,fontFamily:Vc,fontSize:gr,intersect:jD,intersectBoxLine:ju,intersectPath:Eb,intersectPoint:_b,intersectRule:Bk,lineHeight:Ks,markup:Kb,multiLineOffset:Rb,pathCurves:lb,pathEqual:zD,pathParse:Tu,pathRectangle:Fk,pathRender:Pc,pathSymbols:$k,pathTrail:kk,point:Og,renderModule:Ng,resetSVGClipId:Mk,resetSVGDefIds:PH,sceneEqual:nx,sceneFromJSON:iD,scenePickVisit:vg,sceneToJSON:nD,sceneVisit:Ti,sceneZOrder:Ab,serializeXML:OD,textMetrics:hr});function doe(e,t,n){let i;t.x2&&(t.x?(n&&e.x>e.x2&&(i=e.x,e.x=e.x2,e.x2=i),e.width=e.x2-e.x):e.x=e.x2-(e.width||0)),t.xc&&(e.x=e.xc-(e.width||0)/2),t.y2&&(t.y?(n&&e.y>e.y2&&(i=e.y,e.y=e.y2,e.y2=i),e.height=e.y2-e.y):e.y=e.y2-(e.height||0)),t.yc&&(e.y=e.yc-(e.height||0)/2)}var hoe={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},goe={"*":(e,t)=>e*t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,">":(e,t)=>e>t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"&":(e,t)=>e&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t},poe={"+":e=>+e,"-":e=>-e,"~":e=>~e,"!":e=>!e};const moe=Array.prototype.slice,Sa=(e,t,n)=>{const i=n?n(t[0]):t[0];return i[e].apply(i,moe.call(t,1))},yoe=(e,t,n,i,r,s,o)=>new Date(e,t||0,n!=null?n:1,i||0,r||0,s||0,o||0);var voe={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(e,t,n)=>Math.max(t,Math.min(n,e)),now:Date.now,utc:Date.UTC,datetime:yoe,date:e=>new Date(e).getDate(),day:e=>new Date(e).getDay(),year:e=>new Date(e).getFullYear(),month:e=>new Date(e).getMonth(),hours:e=>new Date(e).getHours(),minutes:e=>new Date(e).getMinutes(),seconds:e=>new Date(e).getSeconds(),milliseconds:e=>new Date(e).getMilliseconds(),time:e=>new Date(e).getTime(),timezoneoffset:e=>new Date(e).getTimezoneOffset(),utcdate:e=>new Date(e).getUTCDate(),utcday:e=>new Date(e).getUTCDay(),utcyear:e=>new Date(e).getUTCFullYear(),utcmonth:e=>new Date(e).getUTCMonth(),utchours:e=>new Date(e).getUTCHours(),utcminutes:e=>new Date(e).getUTCMinutes(),utcseconds:e=>new Date(e).getUTCSeconds(),utcmilliseconds:e=>new Date(e).getUTCMilliseconds(),length:e=>e.length,join:function(){return Sa("join",arguments)},indexof:function(){return Sa("indexOf",arguments)},lastindexof:function(){return Sa("lastIndexOf",arguments)},slice:function(){return Sa("slice",arguments)},reverse:e=>e.slice().reverse(),parseFloat,parseInt,upper:e=>String(e).toUpperCase(),lower:e=>String(e).toLowerCase(),substring:function(){return Sa("substring",arguments,String)},split:function(){return Sa("split",arguments,String)},replace:function(){return Sa("replace",arguments,String)},trim:e=>String(e).trim(),regexp:RegExp,test:(e,t)=>RegExp(e).test(t)};const boe=["view","item","group","xy","x","y"],xoe={Literal:(e,t)=>t.value,Identifier:(e,t)=>{const n=t.name;return e.memberDepth>0?n:n==="datum"?e.datum:n==="event"?e.event:n==="item"?e.item:hoe[n]||e.params["$"+n]},MemberExpression:(e,t)=>{const n=!t.computed,i=e(t.object);n&&(e.memberDepth+=1);const r=e(t.property);return n&&(e.memberDepth-=1),i[r]},CallExpression:(e,t)=>{const n=t.arguments;let i=t.callee.name;return i.startsWith("_")&&(i=i.slice(1)),i==="if"?e(n[0])?e(n[1]):e(n[2]):(e.fn[i]||voe[i]).apply(e.fn,n.map(e))},ArrayExpression:(e,t)=>t.elements.map(e),BinaryExpression:(e,t)=>goe[t.operator](e(t.left),e(t.right)),UnaryExpression:(e,t)=>poe[t.operator](e(t.argument)),ConditionalExpression:(e,t)=>e(t.test)?e(t.consequent):e(t.alternate),LogicalExpression:(e,t)=>t.operator==="&&"?e(t.left)&&e(t.right):e(t.left)||e(t.right),ObjectExpression:(e,t)=>t.properties.reduce((n,i)=>{e.memberDepth+=1;const r=e(i.key);return e.memberDepth-=1,n[r]=e(i.value),n},{})};function Xf(e,t,n,i,r,s){const o=a=>xoe[a.type](o,a);return o.memberDepth=0,o.fn=Object.create(t),o.params=n,o.datum=i,o.event=r,o.item=s,boe.forEach(a=>o.fn[a]=(...u)=>r.vega[a](...u)),o(e)}var woe={operator(e,t){const n=t.ast,i=e.functions;return r=>Xf(n,i,r)},parameter(e,t){const n=t.ast,i=e.functions;return(r,s)=>Xf(n,i,s,r)},event(e,t){const n=t.ast,i=e.functions;return r=>Xf(n,i,void 0,void 0,r)},handler(e,t){const n=t.ast,i=e.functions;return(r,s)=>{const o=s.item&&s.item.datum;return Xf(n,i,r,o,s)}},encode(e,t){const{marktype:n,channels:i}=t,r=e.functions,s=n==="group"||n==="image"||n==="rect";return(o,a)=>{const u=o.datum;let l=0,c;for(const f in i)c=Xf(i[f].ast,r,a,u,void 0,o),o[f]!==c&&(o[f]=c,l=1);return n!=="rule"&&doe(o,i,s),l}}};const Eoe="vega-lite",_oe='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Aoe="5.1.1",Ooe=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Soe="https://vega.github.io/vega-lite/",Coe="Vega-Lite is a concise high-level language for interactive visualization.",$oe="build/vega-lite.js",Foe="build/vega-lite.min.js",koe="build/vega-lite.min.js",Doe="build/src/index",Moe="build/src/index.d.ts",Toe={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},Noe={test:"test"},Roe=["bin","build","src","vega-lite*","tsconfig.json"],joe={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/"},Loe={type:"git",url:"https://github.com/vega/vega-lite.git"},Poe="BSD-3-Clause",Ioe={url:"https://github.com/vega/vega-lite/issues"},Boe={"@babel/core":"^7.15.0","@babel/preset-env":"^7.15.0","@babel/preset-typescript":"^7.15.0","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^20.0.0","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.4","@types/chai":"^4.2.21","@types/d3":"^7.0.0","@types/jest":"^27.0.1","@types/mkdirp":"^1.0.2","@types/pako":"^1.0.2","@typescript-eslint/eslint-plugin":"^4.29.2","@typescript-eslint/parser":"^4.29.2",ajv:"^8.6.2","ajv-formats":"^2.1.1",chai:"^4.3.4",cheerio:"^1.0.0-rc.10","conventional-changelog-cli":"^2.1.1",d3:"^7.0.1","del-cli":"^4.0.1",eslint:"^7.32.0","eslint-config-prettier":"^8.3.0","eslint-plugin-jest":"^24.4.0","eslint-plugin-prettier":"^4.0.0","gh-pages":"^3.2.3","highlight.js":"^11.2.0",jest:"^27.0.6","jest-dev-server":"^5.0.3",mkdirp:"^1.0.4",pako:"^2.0.4",prettier:"^2.3.2",puppeteer:"^10.2.0",rollup:"^2.56.3","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^12.0.0",terser:"^5.7.1","ts-jest":"^27.0.5","ts-json-schema-generator":"^0.95.0",typescript:"~4.4.2","vega-cli":"^5.20.2","vega-datasets":"~2.2.0","vega-embed":"^6.18.2","vega-tooltip":"^0.27.0","yaml-front-matter":"^4.1.1"},zoe={"@types/clone":"~2.1.1","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.3.1","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-util":"~1.16.1",yargs:"~17.1.1"},Uoe={vega:"^5.20.2"},qoe={node:">=12"};var Woe={name:Eoe,author:_oe,version:Aoe,collaborators:Ooe,homepage:Soe,description:Coe,main:$oe,unpkg:Foe,jsdelivr:koe,module:Doe,types:Moe,bin:Toe,directories:Noe,files:Roe,scripts:joe,repository:Loe,license:Poe,bugs:Ioe,devDependencies:Boe,dependencies:zoe,peerDependencies:Uoe,engines:qoe};function ll(e,t,n){return e.fields=t||[],e.fname=n,e}function Goe(e){return e.length===1?Hoe(e[0]):Yoe(e)}const Hoe=e=>function(t){return t[e]},Yoe=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function Zw(e){throw Error(e)}function Ca(e){const t=[],n=e.length;let i=null,r=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===i)l(),i=null,r=-1;else{if(i)continue;o===r&&u==='"'||o===r&&u==="'"?(o=a+1,i=u):u==="."&&!r?a>o?l():o=a+1:u==="["?(a>o&&l(),r=o=a+1):u==="]"&&(r||Zw("Access path missing open bracket: "+e),r>0&&l(),r=0,o=a+1)}return r&&Zw("Access path missing closing bracket: "+e),i&&Zw("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Voe(e,t,n){const i=Ca(e);return e=i.length===1?i[0]:e,ll((n&&n.get||Goe)(i),[e],t||e)}Voe("id");const Xoe=ll(e=>e,[],"identity");ll(()=>0,[],"zero");ll(()=>1,[],"one");ll(()=>!0,[],"true");ll(()=>!1,[],"false");function mp(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}const Koe=0,Joe=1,XN=2,Qoe=3,Zoe=4;function eae(e,t){let n=e||Koe;return{level(i){return arguments.length?(n=+i,this):n},error(){return n>=Joe&&mp(t||"error","ERROR",arguments),this},warn(){return n>=XN&&mp(t||"warn","WARN",arguments),this},info(){return n>=Qoe&&mp(t||"log","INFO",arguments),this},debug(){return n>=Zoe&&mp(t||"log","DEBUG",arguments),this}}}var V=Array.isArray;function Ue(e){return e===Object(e)}const KN=e=>e!=="__proto__";function JN(...e){return e.reduce((t,n)=>{for(const i in n)if(i==="signals")t.signals=tae(t.signals,n.signals);else{const r=i==="legend"?{layout:1}:i==="style"?!0:null;eE(t,i,n[i],r)}return t},{})}function eE(e,t,n,i){if(!KN(t))return;let r,s;if(Ue(n)&&!V(n)){s=Ue(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?eE(s,r,n[r]):KN(r)&&(s[r]=n[r])}else e[t]=n}function tae(e,t){if(e==null)return t;const n={},i=[];function r(s){n[s.name]||(n[s.name]=1,i.push(s))}return t.forEach(r),e.forEach(r),i}function rt(e){return e!=null?V(e)?e:[e]:[]}function nae(e){return typeof e=="function"}const iae=Object.prototype.hasOwnProperty;function cl(e,t){return iae.call(e,t)}function Kf(e){return typeof e=="boolean"}function ft(e){return typeof e=="number"}function ce(e){return typeof e=="string"}function Ae(e){return V(e)?"["+e.map(Ae)+"]":Ue(e)||ce(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function $a(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,i){return Array.isArray(i)?n.push.apply(n,e.call(i,t-1)):n.push(i),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var QN={exports:{}};(function(e){var t=function(){function n(d,h){return h!=null&&d instanceof h}var i;try{i=Map}catch{i=function(){}}var r;try{r=Set}catch{r=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(d,h,g,p,m){typeof h=="object"&&(g=h.depth,p=h.prototype,m=h.includeNonEnumerable,h=h.circular);var y=[],v=[],b=typeof Buffer!="undefined";typeof h=="undefined"&&(h=!0),typeof g=="undefined"&&(g=1/0);function x(E,_){if(E===null)return null;if(_===0)return E;var w,A;if(typeof E!="object")return E;if(n(E,i))w=new i;else if(n(E,r))w=new r;else if(n(E,s))w=new s(function(L,U){E.then(function(H){L(x(H,_-1))},function(H){U(x(H,_-1))})});else if(o.__isArray(E))w=[];else if(o.__isRegExp(E))w=new RegExp(E.source,f(E)),E.lastIndex&&(w.lastIndex=E.lastIndex);else if(o.__isDate(E))w=new Date(E.getTime());else{if(b&&Buffer.isBuffer(E))return Buffer.allocUnsafe?w=Buffer.allocUnsafe(E.length):w=new Buffer(E.length),E.copy(w),w;n(E,Error)?w=Object.create(E):typeof p=="undefined"?(A=Object.getPrototypeOf(E),w=Object.create(A)):(w=Object.create(p),A=p)}if(h){var S=y.indexOf(E);if(S!=-1)return v[S];y.push(E),v.push(w)}n(E,i)&&E.forEach(function(L,U){var H=x(U,_-1),ae=x(L,_-1);w.set(H,ae)}),n(E,r)&&E.forEach(function(L){var U=x(L,_-1);w.add(U)});for(var O in E){var C;A&&(C=Object.getOwnPropertyDescriptor(A,O)),!(C&&C.set==null)&&(w[O]=x(E[O],_-1))}if(Object.getOwnPropertySymbols)for(var k=Object.getOwnPropertySymbols(E),O=0;O<k.length;O++){var F=k[O],j=Object.getOwnPropertyDescriptor(E,F);j&&!j.enumerable&&!m||(w[F]=x(E[F],_-1),j.enumerable||Object.defineProperty(w,F,{enumerable:!1}))}if(m)for(var $=Object.getOwnPropertyNames(E),O=0;O<$.length;O++){var R=$[O],j=Object.getOwnPropertyDescriptor(E,R);j&&j.enumerable||(w[R]=x(E[R],_-1),Object.defineProperty(w,R,{enumerable:!1}))}return w}return x(d,g)}o.clonePrototype=function(h){if(h===null)return null;var g=function(){};return g.prototype=h,new g};function a(d){return Object.prototype.toString.call(d)}o.__objToStr=a;function u(d){return typeof d=="object"&&a(d)==="[object Date]"}o.__isDate=u;function l(d){return typeof d=="object"&&a(d)==="[object Array]"}o.__isArray=l;function c(d){return typeof d=="object"&&a(d)==="[object RegExp]"}o.__isRegExp=c;function f(d){var h="";return d.global&&(h+="g"),d.ignoreCase&&(h+="i"),d.multiline&&(h+="m"),h}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(QN);var rae=QN.exports,sae=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!=0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),i=s.length,i!==Object.keys(n).length)return!1;for(r=i;r--!=0;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;r--!=0;){var o=s[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n},tE=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,u){var l={key:a,value:o[a]},c={key:u,value:o[u]};return s(l,c)}}}(t.cmp),r=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,u;if(Array.isArray(o)){for(u="[",a=0;a<o.length;a++)a&&(u+=","),u+=s(o[a])||"null";return u+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(o)-1,c=Object.keys(o).sort(i&&i(o));for(u="",a=0;a<c.length;a++){var f=c[a],d=s(o[f]);!d||(u&&(u+=","),u+=JSON.stringify(f)+":"+d)}return r.splice(l,1),"{"+u+"}"}}(e)};function nE(e){return!!e.or}function iE(e){return!!e.and}function rE(e){return!!e.not}function yp(e,t){if(rE(e))yp(e.not,t);else if(iE(e))for(const n of e.and)yp(n,t);else if(nE(e))for(const n of e.or)yp(n,t);else t(e)}function fl(e,t){return rE(e)?{not:fl(e.not,t)}:iE(e)?{and:e.and.map(n=>fl(n,t))}:nE(e)?{or:e.or.map(n=>fl(n,t))}:t(e)}const Er=sae,fe=rae;function dl(e,t){const n={};for(const i of t)cl(e,i)&&(n[i]=e[i]);return n}function ti(e,t){const n=Object.assign({},e);for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>tE(e)).join(",")})`};const qe=tE;function xe(e){if(ft(e))return e;const t=ce(e)?e:tE(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function sE(e){return e===!1||e===null}function pe(e,t){return e.includes(t)}function hl(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function oE(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function ZN(e,...t){for(const n of t)oae(e,n!=null?n:{});return e}function oae(e,t){for(const n of P(t))eE(e,n,t[n],!0)}function _r(e,t){const n=[],i={};let r;for(const s of e)r=t(s),!(r in i)&&(i[r]=1,n.push(s));return n}function aae(e,t){const n=P(e),i=P(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function e6(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function aE(e,t){for(const n of e)if(t.has(n))return!0;return!1}function uE(e){const t=new Set;for(const n of e){const r=Ca(n).map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function lE(e,t){return e===void 0||t===void 0?!0:aE(uE(e),uE(t))}function Pe(e){return P(e).length===0}const P=Object.keys,Qt=Object.values,fo=Object.entries;function Jf(e){return e===!0||e===!1}function Xe(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Qf(e,t){return rE(e)?`!(${Qf(e.not,t)})`:iE(e)?`(${e.and.map(n=>Qf(n,t)).join(") && (")})`:nE(e)?`(${e.or.map(n=>Qf(n,t)).join(") || (")})`:t(e)}function vp(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&vp(e[n],t)&&delete e[n],Pe(e)}function Zf(e){return e.charAt(0).toUpperCase()+e.substr(1)}function cE(e,t="datum"){const n=Ca(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(Ae).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function t6(e,t="datum"){return`${t}[${Ae(Ca(e).join("."))}]`}function uae(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function yi(e){return`${Ca(e).map(uae).join("\\.")}`}function Fa(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function fE(e){return`${Ca(e).join(".")}`}function gl(e){return e?Ca(e).length:0}function dt(...e){for(const t of e)if(t!==void 0)return t}let n6=42;function i6(e){const t=++n6;return e?String(e)+t:t}function lae(){n6=42}function r6(e){return s6(e)?e:`__${e}`}function s6(e){return e.startsWith("__")}function ed(e){if(e!==void 0)return(e%360+360)%360}function bp(e){return ft(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}var td=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const as="row",us="column",xp="facet",Qe="x",xt="y",Gi="x2",Ar="y2",Or="radius",ls="radius2",Hi="theta",cs="theta2",Sr="latitude",Cr="longitude",Yi="latitude2",vi="longitude2",In="color",$r="fill",Fr="stroke",Bn="shape",fs="size",ka="angle",ds="opacity",ho="fillOpacity",go="strokeOpacity",po="strokeWidth",mo="strokeDash",nd="text",id="order",rd="detail",wp="key",Da="tooltip",Ep="href",_p="url",Ap="description",cae={x:1,y:1,x2:1,y2:1},o6={theta:1,theta2:1,radius:1,radius2:1};function a6(e){return e in o6}const dE={longitude:1,longitude2:1,latitude:1,latitude2:1};function fae(e){switch(e){case Sr:return"y";case Yi:return"y2";case Cr:return"x";case vi:return"x2"}}function dae(e){return e in dE}const hae=P(dE),u6=Object.assign(Object.assign(Object.assign(Object.assign({},cae),o6),dE),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function pl(e){return e===In||e===$r||e===Fr}const l6={row:1,column:1,facet:1},bi=P(l6),hE=Object.assign(Object.assign({},u6),l6),gae=P(hE),pae=td(hE,["order","detail","tooltip"]),mae=td(pae,["row","column","facet"]);function yae(e){return!!mae[e]}function c6(e){return!!hE[e]}const vae=[Gi,Ar,Yi,vi,cs,ls];function f6(e){return Ma(e)!==e}function Ma(e){switch(e){case Gi:return Qe;case Ar:return xt;case Yi:return Sr;case vi:return Cr;case cs:return Hi;case ls:return Or}return e}function yo(e){if(a6(e))switch(e){case Hi:return"startAngle";case cs:return"endAngle";case Or:return"outerRadius";case ls:return"innerRadius"}return e}function hs(e){switch(e){case Qe:return Gi;case xt:return Ar;case Sr:return Yi;case Cr:return vi;case Hi:return cs;case Or:return ls}}function xi(e){switch(e){case Qe:case Gi:return"width";case xt:case Ar:return"height"}}function bae(e){switch(e){case Qe:return"xOffset";case xt:return"yOffset";case Gi:return"x2Offset";case Ar:return"y2Offset";case Hi:return"thetaOffset";case Or:return"radiusOffset";case cs:return"theta2Offset";case ls:return"radius2Offset"}}const gE=td(u6,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),xae=P(gE),vo={x:1,y:1},kr=P(vo);function Dr(e){return e in vo}const pE={theta:1,radius:1},wae=P(pE);function Op(e){return e==="width"?Qe:xt}const d6=td(gE,["text","tooltip","href","url","description","detail","key","order"]),Eae=P(d6);function _ae(e){return!!gE[e]}function Aae(e){switch(e){case In:case $r:case Fr:case fs:case Bn:case ds:case po:case mo:return!0;case ho:case go:case ka:return!1}}const h6=Object.assign(Object.assign(Object.assign({},vo),pE),d6),Sp=P(h6);function bo(e){return!!h6[e]}function Oae(e,t){return Cae(e)[t]}const g6={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},Sae=td(g6,["geoshape"]);function Cae(e){switch(e){case In:case $r:case Fr:case Ap:case rd:case wp:case Da:case Ep:case id:case ds:case ho:case go:case po:case xp:case as:case us:return g6;case Qe:case xt:case Sr:case Cr:return Sae;case Gi:case Ar:case Yi:case vi:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case fs:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case mo:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Bn:return{point:"always",geoshape:"always"};case nd:return{text:"always"};case ka:return{point:"always",square:"always",text:"always"};case _p:return{image:"always"};case Hi:return{text:"always",arc:"always"};case Or:return{text:"always",arc:"always"};case cs:case ls:return{arc:"always"}}}function mE(e){switch(e){case Qe:case xt:case Hi:case Or:case fs:case ka:case po:case ds:case ho:case go:case Gi:case Ar:case cs:case ls:return;case xp:case as:case us:case Bn:case mo:case nd:case Da:case Ep:case _p:case Ap:return"discrete";case In:case $r:case Fr:return"flexible";case Sr:case Cr:case Yi:case vi:case rd:case wp:case id:return}}const $ae={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Fae={count:1,min:1,max:1};function gs(e){return!!e&&!!e.argmin}function xo(e){return!!e&&!!e.argmax}function yE(e){return ce(e)&&!!$ae[e]}const kae=["count","valid","missing","distinct"];function p6(e){return ce(e)&&pe(kae,e)}function Dae(e){return ce(e)&&pe(["min","max"],e)}const Mae=["count","sum","distinct","valid","missing"],Tae=["mean","average","median","q1","q3","min","max"],Nae=$a(Tae);function m6(e){return Kf(e)&&(e=Hp(e,void 0)),"bin"+P(e).map(t=>Cp(e[t])?Xe(`_${t}_${fo(e[t])}`):Xe(`_${t}_${e[t]}`)).join("")}function We(e){return e===!0||Ta(e)&&!e.binned}function wn(e){return e==="binned"||Ta(e)&&e.binned===!0}function Ta(e){return Ue(e)}function Cp(e){return e==null?void 0:e.param}function y6(e){switch(e){case as:case us:case fs:case In:case $r:case Fr:case po:case ds:case ho:case go:case Bn:return 6;case mo:return 4;default:return 10}}function sd(e){return e&&!!e.expr}function zn(e){const t=P(e||{}),n={};for(const i of t)n[i]=ni(e[i]);return n}var Rae=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function v6(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:u,subtitleFont:l,subtitleFontSize:c,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:h,subtitlePadding:g}=e,p=Rae(e,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),m=Object.assign(Object.assign({},p),a?{fill:a}:{}),y=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),s!==void 0?{angle:s}:{}),o!==void 0?{limit:o}:{}),v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},u?{subtitleColor:u}:{}),l?{subtitleFont:l}:{}),c?{subtitleFontSize:c}:{}),f?{subtitleFontStyle:f}:{}),d?{subtitleFontWeight:d}:{}),h?{subtitleLineHeight:h}:{}),g?{subtitlePadding:g}:{}),b=dl(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:b,nonMarkTitleProperties:y,subtitle:v}}function wo(e){return ce(e)||V(e)&&ce(e[0])}function te(e){return e&&!!e.signal}function Eo(e){return!!e.step}function jae(e){return V(e)?!1:"fields"in e&&!("data"in e)}function Lae(e){return V(e)?!1:"fields"in e&&"data"in e}function ps(e){return V(e)?!1:"field"in e&&"data"in e}const Pae={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Iae=P(Pae),Bae={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},vE=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var bE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function b6(e){const t=V(e.condition)?e.condition.map(x6):x6(e.condition);return Object.assign(Object.assign({},ni(e)),{condition:t})}function ni(e){if(sd(e)){const{expr:t}=e,n=bE(e,["expr"]);return Object.assign({signal:t},n)}return e}function x6(e){if(sd(e)){const{expr:t}=e,n=bE(e,["expr"]);return Object.assign({signal:t},n)}return e}function Ke(e){if(sd(e)){const{expr:t}=e,n=bE(e,["expr"]);return Object.assign({signal:t},n)}return te(e)?e:e!==void 0?{value:e}:void 0}function w6(e){return te(e)?e.signal:Ae(e.value)}function ms(e){return te(e)?e.signal:e==null?null:Ae(e)}function zae(e,t,n){for(const i of n){const r=Na(i,t.markDef,t.config);r!==void 0&&(e[i]=Ke(r))}return e}function E6(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Ne(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Na(e,t,n,i)}function Na(e,t,n,{vgChannel:i}={}){return dt(i?$p(e,t,n.style):void 0,$p(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function $p(e,t,n){return _6(e,E6(t),n)}function _6(e,t,n){t=rt(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function A6(e,t){return rt(e).reduce((n,i)=>{var r;return n.field.push(q(i,t)),n.order.push((r=i.sort)!==null&&r!==void 0?r:"ascending"),n},{field:[],order:[]})}function O6(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(Er(r,i))return;n.push(i)}),n}function S6(e,t){return Er(e,t)||!t?e:e?[...rt(e),...rt(t)].join(", "):t}function C6(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((wo(n)||te(n))&&(wo(i)||te(i)))return{explicit:e.explicit,value:S6(n,i)};if(wo(n)||te(n))return{explicit:e.explicit,value:n};if(wo(i)||te(i))return{explicit:e.explicit,value:i};if(!wo(n)&&!te(n)&&!wo(i)&&!te(i))return{explicit:e.explicit,value:O6(n,i)};throw new Error("It should never reach here")}function xE(e){return`Invalid specification ${qe(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Uae='Autosize "fit" only works for single views and layered views.';function $6(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function F6(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function k6(e){return e?`Dropping "fit-${e}" because spec has discrete ${xi(e)}.`:'Dropping "fit" because spec has discrete size.'}function wE(e){return`Unknown field for ${e}. Cannot calculate view size.`}function D6(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function qae(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Wae(e){return`The "nearest" transform is not supported for ${e} marks.`}function M6(e){return`Selection not supported for ${e} yet.`}function Gae(e){return`Cannot find a selection named "${e}".`}const Hae="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Yae="Legend bindings are only supported for selections over an individual field or encoding channel.";function Vae(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Xae(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Kae="The same selection must be used to override scale domains in a layered view.",Jae='Interval selections should be initialized using "x" and/or "y" keys.';function Qae(e){return`Unknown repeated value "${e}".`}function T6(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const Zae="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function eue(e){return`Unrecognized parse "${e}".`}function N6(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const tue="Attempt to add the same child twice.";function nue(e){return`Ignoring an invalid transform: ${qe(e)}.`}const iue='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function R6(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function rue(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${qe(t)} is overridden by a child projection ${qe(n)}.`}const sue="Arc marks uses theta channel rather than angle, replacing angle with theta.";function oue(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${qe(n)}}.`}function j6(e){return`Invalid field type "${e}".`}function aue(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function uue(e){return`Invalid aggregation operator "${e}".`}function L6(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function lue(e){return`Position range does not support relative band size for ${e}.`}function EE(e,t){return`Dropping ${qe(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const cue="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function Fp(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function fue(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function due(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function hue(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function gue(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function _E(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function pue(e){return`The ${e} for range marks cannot be an expression`}function mue(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function yue(e,t){return`Specified orient "${e}" overridden with "${t}".`}function vue(e){return`Cannot use the scale property "${e}" with non-color channel.`}function bue(e){return`Cannot use the relative band size with ${e} scale.`}function xue(e){return`Using unaggregated domain with raw field has no effect (${qe(e)}).`}function wue(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Eue(e){return`Unaggregated domain is currently unsupported for log scale (${qe(e)}).`}function _ue(e){return`Cannot apply size to non-oriented mark "${e}".`}function Aue(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Oue(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function P6(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function I6(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Sue(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${qe(n)} and ${qe(i)}). Using ${qe(n)}.`}function Cue(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${qe(n)} and ${qe(i)}). Using the union of the two domains.`}function $ue(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Fue(e){return`Dropping sort property ${qe(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const B6="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",kue="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Due="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Mue="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Tue(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Nue(e){return`Cannot stack non-linear scale (${e}).`}function Rue(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function kp(e,t){return`Invalid ${e}: ${qe(t)}.`}function jue(e){return`Dropping day from datetime ${qe(e)} as day cannot be combined with other units.`}function Lue(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Pue(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Iue(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function z6(e){return`1D error band does not support ${e}.`}function U6(e){return`Channel ${e} is required for "binned" bin.`}function Bue(e){return`Channel ${e} should not be used with "binned" bin.`}function zue(e){return`Domain for ${e} is required for threshold scale.`}globalThis&&globalThis.__classPrivateFieldSet;globalThis&&globalThis.__classPrivateFieldGet;const q6=eae(XN);let ml=q6;function Uue(e){return ml=e,ml}function que(){return ml=q6,ml}function B(...e){ml.warn(...e)}function Wue(...e){ml.debug(...e)}function Ra(e){if(e&&Ue(e)){for(const t of OE)if(t in e)return!0}return!1}const W6=["january","february","march","april","may","june","july","august","september","october","november","december"],Gue=W6.map(e=>e.substr(0,3)),G6=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Hue=G6.map(e=>e.substr(0,3));function Yue(e){if(bp(e)&&(e=+e),ft(e))return e>4&&B(kp("quarter",e)),e-1;throw new Error(kp("quarter",e))}function Vue(e){if(bp(e)&&(e=+e),ft(e))return e-1;{const t=e.toLowerCase(),n=W6.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Gue.indexOf(i);if(r!==-1)return r;throw new Error(kp("month",e))}}function Xue(e){if(bp(e)&&(e=+e),ft(e))return e%7;{const t=e.toLowerCase(),n=G6.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Hue.indexOf(i);if(r!==-1)return r;throw new Error(kp("day",e))}}function AE(e,t){const n=[];if(t&&e.day!==void 0&&P(e).length>1&&(B(jue(e)),e=fe(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Vue(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Yue(e.quarter):e.quarter;n.push(ft(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Xue(e.day):e.day;n.push(ft(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r=="undefined"?0:r)}return n}function od(e){const n=AE(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Kue(e){const n=AE(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Jue(e){const t=AE(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}var Que=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const H6={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},OE=P(H6);function Zue(e){return!!H6[e]}function SE(e){return e.startsWith("utc")}function ele(e){return e.substr(3)}const tle={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function CE(e){return OE.filter(t=>Y6(e,t))}function Y6(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function nle(e,t,{end:n}={end:!1}){const i=cE(t),r=SE(e)?"utc":"";function s(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let o;const a={};for(const u of OE)Y6(e,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),Kue(a)}function V6(e){if(!e)return;const t=CE(e);return`timeUnitSpecifier(${qe(t)}, ${qe(tle)})`}function ile(e,t,n){if(!e)return;const i=V6(e);return`${n||SE(e)?"utc":"time"}Format(${t}, ${i})`}function En(e){if(!e)return;let t;return ce(e)?t={unit:e}:Ue(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),SE(t.unit)&&(t.utc=!0,t.unit=ele(t.unit)),t}function rle(e){const t=En(e),{utc:n}=t,i=Que(t,["utc"]);return i.unit?(n?"utc":"")+P(i).map(r=>Xe(`${r==="unit"?"":`_${r}_`}${i[r]}`)).join(""):(n?"utc":"")+"timeunit"+P(i).map(r=>Xe(`_${r}_${i[r]}`)).join("")}function sle(e){return e==null?void 0:e.param}function $E(e){return e&&!!e.field&&e.equal!==void 0}function FE(e){return e&&!!e.field&&e.lt!==void 0}function kE(e){return e&&!!e.field&&e.lte!==void 0}function DE(e){return e&&!!e.field&&e.gt!==void 0}function ME(e){return e&&!!e.field&&e.gte!==void 0}function TE(e){if(e==null?void 0:e.field){if(V(e.range)&&e.range.length===2)return!0;if(te(e.range))return!0}return!1}function NE(e){return e&&!!e.field&&(V(e.oneOf)||V(e.in))}function ole(e){return e&&!!e.field&&e.valid!==void 0}function X6(e){return NE(e)||$E(e)||TE(e)||FE(e)||DE(e)||kE(e)||ME(e)}function Mr(e,t){return Yp(e,{timeUnit:t,wrapTime:!0})}function ale(e,t){return e.map(n=>Mr(n,t))}function K6(e,t=!0){var n;const{field:i}=e,r=(n=En(e.timeUnit))===null||n===void 0?void 0:n.unit,s=r?`time(${nle(r,i)})`:q(e,{expr:"datum"});if($E(e))return`${s}===${Mr(e.equal,r)}`;if(FE(e)){const o=e.lt;return`${s}<${Mr(o,r)}`}else if(DE(e)){const o=e.gt;return`${s}>${Mr(o,r)}`}else if(kE(e)){const o=e.lte;return`${s}<=${Mr(o,r)}`}else if(ME(e)){const o=e.gte;return`${s}>=${Mr(o,r)}`}else{if(NE(e))return`indexof([${ale(e.oneOf,r).join(",")}], ${s}) !== -1`;if(ole(e))return RE(s,e.valid);if(TE(e)){const{range:o}=e,a=te(o)?{signal:`${o.signal}[0]`}:o[0],u=te(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&u!==null&&t)return"inrange("+s+", ["+Mr(a,r)+", "+Mr(u,r)+"])";const l=[];return a!==null&&l.push(`${s} >= ${Mr(a,r)}`),u!==null&&l.push(`${s} <= ${Mr(u,r)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${qe(e)}`)}function RE(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function ule(e){var t;return X6(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=En(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const ad={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},ja=ad.quantitative,jE=ad.ordinal,yl=ad.temporal,LE=ad.nominal,vl=ad.geojson;function lle(e){if(e)switch(e=e.toLowerCase(),e){case"q":case ja:return"quantitative";case"t":case yl:return"temporal";case"o":case jE:return"ordinal";case"n":case LE:return"nominal";case vl:return"geojson"}}var cle=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const wt={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},PE={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function fle(e,t){const n=PE[e],i=PE[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const dle={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function J6(e){return dle[e]}const Q6=["linear","log","pow","sqrt","symlog","time","utc"],hle=$a(Q6),gle=["linear","log","pow","sqrt","symlog"],ple=$a(gle);function mle(e){return e in ple}const yle=["quantile","quantize","threshold"],vle=$a(yle),ble=Q6.concat(["quantile","quantize","threshold","sequential","identity"]),xle=$a(ble),wle=["ordinal","bin-ordinal","point","band"],Ele=$a(wle);function Zt(e){return e in Ele}function ii(e){return e in xle}function Vi(e){return e in hle}function ud(e){return e in vle}const _le={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function Ale(e){return!ce(e)&&!!e.name}function Z6(e){return e==null?void 0:e.param}function Ole(e){return e&&e.unionWith}function Sle(e){return ue(e)&&"field"in e}const Cle={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},$le=cle(Cle,["type","domain","range","rangeMax","rangeMin","scheme"]),Fle=P($le);function IE(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Vi(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Vi(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return Vi(e);case"nice":return Vi(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return ii(e)&&!pe(["log","time","utc","threshold","quantile"],e)}}function eR(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return pl(e)?void 0:vue(e);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function kle(e,t){return pe([jE,LE],t)?e===void 0||Zt(e):t===yl?pe([wt.TIME,wt.UTC,void 0],e):t===ja?pe([wt.LOG,wt.POW,wt.SQRT,wt.SYMLOG,wt.QUANTILE,wt.QUANTIZE,wt.THRESHOLD,wt.LINEAR,void 0],e):!0}function Dle(e,t){if(!bo(e))return!1;switch(e){case Qe:case xt:case Hi:case Or:return Vi(t)||pe(["band","point"],t);case fs:case po:case ds:case ho:case go:case ka:return Vi(t)||ud(t)||pe(["band","point","ordinal"],t);case In:case $r:case Fr:return t!=="band";case mo:case Bn:return t==="ordinal"||ud(t)}}const _n={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},tR=_n.arc,Dp=_n.area,Mp=_n.bar,Mle=_n.image,Tp=_n.line,Np=_n.point,Tle=_n.rect,Rp=_n.rule,nR=_n.text,BE=_n.tick,Nle=_n.trail,zE=_n.circle,UE=_n.square,iR=_n.geoshape;function _o(e){return["line","area","trail"].includes(e)}function rR(e){return["rect","bar","image","arc"].includes(e)}const sR=P(_n);function Tr(e){return e.type}$a(sR);const Rle=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],jle=["fill","fillOpacity"],Lle=[...Rle,...jle],Ple={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},oR=P(Ple),Ile={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},Ble={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},zle={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},aR=P(zle);function bl(e){return e&&e.band!=null}const Ule={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},uR=5,qle={binSpacing:1,continuousBandSize:uR,timeUnitBandPosition:.5},Wle={binSpacing:0,continuousBandSize:uR,timeUnitBandPosition:.5},Gle={thickness:1};function Hle(e){return Tr(e)?e.type:e}function qE(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=cR(e);return W(n)&&!p6(n.aggregate)&&r&&Vi(r.get("type"))&&r.get("zero")===!1?lR({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function lR({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return _o(n.type)||Ne("invalid",n,r)===null?i:[Yle(e,t),i]}function Yle(e,t){const n=WE(e,!0),r=Ma(t)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function WE(e,t=!0){return RE(ce(e)?e:q(e,{expr:"datum"}),!t)}function Vle(e){const{datum:t}=e;return Ra(t)?od(t):`${qe(t)}`}function La(e,t,n,i){const r={};if(t&&(r.scale=t),Ao(e)){const{datum:s}=e;Ra(s)?r.signal=od(s):te(s)?r.signal=s.signal:sd(s)?r.signal=s.expr:r.value=s}else r.field=q(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function jp({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=q(t,{expr:o,suffix:r}),u=n!==void 0?q(n,{expr:o}):q(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const c=s===0?a:u;l.field=c}else{const c=te(s)?`${s.signal} * ${a} + (1-${s.signal}) * ${u}`:`${s} * ${a} + ${1-s} * ${u}`;l.signal=`scale("${e}", ${c})`}return i&&(l.offset=i),l}function cR({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l,bandPosition:c}){var f;if(t){if(le(t)){if(wi(t)){c!=null||(c=ER({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:h,timeUnit:g,type:p}=t;if(We(h)||c&&g&&p===yl)return(a==null?void 0:a.impute)?La(t,s,{binSuffix:"mid"},{offset:u}):c?jp({scaleName:s,fieldOrDatumDef:t,bandPosition:c,offset:u}):La(t,s,fd(t,e)?{binSuffix:"range"}:{},{offset:u});if(wn(h)){if(W(n))return jp({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:c,offset:u});B(U6(e===Qe?Gi:Ar))}}const d=o==null?void 0:o.get("type");return La(t,s,Zt(d)?{binSuffix:"range"}:{},{offset:u,band:d==="band"?(f=c!=null?c:t.bandPosition)!==null&&f!==void 0?f:.5:void 0})}else if(Xi(t)){const d=t.value,h=u?{offset:u}:{};return Object.assign(Object.assign({},ld(e,d)),h)}}return nae(l)&&(l=l()),l&&Object.assign(Object.assign({},l),u?{offset:u}:{})}function ld(e,t){return pe(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:pe(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:Ke(t)}function Pa(e){return e&&e!=="number"&&e!=="time"}function fR(e,t,n){return`${e}(${t}${n?`, ${qe(n)}`:""})`}const Xle=" \u2013 ";function GE({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var o,a;if(Pa(n))return HE({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const u=dR(e,i,r);if(El(e)){const l=Jle(u,W(e)?(o=En(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,Ia(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===wt.UTC);return l?{signal:l}:void 0}if(t=pR(KE(e),t,s),W(e)&&We(e.bin)){const l=q(e,{expr:i,binSuffix:"end"});return{signal:Lp(u,l,t,n,s)}}else return t||KE(e)==="quantitative"?{signal:`${mR(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function dR(e,t,n){return W(e)?n?`${q(e,{expr:t,suffix:"end"})}-${q(e,{expr:t,suffix:"start"})}`:q(e,{expr:t}):Vle(e)}function HE({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o!=null||(o=dR(e,i,r)),W(e)&&We(e.bin)){const a=q(e,{expr:i,binSuffix:"end"});return{signal:Lp(o,a,t,n,s)}}return{signal:fR(n,o,t)}}function hR(e,t,n,i,r,s){var o;if(!Pa(i)){if(El(e)){const a=W(e)?(o=En(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return Kle(n,a,r,s)}return pR(t,n,r)}}function gR(e,t,n){if(e&&(te(e)||e==="number"||e==="time"))return e;if(El(t)&&n!=="time"&&n!=="utc")return"time"}function pR(e,t,n){if(ce(t))return t;if(e===ja)return n.numberFormat}function Kle(e,t,n,i){return e||(t?{signal:V6(t)}:i?void 0:n.timeFormat)}function mR(e,t){return`format(${e}, "${t||""}")`}function yR(e,t,n,i){var r;return Pa(n)?fR(n,e,t):mR(e,(r=ce(t)?t:void 0)!==null&&r!==void 0?r:i.numberFormat)}function Lp(e,t,n,i,r){const s=yR(e,n,i,r),o=yR(t,n,i,r);return`${RE(e,!1)} ? "null" : ${s} + "${Xle}" + ${o}`}function Jle(e,t,n,i,r){return!t||n?(n=ce(n)?n:i,`${r?"utc":"time"}Format(${e}, '${n}')`):ile(t,e,r)}const Pp="min",Qle={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function vR(e){return e in Qle}function bR(e){return!!e&&!!e.encoding}function Nr(e){return!!e&&(e.op==="count"||!!e.field)}function xR(e){return!!e&&V(e)}function cd(e){return"row"in e||"column"in e}function YE(e){return!!e&&"header"in e}function Ip(e){return"facet"in e}var VE=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Zle(e){return e.param}function ece(e){return e&&!ce(e)&&"repeat"in e}function wR(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:t})}function XE(e){return"sort"in e}function ER({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(le(e)&&e.bandPosition!==void 0)return e.bandPosition;if(W(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return rR(n.type)?0:Na("timeUnitBandPosition",n,i);if(We(s))return .5}}function _R({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var a,u,l;const c=xi(e),f=Ne(o?"size":c,i,r,{vgChannel:c});if(f!==void 0)return f;if(W(t)){const{timeUnit:d,bin:h}=t;if(d&&!n)return{band:Na("timeUnitBandSize",i,r)};if(We(h)&&!Zt(s))return{band:1}}if(rR(i.type))return s?Zt(s)?((a=r[i.type])===null||a===void 0?void 0:a.discreteBandSize)||{band:1}:(u=r[i.type])===null||u===void 0?void 0:u.continuousBandSize:(l=r[i.type])===null||l===void 0?void 0:l.discreteBandSize}function AR(e,t,n,i){return We(e.bin)||e.timeUnit&&wi(e)&&e.type==="temporal"?ER({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function Bp(e){return e&&"condition"in e}function zp(e){const t=e&&e.condition;return!!t&&!V(t)&&W(t)}function Up(e){const t=e&&e.condition;return!!t&&!V(t)&&le(t)}function tce(e){const t=e&&e.condition;return!!t&&(V(t)||Xi(t))}function W(e){return e&&(!!e.field||e.aggregate==="count")}function KE(e){return e&&e.type}function Ao(e){return e&&"datum"in e}function Rr(e){return wi(e)&&!qp(e)||JE(e)}function JE(e){return Ao(e)&&ft(e.datum)}function le(e){return W(e)||Ao(e)}function wi(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function Xi(e){return e&&"value"in e&&"value"in e}function Ia(e){return e&&("scale"in e||"sort"in e)}function QE(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function OR(e){return e&&"legend"in e}function SR(e){return e&&("format"in e||"formatType"in e)}function nce(e){return ti(e,["legend","axis","header","scale"])}function ice(e){return"op"in e}function q(e,t={}){var n,i,r;let s=e.field;const o=t.prefix;let a=t.suffix,u="";if(sce(e))s=r6("count");else{let l;if(!t.nofn)if(ice(e))l=e.op;else{const{bin:c,aggregate:f,timeUnit:d}=e;We(c)?(l=m6(c),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((i=t.suffix)!==null&&i!==void 0?i:"")):f?xo(f)?(u=`["${s}"]`,s=`argmax_${f.argmax}`):gs(f)?(u=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):d&&(l=rle(d),a=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((r=t.suffix)!==null&&r!==void 0?r:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?fE(s):t.expr?t6(s,t.expr)+u:yi(s)+u}function qp(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return W(e)&&!!e.bin;case"temporal":return!1}throw new Error(j6(e.type))}function rce(e){var t;return Ia(e)&&ud((t=e.scale)===null||t===void 0?void 0:t.type)}function sce(e){return e.aggregate==="count"}function oce(e,t){var n;const{field:i,bin:r,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(We(r))return`${i} (binned)`;if(s){const a=(n=En(s))===null||n===void 0?void 0:n.unit;if(a)return`${i} (${CE(a).join("-")})`}else if(o)return xo(o)?`${i} for max ${o.argmax}`:gs(o)?`${i} for min ${o.argmin}`:`${Zf(o)} of ${i}`;return i}function ace(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(xo(t))return`${r} for argmax(${t.argmax})`;if(gs(t))return`${r} for argmin(${t.argmin})`;const s=En(i),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||We(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const CR=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return ace(e);default:return oce(e,t)}};let $R=CR;function FR(e){$R=e}function uce(){FR(CR)}function xl(e,t,{allowDisabling:n,includeDefault:i=!0}){var r,s;const o=(r=ZE(e))===null||r===void 0?void 0:r.title;if(!W(e))return o;const a=e,u=i?e_(a,t):void 0;return n?dt(o,a.title,u):(s=o!=null?o:a.title)!==null&&s!==void 0?s:u}function ZE(e){if(QE(e)&&e.axis)return e.axis;if(OR(e)&&e.legend)return e.legend;if(YE(e)&&e.header)return e.header}function e_(e,t){return $R(e,t)}function Wp(e){var t;if(SR(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=ZE(e))!==null&&t!==void 0?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function lce(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(XE(e)&&V(e.sort))return"ordinal";const{aggregate:i,bin:r,timeUnit:s}=e;if(s)return"temporal";if(r||i&&!xo(i)&&!gs(i))return"quantitative";if(Ia(e)&&((n=e.scale)===null||n===void 0?void 0:n.type))switch(PE[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function jr(e){if(W(e))return e;if(zp(e))return e.condition}function Et(e){if(le(e))return e;if(Up(e))return e.condition}function kR(e,t,n,i={}){if(ce(e)||ft(e)||Kf(e)){const r=ce(e)?"string":ft(e)?"number":"boolean";return B(oue(t,r,e)),{value:e}}return le(e)?Gp(e,t,n,i):Up(e)?Object.assign(Object.assign({},e),{condition:Gp(e.condition,t,n,i)}):e}function Gp(e,t,n,i){if(SR(e)){const{format:r,formatType:s}=e,o=VE(e,["format","formatType"]);if(Pa(s)&&!n.customFormatTypes)return B(R6(t)),Gp(o,t,n,i)}else{const r=QE(e)?"axis":OR(e)?"legend":YE(e)?"header":null;if(r&&e[r]){const s=e[r],{format:o,formatType:a}=s,u=VE(s,["format","formatType"]);if(Pa(a)&&!n.customFormatTypes)return B(R6(t)),Gp(Object.assign(Object.assign({},e),{[r]:u}),t,n,i)}}return W(e)?t_(e,t,i):cce(e)}function cce(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=ft(n)?"quantitative":ce(n)?"nominal":Ra(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function t_(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a=Object.assign({},e);if(!n&&i&&!yE(i)&&!xo(i)&&!gs(i)&&(B(uue(i)),delete a.aggregate),r&&(a.timeUnit=En(r)),o&&(a.field=`${o}`),We(s)&&(a.bin=Hp(s,t)),wn(s)&&!Dr(t)&&B(Bue(t)),wi(a)){const{type:u}=a,l=lle(u);u!==l&&(a.type=l),u!=="quantitative"&&p6(i)&&(B(aue(u,i)),a.type="quantitative")}else if(!f6(t)){const u=lce(a,t);a.type=u}if(wi(a)){const{compatible:u,warning:l}=fce(a,t)||{};u===!1&&B(l)}if(XE(a)&&ce(a.sort)){const{sort:u}=a;if(vR(u))return Object.assign(Object.assign({},a),{sort:{encoding:u}});const l=u.substr(1);if(u.charAt(0)==="-"&&vR(l))return Object.assign(Object.assign({},a),{sort:{encoding:l,order:"descending"}})}if(YE(a)){const{header:u}=a;if(u){const{orient:l}=u,c=VE(u,["orient"]);if(l)return Object.assign(Object.assign({},a),{header:Object.assign(Object.assign({},c),{labelOrient:u.labelOrient||l,titleOrient:u.titleOrient||l})})}}return a}function Hp(e,t){return Kf(e)?{maxbins:y6(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:y6(t)}):e}const wl={compatible:!0};function fce(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case as:case us:case xp:return qp(e)?wl:{compatible:!1,warning:due(t)};case Qe:case xt:case In:case $r:case Fr:case nd:case rd:case wp:case Da:case Ep:case _p:case ka:case Hi:case Or:case Ap:return wl;case Cr:case vi:case Sr:case Yi:return n!==ja?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:wl;case ds:case ho:case go:case po:case fs:case cs:case ls:case Gi:case Ar:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:wl;case Bn:case mo:return!qp(e)&&!rce(e)?{compatible:!1,warning:hue(t)}:wl;case id:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:wl}}function El(e){const{formatType:t}=Wp(e);return t==="time"||!t&&dce(e)}function dce(e){return e&&(e.type==="temporal"||W(e)&&!!e.timeUnit)}function Yp(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var s;const o=t&&((s=En(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",u;return sd(e)?u=e.expr:te(e)?u=e.signal:Ra(e)?(a=!0,u=od(e)):(ce(e)||ft(e))&&a&&(u=`datetime(${qe(e)})`,Zue(o)&&(ft(e)&&e<1e4||ce(e)&&isNaN(Date.parse(e)))&&(u=od({[o]:e}))),u?i&&a?`time(${u})`:u:r?void 0:qe(e)}function DR(e,t){const{type:n}=e;return t.map(i=>{const r=Yp(i,{timeUnit:W(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return r!==void 0?{signal:r}:i})}function fd(e,t){return We(e.bin)?bo(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const MR={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function dd(e){return e&&e.condition}const TR=["domain","grid","labels","ticks","title"],hce={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},NR={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},gce=Object.assign(Object.assign({},NR),{style:1,labelExpr:1,encoding:1});function RR(e){return!!gce[e]}const pce={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},jR=P(pce);function ys(e){return"mark"in e}class Vp{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return ys(t)?Hle(t.mark)===this.name:!1}}var mce=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Ba(e,t){const n=e&&e[t];return n?V(n)?hl(n,i=>!!i.field):W(n)||zp(n):!1}function n_(e){return hl(gae,t=>{if(Ba(e,t)){const n=e[t];if(V(n))return hl(n,i=>!!i.aggregate);{const i=jr(n);return i&&!!i.aggregate}}return!1})}function LR(e,t){const n=[],i=[],r=[],s=[],o={};return i_(e,(a,u)=>{if(W(a)){const{field:l,aggregate:c,bin:f,timeUnit:d}=a,h=mce(a,["field","aggregate","bin","timeUnit"]);if(c||d||f){const g=ZE(a),p=g==null?void 0:g.title;let m=q(a,{forAs:!0});const y=Object.assign(Object.assign(Object.assign({},p?[]:{title:xl(a,t,{allowDisabling:!0})}),h),{field:m});if(c){let v;if(xo(c)?(v="argmax",m=q({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${m}.${l}`):gs(c)?(v="argmin",m=q({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${m}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(v=c),v){const b={op:v,as:m};l&&(b.field=l),s.push(b)}}else if(n.push(m),wi(a)&&We(f)){if(i.push({bin:f,field:l,as:m}),n.push(q(a,{binSuffix:"end"})),fd(a,u)&&n.push(q(a,{binSuffix:"range"})),Dr(u)){const v={field:`${m}_end`};o[`${u}2`]=v}y.bin="binned",f6(u)||(y.type=ja)}else if(d){r.push({timeUnit:d,field:l,as:m});const v=wi(a)&&a.type!==yl&&"time";v&&(u===nd||u===Da?y.formatType=v:_ae(u)?y.legend=Object.assign({formatType:v},y.legend):Dr(u)&&(y.axis=Object.assign({formatType:v},y.axis)))}o[u]=y}else n.push(l),o[u]=e[u]}else o[u]=e[u]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function yce(e,t,n){const i=Oae(t,n);if(i){if(i==="binned"){const r=e[t===Gi?Qe:xt];return!!(W(r)&&W(e[t])&&wn(r.bin))}}else return!1;return!0}function vce(e,t,n,i){return P(e).reduce((r,s)=>{if(!c6(s))return B(fue(s)),r;const o=e[s];if(s==="angle"&&t==="arc"&&!e.theta&&(B(sue),s=Hi),!yce(e,s,t))return B(Fp(s,t)),r;if(s===fs&&t==="line"){const a=jr(e[s]);if(a==null?void 0:a.aggregate)return B(cue),r}if(s===In&&(n?"fill"in e:"stroke"in e))return B(L6("encoding",{fill:"fill"in e,stroke:"stroke"in e})),r;if(s===rd||s===id&&!V(o)&&!Xi(o)||s===Da&&V(o))o&&(r[s]=rt(o).reduce((a,u)=>(W(u)?a.push(t_(u,s)):B(EE(u,s)),a),[]));else{if(s===Da&&o===null)r[s]=null;else if(!W(o)&&!Ao(o)&&!Xi(o)&&!Bp(o)&&!te(o))return B(EE(o,s)),r;r[s]=kR(o,s,i)}return r},{})}function Xp(e,t){const n={};for(const i of P(e)){const r=kR(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function bce(e){const t=[];for(const n of P(e))if(Ba(e,n)){const i=e[n],r=rt(i);for(const s of r)W(s)?t.push(s):zp(s)&&t.push(s.condition)}return t}function i_(e,t,n){if(!!e)for(const i of P(e)){const r=e[i];if(V(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function xce(e,t,n,i){return e?P(e).reduce((r,s)=>{const o=e[s];return V(o)?o.reduce((a,u)=>t.call(i,a,u,s),r):t.call(i,r,o,s)},n):n}function PR(e,t){return P(t).reduce((n,i)=>{switch(i){case Qe:case xt:case Ep:case Ap:case _p:case Gi:case Ar:case Hi:case cs:case Or:case ls:case Sr:case Cr:case Yi:case vi:case nd:case Bn:case ka:case Da:return n;case id:if(e==="line"||e==="trail")return n;case rd:case wp:{const r=t[i];if(V(r)||W(r))for(const s of rt(r))s.aggregate||n.push(q(s,{}));return n}case fs:if(e==="trail")return n;case In:case $r:case Fr:case ds:case ho:case go:case mo:case po:{const r=jr(t[i]);return r&&!r.aggregate&&n.push(q(r,{})),n}}},[])}var IR=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function wce(e){const{tooltip:t}=e,n=IR(e,["tooltip"]);if(!t)return{filteredEncoding:n};let i,r;if(V(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return V(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function r_(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const u=i?` of ${s_(t)}`:"";return{field:o+t.field,type:t.type,title:te(a)?{signal:`${a}"${escape(u)}"`}:a+u}}),s=bce(n).map(nce);return{tooltip:[...r,..._r(s,xe)]}}function s_(e){const{title:t,field:n}=e;return dt(t,n)}function o_(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,extraEncoding:f={}})=>{const d=s_(n);return BR(e,a,r,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:`${l}_${n.field}`,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},ce(c)?{[`${t}2`]:{field:`${c}_${n.field}`}}:{}),i),f)})}}function BR(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),r?{clip:r}:{}),s?{color:s}:{}),o?{opacity:o}:{}),Tr(i.mark)?i.mark:{type:i.mark}),{style:`${a}-${t}`}),Kf(e[t])?{}:e[t])})]:[]}function zR(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],u=i[`${r}Error2`];return{continuousAxisChannelDef:Kp(s,n),continuousAxisChannelDef2:Kp(o,n),continuousAxisChannelDefError:Kp(a,n),continuousAxisChannelDefError2:Kp(u,n),continuousAxis:r}}function Kp(e,t){if(e==null?void 0:e.aggregate){const{aggregate:n}=e,i=IR(e,["aggregate"]);return n!==t&&B(Iue(n,t)),i}else return e}function UR(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(Tr(n)&&n.orient)return n.orient;if(Rr(r)){if(Rr(s)){const o=W(r)&&r.aggregate,a=W(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return El(s)&&!El(r)?"horizontal":"vertical"}return"horizontal"}else{if(Rr(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}var Jp=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Qp="boxplot",Ece=["box","median","outliers","rule","ticks"],_ce=new Vp(Qp,WR);function qR(e){return ft(e)?"tukey":e}function WR(e,{config:t}){var n,i;e=Object.assign(Object.assign({},e),{encoding:Xp(e.encoding,t)});const{mark:r,encoding:s,params:o,projection:a}=e,u=Jp(e,["mark","encoding","params","projection"]),l=Tr(r)?r:{type:r};o&&B(M6("boxplot"));const c=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Ne("size",l,t),d=qR(c),{bins:h,timeUnits:g,transform:p,continuousAxisChannelDef:m,continuousAxis:y,groupby:v,aggregate:b,encodingWithoutContinuousAxis:x,ticksOrient:E,boxOrient:_,customTooltipWithoutAggregatedField:w}=Ace(e,c,t),{color:A,size:S}=x,O=Jp(x,["color","size"]),C=ot=>o_(l,y,m,ot,t.boxplot),k=C(O),F=C(x),j=C(Object.assign(Object.assign({},O),S?{size:S}:{})),$=r_([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],m,x),R={type:"tick",color:"black",opacity:1,orient:E,invalid:null,aria:!1},L=d==="min-max"?$:r_([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],m,x),U=[...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:L}),...k({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:L}),...k({partName:"ticks",mark:R,positionPrefix:"lower_whisker",extraEncoding:L}),...k({partName:"ticks",mark:R,positionPrefix:"upper_whisker",extraEncoding:L})],H=[...d!=="tukey"?U:[],...F({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:_,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:$}),...j({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Ue(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:E,aria:!1}),positionPrefix:"mid_box",extraEncoding:$})];if(d==="min-max")return Object.assign(Object.assign({},u),{transform:((i=u.transform)!==null&&i!==void 0?i:[]).concat(p),layer:H});const ae=`datum["lower_box_${m.field}"]`,De=`datum["upper_box_${m.field}"]`,Oe=`(${De} - ${ae})`,Ze=`${ae} - ${c} * ${Oe}`,Be=`${De} + ${c} * ${Oe}`,st=`datum["${m.field}"]`,sn={joinaggregate:GR(m.field),groupby:v},Ai={transform:[{filter:`(${Ze} <= ${st}) && (${st} <= ${Be})`},{aggregate:[{op:"min",field:m.field,as:`lower_whisker_${m.field}`},{op:"max",field:m.field,as:`upper_whisker_${m.field}`},{op:"min",field:`lower_box_${m.field}`,as:`lower_box_${m.field}`},{op:"max",field:`upper_box_${m.field}`,as:`upper_box_${m.field}`},...b],groupby:v}],layer:U},si=Jp(O,["tooltip"]),{scale:G,axis:oe}=m,he=s_(m),I=ti(oe,["title"]),lt=BR(l,"outliers",t.boxplot,{transform:[{filter:`(${st} < ${Ze}) || (${st} > ${Be})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[y]:Object.assign(Object.assign(Object.assign({field:m.field,type:m.type},he!==void 0?{title:he}:{}),G!==void 0?{scale:G}:{}),Pe(I)?{}:{axis:I})},si),A?{color:A}:{}),w?{tooltip:w}:{})})[0];let ve;const gt=[...h,...g,sn];return lt?ve={transform:gt,layer:[lt,Ai]}:(ve=Ai,ve.transform.unshift(...gt)),Object.assign(Object.assign({},u),{layer:[ve,{transform:p,layer:H}]})}function GR(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function Ace(e,t,n){const i=UR(e,Qp),{continuousAxisChannelDef:r,continuousAxis:s}=zR(e,i,Qp),o=r.field,a=qR(t),u=[...GR(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],c=e.encoding,f=s;c[f];const d=Jp(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:h,filteredEncoding:g}=wce(d),{bins:p,timeUnits:m,aggregate:y,groupby:v,encoding:b}=LR(g,n),x=i==="vertical"?"horizontal":"vertical",E=i,_=[...p,...m,{aggregate:[...y,...u],groupby:v},...l];return{bins:p,timeUnits:m,transform:_,groupby:v,aggregate:y,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:E,customTooltipWithoutAggregatedField:h}}var HR=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const a_="errorbar",Oce=["ticks","rule"],Sce=new Vp(a_,YR);function YR(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Xp(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:l}=VR(e,a_,t);delete s.size;const c=o_(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,h=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},f!==void 0?{thickness:f}:{}),d!==void 0?{size:d}:{}),g=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:l}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},f!==void 0?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),g.length>1?{layer:g}:Object.assign({},g[0]))}function Cce(e,t){const{encoding:n}=e;if($ce(n))return{orient:UR(e,t),inputType:"raw"};const i=Fce(n),r=kce(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(le(a)&&le(u))throw new Error(`${t} cannot have both x2 and y2`);if(le(a)){if(Rr(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(le(u)){if(Rr(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(le(u)&&!le(a))throw new Error(`${t} cannot have xError2 without xError`);if(le(c)&&!le(l))throw new Error(`${t} cannot have yError2 without yError`);if(le(a)&&le(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(le(a)){if(Rr(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(le(l)){if(Rr(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function $ce(e){return(le(e.x)||le(e.y))&&!le(e.x2)&&!le(e.y2)&&!le(e.xError)&&!le(e.xError2)&&!le(e.yError)&&!le(e.yError2)}function Fce(e){return le(e.x2)||le(e.y2)}function kce(e){return le(e.xError)||le(e.xError2)||le(e.yError)||le(e.yError2)}function VR(e,t,n){var i;const{mark:r,encoding:s,params:o,projection:a}=e,u=HR(e,["mark","encoding","params","projection"]),l=Tr(r)?r:{type:r};o&&B(M6(t));const{orient:c,inputType:f}=Cce(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:g,continuousAxisChannelDefError2:p,continuousAxis:m}=zR(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=Dce(l,d,h,g,p,f,t,n),E=s,_=m;E[_];const w=m==="x"?"x2":"y2";E[w];const A=m==="x"?"xError":"yError";E[A];const S=m==="x"?"xError2":"yError2";E[S];const O=HR(E,[typeof _=="symbol"?_:_+"",typeof w=="symbol"?w:w+"",typeof A=="symbol"?A:A+"",typeof S=="symbol"?S:S+""]),{bins:C,timeUnits:k,aggregate:F,groupby:j,encoding:$}=LR(O,n),R=[...F,...y],L=f!=="raw"?[]:j,U=r_(b,d,$,x);return{transform:[...(i=u.transform)!==null&&i!==void 0?i:[],...C,...k,...R.length===0?[]:[{aggregate:R,groupby:L}],...v],groupby:L,continuousAxisChannelDef:d,continuousAxis:m,encodingWithoutContinuousAxis:$,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:U}}function Dce(e,t,n,i,r,s,o,a){let u=[],l=[];const c=t.field;let f,d=!1;if(s==="raw"){const h=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,g=e.extent?e.extent:h==="mean"?"stderr":"iqr";if(h==="median"!=(g==="iqr")&&B(Pue(h,g,o)),g==="stderr"||g==="stdev")u=[{op:g,field:c,as:`extent_${c}`},{op:h,field:c,as:`center_${c}`}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:`upper_${c}`},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:`lower_${c}`}],f=[{fieldPrefix:"center_",titlePrefix:Zf(h)},{fieldPrefix:"upper_",titlePrefix:XR(h,g,"+")},{fieldPrefix:"lower_",titlePrefix:XR(h,g,"-")}],d=!0;else{let p,m,y;g==="ci"?(p="mean",m="ci0",y="ci1"):(p="median",m="q1",y="q3"),u=[{op:m,field:c,as:`lower_${c}`},{op:y,field:c,as:`upper_${c}`},{op:p,field:c,as:`center_${c}`}],f=[{fieldPrefix:"upper_",titlePrefix:xl({field:c,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:xl({field:c,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:xl({field:c,aggregate:p,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&B(Lue(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${c}`},{calculate:`datum["${c}"]`,as:`lower_${c}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:`upper_${c}`}],r?l.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:`lower_${c}`}):l.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:`lower_${c}`}));for(const h of l)f.push({fieldPrefix:h.as.substring(0,6),titlePrefix:Fa(Fa(h.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:d}}function XR(e,t,n){return`${Zf(e)} ${n} ${t}`}const u_="errorband",Mce=["band","borders"],Tce=new Vp(u_,KR);function KR(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:Xp(e.encoding,t)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=VR(e,u_,t),l=o,c=o_(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const g=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),g),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign(Object.assign({},h),g),{aria:!1})):l.interpolate?B(z6("interpolate")):l.tension&&B(z6("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:u})]})}const JR={};function l_(e,t,n){const i=new Vp(e,t);JR[e]={normalizer:i,parts:n}}function Nce(){return P(JR)}l_(Qp,WR,Ece);l_(a_,YR,Oce);l_(u_,KR,Mce);const Rce=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],QR={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},ZR={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},jce=P(QR),Lce=P(ZR),Pce={header:1,headerRow:1,headerColumn:1,headerFacet:1},ej=P(Pce),tj=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Ice={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Bce={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},hd="_vgsid_",zce={point:{on:"click",fields:[hd],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function c_(e){return!!e&&(e==="legend"||!!e.legend)}function f_(e){return c_(e)&&Ue(e)}function d_(e){return!!e.select}var Uce=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function nj(e){const t=[];for(const n of e||[]){if(d_(n))continue;const{expr:i,bind:r}=n,s=Uce(n,["expr","bind"]);if(r&&i){const o=Object.assign(Object.assign({},s),{bind:r,init:i});t.push(o)}else{const o=Object.assign(Object.assign(Object.assign({},s),i?{update:i}:{}),r?{bind:r}:{});t.push(o)}}return t}function qce(e){return Zp(e)||g_(e)||h_(e)}function h_(e){return"concat"in e}function Zp(e){return"vconcat"in e}function g_(e){return"hconcat"in e}function Lr(e){return Ue(e)&&e.step!==void 0}function ij(e){return e.view||e.width||e.height}const rj=20,Wce={align:1,bounds:1,center:1,columns:1,spacing:1},Gce=P(Wce);function Hce(e,t,n){var i,r;const s=n[t],o={},{spacing:a,columns:u}=s;a!==void 0&&(o.spacing=a),u!==void 0&&(Ip(e)&&!cd(e.facet)||h_(e))&&(o.columns=u),Zp(e)&&(o.columns=1);for(const l of Gce)if(e[l]!==void 0)if(l==="spacing"){const c=e[l];o[l]=ft(c)?c:{row:(i=c.row)!==null&&i!==void 0?i:a,column:(r=c.column)!==null&&r!==void 0?r:a}}else o[l]=e[l];return o}var Yce=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function p_(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function em(e,t){const n=gd(e,t);return Lr(n)?n.step:sj}function gd(e,t){var n;const i=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return dt(i,{step:e.step})}const sj=20,Vce={continuousWidth:200,continuousHeight:200,step:sj},Xce={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Vce,mark:Ble,arc:{},area:{},bar:qle,circle:{},geoshape:{},image:{},line:{},point:{},rect:Wle,rule:{color:"black"},square:{},text:{color:"black"},tick:Gle,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:_le,projection:{},legend:Ice,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:zce,style:{},title:{},facet:{spacing:rj},concat:{spacing:rj}},vs=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],oj={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},aj={blue:vs[0],orange:vs[1],red:vs[2],teal:vs[3],green:vs[4],yellow:vs[5],purple:vs[6],pink:vs[7],brown:vs[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Kce(e={}){return{signals:[{name:"color",value:Ue(e)?Object.assign(Object.assign({},aj),e):aj}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Jce(e){return{signals:[{name:"fontSize",value:Ue(e)?Object.assign(Object.assign({},oj),e):oj}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Qce(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function uj(e){const t=P(e||{}),n={};for(const i of t){const r=e[i];n[i]=dd(r)?b6(r):ni(r)}return n}function Zce(e){const t=P(e),n={};for(const i of t)n[i]=uj(e[i]);return n}const efe=[...aR,...jR,...ej,"background","padding","legend","lineBreak","scale","style","title","view"];function lj(e={}){const{color:t,font:n,fontSize:i,selection:r}=e,s=Yce(e,["color","font","fontSize","selection"]),o=JN({},fe(Xce),n?Qce(n):{},t?Kce(t):{},i?Jce(i):{},s||{});r&&Kl(o,"selection",r,!0);const a=ti(o,efe);for(const u of["background","lineBreak","padding"])o[u]&&(a[u]=ni(o[u]));for(const u of aR)o[u]&&(a[u]=zn(o[u]));for(const u of jR)o[u]&&(a[u]=uj(o[u]));for(const u of ej)o[u]&&(a[u]=zn(o[u]));return o.legend&&(a.legend=zn(o.legend)),o.scale&&(a.scale=zn(o.scale)),o.style&&(a.style=Zce(o.style)),o.title&&(a.title=zn(o.title)),o.view&&(a.view=zn(o.view)),a}const tfe=["view",...sR],nfe=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],ife=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},Ile);function rfe(e){e=fe(e);for(const t of nfe)delete e[t];if(e.axis)for(const t in e.axis)dd(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Rce)delete e.legend[t];if(e.mark){for(const t of oR)delete e.mark[t];e.mark.tooltip&&Ue(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(nj(e.params)),delete e.params);for(const t of tfe){for(const i of oR)delete e[t][i];const n=ife[t];if(n)for(const i of n)delete e[t][i];ofe(e,t)}for(const t of Nce())delete e[t];sfe(e);for(const t in e)Ue(e[t])&&Pe(e[t])&&delete e[t];return Pe(e)?void 0:e}function sfe(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=v6(e.title);Pe(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),Pe(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),Pe(i)?delete e.title:e.title=i}function ofe(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},r),e.style[n!=null?n:t]);Pe(s)||(e.style[n!=null?n:t]=s),i||delete e[t]}function tm(e){return"layer"in e}function afe(e){return"repeat"in e}function ufe(e){return!V(e.repeat)&&e.repeat.layer}var lfe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class m_{map(t,n){return Ip(t)?this.mapFacet(t,n):afe(t)?this.mapRepeat(t,n):g_(t)?this.mapHConcat(t,n):Zp(t)?this.mapVConcat(t,n):h_(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(tm(t))return this.mapLayer(t,n);if(ys(t))return this.mapUnit(t,n);throw new Error(xE(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(i=>this.map(i,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(i=>this.map(i,n))})}mapConcat(t,n){const{concat:i}=t,r=lfe(t,["concat"]);return Object.assign(Object.assign({},r),{concat:i.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const cfe={zero:1,center:1,normalize:1};function ffe(e){return e in cfe}const dfe=new Set([tR,Mp,Dp,Rp,Np,zE,UE,Tp,nR,BE]),hfe=new Set([Mp,Dp,tR]);function _l(e){return W(e)&&KE(e)==="quantitative"&&!e.bin}function cj(e,t){var n,i;const r=t==="x"?"y":"radius",s=e[t],o=e[r];if(W(s)&&W(o))if(_l(s)&&_l(o)){if(s.stack)return t;if(o.stack)return r;const a=W(s)&&!!s.aggregate,u=W(o)&&!!o.aggregate;if(a!==u)return a?t:r;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,c=(i=o.scale)===null||i===void 0?void 0:i.type;if(l&&l!=="linear")return r;if(c&&c!=="linear")return t}}else{if(_l(s))return t;if(_l(o))return r}else{if(_l(s))return t;if(_l(o))return r}}function gfe(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function fj(e,t,n={}){var i,r;const s=Tr(e)?e.type:e;if(!dfe.has(s))return null;const o=cj(t,"x")||cj(t,"theta");if(!o)return null;const a=t[o],u=W(a)?q(a,{}):void 0;let l=gfe(o),c=t[l],f=W(c)?q(c,{}):void 0;f===u&&(f=void 0,c=void 0,l=void 0);const d=xae.reduce((g,p)=>{if(p!=="tooltip"&&Ba(t,p)){const m=t[p];for(const y of rt(m)){const v=jr(y);if(v.aggregate)continue;const b=q(v,{});(!b||b!==f)&&g.push({channel:p,fieldDef:v})}}return g},[]);let h;if(a.stack!==void 0?Kf(a.stack)?h=a.stack?"zero":null:h=a.stack:hfe.has(s)&&(h="zero"),!h||!ffe(h)||n_(t)&&d.length===0)return null;if(((i=a==null?void 0:a.scale)===null||i===void 0?void 0:i.type)&&((r=a==null?void 0:a.scale)===null||r===void 0?void 0:r.type)!==wt.LINEAR){if(n.disallowNonLinearStack)return null;B(Nue(a.scale.type))}return le(t[hs(o)])?(a.stack!==void 0&&B(Tue(o)),null):(W(a)&&a.aggregate&&!pe(Mae,a.aggregate)&&B(Rue(a.aggregate)),{groupbyChannel:c?l:void 0,groupbyField:f,fieldChannel:o,impute:a.impute===null?!1:_o(s),stackBy:d,offset:h})}var dj=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function pfe(e){const t=dj(e,["point","line"]);return P(t).length>1?t:t.type}function mfe(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:ti(e[t],["point","line"])}));return e}function y_(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?Ue(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?Ue(t.point)?t.point:{}:void 0}function hj(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class yfe{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(ys(t)){const{mark:i,encoding:r}=t,s=Tr(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!y_(s,n[s.type],r);case"area":return!!y_(s,n[s.type],r)||!!hj(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,encoding:u}=t,l=dj(t,["params","projection","mark","encoding"]),c=Xp(u,r),f=Tr(a)?a:{type:a},d=y_(f,r[f.type],c),h=f.type==="area"&&hj(f,r[f.type]),g=[Object.assign(Object.assign({},s?{params:s}:{}),{mark:pfe(Object.assign(Object.assign({},f.type==="area"&&f.opacity===void 0&&f.fillOpacity===void 0?{opacity:.7}:{}),f)),encoding:ti(c,["shape"])})],p=fj(f,c);let m=c;if(p){const{fieldChannel:y,offset:v}=p;m=Object.assign(Object.assign({},c),{[y]:Object.assign(Object.assign({},c[y]),v?{stack:v}:{})})}return h&&g.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},dl(f,["clip","interpolate","tension","tooltip"])),h),encoding:m})),d&&g.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},dl(f,["clip","tooltip"])),d),encoding:m})),i(Object.assign(Object.assign({},l),{layer:g}),Object.assign(Object.assign({},n),{config:mfe(r)}))}}var vfe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function bfe(e,t){return t?cd(e)?yj(e,t):gj(e,t):e}function v_(e,t){return t?yj(e,t):e}function b_(e,t,n){const i=t[e];if(ece(i)){if(i.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[i.repeat]});B(Qae(i.repeat));return}return t}function gj(e,t){if(e=b_("field",e,t),e!==void 0){if(e===null)return null;if(XE(e)&&Nr(e.sort)){const n=b_("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function pj(e,t){if(W(e))return gj(e,t);{const n=b_("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function mj(e,t){if(le(e)){const n=pj(e,t);if(n)return n;if(Bp(e))return{condition:e.condition}}else{if(Up(e)){const n=pj(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):vfe(e,["condition"])}return e}}function yj(e,t){const n={};for(const i in e)if(cl(e,i)){const r=e[i];if(V(r))n[i]=r.map(s=>mj(s,t)).filter(s=>s);else{const s=mj(r,t);s!==void 0&&(n[i]=s)}}return n}class xfe{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(ys(t)){const{encoding:n,mark:i}=t;if(i==="line"||Tr(i)&&i.type==="line")for(const r of vae){const s=Ma(r),o=n[s];if(n[r]&&(W(o)&&!wn(o.bin)||Ao(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return B(mue(!!r.x2,!!r.y2)),i(Object.assign(Object.assign({},t),{mark:Ue(s)?Object.assign(Object.assign({},s),{type:"rule"}):"rule"}),n)}}var Oo=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class wfe extends m_{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[_ce,Sce,Tce,new yfe,new xfe]}map(t,n){if(ys(t)){const i=Ba(t.encoding,as),r=Ba(t.encoding,us),s=Ba(t.encoding,xp);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=v_(t.encoding,n.repeater),o=Object.assign(Object.assign({},t),s?{encoding:s}:{});if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(o,n.config))return u.run(o,n,a);return o}mapRepeat(t,n){return ufe(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r}=t,s=Oo(t,["repeat","spec"]),{row:o,column:a,layer:u}=i,{repeater:l={},repeaterPrefix:c=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:u},spec:r}}),n):Object.assign(Object.assign({},s),{layer:u.map(f=>{const d=Object.assign(Object.assign({},l),{layer:f}),h=`${(r.name||"")+c}child__layer_${Xe(f)}`,g=this.mapLayerOrUnit(r,Object.assign(Object.assign({},n),{repeater:d,repeaterPrefix:h}));return g.name=h,g})})}mapNonLayerRepeat(t,n){var i;const{repeat:r,spec:s,data:o}=t,a=Oo(t,["repeat","spec","data"]);!V(r)&&t.columns&&(t=ti(t,["columns"]),B(T6("repeat")));const u=[],{repeater:l={},repeaterPrefix:c=""}=n,f=!V(r)&&r.row||[l?l.row:null],d=!V(r)&&r.column||[l?l.column:null],h=V(r)&&r||[l?l.repeat:null];for(const p of h)for(const m of f)for(const y of d){const v={repeat:p,row:m,column:y,layer:l.layer},b=(s.name||"")+c+"child__"+(V(r)?`${Xe(p)}`:(r.row?`row_${Xe(m)}`:"")+(r.column?`column_${Xe(y)}`:"")),x=this.map(s,Object.assign(Object.assign({},n),{repeater:v,repeaterPrefix:b}));x.name=b,u.push(ti(x,["data"]))}const g=V(r)?t.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:(i=s.data)!==null&&i!==void 0?i:o,align:"all"},a),{columns:g,concat:u})}mapFacet(t,n){const{facet:i}=t;return cd(i)&&t.columns&&(t=ti(t,["columns"]),B(T6("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,u=bj({parentProjection:o,projection:r}),l=vj({parentEncoding:s,encoding:v_(i,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),u?{projection:u}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const i=t.encoding,{row:r,column:s,facet:o}=i,a=Oo(i,["row","column","facet"]),{mark:u,width:l,projection:c,height:f,view:d,params:h,encoding:g}=t,p=Oo(t,["mark","width","projection","height","view","params","encoding"]),{facetMapping:m,layout:y}=this.getFacetMappingAndLayout({row:r,column:s,facet:o},n),v=v_(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),y),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),d?{view:d}:{}),c?{projection:c}:{}),{mark:u,encoding:v}),h?{params:h}:{})}),n)}getFacetMappingAndLayout(t,n){var i;const{row:r,column:s,facet:o}=t;if(r||s){o&&B(gue([...r?[as]:[],...s?[us]:[]]));const a={},u={};for(const l of[as,us]){const c=t[l];if(c){const f=Oo(c,["align","center","spacing","columns"]);a[l]=f;for(const d of["align","center","spacing"])c[d]!==void 0&&((i=u[d])!==null&&i!==void 0||(u[d]={}),u[d][l]=c[d])}}return{facetMapping:a,layout:u}}else{const{align:a,center:u,spacing:l,columns:c}=o,f=Oo(o,["align","center","spacing","columns"]);return{facetMapping:bfe(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),u?{center:u}:{}),l?{spacing:l}:{}),c?{columns:c}:{})}}}mapLayer(t,n){var{parentEncoding:i,parentProjection:r}=n,s=Oo(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,u=Oo(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:vj({parentEncoding:i,encoding:o,layer:!0}),parentProjection:bj({parentProjection:r,projection:a})});return super.mapLayer(u,l)}}function vj({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...P(e),...P(t)]);for(const s of r){const o=t[s],a=e[s];if(le(o)){const u=Object.assign(Object.assign({},a),o);i[s]=u}else Up(o)?i[s]=Object.assign(Object.assign({},o),{condition:Object.assign(Object.assign({},a),o.condition)}):o||o===null?i[s]=o:(n||Xi(a)||te(a)||le(a)||V(a))&&(i[s]=a)}}else i=t;return!i||Pe(i)?void 0:i}function bj(e){const{parentProjection:t,projection:n}=e;return t&&n&&B(rue({parentProjection:t,projection:n})),n!=null?n:t}function x_(e){return"filter"in e}function Efe(e){return(e==null?void 0:e.stop)!==void 0}function xj(e){return"lookup"in e}function _fe(e){return"data"in e}function Afe(e){return"param"in e}function Ofe(e){return"pivot"in e}function Sfe(e){return"density"in e}function Cfe(e){return"quantile"in e}function $fe(e){return"regression"in e}function Ffe(e){return"loess"in e}function kfe(e){return"sample"in e}function Dfe(e){return"window"in e}function Mfe(e){return"joinaggregate"in e}function Tfe(e){return"flatten"in e}function Nfe(e){return"calculate"in e}function wj(e){return"bin"in e}function Rfe(e){return"impute"in e}function jfe(e){return"timeUnit"in e}function Lfe(e){return"aggregate"in e}function Pfe(e){return"stack"in e}function Ife(e){return"fold"in e}function Bfe(e){return e.map(t=>x_(t)?{filter:fl(t.filter,ule)}:t)}var So=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class zfe extends m_{map(t,n){var i,r;return(i=n.emptySelections)!==null&&i!==void 0||(n.emptySelections={}),(r=n.selectionPredicates)!==null&&r!==void 0||(n.selectionPredicates={}),t=Ej(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=Ej(t,n),t.encoding){const i={};for(const[r,s]of fo(t.encoding))i[r]=_j(s,n);t=Object.assign(Object.assign({},t),{encoding:i})}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const i=t,{selection:r}=i,s=So(i,["selection"]);return r?Object.assign(Object.assign({},s),{params:fo(r).map(([o,a])=>{var u;const l=a,{init:c,bind:f,empty:d}=l,h=So(l,["init","bind","empty"]);h.type==="single"?(h.type="point",h.toggle=!1):h.type==="multi"&&(h.type="point"),n.emptySelections[o]=d!=="none";for(const g of Qt((u=n.selectionPredicates[o])!==null&&u!==void 0?u:{}))g.empty=d!=="none";return{name:o,value:c,select:h,bind:f}})}):t}}function Ej(e,t){const{transform:n}=e,i=So(e,["transform"]);if(n){const r=n.map(s=>{if(x_(s))return{filter:w_(s,t)};if(wj(s)&&Ta(s.bin))return Object.assign(Object.assign({},s),{bin:Aj(s.bin)});if(xj(s)){const o=s.from,{selection:a}=o,u=So(o,["selection"]);return a?Object.assign(Object.assign({},s),{from:Object.assign({param:a},u)}):s}return s});return Object.assign(Object.assign({},i),{transform:r})}return e}function _j(e,t){var n,i;const r=fe(e);if(W(r)&&Ta(r.bin)&&(r.bin=Aj(r.bin)),Ia(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const s=r.scale.domain,{selection:o}=s,a=So(s,["selection"]);r.scale.domain=Object.assign(Object.assign({},a),o?{param:o}:{})}if(Bp(r))if(K(r.condition))r.condition=r.condition.map(s=>{const{selection:o,param:a,test:u}=s,l=So(s,["selection","param","test"]);return a?s:Object.assign(Object.assign({},l),{test:w_(s,t)})});else{const s=_j(r.condition,t),{selection:o,param:a,test:u}=s,l=So(s,["selection","param","test"]);r.condition=a?r.condition:Object.assign(Object.assign({},l),{test:w_(r.condition,t)})}return r}function Aj(e){const t=e.extent;if(t==null?void 0:t.selection){const{selection:n}=t,i=So(t,["selection"]);return Object.assign(Object.assign({},e),{extent:Object.assign(Object.assign({},i),{param:n})})}return e}function w_(e,t){const n=i=>fl(i,r=>{var s,o,a;const u=(s=t.emptySelections[r])!==null&&s!==void 0?s:!0,l={param:r,empty:u};return(o=(a=t.selectionPredicates)[r])!==null&&o!==void 0||(a[r]=[]),t.selectionPredicates[r].push(l),l});return e.selection?n(e.selection):fl(e.test||e.filter,i=>i.selection?n(i.selection):i)}class E_ extends m_{map(t,n){var i;const r=(i=n.selections)!==null&&i!==void 0?i:[];if(t.params&&!ys(t)){const s=[];for(const o of t.params)d_(o)?r.push(o):s.push(o);t.params=s}return n.selections=r,super.map(t,Oj(t,n))}mapUnit(t,n){var i;const r=n.selections;if(!r||!r.length)return t;const s=((i=n.path)!==null&&i!==void 0?i:[]).concat(t.name),o=[];for(const a of r)if(!a.views||!a.views.length)o.push(a);else for(const u of a.views)(_e(u)&&(u===t.name||s.indexOf(u)>=0)||K(u)&&u.map(l=>s.indexOf(l)).every((l,c,f)=>l!==-1&&(c===0||l>f[c-1])))&&o.push(a);return o.length&&(t.params=o),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=E_.prototype[e];E_.prototype[e]=function(n,i){return t.call(this,n,Oj(n,i))}}function Oj(e,t){var n;return e.name?Object.assign(Object.assign({},t),{path:((n=t.path)!==null&&n!==void 0?n:[]).concat(e.name)}):t}function Sj(e,t){t===void 0&&(t=lj(e.config));const n=Gfe(e,t),{width:i,height:r}=e,s=Hfe(n,{width:i,height:r,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const Ufe=new wfe,qfe=new zfe,Wfe=new E_;function Gfe(e,t={}){const n={config:t};return Wfe.map(Ufe.map(qfe.map(e,n),n),n)}function Cj(e){return ce(e)?{type:e}:e!=null?e:{}}function Hfe(e,t,n){let{width:i,height:r}=t;const s=ys(e)||tm(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(B($6("width")),i=void 0),r=="container"&&(B($6("height")),r=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?Cj(n.autosize):{}),Cj(e.autosize));if(a.type==="fit"&&!s&&(B(Uae),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&B(F6("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&B(F6("height")),!Er(a,{type:"pad"}))return a}function Yfe(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Vfe(e){return e?`fit-${Op(e)}`:"fit"}const Xfe=["background","padding"];function $j(e,t){const n={};for(const i of Xfe)e&&e[i]!==void 0&&(n[i]=ni(e[i]));return t&&(n.params=e.params),n}class bs{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new bs(fe(this.explicit),fe(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return dt(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of P(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function xs(e){return{explicit:!0,value:e}}function ri(e){return{explicit:!1,value:e}}function Fj(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:nm(t,n,i,r)}}function nm(e,t,n,i){return e.explicit&&t.explicit&&B(Sue(n,i,e.value,t.value)),e}function Co(e,t,n,i,r=nm){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Er(e.value,t.value)?e:r(e,t,n,i)}class Kfe extends bs{constructor(t={},n={},i=!1){super(t,n);this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function Al(e){return"url"in e}function pd(e){return"values"in e}function kj(e){return"name"in e&&!Al(e)&&!pd(e)&&!$o(e)}function $o(e){return e&&(Dj(e)||Mj(e)||__(e))}function Dj(e){return"sequence"in e}function Mj(e){return"sphere"in e}function __(e){return"graticule"in e}var Ge;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(Ge||(Ge={}));const Jfe="view",im="[",rm="]",Tj="{",Nj="}",Qfe=":",Rj=",",Zfe="@",ede=">",tde=/[[\]{}]/,nde={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let jj,Lj;function Ol(e,t,n){return jj=t||Jfe,Lj=n||nde,Pj(e.trim()).map(A_)}function ide(e){return Lj[e]}function md(e,t,n,i,r){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;r&&r.indexOf(a)>=0?--o:i&&i.indexOf(a)>=0&&++o}return t}function Pj(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=md(e,r,Rj,im+Tj,rm+Nj),t.push(e.substring(i,r).trim()),i=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function A_(e){return e[0]==="["?rde(e):sde(e)}function rde(e){const t=e.length;let n=1,i;if(n=md(e,n,rm,im,rm),n===t)throw"Empty between selector: "+e;if(i=Pj(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==ede)throw"Expected '>' after between selector: "+e;i=i.map(A_);const r=A_(e.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}function sde(e){const t={source:jj},n=[];let i=[0,0],r=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===Nj){if(a=e.lastIndexOf(Tj),a>=0){try{i=ode(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===Zfe&&(r=++a),u=md(e,a,Qfe),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=md(e,a,im),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=md(e,a,rm),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==im)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||tde.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],r?t.markname=n[0].slice(1):ide(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function ode(e){const t=e.split(Rj);if(!e.length||t.length>2)throw e;return t.map(n=>{const i=+n;if(i!==i)throw e;return i})}var ade=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Sl(e,t=!0,n=Xoe){if(V(e)){const i=e.map(r=>Sl(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Ra(e))return n(t?od(e):Jue(e));return t?n(qe(e)):e}function ude(e,t){var n;for(const i of Qt((n=e.component.selection)!==null&&n!==void 0?n:{})){const r=i.name;let s=`${r}${Do}, ${i.resolve==="global"?"true":`{unit: ${Fl(e)}}`}`;for(const o of lm)!o.defined(i)||(o.signals&&(t=o.signals(e,i,t)),o.modifyExpr&&(s=o.modifyExpr(e,i,s)));t.push({name:r+zde,on:[{events:{signal:i.name+Do},update:`modify(${Ae(i.name+za)}, ${s})`}]})}return O_(t)}function lde(e,t){if(e.component.selection&&P(e.component.selection).length){const n=Ae(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Ol("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return O_(t)}function cde(e,t){var n;let i=!1;for(const r of Qt((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=r.name,o=Ae(s+za);if(t.filter(u=>u.name===s).length===0){const u=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:`${a8}(${o}, ${Ae(u)}${l}`})}i=!0;for(const u of lm)u.defined(r)&&u.topLevelSignals&&(t=u.topLevelSignals(e,r,t))}return i&&t.filter(s=>s.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),O_(t)}function fde(e,t){var n;const i=[...t];for(const r of Qt((n=e.component.selection)!==null&&n!==void 0?n:{})){const s={name:r.name+za};if(r.init){const a=r.project.items.map(u=>ade(u,["signals"]));s.values=r.init.map(u=>({unit:Fl(e,{escape:!1}),fields:a,values:Sl(u,!1)}))}i.filter(a=>a.name===r.name+za).length||i.push(s)}return i}function Ij(e,t){var n;for(const i of Qt((n=e.component.selection)!==null&&n!==void 0?n:{}))for(const r of lm)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function dde(e,t){for(const n of e.children)ht(n)&&(t=Ij(n,t));return t}function hde(e,t,n,i){const r=O8(e,t.param,t);return{signal:ii(n.get("type"))&&V(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function O_(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class Ie{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){B(tue);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const i of this._children)i.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class An extends Ie{constructor(t,n,i,r){super(t,n);this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${i6()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Bj=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Pr extends Ie{constructor(t,n){super(t);this.formula=n}clone(){return new Pr(null,fe(this.formula))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){const u=q(s,{forAs:!0});r[xe({as:u,field:o,timeUnit:a})]={as:u,field:o,timeUnit:a}}return r},{});return Pe(i)?null:new Pr(t,i)}static makeFromTransform(t,n){const i=Object.assign({},n),{timeUnit:r}=i,s=Bj(i,["timeUnit"]),o=En(r),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Pr(t,{[xe(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of fo(this.formula))t.has(r.as)||(n[i]=r);this.formula=n}producedFields(){return new Set(Qt(this.formula).map(t=>t.as))}dependentFields(){return new Set(Qt(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${xe(this.formula)}`}assemble(){const t=[];for(const n of Qt(this.formula)){const{field:i,as:r,timeUnit:s}=n,o=En(s),{unit:a,utc:u}=o,l=Bj(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:yi(i),type:"timeunit"},a?{units:CE(a)}:{}),u?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return t}}var gde=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const yd="_tuple_fields";class pde{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const mde={defined:()=>!0,parse:(e,t,n)=>{var i;const r=t.name,s=(i=t.project)!==null&&i!==void 0?i:t.project=new pde,o={},a={},u=new Set,l=(p,m)=>{const y=m==="visual"?p.channel:p.field;let v=Xe(`${r}_${y}`);for(let b=1;u.has(v);b++)v=Xe(`${r}_${y}_${b}`);return u.add(v),{[m]:v}},c=t.type,f=e.config.selection[c],d=n.value!==void 0?rt(n.value):null;let{fields:h,encodings:g}=Ue(n.select)?n.select:{};if(!h&&!g&&d){for(const p of d)if(!!Ue(p))for(const m of P(p))yae(m)?(g||(g=[])).push(m):c==="interval"?(B(Jae),g=f.encodings):(h||(h=[])).push(m)}!h&&!g&&(g=f.encodings,"fields"in f&&(h=f.fields));for(const p of g!=null?g:[]){const m=e.fieldDef(p);if(m){let y=m.field;if(m.aggregate){B(qae(p,m.aggregate));continue}else if(!y){B(D6(p));continue}if(m.timeUnit){y=e.vgField(p);const v={timeUnit:m.timeUnit,as:y,field:m.field};a[xe(v)]=v}if(!o[y]){let v="E";if(c==="interval"){const x=e.getScaleComponent(p).get("type");ii(x)&&(v="R")}else m.bin&&(v="R-RE");const b={field:y,channel:p,type:v};b.signals=Object.assign(Object.assign({},l(b,"data")),l(b,"visual")),s.items.push(o[y]=b),s.hasField[y]=s.hasChannel[p]=o[y]}}else B(D6(p))}for(const p of h!=null?h:[]){if(s.hasField[p])continue;const m={type:"E",field:p};m.signals=Object.assign({},l(m,"data")),s.items.push(m),s.hasField[p]=m}d&&(t.init=d.map(p=>s.items.map(m=>Ue(p)?p[m.channel]!==void 0?p[m.channel]:p[m.field]:p))),Pe(a)||(s.timeUnit=new Pr(null,a))},signals:(e,t,n)=>{const i=t.name+yd;return n.filter(s=>s.name===i).length>0?n:n.concat({name:i,value:t.project.items.map(s=>{const o=gde(s,["signals","hasLegend"]);return o.field=yi(o.field),o})})}},Fo={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!bo(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!ii(o)){B(Hae);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||C_(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(a8)>=0)r.update=`{${i.map(o=>`${Ae(yi(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${Ae(yi(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!C_(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function S_(e,t){return`domain(${Ae(e.scaleName(t))})`}function C_(e){var t;return e.parent&&jl(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:C_(e.parent.parent))}var yde=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};const Cl="_brush",$_="_scale_trigger",vde={defined:e=>e.type==="interval",signals:(e,t,n)=>{const i=t.name,r=i+yd,s=Fo.defined(t),o=t.init?t.init[0]:null,a=[],u=[];if(t.translate&&!s){const c=`!event.item || event.item.mark.name !== ${Ae(i+Cl)}`;zj(t,(f,d)=>{var h,g;const p=rt((h=(g=d.between[0]).filter)!==null&&h!==void 0?h:g.filter=[]);return p.includes(c)||p.push(c),f})}t.project.items.forEach((c,f)=>{const d=c.channel;if(d!==Qe&&d!==xt){B("Interval selections only support x and y encoding channels.");return}const h=o?o[f]:null,g=bde(e,t,c,h),p=c.signals.data,m=c.signals.visual,y=Ae(e.scaleName(d)),v=e.getScaleComponent(d).get("type"),b=ii(v)?"+":"";n.push(...g),a.push(p),u.push({scaleName:e.scaleName(d),expr:`(!isArray(${p}) || (${b}invert(${y}, ${m})[0] === ${b}${p}[0] && ${b}invert(${y}, ${m})[1] === ${b}${p}[1]))`})}),!s&&u.length&&n.push({name:i+$_,value:{},on:[{events:u.map(c=>({scale:c.scaleName})),update:`${u.map(c=>c.expr).join(" && ")} ? ${i+$_} : {}`}]});const l=`unit: ${Fl(e)}, fields: ${r}, values`;return n.concat(Object.assign(Object.assign({name:i+Do},o?{init:`{${l}: ${Sl(o)}}`}:{}),a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${l}: [${a}]} : null`}]}:{}))},marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r&&r.signals.visual,a=s&&s.signals.visual,u=`data(${Ae(t.name+za)})`;if(Fo.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of P(l))l[m]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${Fl(e)}`},l[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,g=yde(c,["fill","fillOpacity","cursor"]),p=P(g).reduce((m,y)=>(m[y]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(v=>v).join(" && "),value:g[y]},{value:null}],m),{});return[{name:`${i+Cl}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:l}},...n,{name:i+Cl,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),p)}}]}};function bde(e,t,n,i){const r=n.channel,s=n.signals.visual,o=n.signals.data,a=Fo.defined(t),u=Ae(e.scaleName(r)),l=e.getScaleComponent(r),c=l?l.get("type"):void 0,f=p=>`scale(${u}, ${p})`,d=e.getSizeSignalRef(r===Qe?"width":"height").signal,h=`${r}(unit)`,g=zj(t,(p,m)=>[...p,{events:m.between[0],update:`[${h}, ${h}]`},{events:m,update:`[${s}[0], clamp(${h}, 0, ${d})]`}]);return g.push({events:{signal:t.name+$_},update:ii(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},i?{init:Sl(i,!0,f)}:{value:[]}),{on:g}),Object.assign(Object.assign({name:o},i?{init:Sl(i)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}function zj(e,t){return e.events.reduce((n,i)=>i.between?t(n,i):(B(`${i} is not an ordered event stream for interval selections.`),n),[])}const xde={defined:e=>e.type==="point",signals:(e,t,n)=>{var i;const r=t.name,s=r+yd,o=t.project,a="(item().isVoronoi ? datum.datum : datum)",u=o.items.map(h=>{const g=e.fieldDef(h.channel);return(g==null?void 0:g.bin)?`[${a}[${Ae(e.vgField(h.channel,{}))}], ${a}[${Ae(e.vgField(h.channel,{binSuffix:"end"}))}]]`:`${a}[${Ae(h.field)}]`}).join(", "),l=`unit: ${Fl(e)}, fields: ${s}, values`,c=t.events,f=Qt((i=e.component.selection)!==null&&i!==void 0?i:{}).reduce((h,g)=>g.type==="interval"?h.concat(g.name+Cl):h,[]).map(h=>`indexof(item().mark.name, '${h}') < 0`).join(" && "),d="datum && item().mark.marktype !== 'group'"+(f?` && ${f}`:"");return n.concat([{name:r+Do,on:c?[{events:c,update:`${d} ? {${l}: [${u}]} : null`,force:!0}]:[]}])}};function $l(e,t,n,i){const r=Bp(t)&&t.condition,s=i(t);if(r){const a=rt(r).map(u=>{const l=i(u);if(Zle(u)){const{param:c,empty:f}=u,d=A8(e,{param:c,empty:f});return Object.assign({test:d},l)}else{const c=mm(e,u.test);return Object.assign({test:c},l)}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function F_(e,t="text"){const n=e.encoding[t];return $l(e,n,t,i=>sm(i,e.config))}function sm(e,t,n="datum"){if(e){if(Xi(e))return Ke(e.value);if(le(e)){const{format:i,formatType:r}=Wp(e);return GE({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function Uj(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(V(o))return{tooltip:Wj({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return $l(e,o,"tooltip",u=>{const l=sm(u,r,a);if(l)return l;if(u===null)return;let c=Ne("tooltip",i,r);if(c===!0&&(c={content:"encoding"}),ce(c))return{value:c};if(Ue(c))return te(c)?c:c.content==="encoding"?Wj(n,s,r,t):{signal:a}})}}function qj(e,t,n,{reactiveGeom:i}={}){const r={},s=i?"datum.datum":"datum",o=[];function a(l,c){const f=Ma(c),d=wi(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),h=d.title||e_(d,n),g=rt(h).join(", ");let p;if(Dr(c)){const m=c==="x"?"x2":"y2",y=jr(e[m]);if(wn(d.bin)&&y){const v=q(d,{expr:s}),b=q(y,{expr:s}),{format:x,formatType:E}=Wp(d);p=Lp(v,b,x,E,n),r[m]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:v,formatType:b}=Wp(d);p=GE({fieldOrDatumDef:d,format:v,formatType:b,expr:s,config:n,normalizeStack:!0}).signal}}p!=null||(p=sm(d,n,s).signal),o.push({channel:c,key:g,value:p})}i_(e,(l,c)=>{W(l)?a(l,c):zp(l)&&a(l.condition,c)});const u={};for(const{channel:l,key:c,value:f}of o)!r[l]&&!u[c]&&(u[c]=f);return u}function Wj(e,t,n,{reactiveGeom:i}={}){const r=qj(e,t,n,{reactiveGeom:i}),s=fo(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function wde(e){const{markDef:t,config:n}=e,i=Ne("aria",t,n);return i===!1?{}:Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),Ede(e)),_de(e))}function Ede(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Ne("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Bae?{}:{ariaRoleDescription:{value:t}}}function _de(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return $l(e,s,"description",u=>sm(u,e.config));const o=Ne("description",n,i);if(o!=null)return{description:Ke(o)};if(i.aria===!1)return{};const a=qj(t,r,i);if(!Pe(a))return{description:{signal:fo(a).map(([u,l],c)=>`"${c>0?"; ":""}${u}: " + (${l})`).join(" + ")}}}function kt(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u!=null||(u=Ne(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),u!==void 0&&(a=Ke(u)));const l=r[e];return $l(t,l,o!=null?o:e,c=>cR({channel:e,channelDef:c,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Gj(e,t={filled:void 0}){var n,i,r,s;const{markDef:o,encoding:a,config:u}=e,{type:l}=o,c=(n=t.filled)!==null&&n!==void 0?n:Ne("filled",o,u),f=pe(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,d=(r=(i=Ne(c===!0?"color":void 0,o,u,{vgChannel:"fill"}))!==null&&i!==void 0?i:u.mark[c===!0&&"color"])!==null&&r!==void 0?r:f,h=(s=Ne(c===!1?"color":void 0,o,u,{vgChannel:"stroke"}))!==null&&s!==void 0?s:u.mark[c===!1&&"color"],g=c?"fill":"stroke",p=Object.assign(Object.assign({},d?{fill:Ke(d)}:{}),h?{stroke:Ke(h)}:{});return o.color&&(c?o.fill:o.stroke)&&B(L6("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},p),kt("color",e,{vgChannel:g,defaultValue:c?d:h})),kt("fill",e,{defaultValue:a.fill?d:void 0})),kt("stroke",e,{defaultValue:a.stroke?h:void 0}))}function Ade(e){const{encoding:t,mark:n}=e,i=t.order;return!_o(n)&&Xi(i)?$l(e,i,"zindex",r=>Ke(r.value)):{}}function vd(e,t){const n=bae(e),i=t[n];if(i)return i}function en(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,u=r[e],l=r[hs(e)],c=t.scaleName(e),f=t.getScaleComponent(e),d=vd(e,s),h=k_({model:t,defaultPos:n,channel:e,scaleName:c,scale:f}),g=!u&&Dr(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:Ode({channel:e,channelDef:u,channel2Def:l,markDef:s,config:o,scaleName:c,scale:f,stack:a,offset:d,defaultRef:h});return g?{[i||e]:g}:void 0}function Ode(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(le(n)&&r&&t===r.fieldChannel){if(W(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return jp({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return La(n,i,{suffix:"end"},{offset:s})}return qE(e)}function k_({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=Ma(n),u=yo(n),l=Ne(n,s,o,{vgChannel:u});if(l!==void 0)return ld(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const c=r.get("type");if(!pe([wt.LOG,wt.TIME,wt.UTC],c)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[xi(n)];return Object.assign(Object.assign({},c),{mult:.5})}}}}const Sde={left:"x",center:"xc",right:"x2"},Cde={top:"y",middle:"yc",bottom:"y2"};function Hj(e,t,n,i="middle"){if(e==="radius"||e==="theta")return yo(e);const r=e==="x"?"align":"baseline",s=Ne(r,t,n);let o;return te(s)?(B(pue(r)),o=void 0):o=s,e==="x"?Sde[o||(i==="top"?"left":"center")]:Cde[o||i]}function om(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?Yj(e,t,{defaultPos:n,defaultPos2:i}):en(e,t,{defaultPos:n})}function Yj(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=hs(e),a=xi(e),u=$de(t,i,o),l=u[a]?Hj(e,r,s):yo(e);return Object.assign(Object.assign({},en(e,t,{defaultPos:n,vgChannel:l})),u)}function $de(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,u=Ma(n),l=xi(n),c=yo(n),f=i[u],d=e.scaleName(u),h=e.getScaleComponent(u),g=n in i||n in s?vd(n,e.markDef):vd(u,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=xi(n),y=e.markDef[m];return y!=null?{[m]:{value:y}}:{[c]:{field:e.getName(n)}}}const p=Fde({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:h,stack:o,offset:g,defaultRef:void 0});return p!==void 0?{[c]:p}:am(n,s)||am(n,{[n]:$p(n,s,a.style),[l]:$p(l,s,a.style)})||am(n,a[r])||am(n,a.mark)||{[c]:k_({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}function Fde({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l}){return le(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?La(t,s,{suffix:"start"},{offset:u}):qE({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:u,defaultRef:l})}function am(e,t){const n=xi(e),i=yo(e);if(t[i]!==void 0)return{[i]:ld(e,t[i])};if(t[e]!==void 0)return{[i]:ld(e,t[e])};if(t[n]){const r=t[n];if(bl(r))B(lue(n));else return{[n]:ld(e,r)}}}function ko(e,t,n){var i,r,s,o;const{config:a,encoding:u,markDef:l}=e,c=hs(t),f=xi(t),d=u[t],h=u[c],g=e.getScaleComponent(t),p=g?g.get("type"):void 0,m=e.scaleName(t),y=l.orient,v=(r=(i=u[f])!==null&&i!==void 0?i:u.size)!==null&&r!==void 0?r:Ne("size",l,a,{vgChannel:f}),b=n==="bar"&&(t==="x"?y==="vertical":y==="horizontal");if(W(d)&&(We(d.bin)||wn(d.bin)||d.timeUnit&&!h)&&!(v&&!bl(v))&&!Zt(p)){const x=_R({channel:t,fieldDef:d,markDef:l,config:a,scaleType:p}),E=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],_=(o=E==null?void 0:E.get("translate"))!==null&&o!==void 0?o:.5;return Mde({fieldDef:d,fieldDef2:h,channel:t,markDef:l,scaleName:m,bandSize:x,axisTranslate:_,spacing:Dr(t)?Ne("binSpacing",l,a):void 0,reverse:g.get("reverse"),config:a})}else return(le(d)&&Zt(p)||b)&&!h?Dde(d,t,e):Yj(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function kde(e,t,n,i,r){if(bl(r))if(n){const o=n.get("type");if(o==="band")return{scale:t,band:r.band};r.band!==1&&(B(bue(o)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(te(r))return r;if(r)return{value:r}}if(n){const o=n.get("range");if(Eo(o)&&ft(o.step))return{value:o.step-2}}return{value:em(i.view,e)-2}}function Dde(e,t,n){const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,u=n.scaleName(t),l=n.getScaleComponent(t),c=xi(t),f=hs(t),d=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let h;(r.size||i.size)&&(d?h=kt("size",n,{vgChannel:c,defaultRef:Ke(i.size)}):B(_ue(i.type)));const g=_R({channel:t,fieldDef:e,markDef:i,config:s,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:d});h=h||{[c]:kde(c,u,l,s,g)};const p=(l==null?void 0:l.get("type"))!=="band"||!("band"in h[c])?"middle":"top",m=Hj(t,i,s,p),y=m==="xc"||m==="yc",v=vd(t,i),b=qE({channel:t,channelDef:e,markDef:i,config:s,scaleName:u,scale:l,stack:o,offset:v,defaultRef:k_({model:n,defaultPos:"mid",channel:t,scaleName:u,scale:l}),bandPosition:y?.5:te(g)?{signal:`(1-${g})/2`}:bl(g)?(1-g.band)/2:0});if(c)return Object.assign({[m]:b},h);{const x=yo(f),E=h[c],_=v?Object.assign(Object.assign({},E),{offset:v}):E;return{[m]:b,[x]:V(b)?[b[0],Object.assign(Object.assign({},b[1]),{offset:_})]:Object.assign(Object.assign({},b),{offset:_})}}}function bd(e,t,n,i,r){if(a6(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(te(n)||te(r)||te(i)){const o=ms(n),a=ms(r),u=ms(i),l=u?`${u} + `:"",c=o?`(${o} ? -1 : 1) * `:"",f=a?`(${a} + ${s})`:s;return{signal:l+c+f}}else return r=r||0,i+(n?-r-s:+r+s)}function Mde({fieldDef:e,fieldDef2:t,channel:n,bandSize:i,scaleName:r,markDef:s,spacing:o=0,axisTranslate:a,reverse:u,config:l}){const c=hs(n),f=yo(n),d=yo(c),h=vd(n,s),g=te(i)?{signal:`(1-${i.signal})/2`}:bl(i)?(1-i.band)/2:.5;if(We(e.bin)||e.timeUnit)return{[d]:Vj({channel:n,fieldDef:e,scaleName:r,markDef:s,bandPosition:g,offset:bd(c,o,u,a,h),config:l}),[f]:Vj({channel:n,fieldDef:e,scaleName:r,markDef:s,bandPosition:te(g)?{signal:`1-${g.signal}`}:1-g,offset:bd(n,o,u,a,h),config:l})};if(wn(e.bin)){const p=La(e,r,{},{offset:bd(c,o,u,a,h)});if(W(t))return{[d]:p,[f]:La(t,r,{},{offset:bd(n,o,u,a,h)})};if(Ta(e.bin)&&e.bin.step)return{[d]:p,[f]:{signal:`scale("${r}", ${q(e,{expr:"datum"})} + ${e.bin.step})`,offset:bd(n,o,u,a,h)}}}B(U6(c))}function Vj({channel:e,fieldDef:t,scaleName:n,markDef:i,bandPosition:r,offset:s,config:o}){const a=jp({scaleName:n,fieldOrDatumDef:t,bandPosition:r,offset:s});return lR({fieldDef:t,channel:e,markDef:i,ref:a,config:o})}const Tde=new Set(["aria","width","height"]);function Ei(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Gj(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Nde(e.markDef,t)),Xj(e,"fill",n)),Xj(e,"stroke",i)),kt("opacity",e)),kt("fillOpacity",e)),kt("strokeOpacity",e)),kt("strokeWidth",e)),kt("strokeDash",e)),Ade(e)),Uj(e)),F_(e,"href")),wde(e))}function Xj(e,t,n){const{config:i,mark:r,markDef:s}=e;if(Ne("invalid",s,i)==="hide"&&n&&!_o(r)){const a=Rde(e,{invalid:!0,channels:Sp});if(a)return{[t]:[{test:a,value:null},...rt(n)]}}return n?{[t]:n}:{}}function Nde(e,t){return Iae.reduce((n,i)=>(!Tde.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=Ke(e[i])),n),{})}function Rde(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ii(u)&&(s[l]=!0)}return s},{}),r=P(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>WE(o,t)).join(` ${s} `)}}function D_(e){const{config:t,markDef:n}=e;if(Ne("invalid",n,t)){const r=jde(e,{channels:kr});if(r)return{defined:{signal:r}}}return{}}function jde(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&ii(u)&&(s[l]=!0)}return s},{}),r=P(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>WE(o,t)).join(` ${s} `)}}function Kj(e,t){if(t!==void 0)return{[e]:Ke(t)}}const M_="voronoi",Jj={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(M_)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(_o(s))return B(Wae(s)),n;const o={name:e.getName(M_),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},Uj(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((l,c)=>{var f;const d=(f=l.name)!==null&&f!==void 0?f:"";d===e.component.mark[0].name?a=c:d.indexOf(M_)>=0&&(u=!0)}),u||n.splice(a+1,0,o),n}},Qj={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!c_(e.bind),parse:(e,t,n)=>u8(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=Jj.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,l)=>{var c,f;const d=Xe(`${i}_${u.field}`);n.filter(g=>g.name===d).length||n.unshift(Object.assign(Object.assign({name:d},o?{init:Sl(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${Ae(u.field)}] : null`}]:[],bind:(f=(c=s[u.field])!==null&&c!==void 0?c:s[u.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+Do)[0],o=i+yd,a=r.items.map(l=>Xe(`${i}_${l.field}`)),u=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},um="_toggle",Zj={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+um,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Do,i=t.name+um;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${Fl(e)}}, `)+`${i} ? ${n} : null`}},Lde={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=ce(t.clear)?Ol(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(Qj.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===Xe(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Do);i(r,"null"),Zj.defined(t)&&(r=n.findIndex(s=>s.name===t.name+um),i(r,"false"))}return n}},e8={defined:e=>{const t=e.resolve==="global"&&e.bind&&c_(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==hd;return t&&!n&&B(Yae),t&&n},parse:(e,t,n)=>{var i;const r=fe(n);if(r.select=ce(r.select)?{type:r.select,toggle:t.toggle}:Object.assign(Object.assign({},r.select),{toggle:t.toggle}),u8(t,r),ue(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const u of t.events)u.filter=rt((i=u.filter)!==null&&i!==void 0?i:[]),u.filter.includes(a)||u.filter.push(a)}const s=f_(t.bind)?t.bind.legend:"click",o=ce(s)?Ol(s,"view"):rt(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=f_(t.bind)&&t.bind.legend,s=o=>a=>{const u=fe(a);return u.markname=o,u};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${Xe(o.field)}_legend`,u=`${i}_${a}`;if(n.filter(c=>c.name===u).length===0){const c=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Do),o=i+yd,a=r.items.filter(d=>d.hasLegend).map(d=>Xe(`${i}_${Xe(d.field)}_legend`)),l=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const c=n.find(d=>d.name===i+um),f=f_(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function Pde(e,t,n){var i,r,s,o;const a=(i=e.fieldDef(t))===null||i===void 0?void 0:i.field;for(const u of Qt((r=e.component.selection)!==null&&r!==void 0?r:{})){const l=(s=u.project.hasField[a])!==null&&s!==void 0?s:u.project.hasChannel[t];if(l&&e8.defined(u)){const c=(o=n.get("selections"))!==null&&o!==void 0?o:[];c.push(u.name),n.set("selections",c,!1),l.hasLegend=!0}}}const t8="_translate_anchor",n8="_translate_delta",Ide={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Fo.defined(t),s=i+t8,{x:o,y:a}=t.project.hasChannel;let u=Ol(t.translate,"scope");return r||(u=u.map(l=>(l.between[0].markname=i+Cl,l))),n.push({name:s,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?S_(e,Qe):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?S_(e,xt):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+n8,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&i8(e,t,o,"width",n),a!==void 0&&i8(e,t,a,"height",n),n}};function i8(e,t,n,i,r){var s,o;const a=t.name,u=a+t8,l=a+n8,c=n.channel,f=Fo.defined(t),d=r.filter(w=>w.name===n.signals[f?"data":"visual"])[0],h=e.getSizeSignalRef(i).signal,g=e.getScaleComponent(c),p=g.get("type"),m=g.get("reverse"),y=f?c===Qe?m?"":"-":m?"-":"":"",v=`${u}.extent_${c}`,b=`${y}${l}.${c} / ${f?`${h}`:`span(${v})`}`,x=f?p==="log"?"panLog":p==="symlog"?"panSymlog":p==="pow"?"panPow":"panLinear":"panLinear",E=f?p==="pow"?`, ${(s=g.get("exponent"))!==null&&s!==void 0?s:1}`:p==="symlog"?`, ${(o=g.get("constant"))!==null&&o!==void 0?o:1}`:"":"",_=`${x}(${v}, ${b}${E})`;d.on.push({events:{signal:l},update:f?_:`clampRange(${_}, 0, ${h})`})}const r8="_zoom_anchor",s8="_zoom_delta",Bde={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Fo.defined(t),s=i+s8,{x:o,y:a}=t.project.hasChannel,u=Ae(e.scaleName(Qe)),l=Ae(e.scaleName(xt));let c=Ol(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+Cl,f))),n.push({name:i+r8,on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&o8(e,t,o,"width",n),a!==void 0&&o8(e,t,a,"height",n),n}};function o8(e,t,n,i,r){var s,o;const a=t.name,u=n.channel,l=Fo.defined(t),c=r.filter(x=>x.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(u),h=d.get("type"),g=l?S_(e,u):c.name,p=a+s8,m=`${a}${r8}.${u}`,y=l?h==="log"?"zoomLog":h==="symlog"?"zoomSymlog":h==="pow"?"zoomPow":"zoomLinear":"zoomLinear",v=l?h==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:h==="symlog"?`, ${(o=d.get("constant"))!==null&&o!==void 0?o:1}`:"":"",b=`${y}(${g}, ${m}, ${p}${v})`;c.on.push({events:{signal:p},update:l?b:`clampRange(${b}, 0, ${f})`})}const za="_store",Do="_tuple",zde="_modify",a8="vlSelectionResolve",lm=[xde,vde,mde,Zj,Qj,Fo,e8,Lde,Ide,Bde,Jj];function Ude(e){let t=e.parent;for(;t&&!Zi(t);)t=t.parent;return t}function Fl(e,{escape:t}={escape:!0}){let n=t?Ae(e.name):e.name;const i=Ude(e);if(i){const{facet:r}=i;for(const s of bi)r[s]&&(n+=` + '__facet_${s}_' + (facet[${Ae(i.vgField(s))}])`)}return n}function T_(e){var t;return Qt((t=e.component.selection)!==null&&t!==void 0?t:{}).reduce((n,i)=>n||i.project.items.some(r=>r.field===hd),!1)}function u8(e,t){(_e(t.select)||!t.select.on)&&delete e.events,(_e(t.select)||!t.select.clear)&&delete e.clear,(_e(t.select)||!t.select.toggle)&&delete e.toggle}const qde="RawCode",Wde="Literal",Gde="Property",Hde="Identifier",Yde="ArrayExpression",Vde="BinaryExpression",Xde="CallExpression",Kde="ConditionalExpression",Jde="LogicalExpression",Qde="MemberExpression",Zde="ObjectExpression",ehe="UnaryExpression";function Ki(e){this.type=e}Ki.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=the(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function the(e){switch(e.type){case Yde:return e.elements;case Vde:case Jde:return[e.left,e.right];case Xde:return[e.callee].concat(e.arguments);case Kde:return[e.test,e.consequent,e.alternate];case Qde:return[e.object,e.property];case Zde:return e.properties;case Gde:return[e.key,e.value];case ehe:return[e.argument];case Hde:case Wde:case qde:default:return[]}}var Ir,X,T,tn,je,cm=1,xd=2,Ua=3,Mo=4,fm=5,qa=6,Un=7,wd=8,nhe=9;Ir={};Ir[cm]="Boolean";Ir[xd]="<end>";Ir[Ua]="Identifier";Ir[Mo]="Keyword";Ir[fm]="Null";Ir[qa]="Numeric";Ir[Un]="Punctuator";Ir[wd]="String";Ir[nhe]="RegularExpression";var ihe="ArrayExpression",rhe="BinaryExpression",she="CallExpression",ohe="ConditionalExpression",l8="Identifier",ahe="Literal",uhe="LogicalExpression",lhe="MemberExpression",che="ObjectExpression",fhe="Property",dhe="UnaryExpression",Dt="Unexpected token %0",hhe="Unexpected number",ghe="Unexpected string",phe="Unexpected identifier",mhe="Unexpected reserved word",yhe="Unexpected end of input",N_="Invalid regular expression",R_="Invalid regular expression: missing /",c8="Octal literals are not allowed in strict mode.",vhe="Duplicate data property in object literal not allowed in strict mode",It="ILLEGAL",Ed="Disabled.",bhe=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),xhe=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function dm(e,t){if(!e)throw new Error("ASSERT: "+t)}function ws(e){return e>=48&&e<=57}function j_(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function _d(e){return"01234567".indexOf(e)>=0}function whe(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Ad(e){return e===10||e===13||e===8232||e===8233}function Od(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&bhe.test(String.fromCharCode(e))}function hm(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&xhe.test(String.fromCharCode(e))}const Ehe={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function f8(){for(;T<tn;){const e=X.charCodeAt(T);if(whe(e)||Ad(e))++T;else break}}function L_(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)T<tn&&j_(X[T])?(i=X[T++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):ke({},Dt,It);return String.fromCharCode(r)}function _he(){var e,t,n,i;for(e=X[T],t=0,e==="}"&&ke({},Dt,It);T<tn&&(e=X[T++],!!j_(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&ke({},Dt,It),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function d8(){var e,t;for(e=X.charCodeAt(T++),t=String.fromCharCode(e),e===92&&(X.charCodeAt(T)!==117&&ke({},Dt,It),++T,e=L_("u"),(!e||e==="\\"||!Od(e.charCodeAt(0)))&&ke({},Dt,It),t=e);T<tn&&(e=X.charCodeAt(T),!!hm(e));)++T,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),X.charCodeAt(T)!==117&&ke({},Dt,It),++T,e=L_("u"),(!e||e==="\\"||!hm(e.charCodeAt(0)))&&ke({},Dt,It),t+=e);return t}function Ahe(){var e,t;for(e=T++;T<tn;){if(t=X.charCodeAt(T),t===92)return T=e,d8();if(hm(t))++T;else break}return X.slice(e,T)}function Ohe(){var e,t,n;return e=T,t=X.charCodeAt(T)===92?d8():Ahe(),t.length===1?n=Ua:Ehe.hasOwnProperty(t)?n=Mo:t==="null"?n=fm:t==="true"||t==="false"?n=cm:n=Ua,{type:n,value:t,start:e,end:T}}function P_(){var e=T,t=X.charCodeAt(T),n,i=X[T],r,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++T,{type:Un,value:String.fromCharCode(t),start:e,end:T};default:if(n=X.charCodeAt(T+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return T+=2,{type:Un,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:T};case 33:case 61:return T+=2,X.charCodeAt(T)===61&&++T,{type:Un,value:X.slice(e,T),start:e,end:T}}}if(o=X.substr(T,4),o===">>>=")return T+=4,{type:Un,value:o,start:e,end:T};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return T+=3,{type:Un,value:s,start:e,end:T};if(r=s.substr(0,2),i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>")return T+=2,{type:Un,value:r,start:e,end:T};if(r==="//"&&ke({},Dt,It),"<>=!+-*%&|^/".indexOf(i)>=0)return++T,{type:Un,value:i,start:e,end:T};ke({},Dt,It)}function She(e){let t="";for(;T<tn&&j_(X[T]);)t+=X[T++];return t.length===0&&ke({},Dt,It),Od(X.charCodeAt(T))&&ke({},Dt,It),{type:qa,value:parseInt("0x"+t,16),start:e,end:T}}function Che(e){let t="0"+X[T++];for(;T<tn&&_d(X[T]);)t+=X[T++];return(Od(X.charCodeAt(T))||ws(X.charCodeAt(T)))&&ke({},Dt,It),{type:qa,value:parseInt(t,8),octal:!0,start:e,end:T}}function h8(){var e,t,n;if(n=X[T],dm(ws(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=T,e="",n!=="."){if(e=X[T++],n=X[T],e==="0"){if(n==="x"||n==="X")return++T,She(t);if(_d(n))return Che(t);n&&ws(n.charCodeAt(0))&&ke({},Dt,It)}for(;ws(X.charCodeAt(T));)e+=X[T++];n=X[T]}if(n==="."){for(e+=X[T++];ws(X.charCodeAt(T));)e+=X[T++];n=X[T]}if(n==="e"||n==="E")if(e+=X[T++],n=X[T],(n==="+"||n==="-")&&(e+=X[T++]),ws(X.charCodeAt(T)))for(;ws(X.charCodeAt(T));)e+=X[T++];else ke({},Dt,It);return Od(X.charCodeAt(T))&&ke({},Dt,It),{type:qa,value:parseFloat(e),start:t,end:T}}function $he(){var e="",t,n,i,r,s=!1;for(t=X[T],dm(t==="'"||t==='"',"String literal must starts with a quote"),n=T,++T;T<tn;)if(i=X[T++],i===t){t="";break}else if(i==="\\")if(i=X[T++],!i||!Ad(i.charCodeAt(0)))switch(i){case"u":case"x":X[T]==="{"?(++T,e+=_he()):e+=L_(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:_d(i)?(r="01234567".indexOf(i),r!==0&&(s=!0),T<tn&&_d(X[T])&&(s=!0,r=r*8+"01234567".indexOf(X[T++]),"0123".indexOf(i)>=0&&T<tn&&_d(X[T])&&(r=r*8+"01234567".indexOf(X[T++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&X[T]===`
`&&++T;else{if(Ad(i.charCodeAt(0)))break;e+=i}return t!==""&&ke({},Dt,It),{type:wd,value:e,octal:s,start:n,end:T}}function Fhe(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";ke({},N_)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{ke({},N_)}try{return new RegExp(e,t)}catch{return null}}function khe(){var e,t,n,i,r;for(e=X[T],dm(e==="/","Regular expression literal must start with a slash"),t=X[T++],n=!1,i=!1;T<tn;)if(e=X[T++],t+=e,e==="\\")e=X[T++],Ad(e.charCodeAt(0))&&ke({},R_),t+=e;else if(Ad(e.charCodeAt(0)))ke({},R_);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||ke({},R_),r=t.substr(1,t.length-2),{value:r,literal:t}}function Dhe(){var e,t,n;for(t="",n="";T<tn&&(e=X[T],!!hm(e.charCodeAt(0)));)++T,e==="\\"&&T<tn?ke({},Dt,It):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&ke({},N_,n),{value:n,literal:t}}function Mhe(){var e,t,n,i;return je=null,f8(),e=T,t=khe(),n=Dhe(),i=Fhe(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:T}}function The(e){return e.type===Ua||e.type===Mo||e.type===cm||e.type===fm}function g8(){if(f8(),T>=tn)return{type:xd,start:T,end:T};const e=X.charCodeAt(T);return Od(e)?Ohe():e===40||e===41||e===59?P_():e===39||e===34?$he():e===46?ws(X.charCodeAt(T+1))?h8():P_():ws(e)?h8():P_()}function qn(){const e=je;return T=e.end,je=g8(),T=e.end,e}function p8(){const e=T;je=g8(),T=e}function Nhe(e){const t=new Ki(ihe);return t.elements=e,t}function m8(e,t,n){const i=new Ki(e==="||"||e==="&&"?uhe:rhe);return i.operator=e,i.left=t,i.right=n,i}function Rhe(e,t){const n=new Ki(she);return n.callee=e,n.arguments=t,n}function jhe(e,t,n){const i=new Ki(ohe);return i.test=e,i.consequent=t,i.alternate=n,i}function I_(e){const t=new Ki(l8);return t.name=e,t}function Sd(e){const t=new Ki(ahe);return t.value=e.value,t.raw=X.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function y8(e,t,n){const i=new Ki(lhe);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function Lhe(e){const t=new Ki(che);return t.properties=e,t}function v8(e,t,n){const i=new Ki(fhe);return i.key=t,i.value=n,i.kind=e,i}function Phe(e,t){const n=new Ki(dhe);return n.operator=e,n.argument=t,n.prefix=!0,n}function ke(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(s,o)=>(dm(o<i.length,"Message reference must be in range"),i[o]));throw n=new Error(r),n.index=T,n.description=r,n}function gm(e){e.type===xd&&ke(e,yhe),e.type===qa&&ke(e,hhe),e.type===wd&&ke(e,ghe),e.type===Ua&&ke(e,phe),e.type===Mo&&ke(e,mhe),ke(e,Dt,e.value)}function nn(e){const t=qn();(t.type!==Un||t.value!==e)&&gm(t)}function Ye(e){return je.type===Un&&je.value===e}function B_(e){return je.type===Mo&&je.value===e}function Ihe(){const e=[];for(T=je.start,nn("[");!Ye("]");)Ye(",")?(qn(),e.push(null)):(e.push(Wa()),Ye("]")||nn(","));return qn(),Nhe(e)}function b8(){T=je.start;const e=qn();return e.type===wd||e.type===qa?(e.octal&&ke(e,c8),Sd(e)):I_(e.value)}function Bhe(){var e,t,n,i;if(T=je.start,e=je,e.type===Ua)return n=b8(),nn(":"),i=Wa(),v8("init",n,i);if(e.type===xd||e.type===Un)gm(e);else return t=b8(),nn(":"),i=Wa(),v8("init",t,i)}function zhe(){var e=[],t,n,i,r={},s=String;for(T=je.start,nn("{");!Ye("}");)t=Bhe(),t.key.type===l8?n=t.key.name:n=s(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?ke({},vhe):r[i]=!0,e.push(t),Ye("}")||nn(",");return nn("}"),Lhe(e)}function Uhe(){nn("(");const e=z_();return nn(")"),e}const qhe={if:1};function Whe(){var e,t,n;if(Ye("("))return Uhe();if(Ye("["))return Ihe();if(Ye("{"))return zhe();if(e=je.type,T=je.start,e===Ua||qhe[je.value])n=I_(qn().value);else if(e===wd||e===qa)je.octal&&ke(je,c8),n=Sd(qn());else{if(e===Mo)throw new Error(Ed);e===cm?(t=qn(),t.value=t.value==="true",n=Sd(t)):e===fm?(t=qn(),t.value=null,n=Sd(t)):Ye("/")||Ye("/=")?(n=Sd(Mhe()),p8()):gm(qn())}return n}function Ghe(){const e=[];if(nn("("),!Ye(")"))for(;T<tn&&(e.push(Wa()),!Ye(")"));)nn(",");return nn(")"),e}function Hhe(){T=je.start;const e=qn();return The(e)||gm(e),I_(e.value)}function Yhe(){return nn("."),Hhe()}function Vhe(){nn("[");const e=z_();return nn("]"),e}function Xhe(){var e,t,n;for(e=Whe();;)if(Ye("."))n=Yhe(),e=y8(".",e,n);else if(Ye("("))t=Ghe(),e=Rhe(e,t);else if(Ye("["))n=Vhe(),e=y8("[",e,n);else break;return e}function x8(){const e=Xhe();if(je.type===Un&&(Ye("++")||Ye("--")))throw new Error(Ed);return e}function pm(){var e,t;if(je.type!==Un&&je.type!==Mo)t=x8();else{if(Ye("++")||Ye("--"))throw new Error(Ed);if(Ye("+")||Ye("-")||Ye("~")||Ye("!"))e=qn(),t=pm(),t=Phe(e.value,t);else{if(B_("delete")||B_("void")||B_("typeof"))throw new Error(Ed);t=x8()}}return t}function w8(e){let t=0;if(e.type!==Un&&e.type!==Mo)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function Khe(){var e,t,n,i,r,s,o,a,u,l;if(e=je,u=pm(),i=je,r=w8(i),r===0)return u;for(i.prec=r,qn(),t=[e,je],o=pm(),s=[u,i,o];(r=w8(je))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=m8(a,u,o),s.push(n);i=qn(),i.prec=r,s.push(i),t.push(je),n=pm(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=m8(s[l-1].value,s[l-2],n),l-=2;return n}function Wa(){var e,t,n;return e=Khe(),Ye("?")&&(qn(),t=Wa(),nn(":"),n=Wa(),e=jhe(e,t,n)),e}function z_(){const e=Wa();if(Ye(","))throw new Error(Ed);return e}function Jhe(e){X=e,T=0,tn=X.length,je=null,p8();const t=z_();if(je.type!==xd)throw new Error("Unexpect token after expression.");return t}function U_(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...U_(e.object)),t.push(...U_(e.property))),t)}function E8(e){return e.object.type==="MemberExpression"?E8(e.object):e.object.name==="datum"}function _8(e){const t=Jhe(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&E8(i)&&n.add(U_(i).slice(1).join("."))}),n}class kl extends Ie{constructor(t,n,i){super(t);this.model=n,this.filter=i,this.expr=mm(this.model,this.filter,this),this._dependentFields=_8(this.expr)}clone(){return new kl(null,this.model,fe(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function Qhe(e,t){var n;const i={},r=e.config.selection;if(!t||!t.length)return i;for(const s of t){const o=Xe(s.name),a=s.select,u=ce(a)?a:a.type,l=Ue(a)?fe(a):{type:u},c=r[u];for(const d in c)d==="fields"||d==="encodings"||(d==="mark"&&(l[d]=Object.assign(Object.assign({},c[d]),l[d])),(l[d]===void 0||l[d]===!0)&&(l[d]=(n=c[d])!==null&&n!==void 0?n:l[d]));const f=i[o]=Object.assign(Object.assign({},l),{name:o,type:u,init:s.value,bind:s.bind,events:ce(l.on)?Ol(l.on,"scope"):rt(fe(l.on))});for(const d of lm)d.defined(f)&&d.parse&&d.parse(e,f,s)}return i}function A8(e,t,n,i="datum"){const r=ce(t)?t:t.param,s=Xe(r),o=Ae(s+za);let a;try{a=e.getSelectionComponent(s,r)}catch{return`!!${s}`}if(a.project.timeUnit){const c=n!=null?n:e.component.data.raw,f=a.project.timeUnit.clone();c.parent?f.insertAsParentOf(c):c.parent=f}const u=`vlSelectionTest(${o}, ${i}${a.resolve==="global"?")":`, ${Ae(a.resolve)})`}`,l=`length(data(${o}))`;return t.empty===!1?`${l} && ${u}`:`!${l} || ${u}`}function O8(e,t,n){const i=Xe(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch{return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&B(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Ae(s)}.`);else if(r&&!s){const a=o.project.items.filter(u=>u.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,B((a.length?"Multiple ":"No ")+`matching ${Ae(r)} encoding found for selection ${Ae(n.param)}. Using "field": ${Ae(s)}.`)):s=a[0].field}return`${o.name}[${Ae(yi(s))}]`}function Zhe(e,t){var n;for(const[i,r]of fo((n=e.component.selection)!==null&&n!==void 0?n:{})){const s=e.getName(`lookup_${i}`);e.component.data.outputNodes[s]=r.materialized=new An(new kl(t,e,{param:i}),s,Ge.Lookup,e.component.data.outputNodeRefCounts)}}function mm(e,t,n){return Qf(t,i=>ce(i)?i:sle(i)?A8(e,i,n):K6(i))}var ym=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ege(e,t){if(!!e)return V(e)&&!wo(e)?e.map(n=>e_(n,t)).join(", "):e}function q_(e,t,n,i){var r,s,o,a,u;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(u=e.encode[t]).update)!==null&&o!==void 0||(u.update={}),e.encode[t].update[n]=i}function Cd(e,t,n,i={header:!1}){var r,s;const o=e.combine(),{disable:a,orient:u,scale:l,labelExpr:c,title:f,zindex:d}=o,h=ym(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const g in h){const p=hce[g],m=h[g];if(p&&p!==t&&p!=="both")delete h[g];else if(dd(m)){const{condition:y}=m,v=ym(m,["condition"]),b=rt(y),x=MR[g];if(x){const{vgProp:E,part:_}=x,w=[...b.map(A=>{const{test:S}=A,O=ym(A,["test"]);return Object.assign({test:mm(null,S)},O)}),v];q_(h,_,E,w),delete h[g]}else if(x===null){const E={signal:b.map(_=>{const{test:w}=_,A=ym(_,["test"]);return`${mm(null,w)} ? ${w6(A)} : `}).join("")+w6(v)};h[g]=E}}else if(te(m)){const y=MR[g];if(y){const{vgProp:v,part:b}=y;q_(h,b,v,m),delete h[g]}}pe(["labelAlign","labelBaseline"],g)&&h[g]===null&&delete h[g]}if(t==="grid"){if(!h.grid)return;if(h.encode){const{grid:g}=h.encode;h.encode=Object.assign({},g?{grid:g}:{}),Pe(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:l,orient:u},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:dt(d,0)})}else{if(!i.header&&e.mainExtracted)return;if(c!==void 0){let p=c;((s=(r=h.encode)===null||r===void 0?void 0:r.labels)===null||s===void 0?void 0:s.update)&&te(h.encode.labels.update.text)&&(p=Fa(c,"datum.label",h.encode.labels.update.text.signal)),q_(h,"labels","text",{signal:p})}if(h.labelAlign===null&&delete h.labelAlign,h.encode){for(const p of TR)e.hasAxisPart(p)||delete h.encode[p];Pe(h.encode)&&delete h.encode}const g=ege(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},g?{title:g}:{}),h),n.aria===!1?{aria:!1}:{}),{zindex:dt(d,0)})}}}function S8(e){const{axes:t}=e.component,n=[];for(const i of kr)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function tge(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Cd(r,"grid",t)),...i.map(r=>Cd(r,"grid",t)),...n.map(r=>Cd(r,"main",t)),...i.map(r=>Cd(r,"main",t))].filter(r=>r)}function C8(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...P(o),...P(a)]),l={};for(const c of u.values())l[c]={signal:`${i.signal} === "${s}" ? ${ms(o[c])} : ${ms(a[c])}`};return l}return t[r]})])}function nge(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:mle(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=te(n)?"axisOrient":`axis${Zf(n)}`,a=[...r,...r.map(l=>s+l.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:C8(a,i,e,n),vgAxisConfig:C8(u,i,e,n),axisConfigStyle:ige([...u,...a],i)}}function ige(e,t){var n;const i=[{}];for(const r of e){let s=(n=t[r])===null||n===void 0?void 0:n.style;if(s){s=rt(s);for(const o of s)i.push(t.style[o])}}return Object.assign.apply(null,i)}function W_(e,t,n,i={}){var r;const s=_6(e,n,t);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((r=i[o])===null||r===void 0?void 0:r[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const $8={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:i,formatType:r}=n;return hR(e,e.type,i,r,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return gR(i,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!==null&&i!==void 0?i:rge(n,e)},gridScale:({model:e,channel:t})=>sge(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||k8(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||F8(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!==null&&i!==void 0?i:age(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!==null&&i!==void 0?i:uge(t.type,n,W(t)&&!!t.timeUnit,W(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:cge({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=D8(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return O6(r?[wR(r)]:[],W(o)?[wR(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>fge(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!==null&&i!==void 0?i:dge(n,t)}};function rge(e,t){return!Zt(e)&&W(t)&&!We(t==null?void 0:t.bin)&&!wn(t==null?void 0:t.bin)}function sge(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function oge(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return te(s)?s:ed(s);{const{configValue:o}=W_("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?ed(o):n===Qe&&pe([LE,jE],e.type)&&!(W(e)&&e.timeUnit)?270:void 0}}function G_(e){return`(((${e.signal} % 360) + 360) % 360)`}function F8(e,t,n,i){if(e!==void 0)if(n==="x"){if(te(e)){const r=G_(e),s=te(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(te(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(te(e)){const r=G_(e),s=te(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(te(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function k8(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(te(e)){const o=G_(e),a=te(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180==0)return i?null:"center";if(te(t)){const o=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${o} "${s}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===s)?"left":"right"}function age(e,t){if(t==="x"&&pe(["quantitative","temporal"],e))return!0}function uge(e,t,n,i){if(n&&!Ue(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function lge(e){return e==="x"?"bottom":"left"}function cge({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!Zt(t)&&t!=="log"){if(W(e)){if(We(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&pe(["month","hours","day","quarter"],(r=En(e.timeUnit))===null||r===void 0?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function D8(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;if(s&&o)return S6(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function fge(e,t){const n=e.values;if(V(n))return DR(t,n);if(te(n))return n}function dge(e,t){return e==="rect"&&qp(t)?1:0}class Dl extends Ie{constructor(t,n){super(t);this.transform=n,this._dependentFields=_8(this.transform.calculate)}clone(){return new Dl(null,fe(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(!!Ia(i)&&xR(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,u=a.map((l,c)=>`${K6({field:s,timeUnit:o,equal:l})} ? ${c} : `).join("")+a.length;t=new Dl(t,{calculate:u,as:Ml(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${xe(this.transform)}`}}function Ml(e,t,n){return q(e,Object.assign({prefix:t,suffix:"sort_index"},n!=null?n:{}))}function vm(e,t){return pe(["top","bottom"],t)?"column":pe(["left","right"],t)||e==="row"?"row":"column"}function Tl(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return dt((t||{})[e],r[e],n.header[e])}function bm(e,t,n,i){const r={};for(const s of e){const o=Tl(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const H_=["row","column"],Y_=["header","footer"];function hge(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=bm(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),u=vm(t,a),l=ed(o);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),T8(l,u)),M8(u,l,s)),N8(i,r,t,jce,QR))}}function M8(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=k8(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function T8(e,t){const n=F8(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function gge(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of Y_)if(n[r])for(const s of n[r]){const o=mge(e,t,r,n,s);o!=null&&i.push(o)}return i}function pge(e,t){var n;const{sort:i}=e;return Nr(i)?{field:q(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}:V(i)?{field:Ml(e,t,{expr:"datum"}),order:"ascending"}:{field:q(e,{expr:"datum"}),order:i!=null?i:"ascending"}}function V_(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=bm(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=GE({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=vm(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?Fa(Fa(u,"datum.label",l),"datum.value",q(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),T8(s,c)),M8(c,s,o)),N8(n,e,t,Lce,ZR))}function mge(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=bm(["labelOrient"],o.header,a,t);(t==="row"&&!pe(["top","bottom"],f)||t==="column"&&!pe(["left","right"],f))&&(s=V_(o,t,a))}const u=Zi(e)&&!cd(e.facet),l=r.axes,c=(l==null?void 0:l.length)>0;if(s||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:pge(o,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const yge={column:{start:0,end:1},row:{start:1,end:0}};function vge(e,t){return yge[t][e]}function bge(e,t){const n={};for(const i of bi){const r=e[i];if(r==null?void 0:r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=bm(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=vm(i,o),u=vge(s,a);u!==void 0&&(n[a]=u)}}return Pe(n)?void 0:n}function N8(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=Tl(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function X_(e){return[...xm(e,"width"),...xm(e,"height"),...xm(e,"childWidth"),...xm(e,"childHeight")]}function xm(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(Zt(o)&&Eo(a)){const u=e.scaleName(n);return Zi(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[R8(u,a)]:[R8(u,a),{name:r,update:j8(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=p_(e.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function R8(e,t){return{name:`${e}_step`,value:t.step}}function j8(e,t,n){const i=t.get("type"),r=t.get("padding"),s=dt(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${ms(o)}, ${ms(s)}) * ${e}_step`}function L8(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function P8(e,t){return P(e).reduce((n,i)=>{const r=e[i];return Object.assign(Object.assign({},n),$l(t,r,i,s=>Ke(s.value)))},{})}function I8(e,t){if(Zi(t))return e==="theta"?"independent":"shared";if(jl(t))return"shared";if(fA(t))return Dr(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function K_(e,t){const n=e.scale[t],i=Dr(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&B($ue(t)),"independent"):e[i][t]||"shared"}const xge=Object.assign(Object.assign({},Bce),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),B8=P(xge);class wge extends bs{}const z8={symbols:Ege,gradient:_ge,labels:Age,entries:Oge};function Ege(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var o,a,u,l,c,f,d,h;if(s!=="symbol")return;const{markDef:g,encoding:p,config:m,mark:y}=n,v=g.filled&&y!=="trail";let b=Object.assign(Object.assign({},zae({},n,Lle)),Gj(n,{filled:v}));const x=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:m.legend.symbolOpacity,E=(a=r.get("symbolFillColor"))!==null&&a!==void 0?a:m.legend.symbolFillColor,_=(u=r.get("symbolStrokeColor"))!==null&&u!==void 0?u:m.legend.symbolStrokeColor,w=x===void 0?(l=U8(p.opacity))!==null&&l!==void 0?l:g.opacity:void 0;if(b.fill){if(i==="fill"||v&&i===In)delete b.fill;else if(b.fill.field)E?delete b.fill:(b.fill=Ke((c=m.legend.symbolBaseFillColor)!==null&&c!==void 0?c:"black"),b.fillOpacity=Ke(w!=null?w:1));else if(V(b.fill)){const A=(h=(d=J_((f=p.fill)!==null&&f!==void 0?f:p.color))!==null&&d!==void 0?d:g.fill)!==null&&h!==void 0?h:v&&g.color;A&&(b.fill=Ke(A))}}if(b.stroke){if(i==="stroke"||!v&&i===In)delete b.stroke;else if(b.stroke.field||_)delete b.stroke;else if(V(b.stroke)){const A=dt(J_(p.stroke||p.color),g.stroke,v?g.color:void 0);A&&(b.stroke={value:A})}}if(i!==ds){const A=W(t)&&W8(n,r,t);A?b.opacity=[Object.assign({test:A},Ke(w!=null?w:1)),Ke(m.legend.unselectedOpacity)]:w&&(b.opacity=Ke(w))}return b=Object.assign(Object.assign({},b),e),Pe(b)?void 0:b}function _ge(e,{model:t,legendType:n,legendCmpt:i}){var r;if(n!=="gradient")return;const{config:s,markDef:o,encoding:a}=t;let u={};const c=((r=i.get("gradientOpacity"))!==null&&r!==void 0?r:s.legend.gradientOpacity)===void 0?U8(a.opacity)||o.opacity:void 0;return c&&(u.opacity=Ke(c)),u=Object.assign(Object.assign({},u),e),Pe(u)?void 0:u}function Age(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=W(t)?W8(n,r,t):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s,f=Pa(c)?HE({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return Pe(d)?void 0:d}function Oge(e,{legendCmpt:t}){const n=t.get("selections");return(n==null?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function U8(e){return q8(e,(t,n)=>Math.max(t,n.value))}function J_(e){return q8(e,(t,n)=>dt(t,n.value))}function q8(e,t){if(tce(e))return rt(e.condition).reduce(t,e.value);if(Xi(e))return e.value}function W8(e,t,n){const i=t.get("selections");if(!(i==null?void 0:i.length))return;const r=Ae(n.field);return i.map(s=>`(!length(data(${Ae(Xe(s)+za)})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`).join(" || ")}const G8={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return hR(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return gR(i,t,n)},gradientLength:e=>{var t,n;const{legend:i,legendConfig:r}=e;return(n=(t=i.gradientLength)!==null&&t!==void 0?t:r.gradientLength)!==null&&n!==void 0?n:Mge(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!==null&&i!==void 0?i:t.labelOverlap)!==null&&r!==void 0?r:Tge(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!==null&&r!==void 0?r:Cge(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>xl(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(pl(n)&&Vi(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Sge(t,e)};function Sge(e,t){const n=e.values;if(V(n))return DR(t,n);if(te(n))return n}function Cge(e,t,n,i){var r;if(t!=="shape"){const s=(r=J_(n))!==null&&r!==void 0?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function $ge(e){const{legend:t}=e;return dt(t.type,Fge(e))}function Fge({channel:e,timeUnit:t,scaleType:n}){if(pl(e)){if(pe(["quarter","month","day"],t))return"symbol";if(Vi(n))return"gradient"}return"symbol"}function kge({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!==null&&r!==void 0?r:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:Dge(n,t)}function Dge(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function Mge({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(Vi(r))return n==="horizontal"?i==="top"||i==="bottom"?H8(t,"width",o,s):o:H8(t,"height",u,a)}function H8(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function Tge(e){if(pe(["quantile","threshold","log","symlog"],e))return"greedy"}function Y8(e){const t=ht(e)?Nge(e):Pge(e);return e.component.legends=t,t}function Nge(e){const{encoding:t}=e,n={};for(const i of[In,...tj]){const r=Et(t[i]);!r||!e.getScaleComponent(i)||i===Bn&&W(r)&&r.type===vl||(n[i]=Lge(e,i))}return n}function Rge(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function jge(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n==null?void 0:n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function Lge(e,t){var n,i,r;let s=e.legend(t);const{markDef:o,encoding:a,config:u}=e,l=u.legend,c=new wge({},Rge(e,t));Pde(e,t,c);const f=s!==void 0?!s:l.disable;if(c.set("disable",f,s!==void 0),f)return c;s=s||{};const d=e.getScaleComponent(t).get("type"),h=Et(a[t]),g=W(h)?(n=En(h.timeUnit))===null||n===void 0?void 0:n.unit:void 0,p=s.orient||u.legend.orient||"right",m=$ge({legend:s,channel:t,timeUnit:g,scaleType:d}),y=kge({legend:s,legendType:m,orient:p,legendConfig:l}),v={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:h,legendConfig:l,config:u,scaleType:d,orient:p,legendType:m,direction:y};for(const w of B8){if(m==="gradient"&&w.startsWith("symbol")||m==="symbol"&&w.startsWith("gradient"))continue;const A=w in G8?G8[w](v):s[w];if(A!==void 0){const S=jge(A,w,s,e.fieldDef(t));(S||u.legend[w]===void 0)&&c.set(w,A,S)}}const b=(i=s==null?void 0:s.encoding)!==null&&i!==void 0?i:{},x=c.get("selections"),E={},_={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:m};for(const w of["labels","legend","title","symbols","gradient","entries"]){const A=P8((r=b[w])!==null&&r!==void 0?r:{},e),S=w in z8?z8[w](A,_):A;S!==void 0&&!Pe(S)&&(E[w]=Object.assign(Object.assign(Object.assign({},(x==null?void 0:x.length)&&W(h)?{name:`${Xe(h.field)}_legend_${w}`}:{}),(x==null?void 0:x.length)?{interactive:!!x}:{}),{update:S}))}return Pe(E)||c.set("encode",E,!!(s==null?void 0:s.encoding)),c}function Pge(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){Y8(i);for(const r of P(i.component.legends))n.legend[r]=K_(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=V8(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of P(t))for(const r of e.children)!r.component.legends[i]||n.legend[i]==="shared"&&delete r.component.legends[i];return t}function V8(e,t){var n,i,r,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let u=!1;for(const l of B8){const c=Co(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return Ige(f,d);case"title":return C6(f,d);case"type":return u=!0,ri("symbol")}return nm(f,d,l,"legend")});e.setWithExplicit(l,c)}return u&&(((i=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient)&&vp(e.implicit,["encode","gradient"]),((s=(r=e.explicit)===null||r===void 0?void 0:r.encode)===null||s===void 0?void 0:s.gradient)&&vp(e.explicit,["encode","gradient"])),e}function Ige(e,t){return t.value==="circle"?t:e}var Bge=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function zge(e,t,n,i){var r,s,o,a,u;(r=e.encode)!==null&&r!==void 0||(e.encode={}),(s=(a=e.encode)[t])!==null&&s!==void 0||(a[t]={}),(o=(u=e.encode[t]).update)!==null&&o!==void 0||(u.update={}),e.encode[t].update[n]=i}function X8(e){const t=e.component.legends,n={};for(const r of P(t)){const s=e.getScaleComponent(r),o=qe(s.get("domains"));if(n[o])for(const a of n[o])V8(a,t[r])||n[o].push(t[r]);else n[o]=[t[r].clone()]}return Qt(n).flat().map(r=>Uge(r,e.config)).filter(r=>r!==void 0)}function Uge(e,t){var n,i,r;const s=e.combine(),{disable:o,labelExpr:a,selections:u}=s,l=Bge(s,["disable","labelExpr","selections"]);if(!o){if(t.aria===!1&&l.aria==null&&(l.aria=!1),(n=l.encode)===null||n===void 0?void 0:n.symbols){const c=l.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!l.stroke&&(c.stroke={value:"transparent"});for(const f of tj)l[f]&&delete c[f]}if(l.title||delete l.title,a!==void 0){let c=a;((r=(i=l.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&te(l.encode.labels.update.text)&&(c=Fa(a,"datum.label",l.encode.labels.update.text.signal)),zge(l,"labels","text",{signal:c})}return l}}function qge(e){return jl(e)||fA(e)?Wge(e):K8(e)}function Wge(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),K8(e))}function K8(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const u=te(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return pe(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const Gge=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class J8 extends bs{constructor(t,n,i,r){super(Object.assign({},n),{name:t});this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function Q8(e){e.component.projection=ht(e)?Hge(e):Xge(e)}function Hge(e){var t;if(e.hasProjection){const n=zn(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?Yge(e):void 0,o=new J8(e.projectionName(!0),Object.assign(Object.assign({},(t=zn(e.config.projection))!==null&&t!==void 0?t:{}),n!=null?n:{}),r,s);return o.get("type")||o.set("type","equalEarth",!1),o}}function Yge(e){const t=[],{encoding:n}=e;for(const i of[[Cr,Sr],[vi,Yi]])(Et(n[i[0]])||Et(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Bn)&&e.typedFieldDef(Bn).type===vl&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(Ge.Main)),t}function Vge(e,t){const n=oE(Gge,r=>!!(!cl(e.explicit,r)&&!cl(t.explicit,r)||cl(e.explicit,r)&&cl(t.explicit,r)&&Er(e.get(r),t.get(r))));if(Er(e.size,t.size)){if(n)return e;if(Er(e.explicit,{}))return t;if(Er(t.explicit,{}))return e}return null}function Xge(e){if(e.children.length===0)return;let t;for(const i of e.children)Q8(i);const n=oE(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=Vge(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new J8(i,t.specifiedProjection,t.size,fe(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}}var Kge=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function Jge(e,t,n,i){var r,s;if(fd(t,n)){const o=ht(e)?(s=(r=e.axis(n))!==null&&r!==void 0?r:e.legend(n))!==null&&s!==void 0?s:{}:{},a=q(t,{expr:"datum"}),u=q(t,{expr:"datum",binSuffix:"end"});return{formulaAs:q(t,{binSuffix:"range",forAs:!0}),formula:Lp(a,u,o.format,o.formatType,i)}}return{}}function Z8(e,t){return`${m6(e)}_${t}`}function Qge(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function Q_(e,t,n){var i;const r=(i=Hp(n,void 0))!==null&&i!==void 0?i:{},s=Z8(r,t);return e.getName(`${s}_bins`)}function Zge(e){return"as"in e}function e4(e,t,n){let i,r;Zge(e)?i=ce(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[q(e,{forAs:!0}),q(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},Hp(t,void 0)),o=Z8(s,e.field),{signal:a,extentSignal:u}=Qge(n,o);if(Cp(s.extent)){const c=s.extent;r=O8(n,c.param,c),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[i]},a?{signal:a}:{}),u?{extentSignal:u}:{}),r?{span:r}:{});return{key:o,binComponent:l}}class Br extends Ie{constructor(t,n){super(t);this.bins=n}clone(){return new Br(null,fe(this.bins))}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(wi(s)&&We(s.bin)){const{key:a,binComponent:u}=e4(s,s.bin,n);r[a]=Object.assign(Object.assign(Object.assign({},u),r[a]),Jge(n,s,o,n.config))}return r},{});return Pe(i)?null:new Br(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=e4(n,n.bin,i);return new Br(t,{[r]:s})}merge(t,n){for(const i of P(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=_r([...this.bins[i].as,...t.bins[i].as],xe)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Qt(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Qt(this.bins).map(t=>t.field))}hash(){return`Bin ${xe(this.bins)}`}assemble(){return Qt(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,s=t.bin,{extent:o}=s,a=Kge(s,["extent"]),u=Object.assign(Object.assign(Object.assign({type:"bin",field:yi(t.field),as:i,signal:t.signal},Cp(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:yi(t.field),signal:t.extentSignal}),u.extent={signal:t.extentSignal}),n.push(u);for(const l of r)for(let c=0;c<2;c++)n.push({type:"formula",expr:q({field:i[c]},{expr:"datum"}),as:l[c]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function e0e(e,t,n,i){var r;const s=ht(i)?i.encoding[hs(t)]:void 0;if(wi(n)&&ht(i)&&AR(n,s,i.markDef,i.config))e.add(q(n,{})),e.add(q(n,{suffix:"end"})),n.bin&&fd(n,t)&&e.add(q(n,{binSuffix:"range"}));else if(dae(t)){const o=fae(t);e.add(i.getName(o))}else e.add(q(n));return Ia(n)&&Sle((r=n.scale)===null||r===void 0?void 0:r.range)&&e.add(n.scale.range.field),e}function t0e(e,t){var n;for(const i of P(t)){const r=t[i];for(const s of P(r))i in e?e[i][s]=new Set([...(n=e[i][s])!==null&&n!==void 0?n:[],...r[s]]):e[i]={[s]:r[s]}}}class Ji extends Ie{constructor(t,n,i){super(t);this.dimensions=n,this.measures=i}clone(){return new Ji(null,new Set(this.dimensions),fe(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return!i||(n.forEachFieldDef((o,a)=>{var u,l,c,f;const{aggregate:d,field:h}=o;if(d)if(d==="count")(u=r["*"])!==null&&u!==void 0||(r["*"]={}),r["*"].count=new Set([q(o,{forAs:!0})]);else{if(gs(d)||xo(d)){const g=gs(d)?"argmin":"argmax",p=d[g];(l=r[p])!==null&&l!==void 0||(r[p]={}),r[p][g]=new Set([q({op:g,field:p},{forAs:!0})])}else(c=r[h])!==null&&c!==void 0||(r[h]={}),r[h][d]=new Set([q(o,{forAs:!0})]);bo(a)&&n.scaleDomain(a)==="unaggregated"&&((f=r[h])!==null&&f!==void 0||(r[h]={}),r[h].min=new Set([q({field:h,aggregate:"min"},{forAs:!0})]),r[h].max=new Set([q({field:h,aggregate:"max"},{forAs:!0})]))}else e0e(s,a,o,n)}),s.size+P(r).length===0)?null:new Ji(t,s,r)}static makeFromTransform(t,n){var i,r,s;const o=new Set,a={};for(const u of n.aggregate){const{op:l,field:c,as:f}=u;l&&(l==="count"?((i=a["*"])!==null&&i!==void 0||(a["*"]={}),a["*"].count=new Set([f||q(u,{forAs:!0})])):((r=a[c])!==null&&r!==void 0||(a[c]={}),a[c][l]=new Set([f||q(u,{forAs:!0})])))}for(const u of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(u);return o.size+P(a).length===0?null:new Ji(t,o,a)}merge(t){return e6(this.dimensions,t.dimensions)?(t0e(this.measures,t.measures),!0):(Wue("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...P(this.measures)])}producedFields(){const t=new Set;for(const n of P(this.measures))for(const i of P(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${xe({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of P(this.measures))for(const o of P(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:yi(s));return{type:"aggregate",groupby:[...this.dimensions].map(yi),ops:t,fields:n,as:i}}}class Nl extends Ie{constructor(t,n,i,r){super(t);this.model=n,this.name=i,this.data=r;for(const s of bi){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[q(o),...We(a)?[q(o,{binSuffix:"end"})]:[]]},Nr(u)?{sortField:u}:V(u)?{sortIndexField:Ml(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of bi)this[n]&&(t+=` ${n.charAt(0)}:${xe(this[n])}`);return t}get fields(){var t;const n=[];for(const i of bi)((t=this[i])===null||t===void 0?void 0:t.fields)&&n.push(...this[i].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of bi)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of kr){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(Zt(r)&&Eo(s)){const o=Em(this.childModel,n),a=uA(o);a?t[n]=a:B(wE(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=Pp,field:f}=u;s.push(f),o.push(c),a.push(q(u,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n!=null?n:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,i;const{columns:r}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const c of H_){for(const f of Y_){const d=(n=s[c]&&s[c][f])!==null&&n!==void 0?n:[];for(const h of d)if(((i=h.axes)===null||i===void 0?void 0:i.length)>0){a[c]=!0;break}}if(a[c]){const f=`length(data("${this.facet.name}"))`,d=c==="row"?r?{signal:`ceil(${f} / ${r})`}:1:r?{signal:`min(${f}, ${r})`}:{signal:f};o.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:d}]})}}const{row:u,column:l}=a;return(u||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const i=[];let r=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:u}=this;if(o&&a&&(s.x||s.y)){r=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),c=l.map(()=>"distinct");i.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:c}]})}for(const l of[us,as])this[l]&&i.push(this.assembleRowColumnHeaderData(l,r,s));if(u){const l=this.assembleFacetHeaderData(s);l&&i.push(...l)}return i}}function t4(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function n0e(e,t){const n=cE(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=t4(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=t4(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return B(eue(t)),null}function i0e(e){const t={};return yp(e.filter,n=>{var i;if(X6(n)){let r=null;$E(n)?r=ni(n.equal):kE(n)?r=ni(n.lte):FE(n)?r=ni(n.lt):DE(n)?r=ni(n.gt):ME(n)?r=ni(n.gte):TE(n)?r=n.range[0]:NE(n)&&(r=((i=n.oneOf)!==null&&i!==void 0?i:n.in)[0]),r&&(Ra(r)?t[n.field]="date":ft(r)?t[n.field]="number":ce(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function r0e(e){const t={};function n(i){El(i)?t[i.field]="date":i.type==="quantitative"&&Dae(i.aggregate)?t[i.field]="number":gl(i.field)>1?i.field in t||(t[i.field]="flatten"):Ia(i)&&Nr(i.sort)&&gl(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((ht(e)||Zi(e))&&e.forEachFieldDef((i,r)=>{if(wi(i))n(i);else{const s=Ma(r),o=e.fieldDef(s);n(Object.assign(Object.assign({},i),{type:o.type}))}}),ht(e)){const{mark:i,markDef:r,encoding:s}=e;if(_o(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];W(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function s0e(e){const t={};if(ht(e)&&e.component.selection)for(const n of P(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&gl(r.field)>1&&(t[r.field]="flatten")}return t}class rn extends Ie{constructor(t,n){super(t);this._parse=n}clone(){return new rn(null,fe(this._parse))}hash(){return`Parse ${xe(this._parse)}`}static makeExplicit(t,n,i){var r;let s={};const o=n.data;return!$o(o)&&((r=o==null?void 0:o.format)===null||r===void 0?void 0:r.parse)&&(s=o.format.parse),this.makeWithAncestors(t,s,{},i)}static makeWithAncestors(t,n,i,r){for(const a of P(i)){const u=r.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===i[a]||u.value==="derived"||i[a]==="flatten"?delete i[a]:B(N6(a,i[a],u.value)))}for(const a of P(n)){const u=r.get(a);u!==void 0&&(u===n[a]?delete n[a]:B(N6(a,n[a],u)))}const s=new bs(n,i);r.copyAll(s);const o={};for(const a of P(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return P(o).length===0||r.parseNothing?null:new rn(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of P(this._parse)){const i=this._parse[n];gl(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(P(this._parse))}dependentFields(){return new Set(P(this._parse))}assembleTransforms(t=!1){return P(this._parse).filter(n=>t?gl(n)>1:!0).map(n=>{const i=n0e(n,this._parse[n]);return i?{type:"formula",expr:i,as:fE(n)}:null}).filter(n=>n!==null)}}class To extends Ie{clone(){return new To(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([hd])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:hd}}}class $d extends Ie{constructor(t,n){super(t);this.params=n}clone(){return new $d(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${xe(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class Fd extends Ie{constructor(t,n){super(t);this.params=n}clone(){return new Fd(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${xe(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class Ga extends Ie{constructor(t){super(null);t!=null||(t={name:"source"});let n;if($o(t)||(n=t.format?Object.assign({},ti(t.format,["parse"])):{}),pd(t))this._data={values:t.values};else if(Al(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];pe(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else Mj(t)?this._data={values:[{type:"Sphere"}]}:(kj(t)||$o(t))&&(this._data={});this._generator=$o(t),t.name&&(this._name=t.name),n&&!Pe(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var n4=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},o0e=globalThis&&globalThis.__classPrivateFieldGet||function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},kd;function Z_(e){return e instanceof Ga||e instanceof $d||e instanceof Fd}class eA{constructor(){kd.set(this,void 0),n4(this,kd,!1,"f")}setModified(){n4(this,kd,!0,"f")}get modifiedFlag(){return o0e(this,kd,"f")}}kd=new WeakMap;class Ha extends eA{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class tA extends eA{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class a0e extends tA{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of P(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class u0e extends tA{constructor(t){super();this.requiresSelectionId=t&&T_(t)}run(t){t instanceof To&&(this.requiresSelectionId&&(Z_(t.parent)||t.parent instanceof Ji||t.parent instanceof rn)||(this.setModified(),t.remove()))}}class l0e extends eA{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Pr&&(i=t.producedFields(),aE(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class c0e extends tA{constructor(){super()}run(t){t instanceof An&&!t.isRequired()&&(this.setModified(),t.remove())}}class f0e extends Ha{run(t){if(!Z_(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof rn)if(t instanceof rn)this.setModified(),t.merge(n);else{if(lE(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class d0e extends Ha{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof rn);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const u of P(a))u in r?r[u]!==a[u]&&s.add(u):r[u]=a[u]}for(const o of s)delete r[o];if(!Pe(r)){this.setModified();const o=new rn(t,r);for(const a of n){if(a instanceof rn)for(const u of P(r))delete a.parse[u];t.removeChild(a),a.parent=o,a instanceof rn&&P(a.parse).length===0&&a.remove()}}}}}class h0e extends Ha{run(t){t instanceof An||t.numChildren()>0||t instanceof Nl||t instanceof Ga||(this.setModified(),t.remove())}}class g0e extends Ha{run(t){const n=t.children.filter(r=>r instanceof Pr),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class p0e extends Ha{run(t){const n=t.children.filter(r=>r instanceof Ji),i={};for(const r of n){const s=xe(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of P(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class m0e extends Ha{constructor(t){super();this.model=t}run(t){const n=!(Z_(t)||t instanceof kl||t instanceof rn||t instanceof To),i=[],r=[];for(const s of t.children)s instanceof Br&&(n&&!lE(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Br?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class y0e extends Ha{run(t){const n=[...t.children];if(!hl(n,o=>o instanceof An)||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof An){let a=o;for(;a.numChildren()===1;){const[u]=a.children;if(u instanceof An)a=u;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Ya extends Ie{constructor(t,n){super(t);this.transform=n}clone(){return new Ya(null,fe(this.transform))}addDimensions(t){this.transform.groupby=_r(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:q(t)}hash(){return`JoinAggregateTransform ${xe(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:i,ops:n,fields:t},r!==void 0?{groupby:r}:{})}}function v0e(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=q(i);return r&&t.push(r),t},[])}function b0e(e){return V(e)&&e.every(t=>ce(t))&&e.length>1}class Es extends Ie{constructor(t,n){super(t);this._stack=n}clone(){return new Es(null,fe(this._stack))}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(dt(f.order,"ascending"));const l={field:a,order:u};let c;return b0e(s)?c=s:ce(s)?c=[s,`${s}_end`]:c=[`${n.stack}_start`,`${n.stack}_end`],new Es(t,{stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:u}=i;let l;if(s){const h=r[s];l=jr(h)}const c=v0e(n),f=n.encoding.order;let d;return V(f)||W(f)?d=A6(f):d=c.reduce((h,g)=>(h.field.push(g),h.order.push(o==="y"?"descending":"ascending"),h),{field:[],order:[]}),new Es(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:c,sort:d,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${xe(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:i}=this._stack;return t?t.bin?n?[q(t,{binSuffix:"mid"})]:[q(t,{}),q(t,{binSuffix:"end"})]:[q(t)]:i!=null?i:[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:i,stackField:r,stackby:s,sort:o,offset:a,impute:u,as:l}=this._stack;if(u&&i){const{bandPosition:c=.5,bin:f}=i;f&&t.push({type:"formula",expr:`${c}*`+q(i,{expr:"datum"})+`+${1-c}*`+q(i,{expr:"datum",binSuffix:"end"}),as:q(i,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:r,groupby:[...s,...n],key:q(i,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Rl extends Ie{constructor(t,n){super(t);this.transform=n}clone(){return new Rl(null,fe(this.transform))}addDimensions(t){this.transform.groupby=_r(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const i=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(i.add,i),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(r=>i.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(i.add,i),i}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:q(t)}hash(){return`WindowTransform ${xe(this.transform)}`}assemble(){var t;const n=[],i=[],r=[],s=[];for(const d of this.transform.window)i.push(d.op),r.push(this.getDefaultName(d)),s.push(d.param===void 0?null:d.param),n.push(d.field===void 0?null:d.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&i.every(d=>yE(d)))return Object.assign({type:"joinaggregate",as:r,ops:i,fields:n},a!==void 0?{groupby:a}:{});const u=[],l=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)u.push(d.field),l.push((t=d.order)!==null&&t!==void 0?t:"ascending");const c={field:u,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:r,ops:i,fields:n,sort:c},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}function x0e(e){function t(n){if(!(n instanceof Nl)){const i=n.clone();if(i instanceof An){const r=iA+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Ji||i instanceof Es||i instanceof Rl||i instanceof Ya)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function nA(e){if(e instanceof Nl)if(e.numChildren()===1&&!(e.children[0]instanceof An)){const t=e.children[0];(t instanceof Ji||t instanceof Es||t instanceof Rl||t instanceof Ya)&&t.addDimensions(e.fields),t.swapWithParent(),nA(e)}else{const t=e.model.component.data.main;i4(t);const n=x0e(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(nA)}function i4(e){if(e instanceof An&&e.type===Ge.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Nl||(t.swapWithParent(),i4(e))}}const iA="scale_",wm=5;function rA(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!rA(t.children))return!1}return!0}function Qi(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function r4(e,t,n){let i=e.sources,r=!1;return r=Qi(new c0e,i)||r,r=Qi(new u0e(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=Qi(new h0e,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=Qi(new f0e,i)||r,r=Qi(new m0e(t),i)||r,r=Qi(new l0e,i)||r,r=Qi(new d0e,i)||r,r=Qi(new p0e,i)||r,r=Qi(new g0e,i)||r,r=Qi(new a0e,i)||r,r=Qi(new y0e,i)||r),e.sources=i,r}function w0e(e,t){rA(e.sources);let n=0,i=0;for(let r=0;r<wm&&r4(e,t,!0);r++)n++;e.sources.map(nA);for(let r=0;r<wm&&r4(e,t,!1);r++)i++;rA(e.sources),Math.max(n,i)===wm&&B(`Maximum optimization runs(${wm}) reached.`)}class Wn{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Wn(()=>t(n))}}var E0e=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function s4(e){ht(e)?_0e(e):A0e(e)}function _0e(e){const t=e.component.scales;for(const n of P(t)){const i=S0e(e,n);if(t[n].setWithExplicit("domains",i),$0e(e,n),e.component.data.isFaceted){let s=e;for(;!Zi(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of i.value)ps(a)&&(a.data=iA+a.data.replace(iA,""))}}}function A0e(e){for(const n of e.children)s4(n);const t=e.component.scales;for(const n of P(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Co(i,o.getWithExplicit("domains"),"domains","scale",aA);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&B(Kae),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function O0e(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=o4(t,n);if(!r){B(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=o4(t,n);if(r)return"unaggregated"}return e}function S0e(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=O0e(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:r})),t==="x"&&Et(i.x2)?Et(i.x)?Co(No(n,r,e,"x"),No(n,r,e,"x2"),"domain","scale",aA):No(n,r,e,"x2"):t==="y"&&Et(i.y2)?Et(i.y)?Co(No(n,r,e,"y"),No(n,r,e,"y2"),"domain","scale",aA):No(n,r,e,"y2"):No(n,r,e,t)}function C0e(e,t,n){return e.map(i=>({signal:`{data: ${Yp(i,{timeUnit:n,type:t})}}`}))}function sA(e,t,n){var i;const r=(i=En(n))===null||i===void 0?void 0:i.unit;return t==="temporal"||r?C0e(e,t,r):[e]}function No(e,t,n,i){const{encoding:r}=n,s=Et(r[i]),{type:o}=s,a=s.timeUnit;if(Ole(t)){const f=No(e,void 0,n,i),d=sA(t.unionWith,o,a);return xs([...f.value,...d])}else{if(te(t))return xs([t]);if(t&&t!=="unaggregated"&&!Z6(t))return xs(sA(t,o,a))}const u=n.stack;if(u&&i===u.fieldChannel){if(u.offset==="normalize")return ri([[0,1]]);const f=n.requestDataName(Ge.Main);return ri([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=bo(i)&&W(s)?F0e(n,i,e):void 0;if(Ao(s)){const f=sA([s.datum],o,a);return ri(f)}const c=s;if(t==="unaggregated"){const f=n.requestDataName(Ge.Main),{field:d}=s;return ri([{data:f,field:q({field:d,aggregate:"min"})},{data:f,field:q({field:d,aggregate:"max"})}])}else if(We(c.bin)){if(Zt(e))return ri(e==="bin-ordinal"?[]:[{data:Jf(l)?n.requestDataName(Ge.Main):n.requestDataName(Ge.Raw),field:n.vgField(i,fd(c,i)?{binSuffix:"range"}:{}),sort:l===!0||!Ue(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=c;if(We(f)){const d=Q_(n,c.field,f);return ri([new Wn(()=>{const h=n.getSignalName(d);return`[${h}.start, ${h}.stop]`})])}else return ri([{data:n.requestDataName(Ge.Main),field:n.vgField(i,{})}])}}else if(c.timeUnit&&pe(["time","utc"],e)&&AR(c,ht(n)?n.encoding[hs(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(Ge.Main);return ri([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return ri(l?[{data:Jf(l)?n.requestDataName(Ge.Main):n.requestDataName(Ge.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(Ge.Main),field:n.vgField(i)}])}function oA(e,t){const{op:n,field:i,order:r}=e;return Object.assign(Object.assign({op:n!=null?n:t?"sum":Pp},i?{field:yi(i)}:{}),r?{order:r}:{})}function $0e(e,t){var n;const i=e.component.scales[t],r=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=Z6(r)&&r,a=Ta(s)&&Cp(s.extent)&&s.extent;(o||a)&&i.set("selectionExtent",o!=null?o:a,!0)}function F0e(e,t,n){if(!Zt(n))return;const i=e.fieldDef(t),r=i.sort;if(xR(r))return{op:"min",field:Ml(i,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(Nr(r)){const a=s&&!pe(o,r.field);return oA(r,a)}else if(bR(r)){const{encoding:a,order:u}=r,l=e.fieldDef(a),{aggregate:c,field:f}=l,d=s&&!pe(o,f);if(gs(c)||xo(c))return oA({field:q(l),order:u},d);if(yE(c)||!c)return oA({op:c,field:f,order:u},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(pe(["ascending",void 0],r))return!0}}function o4(e,t){const{aggregate:n,type:i}=e;return n?ce(n)&&!Nae[n]?{valid:!1,reason:wue(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:Eue(e)}:{valid:!0}:{valid:!1,reason:xue(e)}}function aA(e,t,n,i){return e.explicit&&t.explicit&&B(Cue(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function k0e(e){const t=_r(e.map(o=>ps(o)?E0e(o,["sort"]):o),xe),n=_r(e.map(o=>{if(ps(o)){const a=o.sort;return a!==void 0&&!Jf(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),xe);if(t.length===0)return;if(t.length===1){const o=e[0];if(ps(o)&&n.length>0){let a=n[0];if(n.length>1)B(B6),a=!0;else if(Ue(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const i=_r(n.map(o=>Jf(o)||!("op"in o)||ce(o.op)&&o.op in Fae?o:(B(Fue(o)),!0)),xe);let r;i.length===1?r=i[0]:i.length>1&&(B(B6),r=!0);const s=_r(e.map(o=>ps(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?Object.assign({data:s[0],fields:t.map(a=>a.field)},r?{sort:r}:{}):Object.assign({fields:t},r?{sort:r}:{})}function uA(e){if(ps(e)&&ce(e.field))return e.field;if(jae(e)){let t;for(const n of e.fields)if(ps(n)&&ce(n.field)){if(!t)t=n.field;else if(t!==n.field)return B(kue),t}return B(Due),t}else if(Lae(e)){B(Mue);const t=e.fields[0];return ce(t)?t:void 0}}function Em(e,t){const i=e.component.scales[t].get("domains").map(r=>(ps(r)&&(r.data=e.lookupDataSource(r.data)),r));return k0e(i)}var D0e=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function a4(e){return jl(e)||fA(e)?e.children.reduce((t,n)=>t.concat(a4(n)),u4(e)):u4(e)}function u4(e){return P(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:l,reverse:c}=r,f=D0e(r,["name","type","selectionExtent","domains","range","reverse"]),d=M0e(r.range,s,n,e),h=Em(e,n),g=a?hde(e,a,i,h):null;return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},h?{domain:h}:{}),g?{domainRaw:g}:{}),{range:d}),c!==void 0?{reverse:c}:{}),f)),t},[])}function M0e(e,t,n,i){if(Dr(n)){if(Eo(e))return{step:{signal:`${t}_step`}}}else if(Ue(e)&&ps(e))return Object.assign(Object.assign({},e),{data:i.lookupDataSource(e.data)});return e}class l4 extends bs{constructor(t,n){super({},{name:t});this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:hl(this.get("domains"),t=>V(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const T0e=["range","scheme"];function c4(e){return e==="x"?"width":e==="y"?"height":void 0}function N0e(e){const t=e.component.scales;for(const n of Sp){const i=t[n];if(!i)continue;const r=R0e(n,e);i.setWithExplicit("range",r)}}function f4(e,t){const n=e.fieldDef(t);if(n==null?void 0:n.bin){const{bin:i,field:r}=n,s=c4(t),o=e.getName(s);if(Ue(i)&&i.binned&&i.step!==void 0)return new Wn(()=>{const a=e.scaleName(t),u=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(o)} / (${u})`});if(We(i)){const a=Q_(e,r,i);return new Wn(()=>{const u=e.getSignalName(a),l=`(${u}.stop - ${u}.start) / ${u}.step`;return`${e.getSignalName(o)} / (${l})`})}}}function R0e(e,t){const n=t.specifiedScales[e],{size:i}=t,s=t.getScaleComponent(e).get("type");for(const l of T0e)if(n[l]!==void 0){const c=IE(s,l),f=eR(e,l);if(!c)B(P6(s,l,e));else if(f)B(f);else switch(l){case"range":{const d=n.range;if(V(d)){if(Dr(e))return xs(d.map(h=>{if(h==="width"||h==="height"){const g=t.getName(h),p=t.getSignalName.bind(t);return Wn.fromName(p,g)}return h}))}else if(Ue(d))return xs({data:t.requestDataName(Ge.Main),field:d.field,sort:{op:"min",field:t.vgField(e)}});return xs(d)}case"scheme":return xs(j0e(n[l]))}}if(e===Qe||e===xt){const l=e===Qe?"width":"height",c=i[l];if(Lr(c)){if(Zt(s))return xs({step:c.step});B(I6(l))}}const{rangeMin:o,rangeMax:a}=n,u=L0e(e,t);return(o!==void 0||a!==void 0)&&IE(s,"rangeMin")&&V(u)&&u.length===2?xs([o!=null?o:u[0],a!=null?a:u[1]]):ri(u)}function j0e(e){return Ale(e)?Object.assign({scheme:e.name},ti(e,["name"])):{scheme:e}}function L0e(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=Et(s[e]),l=t.getScaleComponent(e).get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case Qe:case xt:{if(pe(["point","band"],l)){if(e===Qe&&!n.width){const g=gd(i.view,"width");if(Lr(g))return g}else if(e===xt&&!n.height){const g=gd(i.view,"height");if(Lr(g))return g}}const d=c4(e),h=t.getName(d);return e===xt&&ii(l)?[Wn.fromName(o,h),0]:[0,Wn.fromName(o,h)]}case fs:{const d=t.component.scales[e].get("zero"),h=d4(r,d,i),g=B0e(r,n,t,i);return ud(l)?I0e(h,g,P0e(l,i,c,e)):[h,g]}case Hi:return[0,Math.PI*2];case ka:return[0,360];case Or:return[0,new Wn(()=>{const d=t.getSignalName("width"),h=t.getSignalName("height");return`min(${d},${h})/2`})];case po:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case mo:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Bn:return"symbol";case In:case $r:case Fr:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case ds:case ho:case go:return[i.scale.minOpacity,i.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function P0e(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&V(n)?n.length+1:(B(zue(i)),3)}}function I0e(e,t,n){const i=()=>{const r=ms(t),s=ms(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return te(t)?new Wn(i):{signal:i()}}function d4(e,t,n){if(t)return te(t)?{signal:`${t.signal} ? 0 : ${d4(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(Fp("size",e))}const h4=.95;function B0e(e,t,n,i){const r={x:f4(n,"x"),y:f4(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=g4(t,r,i.view);return ft(s)?s-1:new Wn(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=g4(t,r,i.view);return ft(s)?Math.pow(h4*s,2):new Wn(()=>`pow(${h4} * ${s.signal}, 2)`)}}throw new Error(Fp("size",e))}function g4(e,t,n){const i=Lr(e.width)?e.width.step:em(n,"width"),r=Lr(e.height)?e.height.step:em(n,"height");return t.x||t.y?new Wn(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function p4(e,t){ht(e)?z0e(e,t):v4(e,t)}function z0e(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of P(n)){const u=o[a],l=n[a],c=e.getScaleComponent(a),f=Et(r[a]),d=u[t],h=c.get("type"),g=c.get("padding"),p=c.get("paddingInner"),m=IE(h,t),y=eR(a,t);if(d!==void 0&&(m?y&&B(y):B(P6(h,t,a))),m&&y===void 0)if(d!==void 0){const v=f.timeUnit,b=f.type;switch(t){case"domainMax":case"domainMin":Ra(u[t])||b==="temporal"||v?l.set(t,{signal:Yp(u[t],{type:b,timeUnit:v})},!0):l.set(t,u[t],!0);break;default:l.copyKeyFromObject(t,u)}}else{const v=t in m4?m4[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:h,scalePadding:g,scalePaddingInner:p,domain:u.domain,markDef:s,config:i}):i.scale[t];v!==void 0&&l.set(t,v,!1)}}}const m4={bins:({model:e,fieldOrDatumDef:t})=>W(t)?U0e(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>q0e(e,t.type),nice:({scaleType:e,channel:t,domain:n,fieldOrDatumDef:i})=>W0e(e,t,n,i),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>G0e(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:i})=>H0e(e,t,n.type,i.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:i,scalePaddingInner:r,config:s})=>Y0e(e,t,n,i.type,r,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=W(e)?e.sort:void 0;return V0e(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r})=>X0e(e,t,n,i,r)};function y4(e){ht(e)?N0e(e):v4(e,"range")}function v4(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?y4(i):p4(i,t);for(const i of P(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=Co(r,a,t,"scale",Fj((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function U0e(e,t){const n=t.bin;if(We(n)){const i=Q_(e,t.field,n);return new Wn(()=>e.getSignalName(i))}else if(wn(n)&&Ta(n)&&n.step!==void 0)return{step:n.step}}function q0e(e,t){if(pe([In,$r,Fr],e)&&t!=="nominal")return"hcl"}function W0e(e,t,n,i){var r;if(!(((r=jr(i))===null||r===void 0?void 0:r.bin)||V(n)||pe([wt.TIME,wt.UTC],e)))return t in vo?!0:void 0}function G0e(e,t,n,i,r,s){if(e in vo){if(Vi(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(W(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===wt.POINT)return n.pointPadding}}function H0e(e,t,n,i){if(e===void 0&&t in vo){const{bandPaddingInner:r,barBandPaddingInner:s,rectBandPaddingInner:o}=i;return dt(r,n==="bar"?s:o)}}function Y0e(e,t,n,i,r,s){if(e===void 0&&t in vo&&n===wt.BAND){const{bandPaddingOuter:o}=s;return dt(o,te(r)?{signal:`${r.signal}/2`}:r/2)}}function V0e(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return ii(e)&&t==="descending"?te(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(ii(e)&&t==="descending")return!0}function X0e(e,t,n,i,r){if(!!n&&n!=="unaggregated"&&ii(r)){if(V(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!ud(r))return!0;if(!(W(t)&&t.bin)&&pe([...kr,...wae],e)){const{orient:o,type:a}=i;return!(pe(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function K0e(e,t,n,i){const r=J0e(t,n,i),{type:s}=e;return bo(t)?s!==void 0?Dle(t,s)?W(n)&&!kle(s,n.type)?(B(Oue(s,r)),r):s:(B(Aue(t,s,r)),r):r:null}function J0e(e,t,n){var i;switch(t.type){case"nominal":case"ordinal":{if(pl(e)||mE(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&B(_E(e,"ordinal")),"ordinal";if(e in vo){if(pe(["rect","bar","image","rule"],n.type))return"band"}else if(n.type==="arc"&&e in pE)return"band";const r=n[xi(e)];return bl(r)||QE(t)&&((i=t.axis)===null||i===void 0?void 0:i.tickBand)?"band":"point"}case"temporal":return pl(e)?"time":mE(e)==="discrete"?(B(_E(e,"temporal")),"ordinal"):W(t)&&t.timeUnit&&En(t.timeUnit).utc?"utc":"time";case"quantitative":return pl(e)?W(t)&&We(t.bin)?"bin-ordinal":"linear":mE(e)==="discrete"?(B(_E(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(j6(t.type))}function Q0e(e,{ignoreRange:t}={}){b4(e),s4(e);for(const n of Fle)p4(e,n);t||y4(e)}function b4(e){ht(e)?e.component.scales=Z0e(e):e.component.scales=tpe(e)}function Z0e(e){const{encoding:t,mark:n,markDef:i}=e;return Sp.reduce((r,s)=>{const o=Et(t[s]);if(o&&n===iR&&s===Bn&&o.type===vl)return r;let a=o&&o.scale;if(o&&a!==null&&a!==!1){a!=null||(a={});const u=K0e(a,s,o,i);r[s]=new l4(e.scaleName(`${s}`,!0),{value:u,explicit:a.type===u})}return r},{})}const epe=Fj((e,t)=>J6(e)-J6(t));function tpe(e){var t,n;const i=e.component.scales={},r={},s=e.component.resolve;for(const o of e.children){b4(o);for(const a of P(o.component.scales))if((t=(n=s.scale)[a])!==null&&t!==void 0||(n[a]=I8(a,e)),s.scale[a]==="shared"){const u=r[a],l=o.component.scales[a].getWithExplicit("type");u?fle(u.value,l.value)?r[a]=Co(u,l,"type","scale",epe):(s.scale[a]="independent",delete r[a]):r[a]=l}}for(const o of P(r)){const a=e.scaleName(o,!0),u=r[o];i[o]=new l4(a,u);for(const l of e.children){const c=l.component.scales[o];c&&(l.renameScale(c.get("name"),a),c.merged=!0)}}return i}var lA=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class cA{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function ht(e){return(e==null?void 0:e.type)==="unit"}function Zi(e){return(e==null?void 0:e.type)==="facet"}function fA(e){return(e==null?void 0:e.type)==="concat"}function jl(e){return(e==null?void 0:e.type)==="layer"}class dA{constructor(t,n,i,r,s,o,a){var u,l;this.type=n,this.parent=i,this.config=s,this.correctDataNames=c=>{var f,d,h;return((f=c.from)===null||f===void 0?void 0:f.data)&&(c.from.data=this.lookupDataSource(c.from.data)),((h=(d=c.from)===null||d===void 0?void 0:d.facet)===null||h===void 0?void 0:h.data)&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c},this.parent=i,this.config=s,this.view=zn(a),this.name=(u=t.name)!==null&&u!==void 0?u:r,this.title=wo(t.title)?{text:t.title}:t.title?zn(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new cA,this.projectionNameMap=i?i.projectionNameMap:new cA,this.signalNameMap=i?i.signalNameMap:new cA,this.data=t.data,this.description=t.description,this.transforms=Bfe((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:Hce(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Ip(t)||i&&i.component.data.isFaceted&&t.data===void 0},layoutSize:new bs,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?fe(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){Q0e(this)}parseProjection(){Q8(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Y8(this)}assembleEncodeFromView(t){const n=lA(t,["style"]),i={};for(const r of P(n)){const s=n[r];s!==void 0&&(i[r]=Ke(s))}return i}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=Ke(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n!=null?n:{}):Pe(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,i=lA(t,["spacing"]),{component:r,config:s}=this,o=bge(r.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),i),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of bi)t[i].title&&n.push(hge(this,i));for(const i of H_)n=n.concat(gge(this,i));return n}assembleAxes(){return tge(this.component.axes,this.config)}assembleLegends(){return X8(this)}assembleProjections(){return qge(this)}assembleTitle(){var t,n,i;const r=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=r,o=lA(r,["encoding"]),a=Object.assign(Object.assign(Object.assign({},v6(this.config.title).nonMarkTitleProperties),o),s?{encode:{update:s}}:{});if(a.text)return pe(["unit","layer"],this.type)?pe(["middle",void 0],a.anchor)&&((n=a.frame)!==null&&n!==void 0||(a.frame="group")):(i=a.anchor)!==null&&i!==void 0||(a.anchor="start"),Pe(a)?void 0:a}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Zi(this.parent)?a4(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return Xe((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(Ge[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Zi(this.parent)){const n=L8(t),i=Op(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(Zt(s)&&Eo(o)){const a=r.get("name"),u=Em(this,i),l=uA(u);if(l){const c=q({aggregate:"distinct",field:l},{expr:"datum"});return{signal:j8(a,r,c)}}else return B(wE(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(c6(t)&&bo(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Gae(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(i=>i.hasOrientSignalRef()))}}class x4 extends dA{vgField(t,n={}){const i=this.fieldDef(t);if(!!i)return q(i,n)}reduceFieldDef(t,n){return xce(this.getMapping(),(i,r,s)=>{const o=jr(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){i_(this.getMapping(),(i,r)=>{const s=jr(i);s&&t(s,r)},n)}}var npe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class _m extends Ie{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=fe(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new _m(null,fe(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${xe(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,i=npe(t,["density"]);return Object.assign({type:"kde",field:n},i)}}class Dd extends Ie{constructor(t,n){super(t);this.filter=n}clone(){return new Dd(null,Object.assign({},this.filter))}static make(t,n){const{config:i,mark:r,markDef:s}=n;if(Ne("invalid",s,i)!=="filter")return null;const a=n.reduceFieldDef((u,l,c)=>{const f=bo(c)&&n.getScaleComponent(c);if(f){const d=f.get("type");ii(d)&&l.aggregate!=="count"&&!_o(r)&&(u[l.field]=l)}return u},{});return P(a).length?new Dd(t,a):null}dependentFields(){return new Set(P(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${xe(this.filter)}`}assemble(){const t=P(this.filter).reduce((n,i)=>{const r=this.filter[i],s=q(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Am extends Ie{constructor(t,n){super(t);this.transform=n,this.transform=fe(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!==null&&a!==void 0?a:s})}clone(){return new Am(this.parent,fe(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${xe(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class Om extends Ie{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=fe(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new Om(null,fe(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${xe(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Ll extends Ie{constructor(t,n,i,r){super(t);this.fields=n,this.geojson=i,this.signal=r}clone(){return new Ll(null,fe(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[Cr,Sr],[vi,Yi]]){const s=r.map(o=>{const a=Et(n.encoding[o]);return W(a)?a.field:Ao(a)?{expr:`${a.datum}`}:Xi(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new Ll(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(Bn)){const r=n.typedFieldDef(Bn);r.type===vl&&(t=new Ll(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(ce);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${xe(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class Md extends Ie{constructor(t,n,i,r){super(t);this.projection=n,this.fields=i,this.as=r}clone(){return new Md(null,this.projection,fe(this.fields),fe(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[Cr,Sr],[vi,Yi]]){const r=i.map(o=>{const a=Et(n.encoding[o]);return W(a)?a.field:Ao(a)?{expr:`${a.datum}`}:Xi(a)?{expr:`${a.value}`}:void 0}),s=i[0]===vi?"2":"";(r[0]||r[1])&&(t=new Md(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(ce))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${xe(this.fields)} ${xe(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Va extends Ie{constructor(t,n){super(t);this.transform=n}clone(){return new Va(null,fe(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new Va(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(W(r)&&W(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:u,value:l,frame:c,keyvals:f}=o.impute,d=PR(n.mark,i);return new Va(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},u?{method:u}:{}),l!==void 0?{value:l}:{}),c?{frame:c}:{}),f!==void 0?{keyvals:f}:{}),d.length?{groupby:d}:{}))}return null}hash(){return`Impute ${xe(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,u=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},i?{keyvals:Efe(i)?this.processSequence(i):i}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!r||r==="value"?o:null});if(r&&r!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}var ipe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Sm extends Ie{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=fe(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new Sm(null,fe(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${xe(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:i}=t,r=ipe(t,["loess","on"]);return Object.assign({type:"loess",x:i,y:n},r)}}class Td extends Ie{constructor(t,n,i){super(t);this.transform=n,this.secondary=i}clone(){return new Td(null,fe(this.transform),this.secondary)}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(_fe(o)){let u=A4(o.data,s);u||(u=new Ga(o.data),s.push(u));const l=n.getName(`lookup_${r}`);a=new An(u,l,Ge.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(Afe(o)){const u=o.param;i=Object.assign({as:u},i);let l;try{l=n.getSelectionComponent(Xe(u),u)}catch{throw new Error(Vae(u))}if(a=l.materialized,!a)throw new Error(Xae(u))}return new Td(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?rt(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${xe({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:rt(this.transform.as)}:{});else{let n=this.transform.as;ce(n)||(B(iue),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var rpe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class Cm extends Ie{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=fe(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new Cm(null,fe(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${xe(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,i=rpe(t,["quantile"]);return Object.assign({type:"quantile",field:n},i)}}var spe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};class $m extends Ie{constructor(t,n){var i,r,s;super(t);this.transform=n,this.transform=fe(n);const o=(i=this.transform.as)!==null&&i!==void 0?i:[void 0,void 0];this.transform.as=[(r=o[0])!==null&&r!==void 0?r:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new $m(null,fe(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${xe(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:i}=t,r=spe(t,["regression","on"]);return Object.assign({type:"regression",x:i,y:n},r)}}class Fm extends Ie{constructor(t,n){super(t);this.transform=n}clone(){return new Fm(null,fe(this.transform))}addDimensions(t){var n;this.transform.groupby=_r(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),i=>i)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${xe(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},r!==void 0?{limit:r}:{}),s!==void 0?{op:s}:{}),i!==void 0?{groupby:i}:{})}}class km extends Ie{constructor(t,n){super(t);this.transform=n}clone(){return new km(null,fe(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${xe(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function w4(e){let t=0;function n(i,r){var s;if(i instanceof Ga&&!i.isGenerator&&!Al(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof rn&&(i.parent instanceof Ga&&!r.source?(r.format=Object.assign(Object.assign({},(s=r.format)!==null&&s!==void 0?s:{}),{parse:i.assembleFormatParse()}),r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Nl){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}switch((i instanceof $d||i instanceof Fd||i instanceof Dd||i instanceof kl||i instanceof Dl||i instanceof Md||i instanceof Ji||i instanceof Td||i instanceof Rl||i instanceof Ya||i instanceof Om||i instanceof Am||i instanceof _m||i instanceof Sm||i instanceof Cm||i instanceof $m||i instanceof To||i instanceof km||i instanceof Fm)&&r.transform.push(i.assemble()),(i instanceof Br||i instanceof Pr||i instanceof Va||i instanceof Es||i instanceof Ll)&&r.transform.push(...i.assemble()),i instanceof An&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof An?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof An&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children)n(a,{name:null,source:o,transform:[]});break}}}return n}function ope(e){const t=[],n=w4(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function ape(e,t){var n,i;const r=[],s=w4(r);let o=0;for(const u of e.sources){u.hasName()||(u.dataName=`source_${o++}`);const l=u.assemble();s(u,l)}for(const u of r)u.transform.length===0&&delete u.transform;let a=0;for(const[u,l]of r.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&r.splice(a++,0,r.splice(u,1)[0]);for(const u of r)for(const l of(i=u.transform)!==null&&i!==void 0?i:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const u of r)u.name in t&&(u.values=t[u.name]);return r}function upe(e){return e==="top"||e==="left"||te(e)?"header":"footer"}function lpe(e){for(const t of bi)cpe(e,t);_4(e,"x"),_4(e,"y")}function cpe(e,t){var n;const{facet:i,config:r,child:s,component:o}=e;if(e.channelHasField(t)){const a=i[t],u=Tl("title",null,r,t);let l=xl(a,r,{allowDisabling:!0,includeDefault:u===void 0||!!u});s.component.layoutHeaders[t].title&&(l=V(l)?l.join(", "):l,l+=` / ${s.component.layoutHeaders[t].title}`,s.component.layoutHeaders[t].title=null);const c=Tl("labelOrient",a.header,r,t),f=a.header!==null?dt((n=a.header)===null||n===void 0?void 0:n.labels,r.header.labels,!0):!1,d=pe(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[E4(e,t,f)]}}}function E4(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function _4(e,t){var n;const{child:i}=e;if(i.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=K_(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const u of i.component.axes[t]){const l=upe(u.get("orient"));(n=a[l])!==null&&n!==void 0||(a[l]=[E4(e,o,!1)]);const c=Cd(u,"main",e.config,{header:!0});c&&a[l][0].axes.push(c),u.mainExtracted=!0}}}}function fpe(e){hA(e),Dm(e,"width"),Dm(e,"height")}function dpe(e){hA(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Dm(e,t),Dm(e,n)}function hA(e){for(const t of e.children)t.parseLayoutSize()}function Dm(e,t){var n;const i=L8(t),r=Op(i),s=e.component.resolve,o=e.component.layoutSize;let a;for(const u of e.children){const l=u.component.layoutSize.getWithExplicit(i),c=(n=s.scale[r])!==null&&n!==void 0?n:I8(r,e);if(c==="independent"&&l.value==="step"){a=void 0;break}if(a){if(c==="independent"&&a.value!==l.value){a=void 0;break}a=Co(a,l,i,"")}else a=l}if(a){for(const u of e.children)e.renameSignal(u.getName(i),e.getName(t)),u.component.layoutSize.set(i,"merged",!1);o.setWithExplicit(t,a)}else o.setWithExplicit(t,{explicit:!1,value:void 0})}function hpe(e){const{size:t,component:n}=e;for(const i of kr){const r=xi(i);if(t[r]){const s=t[r];n.layoutSize.set(r,Lr(s)?"step":s,!0)}else{const s=gpe(e,r);n.layoutSize.set(r,s,!1)}}}function gpe(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(Zt(s)){const a=gd(i.view,t);return Eo(o)||Lr(a)?"step":a}else return p_(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return p_(i.view,t);{const s=gd(i.view,t);return Lr(s)?s.step:s}}}function gA(e,t,n){return q(t,Object.assign({suffix:`by_${q(e)}`},n!=null?n:{}))}class Nd extends x4{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve);this.child=bA(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!cd(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=P(t),i={};for(const r of n){if(![as,us].includes(r)){B(Fp(r,"facet"));break}const s=t[r];if(s.field===void 0){B(EE(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=t_(t,n);return i.header?i.header=zn(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Mm(this),this.child.parseData()}parseLayoutSize(){hA(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),lpe(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,i;const r={};for(const s of bi)for(const o of Y_){const a=this.component.layoutHeaders[s],u=a[o],{facetFieldDef:l}=a;if(l){const c=Tl("titleOrient",l.header,this.config,s);if(["right","bottom"].includes(c)){const f=vm(s,c);(t=r.titleAnchor)!==null&&t!==void 0||(r.titleAnchor={}),r.titleAnchor[f]="end"}}if(u==null?void 0:u[0]){const c=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(c)&&((n=r[f])!==null&&n!==void 0||(r[f]={}),r[f][s]=.5),a.title&&((i=r.offset)!==null&&i!==void 0||(r.offset={}),r.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),i?{columns:i}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Nd))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof Nd?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:q(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof Nd){if(this.child.channelHasField("column")){const r=q(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of kr){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(Zt(o)&&Eo(a)){const u=Em(this.child,r),l=uA(u);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):B(wE(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const c of bi){const f=this.facet[c];if(f){u.push(q(f));const{bin:d,sort:h}=f;if(We(d)&&u.push(q(f,{binSuffix:"end"})),Nr(h)){const{field:g,op:p=Pp}=h,m=gA(f,h);i&&r?(s.push(m),o.push("max"),a.push(m)):(s.push(g),o.push(p),a.push(m))}else if(V(h)){const g=Ml(f,c);s.push(g),o.push("max"),a.push(g)}}}const l=!!i&&!!r;return Object.assign({name:t,data:n,groupby:u},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,i=n[t];return i?Nr(i.sort)?[gA(i,i.sort,{expr:"datum"})]:V(i.sort)?[Ml(i,t,{expr:"datum"})]:[q(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(Nr(r)?r.order:!V(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var t;const{facet:n,config:i}=this;if(n.facet)return V_(n.facet,"facet",i);const r={row:["top","bottom"],column:["left","right"]};for(const s of H_)if(n[s]){const o=Tl("labelOrient",(t=n[s])===null||t===void 0?void 0:t.header,i,s);if(r[s].includes(o))return V_(n[s],s,i)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=ope(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:bi.map(u=>this.facetSortFields(u)).flat(),order:bi.map(u=>this.facetSortOrder(u)).flat()}}),i.length>0?{data:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup(lde(this,[])))]}getMapping(){return this.facet}}function ppe(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(Nr(s.sort)){const{field:o,op:a=Pp}=s.sort;e=r=new Ya(e,{joinaggregate:[{op:a,field:o,as:gA(s,s.sort,{forAs:!0})}],groupby:[q(s)]})}return r}return null}function A4(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const u=(n=e.format)===null||n===void 0?void 0:n.mesh,l=(i=a.format)===null||i===void 0?void 0:i.feature;if(u&&l)continue;const c=(r=e.format)===null||r===void 0?void 0:r.feature;if((c||l)&&c!==l)continue;const f=(s=a.format)===null||s===void 0?void 0:s.mesh;if(!((u||f)&&u!==f)){if(pd(e)&&pd(a)){if(Er(e.values,a.values))return o}else if(Al(e)&&Al(a)){if(e.url===a.url)return o}else if(kj(e)&&e.name===o.dataName)return o}}return null}function mpe(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Ga({values:[]});return t.push(i),i}const n=A4(e.data,t);if(n)return $o(e.data)||(n.data.format=ZN({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Ga(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function ype(e,t,n){var i,r;let s=0;for(const o of t.transforms){let a,u;if(Nfe(o))u=e=new Dl(e,o),a="derived";else if(x_(o)){const l=i0e(o);u=e=(i=rn.makeWithAncestors(e,{},l,n))!==null&&i!==void 0?i:e,e=new kl(e,t,o.filter)}else if(wj(o))u=e=Br.makeFromTransform(e,o,t),a="number";else if(jfe(o))a="date",n.getWithExplicit(o.field).value===void 0&&(e=new rn(e,{[o.field]:a}),n.set(o.field,a,!1)),u=e=Pr.makeFromTransform(e,o);else if(Lfe(o))u=e=Ji.makeFromTransform(e,o),a="number",T_(t)&&(e=new To(e));else if(xj(o))u=e=Td.make(e,t,o,s++),a="derived";else if(Dfe(o))u=e=new Rl(e,o),a="number";else if(Mfe(o))u=e=new Ya(e,o),a="number";else if(Pfe(o))u=e=Es.makeFromTransform(e,o),a="derived";else if(Ife(o))u=e=new Om(e,o),a="derived";else if(Tfe(o))u=e=new Am(e,o),a="derived";else if(Ofe(o))u=e=new Fm(e,o),a="derived";else if(kfe(o))e=new km(e,o);else if(Rfe(o))u=e=Va.makeFromTransform(e,o),a="derived";else if(Sfe(o))u=e=new _m(e,o),a="derived";else if(Cfe(o))u=e=new Cm(e,o),a="derived";else if($fe(o))u=e=new $m(e,o),a="derived";else if(Ffe(o))u=e=new Sm(e,o),a="derived";else{B(nue(o));continue}if(u&&a!==void 0)for(const l of(r=u.producedFields())!==null&&r!==void 0?r:[])n.set(l,a,!1)}return e}function Mm(e){var t,n,i,r,s,o,a,u,l,c;let f=mpe(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,g=e.data,m=!(g&&($o(g)||Al(g)||pd(g)))&&e.parent?e.parent.component.data.ancestorParse.clone():new Kfe;$o(g)?(Dj(g)?f=new Fd(f,g.sequence):__(g)&&(f=new $d(f,g.graticule)),m.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(m.parseNothing=!0),f=(n=rn.makeExplicit(f,e,m))!==null&&n!==void 0?n:f,f=new To(f);const y=e.parent&&jl(e.parent);(ht(e)||Zi(e))&&y&&(f=(i=Br.makeFromEncoding(f,e))!==null&&i!==void 0?i:f),e.transforms.length>0&&(f=ype(f,e,m));const v=s0e(e),b=r0e(e);f=(r=rn.makeWithAncestors(f,{},Object.assign(Object.assign({},v),b),m))!==null&&r!==void 0?r:f,ht(e)&&(f=Ll.parseAll(f,e),f=Md.parseAll(f,e)),(ht(e)||Zi(e))&&(y||(f=(s=Br.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Pr.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=Dl.parseAllForSortIndex(f,e));const x=e.getDataName(Ge.Raw),E=new An(f,x,Ge.Raw,h);if(d[x]=E,f=E,ht(e)){const S=Ji.makeFromEncoding(f,e);S&&(f=S,T_(e)&&(f=new To(f))),f=(a=Va.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(u=Es.makeFromEncoding(f,e))!==null&&u!==void 0?u:f}ht(e)&&(f=(l=Dd.make(f,e))!==null&&l!==void 0?l:f);const _=e.getDataName(Ge.Main),w=new An(f,_,Ge.Main,h);d[_]=w,f=w,ht(e)&&Zhe(e,w);let A=null;if(Zi(e)){const S=e.getName("facet");f=(c=ppe(f,e.facet))!==null&&c!==void 0?c:f,A=new Nl(f,e,S,w.getSource()),d[S]=A}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:E,main:w,facetRoot:A,ancestorParse:m})}class vpe extends dA{constructor(t,n,i,r){var s,o,a,u;super(t,"concat",n,i,r,t.resolve);(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((u=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||u===void 0?void 0:u.y)==="shared")&&B(Zae),this.children=this.getChildren(t).map((l,c)=>bA(l,this,this.getName(`concat_${c}`),void 0,r))}parseData(){this.component.data=Mm(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of P(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return Zp(t)?t.vconcat:g_(t)?t.hconcat:t.concat}parseLayoutSize(){dpe(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=X_(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),i?{style:i}:{}),r?{encode:{update:r}}:{}),t.assembleGroup())})}assembleGroupStyle(){}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function bpe(e){return e===!1||e===null}const xpe=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},NR),{labelExpr:1,encode:1}),O4=P(xpe);class pA extends bs{constructor(t={},n={},i=!1){super();this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new pA(fe(this.explicit),fe(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!bpe(this.get(t))}hasOrientSignalRef(){return te(this.explicit.orient)}}function wpe(e,t,n){var i;const{encoding:r,config:s}=e,o=(i=Et(r[t]))!==null&&i!==void 0?i:Et(r[hs(t)]),a=e.axis(t)||{},{format:u,formatType:l}=a;return Pa(l)?Object.assign({text:HE({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:l,config:s})},n):n}function Epe(e){return kr.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[Fpe(n,e)]),t),{})}const _pe={bottom:"top",top:"bottom",left:"right",right:"left"};function Ape(e){var t;const{axes:n,resolve:i}=e.component,r={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of P(s.component.axes))i.axis[o]=K_(e.component.resolve,o),i.axis[o]==="shared"&&(n[o]=Ope(n[o],s.component.axes[o]),n[o]||(i.axis[o]="independent",delete n[o]))}for(const s of kr){for(const o of e.children)if(!!o.component.axes[s]){if(i.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:u,explicit:l}=a.getWithExplicit("orient");if(!te(u)){if(r[u]>0&&!l){const c=_pe[u];r[u]>r[c]&&a.set("orient",c,!1)}r[u]++}}}delete o.component.axes[s]}if(i.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])!!o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function Ope(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!=!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=Spe(r,s)}}}else return t.map(n=>n.clone());return e}function Spe(e,t){for(const n of O4){const i=Co(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return C6(r,s);case"gridScale":return{explicit:r.explicit,value:dt(r.value,s.value)}}return nm(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function Cpe(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(te(n.labelAngle)?n.labelAngle:ed(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===D8(i,r))return!0}return e===n[t]}const $pe=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Fpe(e,t){var n,i,r;let s=t.axis(e);const o=new pA,a=Et(t.encoding[e]),{mark:u,config:l}=t,c=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=l.axis)===null||i===void 0?void 0:i.orient)||lge(e),f=t.getScaleComponent(e).get("type"),d=nge(e,f,c,t.config),h=s!==void 0?!s:W_("disable",l.style,s==null?void 0:s.style,d).configValue;if(o.set("disable",h,s!==void 0),h)return o;s=s||{};const g=oge(a,s,e,l.style,d),p={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:c,labelAngle:g,mark:u,config:l};for(const v of O4){const b=v in $8?$8[v](p):RR(v)?s[v]:void 0,x=b!==void 0,E=Cpe(b,v,s,t,e);if(x&&E)o.set(v,b,E);else{const{configValue:_=void 0,configFrom:w=void 0}=RR(v)&&v!=="values"?W_(v,l.style,s.style,d):{},A=_!==void 0;x&&!A?o.set(v,b,E):(w!=="vgAxisConfig"||$pe.has(v)&&A||dd(_)||te(_))&&o.set(v,_,!1)}}const m=(r=s.encoding)!==null&&r!==void 0?r:{},y=TR.reduce((v,b)=>{var x;if(!o.hasAxisPart(b))return v;const E=P8((x=m[b])!==null&&x!==void 0?x:{},t),_=b==="labels"?wpe(t,e,E):E;return _!==void 0&&!Pe(_)&&(v[b]={update:_}),v},{});return Pe(y)||o.set("encode",y,!!s.encoding||s.labelAngle!==void 0),o}function kpe({encoding:e,size:t}){for(const n of kr){const i=xi(n);Lr(t[i])&&Rr(e[n])&&(delete t[i],B(I6(i)))}return t}function Dpe(e,t,n){const i=zn(e),r=Ne("orient",i,n);if(i.orient=Rpe(i.type,t,r),r!==void 0&&r!==i.orient&&B(yue(i.orient,r)),i.type==="bar"&&i.orient){const a=Ne("cornerRadiusEnd",i,n);if(a!==void 0){const u=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Ule[i.orient];for(const l of u)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Ne("opacity",i,n)===void 0&&(i.opacity=Tpe(i.type,t)),Ne("cursor",i,n)===void 0&&(i.cursor=Mpe(i,t,n)),i}function Mpe(e,t,n){return t.href||e.href||Ne("href",e,n)?"pointer":e.cursor}function Tpe(e,t){if(pe([Np,BE,zE,UE],e)&&!n_(t))return .7}function Npe(e,t,{graticule:n}){if(n)return!1;const i=Na("filled",e,t),r=e.type;return dt(i,r!==Np&&r!==Tp&&r!==Rp)}function Rpe(e,t,n){switch(e){case Np:case zE:case UE:case nR:case Tle:case Mle:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case Mp:if(W(i)&&(wn(i.bin)||W(r)&&r.aggregate&&!i.aggregate))return"vertical";if(W(r)&&(wn(r.bin)||W(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(W(i)&&i.type===ja&&!We(i.bin)||JE(i)))return"horizontal";if(!o&&(W(r)&&r.type===ja&&!We(r.bin)||JE(r)))return"vertical"}case Rp:if(s&&!(W(i)&&wn(i.bin))&&o&&!(W(r)&&wn(r.bin)))return;case Dp:if(o)return W(r)&&wn(r.bin)?"horizontal":"vertical";if(s)return W(i)&&wn(i.bin)?"vertical":"horizontal";if(e===Rp){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case Tp:case BE:{const a=Rr(i),u=Rr(r);if(n)return n;if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u){const l=i,c=r,f=l.type===yl,d=c.type===yl;return f&&!d?e!=="tick"?"vertical":"horizontal":!f&&d?e!=="tick"?"horizontal":"vertical":!l.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!c.aggregate&&e!=="tick"?"horizontal":"vertical"}else return}}return"vertical"}const jpe={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),en("x",e,{defaultPos:"mid"})),en("y",e,{defaultPos:"mid"})),ko(e,"radius","arc")),ko(e,"theta","arc"))},Lpe={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),om("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),om("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),D_(e))},Ppe={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ko(e,"x","bar")),ko(e,"y","bar"))},Ipe={vgMark:"shape",encodeEntry:e=>Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&W(n)&&n.type===vl?{field:q(n,{expr:"datum"})}:{})]}},Bpe={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),ko(e,"x","image")),ko(e,"y","image")),F_(e,"url"))},zpe={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),en("x",e,{defaultPos:"mid"})),en("y",e,{defaultPos:"mid"})),kt("size",e,{vgChannel:"strokeWidth"})),D_(e))},Upe={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),en("x",e,{defaultPos:"mid"})),en("y",e,{defaultPos:"mid"})),kt("size",e)),D_(e))};function mA(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),en("x",e,{defaultPos:"mid"})),en("y",e,{defaultPos:"mid"})),kt("size",e)),kt("angle",e)),qpe(e,n,t))}function qpe(e,t,n){return n?{shape:{value:n}}:kt("shape",e)}const Wpe={vgMark:"symbol",encodeEntry:e=>mA(e)},Gpe={vgMark:"symbol",encodeEntry:e=>mA(e,"circle")},Hpe={vgMark:"symbol",encodeEntry:e=>mA(e,"square")},Ype={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),ko(e,"x","rect")),ko(e,"y","rect"))},Vpe={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),om("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),om("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),kt("size",e,{vgChannel:"strokeWidth"}))}},Xpe={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),en("x",e,{defaultPos:"mid"})),en("y",e,{defaultPos:"mid"})),F_(e)),kt("size",e,{vgChannel:"fontSize"})),kt("angle",e)),Kj("align",Kpe(e.markDef,n,t))),Kj("baseline",Jpe(e.markDef,n,t))),en("radius",e,{defaultPos:null})),en("theta",e,{defaultPos:null}))}};function Kpe(e,t,n){if(Ne("align",e,n)===void 0)return"center"}function Jpe(e,t,n){if(Ne("baseline",e,n)===void 0)return"middle"}const Qpe={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ei(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),en("x",e,{defaultPos:"mid",vgChannel:"xc"})),en("y",e,{defaultPos:"mid",vgChannel:"yc"})),kt("size",e,{defaultValue:Zpe(e),vgChannel:r})),{[s]:Ke(Ne("thickness",n,t))})}};function Zpe(e){var t;const{config:n,markDef:i}=e,{orient:r}=i,s=r==="horizontal"?"width":"height",o=e.getScaleComponent(r==="horizontal"?"x":"y"),a=(t=Ne("size",i,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const u=o?o.get("range"):void 0;return u&&Eo(u)&&ft(u.step)?u.step*3/4:em(n.view,s)*3/4}}const Tm={arc:jpe,area:Lpe,bar:Ppe,circle:Gpe,geoshape:Ipe,image:Bpe,line:zpe,point:Wpe,rect:Ype,rule:Vpe,square:Hpe,text:Xpe,tick:Qpe,trail:Upe};function eme(e){if(pe([Tp,Dp,Nle],e.mark)){const t=PR(e.mark,e.encoding);if(t.length>0)return tme(e,t)}else if(e.mark===Mp){const t=vE.some(n=>Ne(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return nme(e)}return yA(e)}const S4="faceted_path_";function tme(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:S4+e.requestDataName(Ge.Main),data:e.requestDataName(Ge.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:yA(e,{fromPrefix:S4})}]}const C4="stack_group_";function nme(e){const[t]=yA(e,{fromPrefix:C4}),n=e.scaleName(e.stack.fieldChannel),i=(l={})=>e.vgField(e.stack.fieldChannel,l),r=(l,c)=>{const f=[i({prefix:"min",suffix:"start",expr:c}),i({prefix:"max",suffix:"start",expr:c}),i({prefix:"min",suffix:"end",expr:c}),i({prefix:"max",suffix:"end",expr:c})];return`${l}(${f.map(d=>`scale('${n}',${d})`).join(",")})`};let s,o;e.stack.fieldChannel==="x"?(s=Object.assign(Object.assign({},dl(t.encode.update,["y","yc","y2","height",...vE])),{x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},ti(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(s=Object.assign(Object.assign({},dl(t.encode.update,["x","xc","x2","width"])),{y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},ti(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const l of vE){const c=Na(l,e.markDef,e.config);t.encode.update[l]?(s[l]=t.encode.update[l],delete t.encode.update[l]):c&&(s[l]=Ke(c)),c&&(t.encode.update[l]={value:0})}const a=[];if(e.stack.groupbyChannel){const l=e.fieldDef(e.stack.groupbyChannel),c=q(l);c&&a.push(c),((l==null?void 0:l.bin)||(l==null?void 0:l.timeUnit))&&a.push(q(l,{binSuffix:"end"}))}return s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((l,c)=>{if(t.encode.update[c])return Object.assign(Object.assign({},l),{[c]:t.encode.update[c]});{const f=Na(c,e.markDef,e.config);return f!==void 0?Object.assign(Object.assign({},l),{[c]:Ke(f)}):l}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(Ge.Main),name:C4+e.requestDataName(Ge.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function ime(e){var t;const{encoding:n,stack:i,mark:r,markDef:s,config:o}=e,a=n.order;if(!(!V(a)&&Xi(a)&&sE(a.value)||!a&&sE(Ne("order",s,o)))){if((V(a)||W(a))&&!i)return A6(a,{expr:"datum"});if(_o(r)){const u=s.orient==="horizontal"?"y":"x",l=n[u];if(W(l)){const c=l.sort;if(V(c))return{field:q(l,{prefix:u,suffix:"sort_index",expr:"datum"})};if(Nr(c))return{field:q({aggregate:n_(e.encoding)?c.op:void 0,field:c.field},{expr:"datum"})};if(bR(c)){const f=e.fieldDef(c.encoding);return{field:q(f,{expr:"datum"}),order:c.order}}else return c===null?void 0:{field:q(l,{binSuffix:((t=e.stack)===null||t===void 0?void 0:t.impute)?"mid":void 0,expr:"datum"})}}return}}}function yA(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=dt(i.clip,rme(e),sme(e)),a=E6(i),u=r.key,l=ime(e),c=ome(e),f=Ne("aria",i,s),d=Tm[n].postEncodingTransform?Tm[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:Tm[n].vgMark},o?{clip:!0}:{}),a?{style:a}:{}),u?{key:u.field}:{}),l?{sort:l}:{}),c||{}),f===!1?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(Ge.Main)},encode:{update:Tm[n].encodeEntry(e)}}),d?{transform:d}:{})]}function rme(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function sme(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function ome(e){if(!e.component.selection)return null;const t=P(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=P(i.component.selection).length,i=i.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}class $4 extends x4{constructor(t,n,i,r={},s){var o;super(t,"unit",n,i,s,void 0,ij(t)?t.view:void 0);this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const a=Tr(t.mark)?Object.assign({},t.mark):{type:t.mark},u=a.type;a.filled===void 0&&(a.filled=Npe(a,s,{graticule:t.data&&__(t.data)}));const l=this.encoding=vce(t.encoding||{},u,a.filled,s);this.markDef=Dpe(a,l,s),this.size=kpe({encoding:l,size:ij(t)?Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):r}),this.stack=fj(u,l),this.specifiedScales=this.initScales(u,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=((o=t.params)!==null&&o!==void 0?o:[]).filter(c=>d_(c))}get hasProjection(){const{encoding:t}=this,n=this.mark===iR,i=t&&hae.some(r=>le(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Sp.reduce((i,r)=>{var s;const o=Et(n[r]);return o&&(i[r]=this.initScale((s=o.scale)!==null&&s!==void 0?s:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=zn(t);return V(n)&&(r.domain=n.map(ni)),V(i)&&(r.range=i.map(ni)),r}initAxes(t){return kr.reduce((n,i)=>{const r=t[i];if(le(r)||i===Qe&&le(t.x2)||i===xt&&le(t.y2)){const s=le(r)?r.axis:void 0;n[i]=s&&this.initAxis(Object.assign({},s))}return n},{})}initAxis(t){const n=P(t),i={};for(const r of n){const s=t[r];i[r]=dd(s)?b6(s):ni(s)}return i}initLegends(t){return Eae.reduce((n,i)=>{const r=Et(t[i]);if(r&&Aae(i)){const s=r.legend;n[i]=s&&zn(s)}return n},{})}parseData(){this.component.data=Mm(this)}parseLayoutSize(){hpe(this)}parseSelections(){this.component.selection=Qhe(this,this.selection)}parseMarkGroup(){this.component.mark=eme(this)}parseAxesAndHeaders(){this.component.axes=Epe(this)}assembleSelectionTopLevelSignals(t){return cde(this,t)}assembleSignals(){return[...S8(this),...ude(this,[])]}assembleSelectionData(t){return fde(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return X_(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!jl(this.parent))&&(n=Ij(this,n)),n.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};if(t!==void 0)return t;if(this.encoding.x||this.encoding.y)return"cell"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return Ba(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return jr(n)}typedFieldDef(t){const n=this.fieldDef(t);return wi(n)?n:null}}class vA extends dA{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},r),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,u)=>{if(tm(a))return new vA(a,this,this.getName(`layer_${u}`),o,s);if(ys(a))return new $4(a,this,this.getName(`layer_${u}`),o,s);throw new Error(xE(a))})}parseData(){this.component.data=Mm(this);for(const t of this.children)t.parseData()}parseLayoutSize(){fpe(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of P(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){Ape(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),S8(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),X_(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of rt(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return dde(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),X8(this))}}function bA(e,t,n,i,r){if(Ip(e))return new Nd(e,t,n,r);if(tm(e))return new vA(e,t,n,i,r);if(ys(e))return new $4(e,t,n,i,r);if(qce(e))return new vpe(e,t,n,r);throw new Error(xE(e))}var ame=globalThis&&globalThis.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n};function ume(e,t={}){t.logger&&Uue(t.logger),t.fieldTitle&&FR(t.fieldTitle);try{const n=lj(JN(t.config,e.config)),i=Sj(e,n),r=bA(i,null,"",void 0,n);return r.parse(),w0e(r.component.data,r),{spec:cme(r,lme(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&que(),t.fieldTitle&&uce()}}function lme(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):ce(t)&&(t={type:t}),r&&s&&Yfe(t.type)){if(r==="step"&&s==="step")B(k6()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";B(k6(Op(o)));const a=o==="width"?"height":"width";t.type=Vfe(a)}}return Object.assign(Object.assign(Object.assign({},P(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),$j(n,!1)),$j(e,!0))}function cme(e,t,n={},i){const r=e.config?rfe(e.config):void 0,s=[].concat(e.assembleSelectionData([]),ape(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter(h=>(h.name==="width"||h.name==="height")&&h.value!==void 0?(t[h.name]=+h.value,!1):!0);const{params:f}=t,d=ame(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...nj(f)])),r?{config:r}:{}),i?{usermeta:i}:{})}const fme=Woe.version;var dme=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",version:fme,compile:ume,normalize:Sj,deepEqual:Er,duplicate:fe,pick:dl,omit:ti,stringify:qe,hash:xe,isNullOrFalse:sE,contains:pe,some:hl,every:oE,mergeDeep:ZN,unique:_r,isEqual:aae,setEqual:e6,hasIntersection:aE,prefixGenerator:uE,fieldIntersection:lE,isEmpty:Pe,keys:P,vals:Qt,entries:fo,isBoolean:Jf,varName:Xe,logicalExpr:Qf,deleteNestedProperty:vp,titleCase:Zf,accessPathWithDatum:cE,flatAccessWithDatum:t6,replacePathInField:yi,replaceAll:Fa,removePathFromField:fE,accessPathDepth:gl,getFirstDefined:dt,uniqueId:i6,resetIdCounter:lae,internalField:r6,isInternalField:s6,normalizeAngle:ed,isNumeric:bp});function F4(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var hme="vega-themes",gme="2.10.0",pme="Themes for stylized Vega and Vega-Lite visualizations.",mme=["vega","vega-lite","themes","style"],yme="BSD-3-Clause",vme={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},bme=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],xme="build/vega-themes.js",wme="build/vega-themes.module.js",Eme="build/vega-themes.min.js",_me="build/vega-themes.min.js",Ame="build/vega-themes.module.d.ts",Ome={type:"git",url:"https://github.com/vega/vega-themes.git"},Sme=["src","build"],Cme={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase"},$me={"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@wessberg/rollup-plugin-ts":"^1.3.8","browser-sync":"^2.26.14",concurrently:"^6.0.0","gh-pages":"^3.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.2.2",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.16.1"},Fme={vega:"*","vega-lite":"*"},kme={name:hme,version:gme,description:pme,keywords:mme,license:yme,author:vme,contributors:bme,main:xme,module:wme,unpkg:Eme,jsdelivr:_me,types:Ame,repository:Ome,files:Sme,scripts:Cme,devDependencies:$me,peerDependencies:Fme};const Pl="#fff",Dme="#888",Mme={background:"#333",title:{color:Pl,subtitleColor:Pl},style:{"guide-label":{fill:Pl},"guide-title":{fill:Pl}},axis:{domainColor:Pl,gridColor:Dme,tickColor:Pl}},Xa="#4572a7",Tme={background:"#fff",arc:{fill:Xa},area:{fill:Xa},line:{stroke:Xa,strokeWidth:2},path:{stroke:Xa},rect:{fill:Xa},shape:{stroke:Xa},symbol:{fill:Xa,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Ka="#30a2da",xA="#cbcbcb",Nme="#999",Rme="#333",k4="#f0f0f0",D4="#333",jme={arc:{fill:Ka},area:{fill:Ka},axis:{domainColor:xA,grid:!0,gridColor:xA,gridWidth:1,labelColor:Nme,labelFontSize:10,titleColor:Rme,tickColor:xA,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:k4,group:{fill:k4},legend:{labelColor:D4,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:D4,titleFontSize:14,titlePadding:10},line:{stroke:Ka,strokeWidth:2},path:{stroke:Ka,strokeWidth:.5},rect:{fill:Ka},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Ka},bar:{binSpacing:2,fill:Ka,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Ja="#000",Lme={group:{fill:"#e5e5e5"},arc:{fill:Ja},area:{fill:Ja},line:{stroke:Ja},path:{stroke:Ja},rect:{fill:Ja},shape:{stroke:Ja},symbol:{fill:Ja,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Pme=22,Ime="normal",M4="Benton Gothic, sans-serif",T4=11.5,Bme="normal",Qa="#82c6df",wA="Benton Gothic Bold, sans-serif",N4="normal",R4=13,Rd={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},zme={background:"#ffffff",title:{anchor:"start",color:"#000000",font:wA,fontSize:Pme,fontWeight:Ime},arc:{fill:Qa},area:{fill:Qa},line:{stroke:Qa,strokeWidth:2},path:{stroke:Qa},rect:{fill:Qa},shape:{stroke:Qa},symbol:{fill:Qa,size:30},axis:{labelFont:M4,labelFontSize:T4,labelFontWeight:Bme,titleFont:wA,titleFontSize:R4,titleFontWeight:N4},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:M4,labelFontSize:T4,symbolType:"square",titleFont:wA,titleFontSize:R4,titleFontWeight:N4},range:{category:Rd["category-6"],diverging:Rd["fireandice-6"],heatmap:Rd["fire-7"],ordinal:Rd["fire-7"],ramp:Rd["fire-7"]}},Za="#ab5787",Nm="#979797",Ume={background:"#f9f9f9",arc:{fill:Za},area:{fill:Za},line:{stroke:Za},path:{stroke:Za},rect:{fill:Za},shape:{stroke:Za},symbol:{fill:Za,size:30},axis:{domainColor:Nm,domainWidth:.5,gridWidth:.2,labelColor:Nm,tickColor:Nm,tickWidth:.2,titleColor:Nm},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},eu="#3e5c69",qme={background:"#fff",arc:{fill:eu},area:{fill:eu},line:{stroke:eu},path:{stroke:eu},rect:{fill:eu},shape:{stroke:eu},symbol:{fill:eu},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},_i="#1696d2",j4="#000000",Wme="#FFFFFF",Rm="Lato",EA="Lato",Gme="Lato",Hme="#DEDDDD",Yme=18,jd={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},Vme={background:Wme,title:{anchor:"start",fontSize:Yme,font:Rm},axisX:{domain:!0,domainColor:j4,domainWidth:1,grid:!1,labelFontSize:12,labelFont:EA,labelAngle:0,tickColor:j4,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Rm},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:Hme,gridWidth:1,labelFontSize:12,labelFont:EA,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Rm,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:EA,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Rm,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:jd["six-groups-cat-1"],diverging:jd["diverging-colors"],heatmap:jd["diverging-colors"],ordinal:jd["six-groups-seq"],ramp:jd["shades-blue"]},area:{fill:_i},rect:{fill:_i},line:{color:_i,stroke:_i,strokeWidth:5},trail:{color:_i,stroke:_i,strokeWidth:0,size:1},path:{stroke:_i,strokeWidth:.5},point:{filled:!0},text:{font:Gme,color:_i,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:_i,stroke:null}},arc:{fill:_i},shape:{stroke:_i},symbol:{fill:_i,size:30}},tu="#3366CC",L4="#ccc",jm="Arial, sans-serif",Xme={arc:{fill:tu},area:{fill:tu},path:{stroke:tu},rect:{fill:tu},shape:{stroke:tu},symbol:{stroke:tu},circle:{fill:tu},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:jm,fontSize:12},"guide-title":{font:jm,fontSize:12},"group-title":{font:jm,fontSize:12}},title:{font:jm,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:L4,tickColor:L4,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},Kme=kme.version;var Jme=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",dark:Mme,excel:Tme,fivethirtyeight:jme,ggplot2:Lme,googlecharts:Xme,latimes:zme,quartz:Ume,urbaninstitute:Vme,version:Kme,vox:qme});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Qme(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Zme(e,t,n){if(K(e))return`[${e.map(i=>t(_e(i)?i:P4(i,n))).join(", ")}]`;if(ue(e)){let i="";const r=e,{title:s,image:o}=r,a=Qme(r,["title","image"]);s&&(i+=`<h2>${t(s)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const u=Object.keys(a);if(u.length>0){i+="<table>";for(const l of u){let c=a[l];c!==void 0&&(ue(c)&&(c=P4(c,n)),i+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(c)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function e1e(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function P4(e,t){return JSON.stringify(e,e1e(t))}var t1e=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const I4="vg-tooltip-element",n1e={offsetX:10,offsetY:10,id:I4,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:i1e,maxDepth:2,formatTooltip:Zme};function i1e(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function r1e(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return t1e.toString().replace(I4,e)}function s1e(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let s=e.clientY+i;return s+t.height>window.innerHeight&&(s=+e.clientY-i-t.height),{x:r,y:s}}class o1e{constructor(t){this.options=Object.assign(Object.assign({},n1e),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=r1e(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){var s;if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),((s=document.fullscreenElement)!==null&&s!==void 0?s:document.body).appendChild(this.el),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:a,y:u}=s1e(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${u}px; left: ${a}px`)}}function a1e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B4(e,t,n,i,r,s,o){try{var a=e[s](o),u=a.value}catch(l){n(l);return}a.done?t(u):Promise.resolve(u).then(i,r)}function Lm(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var s=e.apply(t,n);function o(u){B4(s,i,r,o,a,"next",u)}function a(u){B4(s,i,r,o,a,"throw",u)}o(void 0)})}}var z4=Object.prototype,nu=z4.hasOwnProperty,zr,_A=typeof Symbol=="function"?Symbol:{},Pm=_A.iterator||"@@iterator",u1e=_A.asyncIterator||"@@asyncIterator",Im=_A.toStringTag||"@@toStringTag";function U4(e,t,n,i){var r=t&&t.prototype instanceof OA?t:OA,s=Object.create(r.prototype),o=new FA(i||[]);return s._invoke=h1e(e,n,o),s}function AA(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(i){return{type:"throw",arg:i}}}var q4="suspendedStart",l1e="suspendedYield",W4="executing",Bm="completed",er={};function OA(){}function zm(){}function Il(){}var SA={};SA[Pm]=function(){return this};var CA=Object.getPrototypeOf,Um=CA&&CA(CA(kA([])));Um&&Um!==z4&&nu.call(Um,Pm)&&(SA=Um);var Bl=Il.prototype=OA.prototype=Object.create(SA);zm.prototype=Bl.constructor=Il;Il.constructor=zm;Il[Im]=zm.displayName="GeneratorFunction";function G4(e){["next","throw","return"].forEach(function(t){e[t]=function(n){return this._invoke(t,n)}})}function H4(e){var t=typeof e=="function"&&e.constructor;return t?t===zm||(t.displayName||t.name)==="GeneratorFunction":!1}function c1e(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,Il):(e.__proto__=Il,Im in e||(e[Im]="GeneratorFunction")),e.prototype=Object.create(Bl),e}function f1e(e){return{__await:e}}function qm(e,t){function n(s,o,a,u){var l=AA(e[s],e,o);if(l.type==="throw")u(l.arg);else{var c=l.arg,f=c.value;return f&&typeof f=="object"&&nu.call(f,"__await")?t.resolve(f.__await).then(function(d){n("next",d,a,u)},function(d){n("throw",d,a,u)}):t.resolve(f).then(function(d){c.value=d,a(c)},function(d){return n("throw",d,a,u)})}}var i;function r(s,o){function a(){return new t(function(u,l){n(s,o,u,l)})}return i=i?i.then(a,a):a()}this._invoke=r}G4(qm.prototype);qm.prototype[u1e]=function(){return this};function d1e(e,t,n,i,r){r===void 0&&(r=Promise);var s=new qm(U4(e,t,n,i),r);return H4(t)?s:s.next().then(function(o){return o.done?o.value:s.next()})}function h1e(e,t,n){var i=q4;return function(s,o){if(i===W4)throw new Error("Generator is already running");if(i===Bm){if(s==="throw")throw o;return V4()}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var u=Y4(a,n);if(u){if(u===er)continue;return u}}if(n.method==="next")n.sent=n._sent=n.arg;else if(n.method==="throw"){if(i===q4)throw i=Bm,n.arg;n.dispatchException(n.arg)}else n.method==="return"&&n.abrupt("return",n.arg);i=W4;var l=AA(e,t,n);if(l.type==="normal"){if(i=n.done?Bm:l1e,l.arg===er)continue;return{value:l.arg,done:n.done}}else l.type==="throw"&&(i=Bm,n.method="throw",n.arg=l.arg)}}}function Y4(e,t){var n=e.iterator[t.method];if(n===zr){if(t.delegate=null,t.method==="throw"){if(e.iterator.return&&(t.method="return",t.arg=zr,Y4(e,t),t.method==="throw"))return er;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return er}var i=AA(n,e.iterator,t.arg);if(i.type==="throw")return t.method="throw",t.arg=i.arg,t.delegate=null,er;var r=i.arg;if(!r)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,er;if(r.done)t[e.resultName]=r.value,t.next=e.nextLoc,t.method!=="return"&&(t.method="next",t.arg=zr);else return r;return t.delegate=null,er}G4(Bl);Bl[Im]="Generator";Bl[Pm]=function(){return this};Bl.toString=function(){return"[object Generator]"};function g1e(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function $A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function FA(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(g1e,this),this.reset(!0)}function p1e(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function i(){for(;t.length;){var r=t.pop();if(r in e)return i.value=r,i.done=!1,i}return i.done=!0,i}}function kA(e){if(e){var t=e[Pm];if(t)return t.call(e);if(typeof e.next=="function")return e;if(!isNaN(e.length)){var n=-1,i=function r(){for(;++n<e.length;)if(nu.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=zr,r.done=!0,r};return i.next=i}}return{next:V4}}function V4(){return{value:zr,done:!0}}FA.prototype={constructor:FA,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=zr,this.done=!1,this.delegate=null,this.method="next",this.arg=zr,this.tryEntries.forEach($A),!t)for(var n in this)n.charAt(0)==="t"&&nu.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=zr)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if(n.type==="throw")throw n.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(l,c){return o.type="throw",o.arg=t,n.next=l,c&&(n.method="next",n.arg=zr),!!c}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if(s.tryLoc==="root")return i("end");if(s.tryLoc<=this.prev){var a=nu.call(s,"catchLoc"),u=nu.call(s,"finallyLoc");if(a&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else if(u){if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,n){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&nu.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var s=r;break}}s&&(t==="break"||t==="continue")&&s.tryLoc<=n&&n<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=n,s?(this.method="next",this.next=s.finallyLoc,er):this.complete(o)},complete:function(t,n){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&n&&(this.next=n),er},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),$A(i),er}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===t){var r=i.completion;if(r.type==="throw"){var s=r.arg;$A(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:kA(t),resultName:n,nextLoc:i},this.method==="next"&&(this.arg=zr),er}};var Ro={wrap:U4,isGeneratorFunction:H4,AsyncIterator:qm,mark:c1e,awrap:f1e,async:d1e,keys:p1e,values:kA};function m1e(e,t,n){var i=e.open(t),r=1e4,s=250,o=new URL(t),a=o.origin,u=~~(r/s);function l(f){f.source===i&&(u=0,e.removeEventListener("message",l,!1))}e.addEventListener("message",l,!1);function c(){u<=0||(i.postMessage(n,a),setTimeout(c,s),u-=1)}setTimeout(c,s)}var y1e=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper.fit-x {
    width: 100%; }
  .vega-embed .chart-wrapper.fit-y {
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function X4(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(var r=0,s=n;r<s.length;r++){var o=s[r];v1e(e,o)}return e}function v1e(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];Kl(e,r,t[r],!0)}}var DA;function K4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function jo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?K4(Object(n),!0).forEach(function(i){a1e(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K4(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Lo=foe,Ld=dme,Wm=typeof window!="undefined"?window:void 0;Ld===void 0&&Wm!==null&&Wm!==void 0&&(DA=Wm.vl)!==null&&DA!==void 0&&DA.compile&&(Ld=Wm.vl);var b1e={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},x1e={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Pd={vega:"Vega","vega-lite":"Vega-Lite"},Gm={vega:Lo.version,"vega-lite":Ld?Ld.version:"not available"},w1e={vega:e=>e,"vega-lite":(e,t)=>Ld.compile(e,{config:t}).spec},E1e=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,_1e="chart-wrapper";function A1e(e){return typeof e=="function"}function J4(e,t,n,i){var r="<html><head>".concat(t,'</head><body><pre><code class="json">'),s="</code></pre>".concat(n,"</body></html>"),o=window.open("");o.document.write(r+e+s),o.document.title="".concat(Pd[i]," JSON Source")}function O1e(e,t){if(e.$schema){var n=F4(e.$schema);if(t&&t!==n.library){var i;console.warn("The given visualization spec is written in ".concat(Pd[n.library],", but mode argument sets ").concat((i=Pd[t])!==null&&i!==void 0?i:t,"."))}var r=n.library;return vO.satisfies(Gm[r],"^".concat(n.version.slice(1)))||console.warn("The input spec uses ".concat(Pd[r]," ").concat(n.version,", but the current version of ").concat(Pd[r]," is v").concat(Gm[r],".")),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t!=null?t:"vega"}function S1e(e){return!!(e&&"load"in e)}function Q4(e){return S1e(e)?e:Lo.loader(e)}function Z4(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function k1e(e,t){return MA.apply(this,arguments)}function MA(){return MA=Lm(Ro.mark(function e(t,n){var i,r,s,o,a,u,l,c,f,d,h=arguments;return Ro.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(s=h.length>2&&h[2]!==void 0?h[2]:{},!_e(n)){p.next=10;break}return a=Q4(s.loader),p.t0=JSON,p.next=6,a.load(n);case 6:p.t1=p.sent,o=p.t0.parse.call(p.t0,p.t1),p.next=11;break;case 10:o=n;case 11:return u=Z4(o).loader,(!a||u)&&(a=Q4((l=s.loader)!==null&&l!==void 0?l:u)),p.next=15,e9(Z4(o),a);case 15:return c=p.sent,p.next=18,e9(s,a);case 18:return f=p.sent,d=jo(jo({},X4(f,c)),{},{config:nh((i=f.config)!==null&&i!==void 0?i:{},(r=c.config)!==null&&r!==void 0?r:{})}),p.next=22,$1e(t,o,d,a);case 22:return p.abrupt("return",p.sent);case 23:case"end":return p.stop()}},e)})),MA.apply(this,arguments)}function e9(e,t){return TA.apply(this,arguments)}function TA(){return TA=Lm(Ro.mark(function e(t,n){var i,r,s;return Ro.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!_e(t.config)){a.next=8;break}return a.t1=JSON,a.next=4,n.load(t.config);case 4:a.t2=a.sent,a.t0=a.t1.parse.call(a.t1,a.t2),a.next=9;break;case 8:a.t0=(i=t.config)!==null&&i!==void 0?i:{};case 9:if(r=a.t0,!_e(t.patch)){a.next=18;break}return a.t4=JSON,a.next=14,n.load(t.patch);case 14:a.t5=a.sent,a.t3=a.t4.parse.call(a.t4,a.t5),a.next=19;break;case 18:a.t3=t.patch;case 19:return s=a.t3,a.abrupt("return",jo(jo(jo({},t),s?{patch:s}:{}),r?{config:r}:{}));case 21:case"end":return a.stop()}},e)})),TA.apply(this,arguments)}function C1e(e){var t=e.getRootNode?e.getRootNode():document;if(t instanceof ShadowRoot)return{root:t,rootContainer:t};var n;return{root:document,rootContainer:(n=document.head)!==null&&n!==void 0?n:document.body}}function $1e(e,t){return NA.apply(this,arguments)}function NA(){return NA=Lm(Ro.mark(function e(t,n){var i,r,s,o,a,u,l,c,f,d,h,g,p,m,y,v,b,x,E,_,w,A,S,O,C,k,F,j,$,R,L,U,H,ae,De,Oe,Ze,Be,st,sn,Ai,si,G,oe,he,I,lt,ve,gt,ot=arguments;return Ro.wrap(function(Ur){for(;;)switch(Ur.prev=Ur.next){case 0:if(gt=function(){Oe&&document.removeEventListener("click",Oe),R.finalize()},c=ot.length>2&&ot[2]!==void 0?ot[2]:{},f=ot.length>3?ot[3]:void 0,d=c.theme?nh(Jme[c.theme],(i=c.config)!==null&&i!==void 0?i:{}):c.config,h=E1(c.actions)?c.actions:X4({},b1e,(r=c.actions)!==null&&r!==void 0?r:{}),g=jo(jo({},x1e),c.i18n),p=(s=c.renderer)!==null&&s!==void 0?s:"canvas",m=(o=c.logLevel)!==null&&o!==void 0?o:Lo.Warn,y=(a=c.downloadFileName)!==null&&a!==void 0?a:"visualization",v=typeof t=="string"?document.querySelector(t):t,v){Ur.next=12;break}throw new Error("".concat(t," does not exist"));case 12:return c.defaultStyle!==!1&&(b="vega-embed-style",x=C1e(v),E=x.root,_=x.rootContainer,E.getElementById(b)||(w=document.createElement("style"),w.id=b,w.innerText=c.defaultStyle===void 0||c.defaultStyle===!0?y1e.toString():c.defaultStyle,_.appendChild(w))),A=O1e(n,c.mode),S=w1e[A](n,d),A==="vega-lite"&&S.$schema&&(O=F4(S.$schema),vO.satisfies(Gm.vega,"^".concat(O.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(O.version,", but current version is v").concat(Gm.vega,"."))),v.classList.add("vega-embed"),h&&v.classList.add("has-actions"),v.innerHTML="",C=v,h&&(k=document.createElement("div"),k.classList.add(_1e),v.appendChild(k),C=k),F=c.patch,F&&(F instanceof Function?S=F(S):S=Bd(S,F,!0,!1).newDocument),c.formatLocale&&Lo.formatLocale(c.formatLocale),c.timeFormatLocale&&Lo.timeFormatLocale(c.timeFormatLocale),j=c.ast,$=Lo.parse(S,A==="vega-lite"?{}:d,{ast:j}),R=new(c.viewClass||Lo.View)($,jo({loader:f,logLevel:m,renderer:p},j?{expr:(u=(l=Lo.expressionInterpreter)!==null&&l!==void 0?l:c.expr)!==null&&u!==void 0?u:woe}:{})),R.addSignalListener("autosize",(tr,On)=>{var Gn=On.type;Gn=="fit-x"?(C.classList.add("fit-x"),C.classList.remove("fit-y")):Gn=="fit-y"?(C.classList.remove("fit-x"),C.classList.add("fit-y")):Gn=="fit"?C.classList.add("fit-x","fit-y"):C.classList.remove("fit-x","fit-y")}),c.tooltip!==!1&&(A1e(c.tooltip)?L=c.tooltip:L=new o1e(c.tooltip===!0?{}:c.tooltip).call,R.tooltip(L)),U=c.hover,U===void 0&&(U=A==="vega"),U&&(H=typeof U=="boolean"?{}:U,ae=H.hoverSet,De=H.updateSet,R.hover(ae,De)),c&&(c.width!=null&&R.width(c.width),c.height!=null&&R.height(c.height),c.padding!=null&&R.padding(c.padding)),Ur.next=36,R.initialize(C,c.bind).runAsync();case 36:if(h!==!1){if(Ze=v,c.defaultStyle!==!1&&(Be=document.createElement("details"),Be.title=g.CLICK_TO_VIEW_ACTIONS,v.append(Be),Ze=Be,st=document.createElement("summary"),st.innerHTML=E1e,Be.append(st),Oe=tr=>{Be.contains(tr.target)||Be.removeAttribute("open")},document.addEventListener("click",Oe)),sn=document.createElement("div"),Ze.append(sn),sn.classList.add("vega-actions"),h===!0||h.export!==!1)for(Ai=function(){var On=G[si];if(h===!0||h.export===!0||h.export[On]){var Gn=g["".concat(On.toUpperCase(),"_ACTION")],iu=document.createElement("a");iu.text=Gn,iu.href="#",iu.target="_blank",iu.download="".concat(y,".").concat(On),iu.addEventListener("mousedown",function(){var t9=Lm(Ro.mark(function RA(n9){var jA;return Ro.wrap(function(zl){for(;;)switch(zl.prev=zl.next){case 0:return n9.preventDefault(),zl.next=3,R.toImageURL(On,c.scaleFactor);case 3:jA=zl.sent,this.href=jA;case 5:case"end":return zl.stop()}},RA,this)}));return function(RA){return t9.apply(this,arguments)}}()),sn.append(iu)}},si=0,G=["svg","png"];si<G.length;si++)Ai();(h===!0||h.source!==!1)&&(oe=document.createElement("a"),oe.text=g.SOURCE_ACTION,oe.href="#",oe.addEventListener("click",function(tr){var On,Gn;J4(Zm(n),(On=c.sourceHeader)!==null&&On!==void 0?On:"",(Gn=c.sourceFooter)!==null&&Gn!==void 0?Gn:"",A),tr.preventDefault()}),sn.append(oe)),A==="vega-lite"&&(h===!0||h.compiled!==!1)&&(he=document.createElement("a"),he.text=g.COMPILED_ACTION,he.href="#",he.addEventListener("click",function(tr){var On,Gn;J4(Zm(S),(On=c.sourceHeader)!==null&&On!==void 0?On:"",(Gn=c.sourceFooter)!==null&&Gn!==void 0?Gn:"","vega"),tr.preventDefault()}),sn.append(he)),(h===!0||h.editor!==!1)&&(lt=(I=c.editorUrl)!==null&&I!==void 0?I:"https://vega.github.io/editor/",ve=document.createElement("a"),ve.text=g.EDITOR_ACTION,ve.href="#",ve.addEventListener("click",function(tr){m1e(window,lt,{config:d,mode:A,renderer:p,spec:Zm(n)}),tr.preventDefault()}),sn.append(ve))}return Ur.abrupt("return",{view:R,spec:n,vgSpec:S,finalize:gt});case 38:case"end":return Ur.stop()}},e)})),NA.apply(this,arguments)}export{k1e as e};
